# ==================================================
# Path: E:\UIT\HK8\NT118\Project\T9_Car_Rental\app\src\main\java\com\uit\carrental
# Detected tech: java
# ==================================================

## DIRECTORY STRUCTURE
```
carrental/
├── ActivityPages/
│   ├── AdminMainActivity.java
│   ├── CustomerMainActivity.java
│   ├── OwnerMainActivity.java
│   └── StartAppActivity.java
├── Adapter/
│   ├── ActivityAdapter.java
│   ├── BookingAdapter.java
│   ├── MessageAdapter.java
│   ├── NotificationAdapter.java
│   ├── OwnerActivityAdapter.java
│   ├── OwnerNotificationAdapter.java
│   ├── OwnerVehicleAdapter.java
│   ├── SplashPagerAdapter.java
│   ├── UserAdapter.java
│   ├── VehicleAdapter.java
│   └── ViewPagerAdapter.java
├── FragmentPages/
│   ├── Admin/
│   │   ├── AdminSettingsFragment.java
│   │   ├── AdminStatisticsFragment.java
│   │   ├── AdminUserListFragment.java
│   │   ├── AdminVehicleListFragment.java
│   │   ├── RequestSupplementDialogFragment.java
│   │   ├── SimpleBarChart.java
│   │   ├── UserStatsActivity.java
│   │   ├── UserStatsFragment.java
│   │   └── VehicleFilterFragment.java
│   ├── Customer/
│   │   ├── ChatFragment.java
│   │   ├── CustomerActivityFragment.java
│   │   ├── CustomerHomeFragment.java
│   │   ├── CustomerNotificationFragment.java
│   │   ├── CustomerSettingFragment.java
│   │   └── CustomerVehicleFilterFragment.java
│   ├── Owner/
│   │   ├── OwnerActivityFragment.java
│   │   ├── OwnerNotificationsFragment.java
│   │   ├── OwnerSettingFragment.java
│   │   └── OwnerVehicleFragment.java
│   └── SplashFragment.java
├── Model/
│   ├── Booking.java
│   ├── CreateOrder.java
│   ├── Message.java
│   ├── Notification.java
│   ├── Order.java
│   ├── RentalHistory.java
│   ├── User.java
│   ├── UserClient.java
│   ├── Vehicle.java
│   └── onClickInterface.java
├── Repository/
│   └── VehicleRepository.java
└── Service/
    ├── Activity/
    │   ├── CustomerActivityDetail.java
    │   └── OwnerActivityDetail.java
    ├── Api/
    │   └── CloudinaryApi.java
    ├── Booking/
    │   ├── CarDetailActivity.java
    │   ├── CustomerBookingDetailActivity.java
    │   ├── OwnerBookingDetailActivity.java
    │   ├── RequestSuccessActivity.java
    │   ├── ScheduleSelect.java
    │   └── ScheduleSelectViewModel.java
    ├── UserAuthentication/
    │   ├── CCCDActivity.java
    │   ├── ForgotPasswordActivity.java
    │   ├── GGVerrifyPhone.java
    │   ├── LoginActivity.java
    │   ├── ProfileManagement.java
    │   ├── RegisterActivity.java
    │   ├── UpdatePassword.java
    │   ├── UserProfile.java
    │   └── ValidatePhoneActivity.java
    ├── Vehicle/
    │   ├── AddVehicleActivity.java
    │   ├── AdminVehicleDetailActivity.java
    │   ├── UpdateVehicleActivity.java
    │   ├── VehicleCardActivity.java
    │   └── VehicleDetailActivity.java
    └── ZaloPay/
        ├── Api/
        │   ├── CreateOrder.java
        │   └── HttpProvider.java
        ├── Constant/
        │   └── AppInfo.java
        ├── Helper/
        │   ├── HMac/
        │   │   ├── HMacUtil.java
        │   │   └── HexStringUtil.java
        │   └── Helpers.java
        └── ZPDK/
            └── zpdk-release-v3.1.aar
```

## FILE CONTENTS

### ActivityPages\AdminMainActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.os.Bundle;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import com.google.android.material.bottomnavigation.BottomNavigationView;
import com.uit.carrental.FragmentPages.Admin.AdminSettingsFragment;
import com.uit.carrental.FragmentPages.Admin.AdminStatisticsFragment;
import com.uit.carrental.FragmentPages.Admin.AdminUserListFragment;
import com.uit.carrental.FragmentPages.Admin.AdminVehicleListFragment;
import com.uit.carrental.R;

public class AdminMainActivity extends AppCompatActivity {

    private static final String TAG_USERS = "users";
    private static final String TAG_VEHICLES = "vehicles";
    private static final String TAG_STATISTICS = "statistics";
    private static final String TAG_SETTINGS = "settings";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_admin_main);

        BottomNavigationView bottomNavigationView = findViewById(R.id.bottom_navigation_view);
        bottomNavigationView.setBackground(null);
        bottomNavigationView.setOnItemSelectedListener(item -> {
            String tag;
            Fragment fragment = null;
            int itemId = item.getItemId();

            if (itemId == R.id.users) {
                tag = TAG_USERS;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_USERS);
                if (fragment == null) fragment = new AdminUserListFragment();
            } else if (itemId == R.id.vehicles) {
                tag = TAG_VEHICLES;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_VEHICLES);
                if (fragment == null) fragment = new AdminVehicleListFragment();
            } else if (itemId == R.id.statistics) {
                tag = TAG_STATISTICS;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_STATISTICS);
                if (fragment == null) fragment = new AdminStatisticsFragment();
            } else if (itemId == R.id.settings) {
                tag = TAG_SETTINGS;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_SETTINGS);
                if (fragment == null) fragment = new AdminSettingsFragment();
            } else {
                return false;
            }

            showFragment(fragment, tag);
            return true;
        });

        // Load default (Users)
        if (savedInstanceState == null) {
            showFragment(new AdminUserListFragment(), TAG_USERS);
            bottomNavigationView.setSelectedItemId(R.id.users);
        }
    }

    private void showFragment(Fragment fragment, String tag) {
        FragmentManager fragmentManager = getSupportFragmentManager();
        fragmentManager.beginTransaction()
                .replace(R.id.frame_layout_admin, fragment, tag)
                .addToBackStack(tag)
                .commit();
    }
}
```

### ActivityPages\CustomerMainActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import com.google.android.material.bottomnavigation.BottomNavigationView;
import com.uit.carrental.FragmentPages.Customer.CustomerActivityFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerHomeFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerNotificationFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerSettingFragment;
import com.uit.carrental.R;
import com.uit.carrental.databinding.CustomerActivityMainBinding;

public class CustomerMainActivity extends AppCompatActivity {

    private static final String TAG = "CustomerMainActivity";
    private CustomerActivityMainBinding binding;
    private static final String TAG_HOME = "home";
    private static final String TAG_ACTIVITY = "activity";
    private static final String TAG_NOTIFICATIONS = "notifications";
    private static final String TAG_SETTING = "setting";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = CustomerActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());

        binding.bottomNavigationView.setBackground(null);
        binding.bottomNavigationView.setOnItemSelectedListener(item -> {
            String tag;
            Fragment fragment;
            int itemId = item.getItemId();

            if (itemId == R.id.home) {
                tag = TAG_HOME;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_HOME);
                if (fragment == null) fragment = new CustomerHomeFragment();
            } else if (itemId == R.id.activity) {
                tag = TAG_ACTIVITY;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_ACTIVITY);
                if (fragment == null) fragment = new CustomerActivityFragment();
            } else if (itemId == R.id.notifications) {
                tag = TAG_NOTIFICATIONS;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_NOTIFICATIONS);
                if (fragment == null) fragment = new CustomerNotificationFragment();
            } else if (itemId == R.id.setting) {
                tag = TAG_SETTING;
                fragment = getSupportFragmentManager().findFragmentByTag(TAG_SETTING);
                if (fragment == null) fragment = new CustomerSettingFragment();
            } else {
                return false;
            }

            showFragment(fragment, tag);
            return true;
        });

        // Xử lý intent từ các activity khác
        handleIntent(getIntent());
    }

    @Override
    protected void onNewIntent(Intent intent) {
        super.onNewIntent(intent);
        setIntent(intent);
        handleIntent(intent);
    }

    private void handleIntent(Intent intent) {
        String fragment = intent.getStringExtra("fragment");
        Log.d(TAG, "Xử lý intent, fragment: " + fragment);
        Fragment selectedFragment = null;
        String tag = TAG_HOME;
        int navItemId = R.id.home;

        if ("home".equals(fragment)) {
            selectedFragment = getSupportFragmentManager().findFragmentByTag(TAG_HOME);
            if (selectedFragment == null) selectedFragment = new CustomerHomeFragment();
            tag = TAG_HOME;
            navItemId = R.id.home;
        } else if ("notifications".equals(fragment)) {
            selectedFragment = getSupportFragmentManager().findFragmentByTag(TAG_NOTIFICATIONS);
            if (selectedFragment == null) selectedFragment = new CustomerNotificationFragment();
            tag = TAG_NOTIFICATIONS;
            navItemId = R.id.notifications;
        } else if ("activity".equals(fragment)) {
            selectedFragment = getSupportFragmentManager().findFragmentByTag(TAG_ACTIVITY);
            if (selectedFragment == null) selectedFragment = new CustomerActivityFragment();
            tag = TAG_ACTIVITY;
            navItemId = R.id.activity;
        } else if ("setting".equals(fragment)) {
            selectedFragment = getSupportFragmentManager().findFragmentByTag(TAG_SETTING);
            if (selectedFragment == null) selectedFragment = new CustomerSettingFragment();
            tag = TAG_SETTING;
            navItemId = R.id.setting;
        } else if (getSupportFragmentManager().findFragmentByTag(TAG_HOME) == null) {
            selectedFragment = new CustomerHomeFragment();
        }

        if (selectedFragment != null) {
            showFragment(selectedFragment, tag);
            binding.bottomNavigationView.setSelectedItemId(navItemId);
        }
    }

    private void showFragment(Fragment fragment, String tag) {
        FragmentManager fragmentManager = getSupportFragmentManager();
        fragmentManager.popBackStack(null, FragmentManager.POP_BACK_STACK_INCLUSIVE);
        fragmentManager.beginTransaction()
                .replace(R.id.frame_layout_customer, fragment, tag)
                .commit();
    }
}
```

### ActivityPages\OwnerMainActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;

import com.uit.carrental.FragmentPages.Owner.OwnerActivityFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerNotificationsFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerSettingFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerVehicleFragment;
import com.uit.carrental.R;
import com.uit.carrental.databinding.OwnerActivityMainBinding;

public class OwnerMainActivity extends AppCompatActivity {

    OwnerActivityMainBinding binding;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = OwnerActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        replaceFragment(new OwnerVehicleFragment());
        binding.bottomNavigationView.setBackground(null);

        binding.bottomNavigationView.setOnItemSelectedListener(item -> {
            int itemId = item.getItemId();

            if (itemId == R.id.vehicle) {
                replaceFragment(new OwnerVehicleFragment());
            } else if (itemId == R.id.activity) {
                replaceFragment(new OwnerActivityFragment());
            } else if (itemId == R.id.notifications) {
                replaceFragment(new OwnerNotificationsFragment());
            } else if (itemId == R.id.setting) {
                replaceFragment(new OwnerSettingFragment());
            }

            return true;
        });

    }

    private void replaceFragment(Fragment fragment)
    {
        FragmentManager fragmentManager = getSupportFragmentManager();
        FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
        fragmentTransaction.replace(R.id.frame_layout_owner, fragment);
        fragmentTransaction.commit();
    }
}
```

### ActivityPages\StartAppActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.content.Intent;
import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.viewpager2.widget.ViewPager2;

import com.uit.carrental.Adapter.SplashPagerAdapter;
import com.uit.carrental.FragmentPages.SplashFragment;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;

public class StartAppActivity extends AppCompatActivity implements SplashFragment.OnNextButtonClickListener {

    private ViewPager2 viewPager;
    private static final int TOTAL_SPLASHES = 4;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_splash);

        viewPager = findViewById(R.id.splash_viewpager);
        SplashPagerAdapter adapter = new SplashPagerAdapter(this);
        viewPager.setAdapter(adapter);

        viewPager.setPageTransformer((page, position) -> {
            page.setAlpha(1 - Math.abs(position));
            page.setTranslationX(-position * page.getWidth());
        });
    }

    @Override
    public void onNextButtonClicked(int position) {
        if (position < TOTAL_SPLASHES - 1) {
            viewPager.setCurrentItem(position + 1, true);
        } else {
            startActivity(new Intent(this, LoginActivity.class));
            overridePendingTransition(R.anim.anim_in_right, R.anim.anim_out_left);
            finish();
        }
    }
}
```

### Adapter\ActivityAdapter.java
```java
//package com.uit.carrental.Adapter;
//
//import android.content.Intent;
//import android.view.LayoutInflater;
//import android.view.View;
//import android.view.ViewGroup;
//import android.widget.TextView;
//
//import androidx.annotation.NonNull;
//import androidx.recyclerview.widget.RecyclerView;
//
//import com.google.firebase.firestore.FirebaseFirestore;
//import com.google.firebase.firestore.QueryDocumentSnapshot;
//import com.uit.carrental.FragmentPages.Customer.CustomerActivityFragment;
//import com.uit.carrental.Model.User;
//import com.uit.carrental.R;
//import com.uit.carrental.Service.Activity.CustomerActivityDetail;
//
//import java.util.ArrayList;
//
//public class ActivityAdapter extends RecyclerView.Adapter<ActivityAdapter.MyViewHolder> {
//
//    private final CustomerActivityFragment customerActivityFragment;
//    private Activity noti;
//    private final ArrayList<Activity> mNoti;
//    private final FirebaseFirestore dtb;
//    private String name, ownerId; // Thay ProvideID bằng ownerId
//
//    public ActivityAdapter(CustomerActivityFragment mContext, ArrayList<Activity> mNoti) {
//        this.customerActivityFragment = mContext;
//        this.mNoti = mNoti;
//        this.dtb = FirebaseFirestore.getInstance();
//    }
//
//    @NonNull
//    @Override
//    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
//        View v = LayoutInflater.from(customerActivityFragment.getActivity()).inflate(R.layout.item_activity, parent, false);
//        return new MyViewHolder(v);
//    }
//
//    @Override
//    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
//        noti = mNoti.get(position);
//        ownerId = noti.getOwnerId(); // Thay getProvider_id bằng getOwnerId
//        getUser(ownerId); // Thay ProvideID bằng ownerId
//        holder.name.setText(name != null ? name : "Đang tải...");
//        holder.id.setText(noti.getNoti_id());
//
//        // Hiển thị trạng thái
//        switch (noti.getStatus()) {
//            case "Dang cho":
//                holder.status.setText("Nhà cung cấp chưa xác nhận");
//                break;
//            case "Thanh toan":
//                holder.status.setText("Đang chờ thanh toán");
//                break;
//            case "Khong xac nhan":
//                holder.status.setText("Nhà cung cấp không xác nhận");
//                break;
//            case "Da thanh toan":
//                holder.status.setText("Đã thanh toán");
//                break;
//            default:
//                holder.status.setText("Đã xác nhận");
//                break;
//        }
//
//        // Sự kiện nhấn item
//        holder.itemView.setOnClickListener(view -> {
//            Intent intent = new Intent(customerActivityFragment.getActivity(), CustomerActivityDetail.class);
//            intent.putExtra("NotiID", noti.getNoti_id());
//            customerActivityFragment.startActivity(intent);
//        });
//    }
//
//    @Override
//    public int getItemCount() {
//        return mNoti.size();
//    }
//
//    public static class MyViewHolder extends RecyclerView.ViewHolder {
//        TextView name, status, id;
//
//        public MyViewHolder(@NonNull View itemView) {
//            super(itemView);
//            name = itemView.findViewById(R.id.tv_noti_name);
//            status = itemView.findViewById(R.id.tv_Status);
//            id = itemView.findViewById(R.id.tv_noti_ID);
//        }
//    }
//
//    private void getUser(String ownerId) { // Thay ProvideID bằng ownerId
//        dtb.collection("Users")
//                .whereEqualTo("user_id", ownerId)
//                .get()
//                .addOnCompleteListener(task -> {
//                    if (task.isSuccessful()) {
//                        for (QueryDocumentSnapshot document : task.getResult()) {
//                            User user = new User();
//                            user.setUserId(document.getString("user_id"));
//                            user.setUsername(document.getString("username"));
//                            user.setEmail(document.getString("email"));
//                            user.setPhoneNumber(document.getString("phoneNumber"));
//                            name = user.getUsername();
//                            notifyDataSetChanged(); // Cập nhật giao diện khi có tên
//                        }
//                    }
//                });
//    }
//}
```

### Adapter\BookingAdapter.java
```java
package com.uit.carrental.Adapter;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class BookingAdapter extends RecyclerView.Adapter<BookingAdapter.ViewHolder> {

    private final List<Booking> bookingList;
    private final OnBookingClickListener clickListener;
    private final FirebaseFirestore db;
    private final Map<String, String> vehicleCache;

    public interface OnBookingClickListener {
        void onBookingClick(Booking booking);
    }

    public BookingAdapter(List<Booking> bookingList, OnBookingClickListener clickListener) {
        this.bookingList = bookingList;
        this.clickListener = clickListener;
        this.db = FirebaseFirestore.getInstance();
        this.vehicleCache = new HashMap<>();
    }

    @NonNull
    @Override
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_activity, parent, false);
        return new ViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
        Booking booking = bookingList.get(position);
        String vehicleId = booking.getVehicleId();

        // Lấy tên xe từ cache hoặc Firestore
        if (vehicleCache.containsKey(vehicleId)) {
            holder.tvVehicleName.setText(vehicleCache.get(vehicleId));
        } else {
            db.collection("Vehicles").document(vehicleId)
                    .get()
                    .addOnSuccessListener(document -> {
                        if (document.exists()) {
                            Vehicle vehicle = document.toObject(Vehicle.class);
                            String vehicleName = vehicle != null ? vehicle.getVehicleName() : "Xe #" + vehicleId;
                            vehicleCache.put(vehicleId, vehicleName);
                            holder.tvVehicleName.setText(vehicleName);
                        } else {
                            holder.tvVehicleName.setText("Xe #" + vehicleId);
                        }
                    });
        }

        // Hiển thị trạng thái
        String statusText;
        switch (booking.getStatus()) {
            case "pending": statusText = "Chưa xác nhận"; break;
            case "confirmed": statusText = "Đã xác nhận"; break;
            case "rejected": statusText = "Bị từ chối"; break;
            case "paid": statusText = "Đã thanh toán"; break;
            case "completed": statusText = "Đã hoàn thành"; break;
            case "cancelled": statusText = "Đã hủy"; break;
            default: statusText = booking.getStatus();
        }
        holder.tvStatus.setText(statusText);
        holder.tvBookingId.setText(booking.getBookingId());

        holder.itemView.setOnClickListener(v -> clickListener.onBookingClick(booking));
    }

    @Override
    public int getItemCount() {
        return bookingList.size();
    }

    static class ViewHolder extends RecyclerView.ViewHolder {
        TextView tvVehicleName, tvStatus, tvBookingId;

        ViewHolder(View itemView) {
            super(itemView);
            tvVehicleName = itemView.findViewById(R.id.tv_noti_name);
            tvStatus = itemView.findViewById(R.id.tv_Status);
            tvBookingId = itemView.findViewById(R.id.tv_noti_ID);
        }
    }
}

```

### Adapter\MessageAdapter.java
```java
package com.uit.carrental.Adapter;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.constraintlayout.widget.ConstraintLayout;
import androidx.recyclerview.widget.RecyclerView;
import com.uit.carrental.Model.Message;
import com.uit.carrental.R;
import java.util.List;

public class MessageAdapter extends RecyclerView.Adapter<MessageAdapter.MessageViewHolder> {
    private List<Message> messages;

    public MessageAdapter(List<Message> messages) {
        this.messages = messages;
    }

    @NonNull
    @Override
    public MessageViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.message_item, parent, false);
        return new MessageViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull MessageViewHolder holder, int position) {
        Message message = messages.get(position);
        holder.messageText.setText(message.getContent());

        ConstraintLayout.LayoutParams params = (ConstraintLayout.LayoutParams)
                holder.messageContainer.getLayoutParams();
        if (message.isUser()) {
            params.startToEnd = ConstraintLayout.LayoutParams.UNSET;
            params.endToEnd = ConstraintLayout.LayoutParams.PARENT_ID;
            params.setMarginEnd(8);
            holder.avatar.setVisibility(View.GONE);
            holder.messageContainer.setBackgroundResource(R.drawable.message_bubble_background_user);
        } else {
            params.startToEnd = holder.avatar.getId();
            params.endToEnd = ConstraintLayout.LayoutParams.UNSET;
            params.setMarginStart(8);
            holder.avatar.setVisibility(View.VISIBLE);
            holder.messageContainer.setBackgroundResource(R.drawable.message_bubble_background);
        }
        holder.messageContainer.setLayoutParams(params);
    }

    @Override
    public int getItemCount() {
        return messages.size();
    }

    static class MessageViewHolder extends RecyclerView.ViewHolder {
        ImageView avatar;
        LinearLayout messageContainer;
        TextView messageText;

        MessageViewHolder(@NonNull View itemView) {
            super(itemView);
            avatar = itemView.findViewById(R.id.avatar);
            messageContainer = itemView.findViewById(R.id.message_container);
            messageText = itemView.findViewById(R.id.message_text);
        }
    }
}
```

### Adapter\NotificationAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.Notification;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.VehicleDetailActivity;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

public class NotificationAdapter extends RecyclerView.Adapter<NotificationAdapter.ViewHolder> {

    private static final String TAG = "NotificationAdapter";
    private final List<Notification> notificationList = new ArrayList<>(); // Khởi tạo tại đây
    private final OnNotificationClickListener clickListener;
    private final FirebaseFirestore db;
    private final Map<String, String> userCache;

    public interface OnNotificationClickListener {
        void onNotificationClick(Notification notification);
    }

    public NotificationAdapter(List<Notification> initialList, OnNotificationClickListener clickListener) {
        this.clickListener = clickListener;
        this.db = FirebaseFirestore.getInstance();
        this.userCache = new HashMap<>();
        if (initialList != null) {
            this.notificationList.addAll(initialList);
        }
        Log.d(TAG, "Khởi tạo adapter, số thông báo ban đầu: " + notificationList.size());
    }

    @NonNull
    @Override
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_notification, parent, false);
        Log.d(TAG, "Tạo ViewHolder");
        return new ViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
        Notification notification = notificationList.get(position);
        Log.d(TAG, "Binding notification: " + notification.getNotificationId());

        holder.tvTitle.setText(notification.getTitle() != null ? notification.getTitle() : "");
        holder.tvMessage.setText(notification.getMessage() != null ? notification.getMessage() : "");
        Log.d(TAG, "Set title: " + notification.getTitle() + ", message: " + notification.getMessage());

        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());
        try {
            holder.tvTime.setText(notification.getCreatedAt() != null ?
                    sdf.format(notification.getCreatedAt().toDate()) : "Không có thời gian");
            Log.d(TAG, "Set time: " + holder.tvTime.getText());
        } catch (Exception e) {
            Log.e(TAG, "Lỗi định dạng thời gian: ", e);
            holder.tvTime.setText("Lỗi thời gian");
        }

        if (!notification.isRead()) {
            holder.tvStatus.setVisibility(View.VISIBLE);
            holder.tvStatus.setText(R.string.notifications);
            holder.tvStatus.setTextColor(holder.itemView.getContext().getResources().getColor(R.color.orange_pending));
            Log.d(TAG, "Set status: Chưa đọc");
        } else {
            holder.tvStatus.setVisibility(View.GONE);
            Log.d(TAG, "Set status: Đã đọc");
        }

        if (notification.getBookingId() != null && !notification.getBookingId().isEmpty()) {
            String bookingId = notification.getBookingId();
            if (userCache.containsKey(bookingId)) {
                holder.tvCustomerName.setText(userCache.get(bookingId));
                Log.d(TAG, "Set customerName from cache: " + userCache.get(bookingId));
            } else {
                db.collection("Bookings").document(bookingId)
                        .get()
                        .addOnSuccessListener(document -> {
                            if (document.exists()) {
                                Booking booking = document.toObject(Booking.class);
                                if (booking != null) {
                                    String customerId = booking.getCustomerId();
                                    db.collection("Users").document(customerId)
                                            .get()
                                            .addOnSuccessListener(userDoc -> {
                                                if (userDoc.exists()) {
                                                    String username = userDoc.getString("username");
                                                    userCache.put(bookingId, username != null ? username : "Unknown");
                                                    holder.tvCustomerName.setText(username != null ? username : "Unknown");
                                                    Log.d(TAG, "Set customerName from Firestore: " + username);
                                                } else {
                                                    holder.tvCustomerName.setText("Unknown");
                                                    Log.w(TAG, "User document not found: " + customerId);
                                                }
                                            })
                                            .addOnFailureListener(e -> {
                                                holder.tvCustomerName.setText("Unknown");
                                                Log.e(TAG, "Lỗi lấy user: ", e);
                                            });
                                } else {
                                    holder.tvCustomerName.setText("Unknown");
                                    Log.w(TAG, "Booking document not found: " + bookingId);
                                }
                            } else {
                                holder.tvCustomerName.setText("Unknown");
                                Log.w(TAG, "Booking document not found: " + bookingId);
                            }
                        })
                        .addOnFailureListener(e -> {
                            holder.tvCustomerName.setText("Unknown");
                            Log.e(TAG, "Lỗi lấy booking: ", e);
                        });
            }
        } else {
            holder.tvCustomerName.setVisibility(View.GONE);
            Log.d(TAG, "Ẩn customerName vì không có bookingId");
        }

        holder.itemView.setOnClickListener(v -> {
            Log.d(TAG, "Click notification: " + notification.getNotificationId());
            if (!notification.isRead()) {
                db.collection("Notifications").document(notification.getNotificationId())
                        .update("isRead", true)
                        .addOnSuccessListener(aVoid -> Log.d(TAG, "Đánh dấu thông báo đã đọc"))
                        .addOnFailureListener(e -> Log.e(TAG, "Lỗi cập nhật isRead: ", e));
                notification.setRead(true);
                notifyItemChanged(position);
            }

            if ("vehicle_verification".equals(notification.getType()) && notification.getVehicleId() != null) {
                Intent intent = new Intent(holder.itemView.getContext(), VehicleDetailActivity.class);
                intent.putExtra("vehicleId", notification.getVehicleId());
                holder.itemView.getContext().startActivity(intent);
            }

            clickListener.onNotificationClick(notification);
        });
    }

    @Override
    public int getItemCount() {
        int count = notificationList.size();
        Log.d(TAG, "Số item trong RecyclerView: " + count);
        return count;
    }

    public void updateData(List<Notification> newNotificationList) {
        Log.d(TAG, "Cập nhật dữ liệu adapter, số thông báo: " + (newNotificationList != null ? newNotificationList.size() : 0));
        notificationList.clear();
        if (newNotificationList != null) {
            notificationList.addAll(newNotificationList);
            Log.d(TAG, "Đã thêm " + newNotificationList.size() + " thông báo vào notificationList");
        }
        notifyDataSetChanged();
        Log.d(TAG, "Gọi notifyDataSetChanged, số item hiện tại: " + notificationList.size());
    }

    static class ViewHolder extends RecyclerView.ViewHolder {
        TextView tvTitle, tvCustomerName, tvMessage, tvTime, tvStatus;

        ViewHolder(View itemView) {
            super(itemView);
            tvTitle = itemView.findViewById(R.id.tv_title);
            tvCustomerName = itemView.findViewById(R.id.tv_customer_name);
            tvMessage = itemView.findViewById(R.id.tv_noti_text);
            tvTime = itemView.findViewById(R.id.tv_time_range);
            tvStatus = itemView.findViewById(R.id.tv_status);
            Log.d(TAG, "Khởi tạo ViewHolder");
        }
    }
}
```

### Adapter\OwnerActivityAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.FragmentPages.Owner.OwnerActivityFragment;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.OwnerActivityDetail;
import com.google.firebase.firestore.FirebaseFirestore;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class OwnerActivityAdapter extends RecyclerView.Adapter<OwnerActivityAdapter.MyViewHolder> {

    private final OwnerActivityFragment ownerActivityFragment;
    private final List<Booking> bookingList;
    private final Map<String, String> userCache; // Cache tên người dùng
    private final FirebaseFirestore db;

    public OwnerActivityAdapter(OwnerActivityFragment context, List<Booking> bookingList) {
        this.ownerActivityFragment = context;
        this.bookingList = bookingList != null ? bookingList : new ArrayList<>();
        this.userCache = new HashMap<>();
        this.db = FirebaseFirestore.getInstance();
    }

    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(ownerActivityFragment.getActivity()).inflate(R.layout.item_activity, parent, false);
        return new MyViewHolder(v);
    }

    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
        Booking booking = bookingList.get(position);
        String customerId = booking.getCustomerId();

        // Lấy tên người dùng từ cache hoặc Firestore
        if (userCache.containsKey(customerId)) {
            holder.name.setText(userCache.get(customerId));
        } else {
            db.collection("Users").document(customerId)
                    .get()
                    .addOnSuccessListener(document -> {
                        if (document.exists()) {
                            String username = document.getString("username");
                            userCache.put(customerId, username != null ? username : "Unknown");
                            holder.name.setText(username != null ? username : "Unknown");
                        }
                    });
        }

        holder.id.setText(booking.getBookingId());
        switch (booking.getStatus()) {
            case "pending":
                holder.status.setText("Nhà cung cấp chưa xác nhận");
                break;
            case "confirmed":
                holder.status.setText("Đã xác nhận");
                break;
            case "rejected":
                holder.status.setText("Nhà cung cấp không xác nhận");
                break;
            case "paid":
                holder.status.setText("Đã thanh toán");
                break;
            case "completed":
                holder.status.setText("Đã hoàn thành");
                break;
            default:
                holder.status.setText(booking.getStatus());
        }

        holder.itemView.setOnClickListener(v -> {
            Intent intent = new Intent(ownerActivityFragment.getActivity(), OwnerActivityDetail.class);
            intent.putExtra("NotiID", booking.getBookingId());
            ownerActivityFragment.startActivity(intent);
        });
    }

    @Override
    public int getItemCount() {
        return bookingList.size();
    }

    public void updateData(List<Booking> newBookingList) {
        bookingList.clear();
        if (newBookingList != null) {
            bookingList.addAll(newBookingList);
        }
        notifyDataSetChanged();
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {
        TextView name, status, id;

        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            name = itemView.findViewById(R.id.tv_noti_name);
            status = itemView.findViewById(R.id.tv_Status);
            id = itemView.findViewById(R.id.tv_noti_ID);
        }
    }
}

```

### Adapter\OwnerNotificationAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.FragmentPages.Owner.OwnerNotificationsFragment;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.OwnerActivityDetail;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

public class OwnerNotificationAdapter extends RecyclerView.Adapter<OwnerNotificationAdapter.MyViewHolder> {

    private static final String TAG = "OwnerNotificationAdapter";
    private final OwnerNotificationsFragment ownerNotificationsFragment;
    private final List<Booking> bookingList = new ArrayList<>();
    private final Map<String, String> userCache;
    private final FirebaseFirestore db;

    public OwnerNotificationAdapter(OwnerNotificationsFragment context, List<Booking> initialList) {
        this.ownerNotificationsFragment = context;
        if (initialList != null) {
            this.bookingList.addAll(initialList);
        }
        this.userCache = new HashMap<>();
        this.db = FirebaseFirestore.getInstance();
        Log.d(TAG, "Khởi tạo adapter, số booking ban đầu: " + bookingList.size());
    }

    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(ownerNotificationsFragment.getActivity()).inflate(R.layout.item_notification, parent, false);
        Log.d(TAG, "Tạo ViewHolder");
        return new MyViewHolder(v);
    }

    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
        Booking booking = bookingList.get(position);
        String customerId = booking.getCustomerId();
        Log.d(TAG, "Binding booking: " + booking.getBookingId() + ", customerId: " + customerId);

        if (userCache.containsKey(customerId)) {
            holder.customerName.setText(userCache.get(customerId));
            Log.d(TAG, "Set customerName from cache: " + userCache.get(customerId));
        } else {
            db.collection("Users").document(customerId)
                    .get()
                    .addOnSuccessListener(document -> {
                        if (document.exists()) {
                            String username = document.getString("username");
                            userCache.put(customerId, username != null ? username : "Unknown");
                            holder.customerName.setText(username != null ? username : "Unknown");
                            Log.d(TAG, "Set customerName from Firestore: " + username);
                        } else {
                            holder.customerName.setText("Unknown");
                            Log.w(TAG, "User document not found: " + customerId);
                        }
                    })
                    .addOnFailureListener(e -> {
                        holder.customerName.setText("Unknown");
                        Log.e(TAG, "Lỗi lấy user: ", e);
                    });
        }

        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());
        try {
            String timeRange = String.format("Từ %s đến %s",
                    sdf.format(booking.getStartTime().toDate()),
                    sdf.format(booking.getEndTime().toDate()));
            holder.timeRange.setText(timeRange);
            Log.d(TAG, "Set timeRange: " + timeRange);
        } catch (Exception e) {
            Log.e(TAG, "Lỗi định dạng thời gian: ", e);
            holder.timeRange.setText("Lỗi thời gian");
        }

        String statusText;
        switch (booking.getStatus()) {
            case "pending": statusText = "Bạn vừa nhận một yêu cầu mới"; break;
            case "confirmed": statusText = "Yêu cầu đã được xác nhận"; break;
            case "rejected": statusText = "Yêu cầu đã bị từ chối"; break;
            case "paid": statusText = "Yêu cầu đã được thanh toán"; break;
            case "completed": statusText = "Yêu cầu đã hoàn thành"; break;
            default: statusText = booking.getStatus();
        }
        holder.status.setText(statusText);
        Log.d(TAG, "Set status: " + statusText);

        holder.itemView.setOnClickListener(v -> {
            Intent intent = new Intent(ownerNotificationsFragment.getActivity(), OwnerActivityDetail.class);
            intent.putExtra("NotiID", booking.getBookingId());
            ownerNotificationsFragment.startActivity(intent);
            Log.d(TAG, "Click booking: " + booking.getBookingId());
        });
    }

    @Override
    public int getItemCount() {
        int count = bookingList.size();
        Log.d(TAG, "Số item trong RecyclerView: " + count);
        return count;
    }

    public void updateData(List<Booking> newBookingList) {
        Log.d(TAG, "Cập nhật dữ liệu adapter, số booking: " + (newBookingList != null ? newBookingList.size() : 0));
        bookingList.clear();
        if (newBookingList != null) {
            bookingList.addAll(newBookingList);
            Log.d(TAG, "Đã thêm " + newBookingList.size() + " booking vào bookingList");
        }
        notifyDataSetChanged();
        Log.d(TAG, "Gọi notifyDataSetChanged, số item hiện tại: " + bookingList.size());
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {
        TextView customerName, timeRange, status;

        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            customerName = itemView.findViewById(R.id.tv_customer_name);
            timeRange = itemView.findViewById(R.id.tv_time_range);
            status = itemView.findViewById(R.id.tv_noti_text);
            Log.d(TAG, "Khởi tạo ViewHolder");
        }
    }
}
```

### Adapter\OwnerVehicleAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Context;
import android.content.Intent;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;
import com.bumptech.glide.Glide;
import com.bumptech.glide.load.engine.DiskCacheStrategy;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.UpdateVehicleActivity;
import java.util.ArrayList;

public class OwnerVehicleAdapter extends RecyclerView.Adapter<OwnerVehicleAdapter.MyViewHolder> {
    private static final String TAG = "OwnerVehicleAdapter";
    private final Context context;
    private final ArrayList<Vehicle> vehicleList;
    private final FirebaseFirestore db;

    public OwnerVehicleAdapter(Context context, ArrayList<Vehicle> vehicleList) {
        this.context = context;
        this.vehicleList = vehicleList != null ? vehicleList : new ArrayList<>();
        this.db = FirebaseFirestore.getInstance();
    }

    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.owner_vehicle_card, parent, false);
        return new MyViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
        Vehicle vehicle = vehicleList.get(position);
        Log.d(TAG, "Bind xe tại vị trí " + position + ": " + vehicle.toString());

        // Bind data
        holder.textViewVehicleName.setText(vehicle.getVehicleName() != null && !vehicle.getVehicleName().isEmpty() ? vehicle.getVehicleName() : "Xe mẫu");
        holder.textViewPrice.setText(vehicle.getVehiclePrice() != null && !vehicle.getVehiclePrice().isEmpty() ? vehicle.getVehiclePrice() : "500.000 VNĐ/Ngày");
        holder.textViewRating.setText(String.format("%.1f (0 Đánh giá)", vehicle.getVehicleRating()));

        // Hiển thị trạng thái xác minh
        String verificationStatus = vehicle.getVerificationStatus() != null ? vehicle.getVerificationStatus() : "pending";
        holder.verificationStatus.setText(verificationStatus.equals("verified") ? "Đã duyệt" : "Đang chờ duyệt");
        holder.verificationStatus.setTextColor(verificationStatus.equals("verified") ?
                context.getResources().getColor(R.color.green_verified) :
                context.getResources().getColor(R.color.orange_pending));

        // Load provider name
        String ownerId = vehicle.getOwnerId();
        if (ownerId != null && !ownerId.isEmpty()) {
            db.collection("Users").document(ownerId).get()
                    .addOnSuccessListener(documentSnapshot -> {
                        if (documentSnapshot.exists()) {
                            User user = documentSnapshot.toObject(User.class);
                            String username = user != null && user.getUsername() != null && !user.getUsername().isEmpty() ? user.getUsername() : "Nhà cung cấp mẫu";
                            holder.textViewProviderName.setText(username);
                            Log.d(TAG, "Provider name cho xe " + vehicle.getVehicleName() + ": " + username);
                        } else {
                            holder.textViewProviderName.setText("Nhà cung cấp mẫu");
                            Log.w(TAG, "Không tìm thấy user: " + ownerId);
                        }
                    })
                    .addOnFailureListener(e -> {
                        holder.textViewProviderName.setText("Nhà cung cấp mẫu");
                        Log.e(TAG, "Lỗi tải user: " + e.getMessage());
                    });
        } else {
            holder.textViewProviderName.setText("Nhà cung cấp mẫu");
            Log.w(TAG, "ownerId null cho xe: " + vehicle.getVehicleName());
        }

        // Load image
        if (context != null) {
            Glide.with(context)
                    .load(vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty() ? vehicle.getVehicleImageUrl() : R.drawable.ic_car)
                    .thumbnail(0.25f)
                    .diskCacheStrategy(DiskCacheStrategy.ALL)
                    .placeholder(R.drawable.ic_car)
                    .error(R.drawable.ic_car)
                    .into(holder.imageViewVehicle);
            Log.d(TAG, "Tải ảnh cho xe " + vehicle.getVehicleName() + ": " + vehicle.getVehicleImageUrl());
        }

        // Handle click
        holder.itemView.setOnClickListener(view -> {
            if (vehicle.getVehicleId() != null) {
                Intent intent = new Intent(context, UpdateVehicleActivity.class);
                intent.putExtra("vehicleId", vehicle.getVehicleId()); // Sửa key thành vehicleId
                context.startActivity(intent);
                Log.d(TAG, "Nhấn vào xe: " + vehicle.getVehicleId());
            } else {
                Toast.makeText(context, "Lỗi: Không tìm thấy ID xe", Toast.LENGTH_SHORT).show();
                Log.e(TAG, "vehicleId null cho xe: " + vehicle.getVehicleName());
            }
        });
    }

    @Override
    public int getItemCount() {
        Log.d(TAG, "Số item trong RecyclerView: " + vehicleList.size());
        return vehicleList.size();
    }

    public void updateData(ArrayList<Vehicle> newVehicleList) {
        Log.d(TAG, "Cập nhật dữ liệu adapter, số xe: " + (newVehicleList != null ? newVehicleList.size() : 0));
        vehicleList.clear();
        if (newVehicleList != null) {
            vehicleList.addAll(newVehicleList);
        }
        notifyDataSetChanged();
    }

    static class MyViewHolder extends RecyclerView.ViewHolder {
        TextView textViewVehicleName, textViewPrice, textViewProviderName, textViewRating, verificationStatus;
        ImageView imageViewVehicle;

        MyViewHolder(@NonNull View itemView) {
            super(itemView);
            textViewVehicleName = itemView.findViewById(R.id.vehicle_name);
            textViewPrice = itemView.findViewById(R.id.tv_vehicle_price);
            textViewProviderName = itemView.findViewById(R.id.provider_name);
            textViewRating = itemView.findViewById(R.id.vehicle_rating);
            verificationStatus = itemView.findViewById(R.id.verification_status);
            imageViewVehicle = itemView.findViewById(R.id.img_vehicle);
            Log.d(TAG, "Khởi tạo ViewHolder");
        }
    }
}

```

### Adapter\SplashPagerAdapter.java
```java
package com.uit.carrental.Adapter;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentActivity;
import androidx.viewpager2.adapter.FragmentStateAdapter;

import com.uit.carrental.FragmentPages.SplashFragment;
import com.uit.carrental.R;

public class SplashPagerAdapter extends FragmentStateAdapter {

    private final int[] splashLayouts = {
            R.layout.sflash_1,
            R.layout.sflash_2,
            R.layout.sflash_3,
            R.layout.sflash_4
    };

    public SplashPagerAdapter(@NonNull FragmentActivity fragmentActivity) {
        super(fragmentActivity);
    }

    @NonNull
    @Override
    public Fragment createFragment(int position) {
        return SplashFragment.newInstance(splashLayouts[position], position);
    }

    @Override
    public int getItemCount() {
        return splashLayouts.length;
    }
}
```

### Adapter\UserAdapter.java
```java
package com.uit.carrental.Adapter;

import android.app.AlertDialog;
import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;
import com.bumptech.glide.Glide;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import java.util.List;

public class UserAdapter extends RecyclerView.Adapter<UserAdapter.UserViewHolder> {

    private final List<User> userList;
    private final OnUserClickListener clickListener;
    private final OnDeleteClickListener deleteListener;

    public interface OnUserClickListener {
        void onUserClick(int position);
    }

    public interface OnDeleteClickListener {
        void onDeleteClick(int position);
    }

    public UserAdapter(List<User> userList, OnUserClickListener clickListener, OnDeleteClickListener deleteListener) {
        this.userList = userList;
        this.clickListener = clickListener;
        this.deleteListener = deleteListener;
    }

    @NonNull
    @Override
    public UserViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user, parent, false);
        return new UserViewHolder(view);
    }

    @Override
    public void onBindViewHolder(@NonNull UserViewHolder holder, int position) {
        User user = userList.get(position);

        // Bind data
        holder.textViewUsername.setText(user.getUsername() != null && !user.getUsername().isEmpty() ? user.getUsername() : "Unknown User");
        String verificationStatus = user.getVerificationStatus() != null ? user.getVerificationStatus() : "Not Set";
        String status = user.getStatus() != null ? user.getStatus() : "Not Set";
        holder.textViewDescription.setText(String.format("Role: %s | Verification: %s | Status: %s",
                user.getCurrentRole() != null ? user.getCurrentRole() : "Not Set", verificationStatus, status));

        // Load avatar
        Glide.with(holder.itemView.getContext())
                .load(user.getAvatarUrl() != null && !user.getAvatarUrl().isEmpty() ? user.getAvatarUrl() : R.drawable.ic_person)
                .placeholder(R.drawable.ic_person)
                .into(holder.imageViewAvatar);

        // Click listener for item
        holder.itemView.setOnClickListener(v -> {
            if (clickListener != null) {
                clickListener.onUserClick(position);
            }
        });

        // Click listener for delete button
        holder.deleteButton.setOnClickListener(v -> {
            if (holder.itemView.getContext() != null) {
                new AlertDialog.Builder(holder.itemView.getContext())
                        .setTitle("Xác nhận xóa")
                        .setMessage("Bạn có muốn xóa " + (user.getUsername() != null && !user.getUsername().isEmpty() ? user.getUsername() : "người dùng này") + "?")
                        .setNegativeButton("Hủy", (dialog, which) -> dialog.dismiss())
                        .setPositiveButton("Xác nhận", (dialog, which) -> {
                            if (deleteListener != null) {
                                deleteListener.onDeleteClick(position);
                            }
                        })
                        .create()
                        .show();
            }
        });
    }

    @Override
    public int getItemCount() {
        return userList != null ? userList.size() : 0;
    }

    public void updateData(List<User> newData) {
        this.userList.clear();
        if (newData != null) {
            this.userList.addAll(newData);
        }
        notifyDataSetChanged();
    }

    static class UserViewHolder extends RecyclerView.ViewHolder {
        ImageView imageViewAvatar, deleteButton;
        TextView textViewUsername, textViewDescription;

        UserViewHolder(@NonNull View itemView) {
            super(itemView);
            imageViewAvatar = itemView.findViewById(R.id.user_avatar);
            textViewUsername = itemView.findViewById(R.id.user_name);
            textViewDescription = itemView.findViewById(R.id.user_description);
            deleteButton = itemView.findViewById(R.id.btn_delete);
        }
    }
}

```

### Adapter\VehicleAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.RecyclerView;
import com.bumptech.glide.Glide;
import com.bumptech.glide.load.engine.DiskCacheStrategy;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.uit.carrental.FragmentPages.Admin.AdminVehicleListFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerHomeFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerVehicleFragment;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.Model.onClickInterface;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.AdminVehicleDetailActivity;
import com.uit.carrental.Service.Vehicle.UpdateVehicleActivity;
import com.uit.carrental.Service.Vehicle.VehicleDetailActivity;

import java.util.ArrayList;
import java.util.List;

public class VehicleAdapter extends RecyclerView.Adapter<VehicleAdapter.ViewHolder> {

    private static final String TAG = "VehicleAdapter";
    private final Fragment fragment;
    private ArrayList<Vehicle> vehicles;
    private final onClickInterface onClickInterface;

    public VehicleAdapter(Fragment fragment, ArrayList<Vehicle> vehicles, onClickInterface onClickInterface) {
        this.fragment = fragment;
        this.vehicles = vehicles != null ? vehicles : new ArrayList<>();
        this.onClickInterface = onClickInterface;
        Log.d(TAG, "Khởi tạo adapter với " + this.vehicles.size() + " xe");
    }

    @NonNull
    @Override
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        int layoutRes = fragment instanceof AdminVehicleListFragment ? R.layout.admin_vehicle_card : R.layout.vehicle_card;
        View view = LayoutInflater.from(parent.getContext()).inflate(layoutRes, parent, false);
        return new ViewHolder(view, fragment instanceof AdminVehicleListFragment);
    }

    @Override
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
        if (vehicles == null || position >= vehicles.size()) {
            Log.e(TAG, "Danh sách xe rỗng hoặc vị trí không hợp lệ: " + position);
            return;
        }

        Vehicle vehicle = vehicles.get(position);
        Log.d(TAG, "Ánh xạ xe: " + vehicle.getVehicleName() + ", ID: " + vehicle.getVehicleId() +
                ", verificationStatus: " + vehicle.getVerificationStatus());

        // Ánh xạ chung
        holder.vehicleName.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : "Xe không tên");
        holder.vehiclePrice.setText(vehicle.getVehiclePrice() != null ? vehicle.getVehiclePrice() : "0 VNĐ");
        Float rating = vehicle.getVehicleRating();
        holder.vehicleRating.setText(String.format("%.1f (0 Đánh giá)", rating != null ? rating : 0.0f));

        // Tải ảnh
        if (fragment.getContext() != null) {
            if (vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty()) {
                Glide.with(fragment.getContext())
                        .load(vehicle.getVehicleImageUrl())
                        .placeholder(R.drawable.ic_car)
                        .diskCacheStrategy(DiskCacheStrategy.ALL)
                        .into(holder.vehicleImage);
            } else {
                holder.vehicleImage.setImageResource(R.drawable.ic_car);
            }
        }

        // Ánh xạ riêng cho admin
        if (holder.isAdminView) {
            holder.vehicleNumber.setText(vehicle.getVehicleNumber() != null ? vehicle.getVehicleNumber() : "Không có biển số");
            holder.vehicleBrand.setText(vehicle.getVehicleBrand() != null ? vehicle.getVehicleBrand() : "Không có thương hiệu");
            holder.vehicleAvailability.setText(getAvailabilityText(vehicle.getVehicleAvailability()));
            holder.verificationStatus.setText(getVerificationStatusText(vehicle.getVerificationStatus()));
            holder.verificationStatus.setTextColor(fragment.getResources().getColor(
                    vehicle.getVerificationStatus() != null && vehicle.getVerificationStatus().equals("verified") ?
                            R.color.green_verified : R.color.orange_pending));
        }

        // Xử lý nhấn xe
        holder.itemView.setOnClickListener(v -> {
            if (fragment.getContext() == null || vehicle.getVehicleId() == null) {
                Log.e(TAG, "Context or vehicleId is null");
                if (fragment.getContext() != null) {
                    Toast.makeText(fragment.getContext(), "Lỗi: Không thể mở chi tiết xe", Toast.LENGTH_SHORT).show();
                }
                return;
            }

            Intent intent;
            if (fragment instanceof AdminVehicleListFragment) {
                intent = new Intent(fragment.getContext(), AdminVehicleDetailActivity.class);
            } else if (fragment instanceof OwnerVehicleFragment) {
                FirebaseUser currentUser = FirebaseAuth.getInstance().getCurrentUser();
                if (currentUser != null && vehicle.getOwnerId() != null && vehicle.getOwnerId().equals(currentUser.getUid())) {
                    intent = new Intent(fragment.getContext(), UpdateVehicleActivity.class);
                } else {
                    intent = new Intent(fragment.getContext(), VehicleDetailActivity.class);
                }
            } else if (fragment instanceof CustomerHomeFragment) {
                intent = new Intent(fragment.getContext(), VehicleDetailActivity.class);
            } else {
                intent = new Intent(fragment.getContext(), VehicleDetailActivity.class);
            }
            intent.putExtra("vehicleId", vehicle.getVehicleId());
            fragment.startActivity(intent);
            onClickInterface.setClick(position);
        });
    }

    private String getAvailabilityText(String availability) {
        if (availability == null) return "Không xác định";
        switch (availability) {
            case "renting": return "Đang cho thuê";
            case "available": return "Có sẵn";
            case "maintenance": return "Đang bảo trì";
            case "pending": return "Đang chờ duyệt";
            default: return "Không xác định";
        }
    }

    private String getVerificationStatusText(String verificationStatus) {
        if (verificationStatus == null) return "Không xác định";
        switch (verificationStatus) {
            case "verified": return "Đã duyệt";
            case "pending": return "Chưa duyệt";
            default: return "Không xác định";
        }
    }

    @Override
    public int getItemCount() {
        int count = vehicles != null ? vehicles.size() : 0;
        Log.d(TAG, "getItemCount: " + count);
        return count;
    }

    public void updateData(List<Vehicle> newVehicleList) {
        vehicles.clear();
        if (newVehicleList != null) {
            vehicles.addAll(newVehicleList);
        }
        notifyDataSetChanged();
        Log.d(TAG, "Cập nhật dữ liệu adapter, số xe: " + vehicles.size());
    }

    static class ViewHolder extends RecyclerView.ViewHolder {
        ImageView vehicleImage;
        TextView vehicleName, vehicleNumber, vehiclePrice, vehicleBrand, vehicleAvailability, verificationStatus, vehicleRating;
        boolean isAdminView;

        ViewHolder(View itemView, boolean isAdminView) {
            super(itemView);
            this.isAdminView = isAdminView;
            vehicleImage = itemView.findViewById(isAdminView ? R.id.vehicle_image : R.id.img_vehicle);
            vehicleName = itemView.findViewById(R.id.vehicle_name);
            vehiclePrice = itemView.findViewById(isAdminView ? R.id.vehicle_price : R.id.tv_vehicle_price);
            vehicleRating = itemView.findViewById(R.id.vehicle_rating);
            if (isAdminView) {
                vehicleNumber = itemView.findViewById(R.id.vehicle_number);
                vehicleBrand = itemView.findViewById(R.id.vehicle_brand);
                vehicleAvailability = itemView.findViewById(R.id.vehicle_availability);
                verificationStatus = itemView.findViewById(R.id.verification_status);
            }
        }
    }
}
```

### Adapter\ViewPagerAdapter.java
```java
package com.uit.carrental.Adapter;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentActivity;
import androidx.viewpager2.adapter.FragmentStateAdapter;
import com.uit.carrental.FragmentPages.Customer.ChatFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerHomeFragment;

public class ViewPagerAdapter extends FragmentStateAdapter {
    public ViewPagerAdapter(@NonNull FragmentActivity fragmentActivity) {
        super(fragmentActivity);
    }

    @NonNull
    @Override
    public Fragment createFragment(int position) {
        switch (position) {
            case 0:
                return new CustomerHomeFragment();
            case 1:
                return new ChatFragment();
            default:
                return new CustomerHomeFragment();
        }
    }

    @Override
    public int getItemCount() {
        return 2; // Two tabs: Home and Chat
    }
}
```

### FragmentPages\SplashFragment.java
```java
package com.uit.carrental.FragmentPages;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;

import com.uit.carrental.R;

public class SplashFragment extends Fragment {

    private static final String ARG_LAYOUT = "layout";
    private static final String ARG_POSITION = "position";
    private OnNextButtonClickListener listener;

    public interface OnNextButtonClickListener {
        void onNextButtonClicked(int position);
    }

    public static SplashFragment newInstance(int layoutResId, int position) {
        SplashFragment fragment = new SplashFragment();
        Bundle args = new Bundle();
        args.putInt(ARG_LAYOUT, layoutResId);
        args.putInt(ARG_POSITION, position);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getActivity() instanceof OnNextButtonClickListener) {
            listener = (OnNextButtonClickListener) getActivity();
        }
    }

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        int layoutResId = getArguments() != null ? getArguments().getInt(ARG_LAYOUT) : R.layout.sflash_1;
        View view = inflater.inflate(layoutResId, container, false);

        Button nextButton = view.findViewById(R.id.next_button);
        int position = getArguments() != null ? getArguments().getInt(ARG_POSITION) : 0;
        nextButton.setOnClickListener(v -> {
            if (listener != null) {
                listener.onNextButtonClicked(position);
            }
        });

        return view;
    }
}
```

### FragmentPages\Admin\AdminSettingsFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import com.bumptech.glide.Glide;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;

public class AdminSettingsFragment extends Fragment {

    private ImageView imageViewAvatar, imageViewEdit;
    private TextView textViewName, textViewEdit;
    private View layoutAdminAccount, layoutCommission, layoutNotifications, layoutAdminHistory, layoutSignOut;
    private FirebaseAuth auth;
    private FirebaseFirestore db;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_admin_settings, container, false);

        // Initialize Firebase
        auth = FirebaseAuth.getInstance();
        db = FirebaseFirestore.getInstance();

        // Initialize views
        imageViewAvatar = view.findViewById(R.id.rqqkbht2nw9);
        imageViewEdit = view.findViewById(R.id.ryhyrsup3suq);
        textViewName = view.findViewById(R.id.rzxbt2b9du3b);
        textViewEdit = view.findViewById(R.id.rwemqtod737b);
        layoutAdminAccount = view.findViewById(R.id.layout_admin_account);
        layoutCommission = view.findViewById(R.id.layout_commission);
        layoutNotifications = view.findViewById(R.id.layout_notifications);
        layoutAdminHistory = view.findViewById(R.id.layout_admin_history);
        layoutSignOut = view.findViewById(R.id.r6uqs59f1co);

        // Set text for item_setting_row
        setupSettingRow(layoutAdminAccount, "Quản lý tài khoản quản trị viên");
        setupSettingRow(layoutCommission, "Cấu hình hoa hồng sàn");
        setupSettingRow(layoutNotifications, "Cấu hình hệ thống thông báo");
        setupSettingRow(layoutAdminHistory, "Lịch sử thao tác admin");

        // Load admin info
        loadAdminInfo();

        // Setup click listeners
        textViewEdit.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Chỉnh sửa thông tin admin", Toast.LENGTH_SHORT).show();
        });

        layoutAdminAccount.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Quản lý tài khoản quản trị viên", Toast.LENGTH_SHORT).show();
        });

        layoutCommission.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Cấu hình hoa hồng sàn", Toast.LENGTH_SHORT).show();
        });

        layoutNotifications.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Cấu hình hệ thống thông báo", Toast.LENGTH_SHORT).show();
        });

        layoutAdminHistory.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Lịch sử thao tác admin", Toast.LENGTH_SHORT).show();
        });

        layoutSignOut.setOnClickListener(v -> signOut());

        return view;
    }

    private void setupSettingRow(View layout, String text) {
        TextView textView = layout.findViewById(R.id.setting_text);
        if (textView != null) {
            textView.setText(text);
        }
    }

    private void loadAdminInfo() {
        if (auth.getCurrentUser() != null) {
            String userId = auth.getCurrentUser().getUid();
            db.collection("Users").document(userId).get()
                    .addOnSuccessListener(documentSnapshot -> {
                        if (documentSnapshot.exists()) {
                            String username = documentSnapshot.getString("username");
                            String avatarUrl = documentSnapshot.getString("avatarUrl");
                            textViewName.setText(username != null ? username : "Admin");
                            if (avatarUrl != null && !avatarUrl.isEmpty() && getContext() != null) {
                                Glide.with(getContext()).load(avatarUrl).into(imageViewAvatar);
                            }
                        } else {
                            loadMockAdminInfo();
                        }
                    })
                    .addOnFailureListener(e -> loadMockAdminInfo());
        } else {
            loadMockAdminInfo();
        }
    }

    private void loadMockAdminInfo() {
        textViewName.setText("Chị em chúng mình");
        if (getContext() != null) {
            Glide.with(getContext()).load(R.drawable.ic_person).into(imageViewAvatar);
        }
    }

    private void signOut() {
        auth.signOut();
        if (getActivity() != null) {
            startActivity(new Intent(getActivity(), LoginActivity.class));
            getActivity().finish();
        }
    }
}

```

### FragmentPages\Admin\AdminStatisticsFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.os.Bundle;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.bumptech.glide.Glide;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.Query;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import java.util.ArrayList;
import java.util.List;

public class AdminStatisticsFragment extends Fragment {

    private TextView textViewTotalUsers, textViewTotalOwners, textViewTotalRevenue, textViewMonthlyRevenue;
    private LinearLayout layoutUserStats;
    private RelativeLayout layoutRevenueStats; // Sửa từ LinearLayout thành RelativeLayout
    private RecyclerView recyclerViewTopVehicles;
    private TopVehicleAdapter topVehicleAdapter;
    private FirebaseFirestore db;
    private List<VehicleStat> topVehicles;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_admin_statistics, container, false);

        // Initialize Firebase
        db = FirebaseFirestore.getInstance();

        // Initialize views
        textViewTotalUsers = view.findViewById(R.id.rp42wc0fjdv);
        textViewTotalOwners = view.findViewById(R.id.rtcscqww51js);
        textViewTotalRevenue = view.findViewById(R.id.r26rof30hetx);
        textViewMonthlyRevenue = view.findViewById(R.id.rk10ooehcyo);
        layoutUserStats = view.findViewById(R.id.r4bw82dxnrcg);
        layoutRevenueStats = view.findViewById(R.id.r15sr6ipgnjs_rl); // Sửa ánh xạ
        recyclerViewTopVehicles = view.findViewById(R.id.rutuu0f5fk3);

        // Setup RecyclerView
        recyclerViewTopVehicles.setLayoutManager(new LinearLayoutManager(getContext()));
        topVehicles = new ArrayList<>();
        topVehicleAdapter = new TopVehicleAdapter(topVehicles);
        recyclerViewTopVehicles.setAdapter(topVehicleAdapter);

        // Load static images
        loadStaticImages(view);

        // Load statistics
        loadStatistics();

        // Setup click listeners
        layoutUserStats.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Xem chi tiết thống kê người dùng", Toast.LENGTH_SHORT).show();
        });
        layoutRevenueStats.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Xem chi tiết thống kê doanh thu", Toast.LENGTH_SHORT).show();
        });

        return view;
    }

    private void loadStaticImages(View view) {
        Context context = getContext();
        if (context != null) {
            Glide.with(context)
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/x074yc50_expires_30_days.png")
                    .into((ImageView) view.findViewById(R.id.r3qtlrf08vac));
            Glide.with(context)
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/l5omzz94_expires_30_days.png")
                    .into((ImageView) view.findViewById(R.id.rerhjwf5h2qm));
            Glide.with(context)
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/f1rhppxs_expires_30_days.png")
                    .into((ImageView) view.findViewById(R.id.r15sr6ipgnjs));
        }
    }

    private void loadStatistics() {
        // Tổng số người dùng
        db.collection("Users").get().addOnSuccessListener(querySnapshot -> {
            textViewTotalUsers.setText(String.format("%,d", querySnapshot.size()));
        }).addOnFailureListener(e -> loadMockData());

        // Tổng số chủ xe
        db.collection("Users")
                .whereEqualTo("roles.owner", true)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    textViewTotalOwners.setText(String.format("%,d", querySnapshot.size()));
                });

        // Doanh thu tổng
        db.collection("Orders").get().addOnSuccessListener(querySnapshot -> {
            long totalRevenue = 0;
            for (QueryDocumentSnapshot document : querySnapshot) {
                Long revenue = document.getLong("totalAmount");
                if (revenue != null) totalRevenue += revenue;
            }
            textViewTotalRevenue.setText(String.format("%,dM", totalRevenue / 1_000_000));
        });

        // Doanh thu tháng này
        long oneMonthAgo = System.currentTimeMillis() - 30L * 24 * 60 * 60 * 1000;
        db.collection("Orders")
                .whereGreaterThan("timestamp", oneMonthAgo)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    long monthlyRevenue = 0;
                    for (QueryDocumentSnapshot document : querySnapshot) {
                        Long revenue = document.getLong("totalAmount");
                        if (revenue != null) monthlyRevenue += revenue;
                    }
                    textViewMonthlyRevenue.setText(String.format("%,d", monthlyRevenue));
                });

        // Top 5 xe được thuê
        db.collection("Orders")
                .whereGreaterThan("timestamp", oneMonthAgo)
                .orderBy("vehicleId", Query.Direction.DESCENDING)
                .limit(5)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    topVehicles.clear();
                    for (QueryDocumentSnapshot document : querySnapshot) {
                        String vehicleId = document.getString("vehicleId");
                        long totalOrders = document.getLong("totalOrders") != null ? document.getLong("totalOrders") : 1;
                        long revenue = document.getLong("totalAmount") != null ? document.getLong("totalAmount") : 0;
                        db.collection("Vehicles").document(vehicleId).get().addOnSuccessListener(vehicleDoc -> {
                            if (vehicleDoc.exists()) {
                                Vehicle vehicle = vehicleDoc.toObject(Vehicle.class);
                                if (vehicle != null) {
                                    topVehicles.add(new VehicleStat(
                                            vehicle.getVehicleName(),
                                            vehicle.getVehicleNumber(),
                                            totalOrders,
                                            revenue
                                    ));
                                    topVehicleAdapter.notifyDataSetChanged();
                                }
                            }
                        });
                    }
                });
    }

    private void loadMockData() {
        textViewTotalUsers.setText("25,000");
        textViewTotalOwners.setText("1,000");
        textViewTotalRevenue.setText("900M");
        textViewMonthlyRevenue.setText("90,000,000");
        topVehicles.clear();
        for (int i = 1; i <= 5; i++) {
            topVehicles.add(new VehicleStat(
                    "Vinfast Lux A2.0 " + i,
                    "CS254" + i,
                    187L,
                    8_522_000L
            ));
        }
        topVehicleAdapter.notifyDataSetChanged();
    }

    private static class TopVehicleAdapter extends RecyclerView.Adapter<TopVehicleAdapter.ViewHolder> {
        private final List<VehicleStat> vehicles;

        TopVehicleAdapter(List<VehicleStat> vehicles) {
            this.vehicles = vehicles;
        }

        @NonNull
        @Override
        public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
            View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.vehicle_stat_item, parent, false);
            return new ViewHolder(view);
        }

        @Override
        public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
            VehicleStat stat = vehicles.get(position);
            holder.textViewName.setText(stat.name);
            holder.textViewNumber.setText(stat.vehicleNumber);
            holder.textViewTotalOrders.setText(String.valueOf(stat.totalOrders));
            holder.textViewRevenue.setText(String.format("%,d", stat.revenue));
            holder.itemView.setBackgroundColor(position % 2 == 0 ? Color.parseColor("#C9F3FF") : Color.WHITE);
        }

        @Override
        public int getItemCount() {
            return vehicles.size();
        }

        static class ViewHolder extends RecyclerView.ViewHolder {
            TextView textViewName, textViewNumber, textViewTotalOrders, textViewRevenue;

            ViewHolder(View itemView) {
                super(itemView);
                textViewName = itemView.findViewById(R.id.vehicle_name);
                textViewNumber = itemView.findViewById(R.id.vehicle_number);
                textViewTotalOrders = itemView.findViewById(R.id.total_orders);
                textViewRevenue = itemView.findViewById(R.id.revenue);
            }
        }
    }

    private static class VehicleStat {
        String name;
        String vehicleNumber;
        long totalOrders;
        long revenue;

        VehicleStat(String name, String vehicleNumber, long totalOrders, long revenue) {
            this.name = name;
            this.vehicleNumber = vehicleNumber;
            this.totalOrders = totalOrders;
            this.revenue = revenue;
        }
    }

    public static class SimpleBarChart extends View {
        private final Paint paint;
        private float[] values = {800, 2000, 600, 1200, 400, 3000, 100};

        public SimpleBarChart(Context context) {
            super(context);
            paint = new Paint();
            paint.setAntiAlias(true);
        }

        public SimpleBarChart(Context context, @Nullable AttributeSet attrs) {
            super(context, attrs);
            paint = new Paint();
            paint.setAntiAlias(true);
        }

        public SimpleBarChart(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
            super(context, attrs, defStyleAttr);
            paint = new Paint();
            paint.setAntiAlias(true);
        }

        public void setValues(float[] newValues) {
            this.values = newValues;
            invalidate();
        }

        @Override
        protected void onDraw(Canvas canvas) {
            super.onDraw(canvas);
            float width = getWidth();
            float height = getHeight();
            float barWidth = width / 10f;
            float maxHeight = height * 0.8f;

            int[] colors = {Color.parseColor("#3DD34C"), Color.parseColor("#6D62F7")};

            for (int i = 0; i < values.length; i++) {
                paint.setColor(colors[i % 2]);
                float left = i * barWidth * 1.2f + barWidth * 0.1f;
                float top = height - (values[i] / 3000 * maxHeight);
                float right = left + barWidth;
                float bottom = height;
                canvas.drawRect(left, top, right, bottom, paint);
            }
        }
    }
}

```

### FragmentPages\Admin\AdminUserListFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.app.AlertDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentTransaction;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.ListenerRegistration;
import com.uit.carrental.Adapter.UserAdapter;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

public class AdminUserListFragment extends Fragment {

    private RecyclerView recyclerViewUsers;
    private TextView textViewUserCount, textViewUserStats;
    private LinearLayout buttonSearch, buttonPage1, buttonPage2, buttonPage3;
    private ImageView imageViewFilter, imageViewSearch, imageViewPrevPage, imageViewNextPage;
    private EditText editTextSearch;
    private UserAdapter userAdapter;
    private List<User> userList; // Danh sách tất cả người dùng từ Firestore
    private List<User> filteredUserList; // Danh sách sau khi lọc và tìm kiếm
    private FirebaseFirestore db;
    private FirebaseAuth auth;
    private int currentPage = 1;
    private int totalPages = 1;
    private static final int ITEMS_PER_PAGE = 5;
    private String currentQuery = "";
    private String currentVerificationStatus;
    private ListenerRegistration usersListener;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_admin_user_list, container, false);

        // Initialize Firebase
        db = FirebaseFirestore.getInstance();
        auth = FirebaseAuth.getInstance();

        // Initialize views
        recyclerViewUsers = view.findViewById(R.id.user_list);
        textViewUserCount = view.findViewById(R.id.tv_user_count);
        textViewUserStats = view.findViewById(R.id.btn_user_stats);
        buttonSearch = view.findViewById(R.id.search_container);
        imageViewFilter = view.findViewById(R.id.filter_button);
        imageViewSearch = view.findViewById(R.id.search_button);
        editTextSearch = view.findViewById(R.id.search_input);
        buttonPage1 = view.findViewById(R.id.page_1_button);
        buttonPage2 = view.findViewById(R.id.page_2_button);
        buttonPage3 = view.findViewById(R.id.page_3_button);
        imageViewPrevPage = view.findViewById(R.id.prev_page_button);
        imageViewNextPage = view.findViewById(R.id.next_page_button);

        // Setup RecyclerView
        recyclerViewUsers.setLayoutManager(new LinearLayoutManager(getContext()));
        userList = new ArrayList<>();
        filteredUserList = new ArrayList<>();
        userAdapter = new UserAdapter(filteredUserList, position -> {
            UserStatsFragment fragment = new UserStatsFragment();
            Bundle args = new Bundle();
            args.putString("userId", filteredUserList.get(position).getUserId());
            fragment.setArguments(args);
            FragmentTransaction transaction = getParentFragmentManager().beginTransaction();
            transaction.replace(R.id.frame_layout_admin, fragment);
            transaction.addToBackStack(null);
            transaction.commit();
        }, position -> {
            User user = filteredUserList.get(position);
            if (user.getUserId() != null) {
                deleteUser(user.getUserId(), position);
            } else {
                Toast.makeText(getContext(), "Không tìm thấy ID người dùng", Toast.LENGTH_SHORT).show();
            }
        });
        recyclerViewUsers.setAdapter(userAdapter);

        // Check admin role
        if (auth.getCurrentUser() != null) {
            checkAdminRole(auth.getCurrentUser().getUid());
        } else {
            Toast.makeText(getContext(), "Vui lòng đăng nhập", Toast.LENGTH_SHORT).show();
            requireActivity().finish();
        }

        // Setup search
        setupSearch();

        // Setup filter
        setupFilter();

        // Setup pagination
        setupPagination();

        // Setup user stats button
        textViewUserStats.setOnClickListener(v -> {
            Intent intent = new Intent(getContext(), UserStatsActivity.class);
            startActivity(intent);
        });

        return view;
    }

    private void checkAdminRole(String userId) {
        db.collection("Users").document(userId)
                .get()
                .addOnSuccessListener(documentSnapshot -> {
                    if (documentSnapshot.exists()) {
                        User user = documentSnapshot.toObject(User.class);
                        if (user == null || !user.hasRole("admin")) {
                            Toast.makeText(getContext(), "Bạn không có quyền admin", Toast.LENGTH_SHORT).show();
                            requireActivity().finish();
                        } else {
                            loadUsersRealTime();
                        }
                    } else {
                        Toast.makeText(getContext(), "Không tìm thấy thông tin người dùng", Toast.LENGTH_SHORT).show();
                        requireActivity().finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(getContext(), "Lỗi khi kiểm tra vai trò: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    requireActivity().finish();
                });
    }

    private void setupSearch() {
        buttonSearch.setOnClickListener(v -> updateFilteredList());
        imageViewSearch.setOnClickListener(v -> updateFilteredList());

        editTextSearch.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {}

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {}

            @Override
            public void afterTextChanged(Editable s) {
                currentQuery = s.toString().trim().toLowerCase();
                currentPage = 1;
                updateFilteredList();
            }
        });
    }

    private void setupFilter() {
        imageViewFilter.setOnClickListener(v -> {
            new AlertDialog.Builder(getContext())
                    .setTitle("Lọc người dùng")
                    .setItems(new String[]{"Đã xác minh", "Chờ xác minh", "Tất cả"}, (dialog, which) -> {
                        currentVerificationStatus = switch (which) {
                            case 0 -> "verified";
                            case 1 -> "pending";
                            default -> null;
                        };
                        currentPage = 1;
                        updateFilteredList();
                    })
                    .setNegativeButton("Hủy", null)
                    .show();
        });
    }

    private void setupPagination() {
        buttonPage1.setOnClickListener(v -> setPage(1));
        buttonPage2.setOnClickListener(v -> setPage(2));
        buttonPage3.setOnClickListener(v -> setPage(3));
        imageViewPrevPage.setOnClickListener(v -> setPage(currentPage - 1));
        imageViewNextPage.setOnClickListener(v -> setPage(currentPage + 1));
        updatePageButtons();
    }

    private void setPage(int page) {
        if (page < 1 || page > totalPages) return;
        currentPage = page;
        updateRecyclerView();
    }

    private void updatePageButtons() {
        buttonPage1.setBackgroundResource(currentPage == 1 ? R.drawable.cr15b003087 : R.drawable.s003087sw1cr15bffffff);
        buttonPage2.setBackgroundResource(currentPage == 2 ? R.drawable.cr15b003087 : R.drawable.s003087sw1cr15bffffff);
        buttonPage3.setBackgroundResource(currentPage == 3 ? R.drawable.cr15b003087 : R.drawable.s003087sw1cr15bffffff);
        imageViewPrevPage.setEnabled(currentPage > 1);
        imageViewNextPage.setEnabled(currentPage < totalPages);
        buttonPage1.setVisibility(totalPages >= 1 ? View.VISIBLE : View.GONE);
        buttonPage2.setVisibility(totalPages >= 2 ? View.VISIBLE : View.GONE);
        buttonPage3.setVisibility(totalPages >= 3 ? View.VISIBLE : View.GONE);
    }

    private void loadUsersRealTime() {
        // Lắng nghe thay đổi thời gian thực trên collection Users
        usersListener = db.collection("Users")
                .addSnapshotListener((querySnapshot, error) -> {
                    if (error != null) {
                        Toast.makeText(getContext(), "Lỗi tải dữ liệu: " + error.getMessage(), Toast.LENGTH_SHORT).show();
                        loadMockData();
                        return;
                    }

                    if (querySnapshot != null) {
                        userList.clear();
                        for (DocumentSnapshot document : querySnapshot.getDocuments()) {
                            User user = document.toObject(User.class);
                            if (user != null && user.getUserId() != null) {
                                userList.add(user);
                            }
                        }
                        updateFilteredList();
                    }
                });
    }

    private void updateFilteredList() {
        filteredUserList.clear();

        // Lọc và tìm kiếm client-side
        for (User user : userList) {
            boolean matchesSearch = currentQuery.isEmpty() ||
                    (user.getUsername() != null && user.getUsername().toLowerCase().contains(currentQuery)) ||
                    (user.getEmail() != null && user.getEmail().toLowerCase().contains(currentQuery));
            boolean matchesFilter = currentVerificationStatus == null ||
                    (user.getVerificationStatus() != null && user.getVerificationStatus().equalsIgnoreCase(currentVerificationStatus));

            if (matchesSearch && matchesFilter) {
                filteredUserList.add(user);
            }
        }

        // Sắp xếp theo username client-side
        filteredUserList.sort((u1, u2) -> {
            String username1 = u1.getUsername() != null ? u1.getUsername().toLowerCase() : "";
            String username2 = u2.getUsername() != null ? u2.getUsername().toLowerCase() : "";
            return username1.compareTo(username2);
        });

        // Cập nhật tổng số trang
        totalPages = (int) Math.ceil((double) filteredUserList.size() / ITEMS_PER_PAGE);
        textViewUserCount.setText("Tổng số người dùng: " + filteredUserList.size());
        updatePageButtons();
        updateRecyclerView();
    }

    private void loadMockData() {
        userList.clear();
        filteredUserList.clear();
        String[] verificationStatuses = {"verified", "pending"};
        for (int i = 1; i <= 15; i++) {
            User mockUser = new User();
            mockUser.setUserId("mock_user_" + i);
            mockUser.setUsername("Người dùng " + i);
            mockUser.setEmail("user" + i + "@example.com");
            mockUser.setVerificationStatus(verificationStatuses[i % 2]);
            mockUser.setRoles(Map.of("customer", true));
            userList.add(mockUser);
        }
        updateFilteredList();
    }

    private void updateRecyclerView() {
        int start = (currentPage - 1) * ITEMS_PER_PAGE;
        int end = Math.min(start + ITEMS_PER_PAGE, filteredUserList.size());
        List<User> paginatedList = new ArrayList<>();
        if (start < filteredUserList.size()) {
            paginatedList.addAll(filteredUserList.subList(start, end));
        }
        userAdapter.updateData(paginatedList);
        recyclerViewUsers.scrollToPosition(0); // Cuộn lên đầu khi cập nhật
    }

    private void deleteUser(String userId, int position) {
        db.collection("Users").document(userId)
                .delete()
                .addOnSuccessListener(aVoid -> {
                    // Không cần xóa thủ công vì listener sẽ tự động cập nhật userList
                    Toast.makeText(getContext(), "Đã xóa người dùng", Toast.LENGTH_SHORT).show();
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(getContext(), "Lỗi xóa người dùng: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    @Override
    public void onDestroyView() {
        super.onDestroyView();
        // Hủy listener để tránh rò rỉ bộ nhớ
        if (usersListener != null) {
            usersListener.remove();
        }
    }
}

```

### FragmentPages\Admin\AdminVehicleListFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.app.AlertDialog;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.android.material.slider.RangeSlider;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Adapter.VehicleAdapter;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class AdminVehicleListFragment extends Fragment {

    private static final String TAG = "AdminVehicleList";
    private RecyclerView recyclerViewVehicles;
    private TextView textViewVehicleCount;
    private LinearLayout buttonSearch;
    private ImageView imageViewFilter, imageView_search;
    private EditText editTextSearch;
    private VehicleAdapter vehicleAdapter;
    private List<Vehicle> vehicleList;
    private MutableLiveData<List<Vehicle>> filteredVehicleList;
    private FirebaseFirestore dbVehicle;
    private MutableLiveData<String> currentQuery;
    private String currentBrand = null;
    private String currentStatus = null;
    private String currentVerificationStatus = null;
    private Float currentMinRating = 0.0f;
    private Float currentMaxRating = 5.0f;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_admin_vehicle_list, container, false);

        // Initialize Firebase
        dbVehicle = FirebaseFirestore.getInstance();

        // Initialize LiveData
        vehicleList = new ArrayList<>();
        filteredVehicleList = new MutableLiveData<>(new ArrayList<>());
        currentQuery = new MutableLiveData<>("");

        // Initialize views
        recyclerViewVehicles = view.findViewById(R.id.recycler_view_vehicles);
        textViewVehicleCount = view.findViewById(R.id.tv_vehicle_count);
        buttonSearch = view.findViewById(R.id.rmhryoy6hglh);
        imageViewFilter = view.findViewById(R.id.filter_button);
        imageView_search = view.findViewById(R.id.search_button);
        editTextSearch = view.findViewById(R.id.search_input);

        // Setup RecyclerView
        recyclerViewVehicles.setLayoutManager(new LinearLayoutManager(getContext()));
        vehicleAdapter = new VehicleAdapter(this, new ArrayList<>(), position -> {});
        recyclerViewVehicles.setAdapter(vehicleAdapter);

        // Observe filtered list
        filteredVehicleList.observe(getViewLifecycleOwner(), vehicles -> {
            if (vehicles == null || vehicles.isEmpty()) {
                Log.d(TAG, "Danh sách xe rỗng sau khi lọc");
                vehicleAdapter.updateData(new ArrayList<>());
                textViewVehicleCount.setText(getString(R.string.total_vehicles, 0));

            } else {
                vehicleAdapter.updateData(new ArrayList<>(vehicles));
                textViewVehicleCount.setText(getString(R.string.total_vehicles, vehicles.size()));
            }
            Log.d(TAG, "Cập nhật RecyclerView với " + (vehicles != null ? vehicles.size() : 0) + " xe");
        });

        // Setup search
        setupSearch();

        // Setup filter
        setupFilter();

        // Load vehicles
        loadVehicles();

        return view;
    }

    private void setupSearch() {
        buttonSearch.setOnClickListener(v -> performSearch());
        imageView_search.setOnClickListener(v -> performSearch());

        editTextSearch.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {}

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {}

            @Override
            public void afterTextChanged(Editable s) {
                currentQuery.setValue(s.toString().trim().toLowerCase());
            }
        });

        currentQuery.observe(getViewLifecycleOwner(), query -> {
            if (!vehicleList.isEmpty()) {
                applyFilter();
            }
        });
    }

    private void setupFilter() {
        imageViewFilter.setOnClickListener(v -> showFilterDialog());
    }

    private void loadVehicles() {
        dbVehicle.collection("Vehicles")
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    vehicleList.clear();
                    for (DocumentSnapshot document : querySnapshot) {
                        try {
                            Vehicle vehicle = document.toObject(Vehicle.class);
                            if (vehicle != null && vehicle.getVehicleId() != null) {
                                vehicleList.add(vehicle);

                            }
                        } catch (Exception e) {
                            Log.e(TAG, "Lỗi ánh xạ tài liệu: " + document.getId(), e);
                        }
                    }
                    applyFilter();
                    Log.d(TAG, "Tải " + vehicleList.size() + " xe từ Firestore");
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu: " + e.getMessage());
                    Toast.makeText(getContext(), "Lỗi tải dữ liệu: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    loadMockData();
                });
    }

    private void loadMockData() {
        vehicleList.clear();
        String[] brands = {"Vinfast", "Honda", "Mercedes", "BMW", "Ford", "Toyota"};
        String[] statuses = {"renting", "available", "maintenance", "pending"};
        String[] verificationStatuses = {"verified", "pending"};
        for (int i = 1; i <= 15; i++) {
            Vehicle mockVehicle = new Vehicle();
            mockVehicle.setVehicleId("mock_vehicle_" + i);
            mockVehicle.setVehicleName("Xe mẫu " + i);
            mockVehicle.setVehiclePrice("500.000 VNĐ/Ngày");
            mockVehicle.setVehicleImageUrl("https://example.com/car.jpg");
            mockVehicle.setOwnerId("mock_user_" + i);
            mockVehicle.setVehicleNumber("ABC" + (1000 + i));
            mockVehicle.setVehicleAvailability(statuses[i % 4]);
            mockVehicle.setVehicleBrand(brands[i % 6]);
            mockVehicle.setVehicleRating((float) (3 + (i % 3)));
            mockVehicle.setVerificationStatus(verificationStatuses[i % 2]);

            vehicleList.add(mockVehicle);
        }
        applyFilter();
        Log.d(TAG, "Tải dữ liệu giả: " + vehicleList.size() + " xe");
    }

    private void performSearch() {
        currentQuery.setValue(editTextSearch.getText().toString().trim().toLowerCase());
    }

    private void showFilterDialog() {
        AlertDialog.Builder builder = new AlertDialog.Builder(requireContext());
        View dialogView = LayoutInflater.from(requireContext()).inflate(R.layout.dialog_vehicle_filter, null);
        builder.setView(dialogView);

        // Initialize dialog views
        Spinner spinnerBrand = dialogView.findViewById(R.id.spinner_brand);
        Spinner spinnerAvailability = dialogView.findViewById(R.id.spinner_availability);
        Spinner spinnerVerification = dialogView.findViewById(R.id.spinner_verification);
        TextView tvFuelTypeLabel = dialogView.findViewById(R.id.tv_fuel_type_label);
        Spinner spinnerFuelType = dialogView.findViewById(R.id.spinner_fuel_type);
        TextView tvPriceLabel = dialogView.findViewById(R.id.tv_price_label);
        RangeSlider sliderPrice = dialogView.findViewById(R.id.slider_price);
        RangeSlider sliderRating = dialogView.findViewById(R.id.slider_rating);
        Button btnApply = dialogView.findViewById(R.id.btn_apply_filter);
        Button btnClear = dialogView.findViewById(R.id.btn_clear_filter);
        Button btnCancel = dialogView.findViewById(R.id.btn_cancel);

        // Hide Customer-specific fields
        tvFuelTypeLabel.setVisibility(View.GONE);
        spinnerFuelType.setVisibility(View.GONE);
        tvPriceLabel.setVisibility(View.GONE);
        sliderPrice.setVisibility(View.GONE);

        // Setup spinners
        List<String> brands = new ArrayList<>(Arrays.asList(getString(R.string.all_brands), "Vinfast", "Honda", "Mercedes", "BMW", "Ford", "Toyota"));
        List<String> availabilities = new ArrayList<>(Arrays.asList(getString(R.string.all_availability), "renting", "available", "maintenance", "pending"));
        List<String> verifications = new ArrayList<>(Arrays.asList(getString(R.string.all_verification), "verified", "pending"));
        ArrayAdapter<String> brandAdapter = new ArrayAdapter<>(requireContext(), android.R.layout.simple_spinner_item, brands);
        ArrayAdapter<String> availabilityAdapter = new ArrayAdapter<>(requireContext(), android.R.layout.simple_spinner_item, availabilities);
        ArrayAdapter<String> verificationAdapter = new ArrayAdapter<>(requireContext(), android.R.layout.simple_spinner_item, verifications);
        brandAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        availabilityAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        verificationAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        spinnerBrand.setAdapter(brandAdapter);
        spinnerAvailability.setAdapter(availabilityAdapter);
        spinnerVerification.setAdapter(verificationAdapter);

        // Set default filter values
        spinnerBrand.setSelection(currentBrand != null ? brands.indexOf(currentBrand) : 0);
        spinnerAvailability.setSelection(currentStatus != null ? availabilities.indexOf(currentStatus) : 0);
        spinnerVerification.setSelection(currentVerificationStatus != null ? verifications.indexOf(currentVerificationStatus) : 0);
        sliderRating.setValues(
                currentMinRating != null ? currentMinRating : 0.0f,
                currentMaxRating != null ? currentMaxRating : 5.0f
        );

        AlertDialog dialog = builder.create();

        btnApply.setOnClickListener(v -> {
            currentBrand = spinnerBrand.getSelectedItem().toString().equals(getString(R.string.all_brands)) ? null : spinnerBrand.getSelectedItem().toString();
            currentStatus = spinnerAvailability.getSelectedItem().toString().equals(getString(R.string.all_availability)) ? null : spinnerAvailability.getSelectedItem().toString();
            currentVerificationStatus = spinnerVerification.getSelectedItem().toString().equals(getString(R.string.all_verification)) ? null : spinnerVerification.getSelectedItem().toString();
            List<Float> ratingValues = sliderRating.getValues();
            currentMinRating = ratingValues.isEmpty() ? 0.0f : ratingValues.get(0);
            currentMaxRating = ratingValues.size() < 2 ? 5.0f : ratingValues.get(1);
            applyFilter();
            dialog.dismiss();
        });

        btnClear.setOnClickListener(v -> {
            currentBrand = null;
            currentStatus = null;
            currentVerificationStatus = null;
            currentMinRating = 0.0f;
            currentMaxRating = 5.0f;
            spinnerBrand.setSelection(0);
            spinnerAvailability.setSelection(0);
            spinnerVerification.setSelection(0);
            sliderRating.setValues(0.0f, 5.0f);
            applyFilter();
            dialog.dismiss();
        });

        btnCancel.setOnClickListener(v -> dialog.dismiss());

        dialog.show();
    }

    private void applyFilter() {
        String query = currentQuery.getValue() != null ? currentQuery.getValue() : "";
        List<String> keywords = Arrays.asList(query.split("\\s+"));
        List<Vehicle> filteredList = new ArrayList<>();

        for (Vehicle vehicle : vehicleList) {
            boolean matches = true;

            // Tìm kiếm theo từ khóa
            if (!query.isEmpty()) {
                boolean queryMatch = false;
                String name = vehicle.getVehicleName() != null ? vehicle.getVehicleName().toLowerCase() : "";
                String number = vehicle.getVehicleNumber() != null ? vehicle.getVehicleNumber().toLowerCase() : "";
                for (String keyword : keywords) {
                    if (!keyword.isEmpty()) {
                        queryMatch |= name.contains(keyword) || number.contains(keyword);
                    }
                }
                matches &= queryMatch;
            }

            // Lọc theo thương hiệu
            if (currentBrand != null) {
                matches &= vehicle.getVehicleBrand() != null && vehicle.getVehicleBrand().equalsIgnoreCase(currentBrand);
            }

            // Lọc theo trạng thái sẵn sàng
            if (currentStatus != null) {
                matches &= vehicle.getVehicleAvailability() != null && vehicle.getVehicleAvailability().equalsIgnoreCase(currentStatus);
            }

            // Lọc theo trạng thái xác minh
            if (currentVerificationStatus != null) {
                matches &= vehicle.getVerificationStatus() != null && vehicle.getVerificationStatus().equalsIgnoreCase(currentVerificationStatus);
            }

            // Lọc theo điểm đánh giá
            Float rating = vehicle.getVehicleRating();
            float finalRating = rating != null ? rating : 0.0f;
            matches &= finalRating >= currentMinRating && finalRating <= currentMaxRating;

            if (matches) {
                filteredList.add(vehicle);
            }
        }

        filteredVehicleList.setValue(filteredList);
        Log.d(TAG, "Áp dụng bộ lọc, kết quả: " + filteredList.size() + " xe");
    }
}
```

### FragmentPages\Admin\RequestSupplementDialogFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.DialogFragment;
import com.uit.carrental.R;

public class RequestSupplementDialogFragment extends DialogFragment {

    private static final String ARG_RECIPIENT_ID = "recipient_id";
    private static final String ARG_VEHICLE_ID = "vehicle_id";
    private static final String ARG_TYPE = "type";

    private String recipientId;
    private String vehicleId;
    private String type;
    private OnSubmitListener onSubmitListener;

    public interface OnSubmitListener {
        void onSubmit(String message);
    }

    public static RequestSupplementDialogFragment newInstance(String recipientId, String vehicleId, String type) {
        RequestSupplementDialogFragment fragment = new RequestSupplementDialogFragment();
        Bundle args = new Bundle();
        args.putString(ARG_RECIPIENT_ID, recipientId);
        args.putString(ARG_VEHICLE_ID, vehicleId);
        args.putString(ARG_TYPE, type);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getArguments() != null) {
            recipientId = getArguments().getString(ARG_RECIPIENT_ID);
            vehicleId = getArguments().getString(ARG_VEHICLE_ID);
            type = getArguments().getString(ARG_TYPE);
        }
    }

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.dialog_request_supplement, container, false);

        TextView tvTitle = view.findViewById(R.id.rk1bxbo5ts2e);
        EditText etMessage = view.findViewById(R.id.ro1uxzv0nk4);
        LinearLayout btnSubmit = view.findViewById(R.id.r7nlv9onk9j3);
        ImageView btnClose = view.findViewById(R.id.close_cicle);

        tvTitle.setText(type.equals("violation_warning") ? "Cảnh báo vi phạm" : "Yêu cầu bổ sung");
        etMessage.setHint(type.equals("violation_warning") ? "Nhập lý do vi phạm..." : "Nhập yêu cầu bổ sung...");

        btnSubmit.setOnClickListener(v -> {
            String message = etMessage.getText().toString().trim();
            if (!message.isEmpty() && onSubmitListener != null) {
                onSubmitListener.onSubmit(message);
                dismiss();
            }
        });

        btnClose.setOnClickListener(v -> dismiss());

        return view;
    }

    public void setOnSubmitListener(OnSubmitListener listener) {
        this.onSubmitListener = listener;
    }
}
```

### FragmentPages\Admin\SimpleBarChart.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.util.AttributeSet;
import android.view.View;
import androidx.annotation.Nullable;

public class SimpleBarChart extends View {
    private final Paint paint;
    private float[] values = {800, 2000, 600, 1200, 400, 3000, 100};

    public SimpleBarChart(Context context) {
        super(context);
        paint = new Paint();
        paint.setAntiAlias(true);
    }

    public SimpleBarChart(Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
        paint = new Paint();
        paint.setAntiAlias(true);
    }

    public SimpleBarChart(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        paint = new Paint();
        paint.setAntiAlias(true);
    }

    public void setValues(float[] newValues) {
        this.values = newValues;
        invalidate();
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        float width = getWidth();
        float height = getHeight();
        float barWidth = width / 10f;
        float maxHeight = height * 0.8f;

        int[] colors = {Color.parseColor("#3DD34C"), Color.parseColor("#6D62F7")};

        for (int i = 0; i < values.length; i++) {
            paint.setColor(colors[i % 2]);
            float left = i * barWidth * 1.2f + barWidth * 0.1f;
            float top = height - (values[i] / 3000 * maxHeight);
            float right = left + barWidth;
            float bottom = height;
            canvas.drawRect(left, top, right, bottom, paint);
        }
    }
}
```

### FragmentPages\Admin\UserStatsActivity.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.os.Bundle;
import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import com.bumptech.glide.Glide;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.Query;
import com.uit.carrental.R;

public class UserStatsActivity extends AppCompatActivity {

    private FirebaseFirestore db;
    private TextView totalUsersText, verifiedUsersText, blockedUsersText;
    private TextView roleFilterText, weekFilterText, monthFilterText;
    private String currentRoleFilter = "all"; // Mặc định: Tất cả
    private String currentTimeFilter = "week"; // Mặc định: Tuần này

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_user_stats);

        // Initialize Firebase
        db = FirebaseFirestore.getInstance();

        // Initialize views
        totalUsersText = findViewById(R.id.rbnyyf0spm7); // Tổng người dùng
        verifiedUsersText = findViewById(R.id.rhnirr1sgd5v); // Đã xác minh
        blockedUsersText = findViewById(R.id.r16az2h4g5wq); // Bị khóa
        roleFilterText = findViewById(R.id.r2wdtx5r7t1z); // Lọc vai trò
        weekFilterText = findViewById(R.id.ri2lrieii73); // Tuần này
        monthFilterText = findViewById(R.id.rqf6h1ypj6yc); // Tháng này

        // Load images with Glide
        Glide.with(this)
                .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/6u69svtl_expires_30_days.png")
                .into((ImageView) findViewById(R.id.r44o74nwoz3c));
        Glide.with(this)
                .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/x890qmzm_expires_30_days.png")
                .into((ImageView) findViewById(R.id.r7pj51g0csi3));
        Glide.with(this)
                .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/01lxgpk7_expires_30_days.png")
                .into((ImageView) findViewById(R.id.rtpvn3lra5m));

        // Setup click listeners for filters
        findViewById(R.id.rgcqxgwhq1ni).setOnClickListener(v -> {
            toggleRoleFilter();
            loadUserStats();
        });

        findViewById(R.id.rnlm6qxgv01).setOnClickListener(v -> {
            currentTimeFilter = "week";
            updateTimeFilterUI();
            loadUserStats();
        });

        findViewById(R.id.ranjw4ubsk1p).setOnClickListener(v -> {
            currentTimeFilter = "month";
            updateTimeFilterUI();
            loadUserStats();
        });

        // Load initial stats
        loadUserStats();
    }

    private void toggleRoleFilter() {
        switch (currentRoleFilter) {
            case "all":
                currentRoleFilter = "admin";
                roleFilterText.setText("Admin");
                break;
            case "admin":
                currentRoleFilter = "owner";
                roleFilterText.setText("Chủ xe");
                break;
            case "owner":
                currentRoleFilter = "renter";
                roleFilterText.setText("Người thuê");
                break;
            case "renter":
                currentRoleFilter = "all";
                roleFilterText.setText("Tất cả");
                break;
        }
    }

    private void updateTimeFilterUI() {
        if (currentTimeFilter.equals("week")) {
            weekFilterText.setBackgroundResource(R.drawable.cr8b0b54da5e);
            monthFilterText.setBackgroundResource(R.drawable.cr8b00308726);
        } else {
            weekFilterText.setBackgroundResource(R.drawable.cr8b00308726);
            monthFilterText.setBackgroundResource(R.drawable.cr8b0b54da5e);
        }
    }

    private void loadUserStats() {
        long timeThreshold = currentTimeFilter.equals("week")
                ? System.currentTimeMillis() - 7L * 24 * 60 * 60 * 1000
                : System.currentTimeMillis() - 30L * 24 * 60 * 60 * 1000;

        // Tổng người dùng
        Query totalQuery = db.collection("Users");
        if (!currentRoleFilter.equals("all")) {
            totalQuery = totalQuery.whereEqualTo("roles." + currentRoleFilter, true);
        }
        totalQuery.whereGreaterThan("createdAt", timeThreshold)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    totalUsersText.setText(String.format("%,d", querySnapshot.size()));
                })
                .addOnFailureListener(e -> {
                    totalUsersText.setText("0");
                });

        // Người dùng đã xác minh
        Query verifiedQuery = db.collection("Users")
                .whereEqualTo("verificationStatus", "verified");
        if (!currentRoleFilter.equals("all")) {
            verifiedQuery = verifiedQuery.whereEqualTo("roles." + currentRoleFilter, true);
        }
        verifiedQuery.whereGreaterThan("createdAt", timeThreshold)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    verifiedUsersText.setText(String.format("%,d", querySnapshot.size()));
                })
                .addOnFailureListener(e -> {
                    verifiedUsersText.setText("0");
                });

        // Người dùng bị khóa
        Query blockedQuery = db.collection("Users")
                .whereEqualTo("verificationStatus", "blocked");
        if (!currentRoleFilter.equals("all")) {
            blockedQuery = blockedQuery.whereEqualTo("roles." + currentRoleFilter, true);
        }
        blockedQuery.whereGreaterThan("createdAt", timeThreshold)
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    blockedUsersText.setText(String.format("%,d", querySnapshot.size()));
                })
                .addOnFailureListener(e -> {
                    blockedUsersText.setText("0");
                });
    }
}

```

### FragmentPages\Admin\UserStatsFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import com.bumptech.glide.Glide;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.Timestamp;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import java.util.HashMap;
import java.util.Map;

public class UserStatsFragment extends Fragment {

    private static final String TAG = "UserStatsFragment";
    private FirebaseFirestore db;
    private String userId;
    private User user;
    private TextView tvUsername, tvUserInfo, tvCccdFrontLabel, tvCccdBackLabel, tvLicenseLabel;
    private ImageView imgCccdFront, imgCccdBack, imgLicense, imgAvatar, imgBack; // Thêm imgBack
    private LinearLayout btnApprove, btnReject, btnRequestSupplement;

    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_user_stats, container, false);

        db = FirebaseFirestore.getInstance();
        userId = getArguments() != null ? getArguments().getString("userId") : null;
        if (userId == null) {
            Log.e(TAG, "Không tìm thấy userId");
            return view;
        }

        initViews(view);
        loadUserData();
        setupButtons();
        return view;
    }

    private void initViews(View view) {
        tvUsername = view.findViewById(R.id.rxntl0e8qr7m);
        tvUserInfo = view.findViewById(R.id.rhj4q0f9p29s);
        tvCccdFrontLabel = view.findViewById(R.id.rxem3gpl3efc);
        tvCccdBackLabel = view.findViewById(R.id.rf9ah2n56ocp);
        tvLicenseLabel = view.findViewById(R.id.resyxc24w8x);
        imgAvatar = view.findViewById(R.id.rjorhrg7xhw);
        imgCccdFront = view.findViewById(R.id.r6ijhjkh2w4x);
        imgCccdBack = view.findViewById(R.id.ri7x9glaq17);
        imgLicense = view.findViewById(R.id.rnou1o5qbz7l);
        btnApprove = view.findViewById(R.id.rygcfobvaozi);
        btnReject = view.findViewById(R.id.rgfc3wpe0gx);
        btnRequestSupplement = view.findViewById(R.id.ry07qbxzq9t);
        imgBack = view.findViewById(R.id.rj72dc7rtuc); // Khởi tạo nút back

        // Thêm sự kiện nhấn cho nút back
        imgBack.setOnClickListener(v -> {
            Log.d(TAG, "Nút back được nhấn");
            getParentFragmentManager().popBackStack(); // Quay lại AdminUserListFragment
        });
    }

    private void loadUserData() {
        db.collection("Users").document(userId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        user = document.toObject(User.class);
                        if (user != null) {
                            tvUsername.setText(user.getUsername() != null ? user.getUsername() : "Không xác định");
                            tvUserInfo.setText(String.format("Email: %s\nSĐT: %s",
                                    user.getEmail() != null ? user.getEmail() : "N/A",
                                    user.getPhoneNumber() != null ? user.getPhoneNumber() : "N/A"));
                            Glide.with(this)
                                    .load(user.getAvatarUrl() != null ? user.getAvatarUrl() : R.drawable.ic_person)
                                    .into(imgAvatar);
                            Glide.with(this)
                                    .load(user.getCiCardFront() != null ? user.getCiCardFront() : R.drawable.ic_car)
                                    .into(imgCccdFront);
                            Glide.with(this)
                                    .load(user.getCiCardBehind() != null ? user.getCiCardBehind() : R.drawable.ic_car)
                                    .into(imgCccdBack);
                            Glide.with(this)
                                    .load(user.getLicenseUrl() != null ? user.getLicenseUrl() : R.drawable.ic_car)
                                    .into(imgLicense);
                            // Kiểm tra trạng thái xác minh để ẩn nút Duyệt nếu đã duyệt
                            if ("verified".equals(user.getVerificationStatus())) {
                                btnApprove.setVisibility(View.GONE);
                            }
                        }
                    }
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi tải dữ liệu user: " + e.getMessage()));
    }

    private void setupButtons() {
        btnApprove.setOnClickListener(v -> approveUser());
        btnReject.setOnClickListener(v -> rejectUser());
        btnRequestSupplement.setOnClickListener(v -> showSupplementDialog());
    }

    private void approveUser() {
        Map<String, Object> updates = new HashMap<>();
        updates.put("verificationStatus", "verified");
        db.collection("Users").document(userId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    sendNotification(userId, "Tài khoản đã được duyệt",
                            "Tài khoản của bạn đã được duyệt thành công.", "user_verification", null, "customer");
                    btnApprove.setVisibility(View.GONE); // Ẩn nút Duyệt sau khi duyệt thành công
                    Log.d(TAG, "Đã duyệt tài khoản và ẩn nút Duyệt");
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi duyệt user: " + e.getMessage()));
    }

    private void rejectUser() {
        Map<String, Object> updates = new HashMap<>();
        updates.put("verificationStatus", "rejected");
        db.collection("Users").document(userId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    sendNotification(userId, "Tài khoản bị từ chối",
                            "Tài khoản của bạn đã bị từ chối.", "user_verification", null, "customer");
                    getActivity().finish(); // Giữ nguyên logic gốc
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi từ chối user: " + e.getMessage()));
    }

    private void showSupplementDialog() {
        RequestSupplementDialogFragment dialog = RequestSupplementDialogFragment.newInstance(userId, null, "supplement_request_user");
        dialog.setOnSubmitListener(message -> {
            Map<String, Object> updates = new HashMap<>();
            updates.put("verificationStatus", "rejected");
            db.collection("Users").document(userId)
                    .update(updates)
                    .addOnSuccessListener(aVoid -> {
                        sendNotification(userId, "Yêu cầu bổ sung thông tin",
                                "Tài khoản của bạn cần bổ sung: " + message, "supplement_request_user", null, "customer");
                        getActivity().finish(); // Giữ nguyên logic gốc
                    })
                    .addOnFailureListener(e -> Log.e(TAG, "Lỗi gửi yêu cầu bổ sung: " + e.getMessage()));
        });
        dialog.show(getParentFragmentManager(), "RequestSupplementDialog");
    }

    private void sendNotification(String userId, String title, String message, String type, String vehicleId, String role) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("userId", userId);
        notification.put("title", title);
        notification.put("message", message);
        notification.put("type", type);
        notification.put("vehicleId", vehicleId != null ? vehicleId : "");
        notification.put("createdAt", Timestamp.now());
        notification.put("isRead", false);
        notification.put("role", role); // Thêm trường role

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    String notificationId = documentReference.getId();
                    db.collection("Notifications").document(notificationId)
                            .update("notificationId", notificationId)
                            .addOnSuccessListener(aVoid -> Log.d(TAG, "Gửi thông báo thành công, ID: " + notificationId))
                            .addOnFailureListener(e -> Log.e(TAG, "Lỗi cập nhật notificationId: " + e.getMessage()));
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi gửi thông báo: " + e.getMessage()));
    }
}

```

### FragmentPages\Admin\VehicleFilterFragment.java
```java
package com.uit.carrental.FragmentPages.Admin;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import com.bumptech.glide.Glide;
import com.google.android.material.imageview.ShapeableImageView;
import com.uit.carrental.R;

public class VehicleFilterFragment extends Fragment {

    private LinearLayout buttonVinfast, buttonHonda, buttonMercedes, buttonBMW, buttonFord, buttonToyota;
    private LinearLayout buttonRenting, buttonAvailable, buttonMaintenance, buttonPending;
    private LinearLayout buttonVerified, buttonUnverified;
    private LinearLayout buttonRating5, buttonRating5to4, buttonRating4, buttonRating3, buttonRating2to1;
    private LinearLayout buttonReset, buttonConfirm;
    private ImageView buttonClose;
    private String selectedBrand;
    private String selectedStatus;
    private String selectedVerificationStatus;
    private Float selectedMinRating, selectedMaxRating;
    private FilterCallback callback;

    public interface FilterCallback {
        void onFilterApplied(String brand, String status, String verificationStatus, Float minRating, Float maxRating);
    }

    public static VehicleFilterFragment newInstance(FilterCallback callback) {
        VehicleFilterFragment fragment = new VehicleFilterFragment();
        fragment.callback = callback;
        return fragment;
    }

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_vehicle_filter, container, false);

        initViews(view);
        loadStaticImages(view);
        setupFilterButtons(view);

        buttonReset.setOnClickListener(v -> resetFilters());
        buttonConfirm.setOnClickListener(v -> applyFilters());
        buttonClose.setOnClickListener(v -> closeFragment());

        return view;
    }

    private void initViews(View view) {
        buttonVinfast = view.findViewById(R.id.re5bkjyzw71a);
        buttonHonda = view.findViewById(R.id.r29lmqq8qqka);
        buttonMercedes = view.findViewById(R.id.r5wpc3jutt9d);
        buttonBMW = view.findViewById(R.id.r047t6es9ecg6);
        buttonFord = view.findViewById(R.id.rwviyruuyw0d);
        buttonToyota = view.findViewById(R.id.r2lvmia82fj5);
        buttonRenting = view.findViewById(R.id.rv2rbtkh118);
        buttonAvailable = view.findViewById(R.id.rzvu0zdr3b79);
        buttonMaintenance = view.findViewById(R.id.rpdbvxqwor8);
        buttonPending = view.findViewById(R.id.r14thtgj04tg);
        buttonVerified = view.findViewById(R.id.r_verified);
        buttonUnverified = view.findViewById(R.id.r_unverified);
        buttonRating5 = view.findViewById(R.id.rozw79prjrbs);
        buttonRating5to4 = view.findViewById(R.id.rx3ytiykf6v);
        buttonRating4 = view.findViewById(R.id.rsooed0x193);
        buttonRating3 = view.findViewById(R.id.rusqd789cwjj);
        buttonRating2to1 = view.findViewById(R.id.ru6lopcq6jh);
        buttonConfirm = view.findViewById(R.id.rt94tooyri0r);
        buttonReset = view.findViewById(R.id.rvai73xq5syc);
        buttonClose = view.findViewById(R.id.rz3n8dabzscm);
    }

    private void loadStaticImages(View view) {
        if (getContext() != null) {
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/7l1ioa0k_expires_30_days.png")
                    .into((ImageView) view.findViewById(R.id.rz3n8dabzscm));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/inzw1wo3_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.r4y8nv6c7mpc));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/asva4ip1_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.rb6215hqc4bl));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/zlhcok6g_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.rtnetjohacza));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/s5ugz48w_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.rw0l5x2vl8bi));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/m0hnc1ol_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.rwwi7sxl6nz));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/hvjc3cad_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.rayfaxchsqb8));
            Glide.with(getContext())
                    .load("https://storage.googleapis.com/tagjs-prod.appspot.com/v1/3ysO8Aie7W/13zcccmz_expires_30_days.png")
                    .into((ShapeableImageView) view.findViewById(R.id.r46s7tlb9ka4));
        }
    }

    private void setupFilterButtons(View view) {
        // Loại xe
        View.OnClickListener brandClickListener = v -> {
            int id = v.getId();
            if (id == R.id.re5bkjyzw71a) {
                selectedBrand = "Vinfast";
            } else if (id == R.id.r29lmqq8qqka) {
                selectedBrand = "Honda";
            } else if (id == R.id.r5wpc3jutt9d) {
                selectedBrand = "Mercedes";
            } else if (id == R.id.r047t6es9ecg6) {
                selectedBrand = "BMW";
            } else if (id == R.id.rwviyruuyw0d) {
                selectedBrand = "Ford";
            } else if (id == R.id.r2lvmia82fj5) {
                selectedBrand = "Toyota";
            } else {
                selectedBrand = null;
            }
            updateBrandButtonUI(id);
        };
        buttonVinfast.setOnClickListener(brandClickListener);
        buttonHonda.setOnClickListener(brandClickListener);
        buttonMercedes.setOnClickListener(brandClickListener);
        buttonBMW.setOnClickListener(brandClickListener);
        buttonFord.setOnClickListener(brandClickListener);
        buttonToyota.setOnClickListener(brandClickListener);

        // Trạng thái
        View.OnClickListener statusClickListener = v -> {
            int id = v.getId();
            if (id == R.id.rv2rbtkh118) {
                selectedStatus = "renting";
            } else if (id == R.id.rzvu0zdr3b79) {
                selectedStatus = "available";
            } else if (id == R.id.rpdbvxqwor8) {
                selectedStatus = "maintenance";
            } else if (id == R.id.r14thtgj04tg) {
                selectedStatus = "pending";
            } else {
                selectedStatus = null;
            }
            updateStatusButtonUI(id);
        };
        buttonRenting.setOnClickListener(statusClickListener);
        buttonAvailable.setOnClickListener(statusClickListener);
        buttonMaintenance.setOnClickListener(statusClickListener);
        buttonPending.setOnClickListener(statusClickListener);

        // Trạng thái duyệt
        View.OnClickListener verificationStatusClickListener = v -> {
            int id = v.getId();
            if (id == R.id.r_verified) {
                selectedVerificationStatus = "verified";
            } else if (id == R.id.r_unverified) {
                selectedVerificationStatus = "pending";
            } else {
                selectedVerificationStatus = null;
            }
            updateVerificationStatusButtonUI(id);
        };
        buttonVerified.setOnClickListener(verificationStatusClickListener);
        buttonUnverified.setOnClickListener(verificationStatusClickListener);

        // Đánh giá
        View.OnClickListener ratingClickListener = v -> {
            int id = v.getId();
            if (id == R.id.rozw79prjrbs) {
                selectedMinRating = 5.0f;
                selectedMaxRating = 5.0f;
            } else if (id == R.id.rx3ytiykf6v) {
                selectedMinRating = 4.0f;
                selectedMaxRating = 5.0f;
            } else if (id == R.id.rsooed0x193) {
                selectedMinRating = 4.0f;
                selectedMaxRating = 4.0f;
            } else if (id == R.id.rusqd789cwjj) {
                selectedMinRating = 3.0f;
                selectedMaxRating = 3.0f;
            } else if (id == R.id.ru6lopcq6jh) {
                selectedMinRating = 1.0f;
                selectedMaxRating = 2.0f;
            } else {
                selectedMinRating = null;
                selectedMaxRating = null;
            }
            updateRatingButtonUI(id);
        };
        buttonRating5.setOnClickListener(ratingClickListener);
        buttonRating5to4.setOnClickListener(ratingClickListener);
        buttonRating4.setOnClickListener(ratingClickListener);
        buttonRating3.setOnClickListener(ratingClickListener);
        buttonRating2to1.setOnClickListener(ratingClickListener);
    }

    private void updateBrandButtonUI(int selectedId) {
        int selectedBg = R.drawable.s003087sw1cr100b0030871f;
        int defaultBg = R.drawable.s4d3a4dsw1cr100;
        buttonVinfast.setBackgroundResource(selectedId == R.id.re5bkjyzw71a ? selectedBg : defaultBg);
        buttonHonda.setBackgroundResource(selectedId == R.id.r29lmqq8qqka ? selectedBg : defaultBg);
        buttonMercedes.setBackgroundResource(selectedId == R.id.r5wpc3jutt9d ? selectedBg : defaultBg);
        buttonBMW.setBackgroundResource(selectedId == R.id.r047t6es9ecg6 ? selectedBg : defaultBg);
        buttonFord.setBackgroundResource(selectedId == R.id.rwviyruuyw0d ? selectedBg : defaultBg);
        buttonToyota.setBackgroundResource(selectedId == R.id.r2lvmia82fj5 ? selectedBg : defaultBg);
    }

    private void updateStatusButtonUI(int selectedId) {
        buttonRenting.setBackgroundResource(selectedId == R.id.rv2rbtkh118 ? R.drawable.s003087sw1cr100b0030871f : R.drawable.s4d3a4dsw1cr100);
        buttonAvailable.setBackgroundResource(selectedId == R.id.rzvu0zdr3b79 ? R.drawable.s003087sw1cr100b0030871f : R.drawable.s4d3a4dsw1cr100);
        buttonMaintenance.setBackgroundResource(selectedId == R.id.rpdbvxqwor8 ? R.drawable.sb60101sw1cr100bb6050233 : R.drawable.s4d3a4dsw1cr100);
        buttonPending.setBackgroundResource(selectedId == R.id.r14thtgj04tg ? R.drawable.sb66e01sw1cr100bb64d0233 : R.drawable.s4d3a4dsw1cr100);
    }

    private void updateVerificationStatusButtonUI(int selectedId) {
        int selectedBg = R.drawable.s003087sw1cr100b0030871f;
        int defaultBg = R.drawable.s4d3a4dsw1cr100;
        buttonVerified.setBackgroundResource(selectedId == R.id.r_verified ? selectedBg : defaultBg);
        buttonUnverified.setBackgroundResource(selectedId == R.id.r_unverified ? selectedBg : defaultBg);
    }

    private void updateRatingButtonUI(int selectedId) {
        int defaultBg = R.drawable.s4d3a4dsw1cr100;
        buttonRating5.setBackgroundResource(selectedId == R.id.rozw79prjrbs ? R.drawable.s4d3a4dsw1cr100bffbc7d33 : defaultBg);
        buttonRating5to4.setBackgroundResource(selectedId == R.id.rx3ytiykf6v ? R.drawable.s4d3a4dsw1cr100bffbc7d33 : defaultBg);
        buttonRating4.setBackgroundResource(selectedId == R.id.rsooed0x193 ? R.drawable.s4d3a4dsw1cr100bffbc7d33 : defaultBg);
        buttonRating3.setBackgroundResource(selectedId == R.id.rusqd789cwjj ? R.drawable.s4d3a4dsw1cr100bffbc7d33 : defaultBg);
        buttonRating2to1.setBackgroundResource(selectedId == R.id.ru6lopcq6jh ? R.drawable.s4d3a4dsw1cr100bffbc7d33 : defaultBg);
    }

    private void resetFilters() {
        selectedBrand = null;
        selectedStatus = null;
        selectedVerificationStatus = null;
        selectedMinRating = null;
        selectedMaxRating = null;
        updateBrandButtonUI(0);
        updateStatusButtonUI(0);
        updateVerificationStatusButtonUI(0);
        updateRatingButtonUI(0);
    }

    private void applyFilters() {
        if (callback != null) {
            callback.onFilterApplied(selectedBrand, selectedStatus, selectedVerificationStatus, selectedMinRating, selectedMaxRating);
        }
        if (getParentFragmentManager() != null) {
            getParentFragmentManager().popBackStack();
        }
    }

    private void closeFragment() {
        if (getParentFragmentManager() != null) {
            getParentFragmentManager().popBackStack();
        }
    }
}

```

### FragmentPages\Customer\ChatFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.MessageAdapter;
import com.uit.carrental.Model.Message;
import com.uit.carrental.R;

import org.json.JSONArray;
import org.json.JSONObject;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import okhttp3.Call;
import okhttp3.Callback;
import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;

public class ChatFragment extends Fragment {
    private RecyclerView chatRecyclerView;
    private EditText messageInput;
    private ImageView sendButton;
    private ImageView closeButton;
    private MessageAdapter messageAdapter;
    private List<Message> messages;
    private LinearLayout draggableChatContainer;
    private float dX, dY;
    private int lastAction;
    private OkHttpClient client;
    private FirebaseFirestore db;
    private List<String> vehicleNames;

    private static final String HUGGINGFACE_API_KEY = "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";
    private static final String API_URL = "https://api-inference.huggingface.co/models/meta-llama/Llama-3.1-8B-Instruct";

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,
                             @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_chat, container, false);

        // Initialize views
        chatRecyclerView = view.findViewById(R.id.chat_recycler_view);
        messageInput = view.findViewById(R.id.message_input);
        sendButton = view.findViewById(R.id.send_button);
        closeButton = view.findViewById(R.id.close_button);
        draggableChatContainer = view.findViewById(R.id.draggable_chat_container);

        // Initialize OkHttpClient and Firestore
        client = new OkHttpClient();
        db = FirebaseFirestore.getInstance();
        vehicleNames = new ArrayList<>();

        // Load vehicle names from Firestore
        loadVehicleNames();

        // Setup RecyclerView
        messages = new ArrayList<>();
        messages.add(new Message("Chào bạn! T9 Car Rental luôn sẵn sàng hỗ trợ.", false));
        messageAdapter = new MessageAdapter(messages);
        LinearLayoutManager layoutManager = new LinearLayoutManager(getContext());
        layoutManager.setStackFromEnd(true);
        chatRecyclerView.setLayoutManager(layoutManager);
        chatRecyclerView.setAdapter(messageAdapter);

        // Send button click
        sendButton.setOnClickListener(v -> {
            String text = messageInput.getText().toString().trim();
            if (!text.isEmpty()) {
                messages.add(new Message(text, true));
                messageAdapter.notifyItemInserted(messages.size() - 1);
                chatRecyclerView.scrollToPosition(messages.size() - 1);
                messageInput.setText("");
                sendMessageToHuggingFace(text);
            }
        });

        // Close button click
        closeButton.setOnClickListener(v -> {
            getParentFragmentManager().popBackStack(); // Quay lại CustomerHomeFragment
        });

        // Draggable container
        draggableChatContainer.setOnTouchListener((v, event) -> {
            switch (event.getActionMasked()) {
                case MotionEvent.ACTION_DOWN:
                    dX = v.getX() - event.getRawX();
                    dY = v.getY() - event.getRawY();
                    lastAction = MotionEvent.ACTION_DOWN;
                    return true;
                case MotionEvent.ACTION_MOVE:
                    v.setY(event.getRawY() + dY);
                    v.setX(event.getRawX() + dX);
                    lastAction = MotionEvent.ACTION_MOVE;
                    return true;
                case MotionEvent.ACTION_UP:
                    if (lastAction == MotionEvent.ACTION_DOWN) {
                    }
                    return true;
                default:
                    return false;
            }
        });

        return view;
    }

    private void loadVehicleNames() {
        db.collection("Vehicles")
                .get()
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        vehicleNames.clear();
                        for (QueryDocumentSnapshot document : task.getResult()) {
                            String vehicleName = document.getString("vehicle_name");
                            if (vehicleName != null) {
                                vehicleNames.add(vehicleName);
                            }
                        }
                    } else {
                        Toast.makeText(getContext(), "Lỗi tải danh sách xe", Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void sendMessageToHuggingFace(String userMessage) {
        try {
            // Định dạng danh sách xe
            String vehicleList = vehicleNames.isEmpty() ? "Không có xe nào hiện tại." : vehicleNames.stream().collect(Collectors.joining(", "));
            // Prompt chuẩn cho Llama-3.1
            String prompt = "<|begin_of_text|>Bạn là nhân viên tư vấn thuê xe trực tuyến của T9 Car Rental. Dựa trên yêu cầu của khách hàng và danh sách xe hiện có (" + vehicleList + "), hãy đề xuất loại xe phù hợp nhất và giải thích ngắn gọn lý do. Trả lời thân thiện, chuyên nghiệp, tối đa 100 từ:\n" + userMessage + "<|end_of_text|>";

            JSONObject requestBody = new JSONObject();
            requestBody.put("inputs", prompt);
            requestBody.put("parameters", new JSONObject()
                    .put("max_new_tokens", 100)
                    .put("temperature", 0.7)
                    .put("top_p", 0.9));

            RequestBody body = RequestBody.create(
                    requestBody.toString(),
                    MediaType.parse("application/json; charset=utf-8")
            );

            Request request = new Request.Builder()
                    .url(API_URL)
                    .header("Authorization", "Bearer " + HUGGINGFACE_API_KEY)
                    .header("Content-Type", "application/json")
                    .post(body)
                    .build();

            client.newCall(request).enqueue(new Callback() {
                @Override
                public void onFailure(@NonNull Call call, @NonNull IOException e) {
                    getActivity().runOnUiThread(() -> {
                        Toast.makeText(getContext(), "Lỗi kết nối: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        messages.add(new Message("Lỗi kết nối, vui lòng thử lại.", false));
                        messageAdapter.notifyItemInserted(messages.size() - 1);
                        chatRecyclerView.scrollToPosition(messages.size() - 1);
                    });
                }

                @Override
                public void onResponse(@NonNull Call call, @NonNull Response response) throws IOException {
                    if (!response.isSuccessful()) {
                        getActivity().runOnUiThread(() -> {
                            Toast.makeText(getContext(), "Lỗi server: " + response.code(), Toast.LENGTH_SHORT).show();
                        });
                        return;
                    }

                    String responseBody = response.body().string();
                    try {
                        JSONArray jsonArray = new JSONArray(responseBody);
                        String rawResponse = jsonArray.getJSONObject(0).getString("generated_text");
                        final String aiResponse = rawResponse.replace(prompt, "").trim();

                        getActivity().runOnUiThread(() -> {
                            messages.add(new Message(aiResponse, false));
                            messageAdapter.notifyItemInserted(messages.size() - 1);
                            chatRecyclerView.scrollToPosition(messages.size() - 1);
                        });
                    } catch (Exception e) {
                        getActivity().runOnUiThread(() -> {
                            Toast.makeText(getContext(), "Lỗi phân tích phản hồi: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        });
                    }
                }
            });
        } catch (Exception e) {
            Toast.makeText(getContext(), "Lỗi tạo request: " + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }
}
```

### FragmentPages\Customer\CustomerActivityFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.ListenerRegistration;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.BookingAdapter;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.R;
import com.uit.carrental.Service.Booking.CustomerBookingDetailActivity;
import java.util.ArrayList;
import java.util.List;

public class CustomerActivityFragment extends Fragment {

    private static final String TAG = "CustomerActivityFragment";
    private RecyclerView recyclerView;
    private TextView tvEmpty;
    private BookingAdapter bookingAdapter;
    private List<Booking> bookingList;
    private FirebaseFirestore db;
    private FirebaseAuth auth;
    private ProgressDialog progressDialog;
    private ListenerRegistration bookingListener;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_activity, container, false);

        db = FirebaseFirestore.getInstance();
        auth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();

        recyclerView = view.findViewById(R.id.rv_activities);
        tvEmpty = view.findViewById(R.id.tv_empty);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        bookingList = new ArrayList<>();
        bookingAdapter = new BookingAdapter(bookingList, booking -> {
            Intent intent = new Intent(getContext(), CustomerBookingDetailActivity.class);
            intent.putExtra("bookingId", booking.getBookingId());
            startActivity(intent);
        });
        recyclerView.setAdapter(bookingAdapter);

        loadBookings();

        return view;
    }

    private void loadBookings() {
        String userId = auth.getCurrentUser().getUid();
        bookingListener = db.collection("Bookings")
                .whereEqualTo("customerId", userId)
                .addSnapshotListener((querySnapshot, error) -> {
                    if (error != null) {
                        Toast.makeText(getContext(), "Lỗi tải đơn hàng: " + error.getMessage(), Toast.LENGTH_SHORT).show();
                        progressDialog.dismiss();
                        return;
                    }
                    bookingList.clear();
                    if (querySnapshot != null) {
                        for (QueryDocumentSnapshot document : querySnapshot) {
                            Booking booking = document.toObject(Booking.class);
                            booking.setBookingId(document.getId());
                            bookingList.add(booking);
                        }
                    }
                    bookingAdapter.notifyDataSetChanged();
                    tvEmpty.setVisibility(bookingList.isEmpty() ? View.VISIBLE : View.GONE);
                    recyclerView.setVisibility(bookingList.isEmpty() ? View.GONE : View.VISIBLE);
                    progressDialog.dismiss();
                });
    }

    @Override
    public void onDestroyView() {
        super.onDestroyView();
        if (bookingListener != null) {
            bookingListener.remove();
        }
        if (progressDialog.isShowing()) {
            progressDialog.dismiss();
        }
    }
}

```

### FragmentPages\Customer\CustomerHomeFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.AlertDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentTransaction;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.android.material.floatingactionbutton.FloatingActionButton;
import com.google.android.material.slider.RangeSlider;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Adapter.VehicleAdapter;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.VehicleDetailActivity;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class CustomerHomeFragment extends Fragment {

    private static final String TAG = "CustomerHomeFragment";
    private RecyclerView recyclerViewVehicles;
    private LinearLayout buttonSearch;
    private ImageView imageViewFilter, imageViewSearch;
    private EditText editTextSearch;
    private FloatingActionButton fabChat;
    private VehicleAdapter vehicleAdapter;
    private List<Vehicle> vehicleList;
    private List<Vehicle> filteredVehicleList;
    private FirebaseFirestore db;
    private String currentQuery = "";
    private String currentBrand;
    private String currentFuelType;
    private Float currentMinRating, currentMaxRating;
    private Long currentMinPrice, currentMaxPrice;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_home, container, false);

        // Initialize Firebase
        db = FirebaseFirestore.getInstance();

        // Initialize views
        recyclerViewVehicles = view.findViewById(R.id.recycler_view_vehicles);
        buttonSearch = view.findViewById(R.id.search_container);
        imageViewFilter = view.findViewById(R.id.filter_button);
        imageViewSearch = view.findViewById(R.id.search_button);
        editTextSearch = view.findViewById(R.id.search_input);
        fabChat = view.findViewById(R.id.fab_chat);

        // Setup RecyclerView
        recyclerViewVehicles.setLayoutManager(new LinearLayoutManager(getContext()));
        vehicleList = new ArrayList<>();
        filteredVehicleList = new ArrayList<>();
        vehicleAdapter = new VehicleAdapter(this, new ArrayList<>(filteredVehicleList), position -> {
            Vehicle clickedVehicle = filteredVehicleList.get(position);
            Intent intent = new Intent(getContext(), VehicleDetailActivity.class);
            intent.putExtra("vehicleId", clickedVehicle.getVehicleId());
            startActivity(intent);
        });
        recyclerViewVehicles.setAdapter(vehicleAdapter);

        // Setup search
        setupSearch();

        // Setup filter
        setupFilter();

        // Setup FloatingActionButton
        fabChat.setOnClickListener(v -> openChatFragment());

        // Load vehicles
        loadVehicles();

        return view;
    }

    private void setupSearch() {
        buttonSearch.setOnClickListener(v -> performSearch());
        imageViewSearch.setOnClickListener(v -> performSearch());

        editTextSearch.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {}

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {}

            @Override
            public void afterTextChanged(Editable s) {
                currentQuery = s.toString().trim().toLowerCase();
                applyFilter();
            }
        });
    }

    private void setupFilter() {
        imageViewFilter.setOnClickListener(v -> showFilterDialog());
    }

    private void loadVehicles() {
        db.collection("Vehicles")
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    vehicleList.clear();
                    filteredVehicleList.clear();
                    for (DocumentSnapshot document : querySnapshot) {
                        Vehicle vehicle = document.toObject(Vehicle.class);
                        if (vehicle != null && vehicle.getVehicleId() != null &&
                                "verified".equals(vehicle.getVerificationStatus()) &&
                                "available".equals(vehicle.getVehicleAvailability())) {
                            vehicleList.add(vehicle);
                        }
                    }
                    applyFilter();
                    Log.d(TAG, "Tải " + vehicleList.size() + " xe từ Firestore");
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu: " + e.getMessage());
                    Toast.makeText(getContext(), "Lỗi tải dữ liệu: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    loadMockData();
                });
    }

    private void loadMockData() {
        vehicleList.clear();
        filteredVehicleList.clear();
        String[] brands = {"Vinfast", "Honda", "Mercedes", "BMW", "Ford", "Toyota"};
        String[] fuelTypes = {"Xăng", "Dầu", "Điện"};
        for (int i = 1; i <= 15; i++) {
            Vehicle mockVehicle = new Vehicle();
            mockVehicle.setVehicleId("mock_vehicle_" + i);
            mockVehicle.setVehicleName("Xe mẫu " + i);
            mockVehicle.setVehiclePrice(String.format("%d.000 VNĐ/Ngày", 300 + (i * 100)));
            mockVehicle.setVehicleImageUrl("https://example.com/car.jpg");
            mockVehicle.setOwnerId("mock_user_" + i);
            mockVehicle.setVehicleNumber("ABC" + (1000 + i));
            mockVehicle.setVehicleAvailability("available");
            mockVehicle.setVehicleBrand(brands[i % 6]);
            mockVehicle.setFuelType(fuelTypes[i % 3]);
            mockVehicle.setVehicleRating((float) (3 + (i % 3)));
            mockVehicle.setVerificationStatus("verified");
            vehicleList.add(mockVehicle);
        }
        applyFilter();
        Log.d(TAG, "Tải dữ liệu giả: " + vehicleList.size() + " xe");
    }

    private void performSearch() {
        currentQuery = editTextSearch.getText().toString().trim().toLowerCase();
        applyFilter();
    }

    private void showFilterDialog() {
        AlertDialog.Builder builder = new AlertDialog.Builder(requireContext());
        View dialogView = LayoutInflater.from(requireContext()).inflate(R.layout.dialog_vehicle_filter, null);
        builder.setView(dialogView);

        // Initialize dialog views
        Spinner spinnerBrand = dialogView.findViewById(R.id.spinner_brand);
        TextView tvAvailabilityLabel = dialogView.findViewById(R.id.tv_availability_label);
        Spinner spinnerAvailability = dialogView.findViewById(R.id.spinner_availability);
        TextView tvVerificationLabel = dialogView.findViewById(R.id.tv_verification_label);
        Spinner spinnerVerification = dialogView.findViewById(R.id.spinner_verification);
        Spinner spinnerFuelType = dialogView.findViewById(R.id.spinner_fuel_type);
        RangeSlider sliderPrice = dialogView.findViewById(R.id.slider_price);
        RangeSlider sliderRating = dialogView.findViewById(R.id.slider_rating);
        Button btnApply = dialogView.findViewById(R.id.btn_apply_filter);
        Button btnClear = dialogView.findViewById(R.id.btn_clear_filter);
        Button btnCancel = dialogView.findViewById(R.id.btn_cancel);

        // Hide Admin-specific fields
        tvAvailabilityLabel.setVisibility(View.GONE);
        spinnerAvailability.setVisibility(View.GONE);
        tvVerificationLabel.setVisibility(View.GONE);
        spinnerVerification.setVisibility(View.GONE);

        // Setup spinners
        List<String> brands = new ArrayList<>(Arrays.asList(getString(R.string.all_brands), "Vinfast", "Honda", "Mercedes", "BMW", "Ford", "Toyota"));
        List<String> fuelTypes = new ArrayList<>(Arrays.asList(getString(R.string.all_fuel_types), "Xăng", "Dầu", "Điện"));
        ArrayAdapter<String> brandAdapter = new ArrayAdapter<>(requireContext(), android.R.layout.simple_spinner_item, brands);
        ArrayAdapter<String> fuelTypeAdapter = new ArrayAdapter<>(requireContext(), android.R.layout.simple_spinner_item, fuelTypes);
        brandAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        fuelTypeAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        spinnerBrand.setAdapter(brandAdapter);
        spinnerFuelType.setAdapter(fuelTypeAdapter);

        // Set current filter values
        if (currentBrand != null) {
            spinnerBrand.setSelection(brands.indexOf(currentBrand));
        }
        if (currentFuelType != null) {
            spinnerFuelType.setSelection(fuelTypes.indexOf(currentFuelType));
        }
        if (currentMinRating != null && currentMaxRating != null) {
            sliderRating.setValues(currentMinRating, currentMaxRating);
        } else {
            sliderRating.setValues(0.0f, 5.0f); // Giá trị mặc định
        }
        if (currentMinPrice != null && currentMaxPrice != null) {
            sliderPrice.setValues(currentMinPrice.floatValue(), currentMaxPrice.floatValue());
        } else {
            sliderPrice.setValues(0.0f, 5000000.0f); // Giá trị mặc định
        }

        // Đảm bảo RangeSlider có giá trị hợp lệ
        sliderRating.setValueFrom(0.0f);
        sliderRating.setValueTo(5.0f);
        sliderRating.setStepSize(0.1f);
        sliderPrice.setValueFrom(0.0f);
        sliderPrice.setValueTo(5000000.0f);
        sliderPrice.setStepSize(1000.0f);

        AlertDialog dialog = builder.create();

        btnApply.setOnClickListener(v -> {
            currentBrand = spinnerBrand.getSelectedItem().toString().equals(getString(R.string.all_brands)) ? null : spinnerBrand.getSelectedItem().toString();
            currentFuelType = spinnerFuelType.getSelectedItem().toString().equals(getString(R.string.all_fuel_types)) ? null : spinnerFuelType.getSelectedItem().toString();

            // Kiểm tra ratingValues
            List<Float> ratingValues = sliderRating.getValues();
            if (ratingValues.size() >= 2) {
                currentMinRating = ratingValues.get(0);
                currentMaxRating = ratingValues.get(1);
            } else {
                Log.w(TAG, "ratingValues không đủ 2 phần tử: " + ratingValues.size());
                currentMinRating = 0.0f;
                currentMaxRating = 5.0f;
            }

            // Kiểm tra priceValues
            List<Float> priceValues = sliderPrice.getValues();
            if (priceValues.size() >= 2) {
                currentMinPrice = priceValues.get(0).longValue();
                currentMaxPrice = priceValues.get(1).longValue();
            } else {
                Log.w(TAG, "priceValues không đủ 2 phần tử: " + priceValues.size());
                currentMinPrice = 0L;
                currentMaxPrice = 5000000L;
            }

            applyFilter();
            dialog.dismiss();
        });

        btnClear.setOnClickListener(v -> {
            currentBrand = null;
            currentFuelType = null;
            currentMinRating = 0.0f;
            currentMaxRating = 5.0f;
            currentMinPrice = 0L;
            currentMaxPrice = 5000000L;
            spinnerBrand.setSelection(0);
            spinnerFuelType.setSelection(0);
            sliderRating.setValues(0.0f, 5.0f);
            sliderPrice.setValues(0.0f, 5000000.0f);
            applyFilter();
            dialog.dismiss();
        });

        btnCancel.setOnClickListener(v -> dialog.dismiss());

        dialog.show();
    }

    private void applyFilter() {
        filteredVehicleList.clear();
        for (Vehicle vehicle : vehicleList) {
            boolean matches = true;
            if (!currentQuery.isEmpty()) {
                matches &= vehicle.getVehicleName() != null && vehicle.getVehicleName().toLowerCase().contains(currentQuery);
            }
            if (currentBrand != null) {
                matches &= vehicle.getVehicleBrand() != null && vehicle.getVehicleBrand().equalsIgnoreCase(currentBrand);
            }
            if (currentFuelType != null) {
                matches &= vehicle.getFuelType() != null && vehicle.getFuelType().equalsIgnoreCase(currentFuelType);
            }
            if (currentMinRating != null && currentMaxRating != null) {
                matches &= vehicle.getVehicleRating() >= currentMinRating && vehicle.getVehicleRating() <= currentMaxRating;
            }
            if (currentMinPrice != null && currentMaxPrice != null) {
                long price = parsePrice(vehicle.getVehiclePrice());
                matches &= price >= currentMinPrice && price <= currentMaxPrice;
            }
            if (matches) {
                filteredVehicleList.add(vehicle);
            }
        }

        vehicleAdapter = new VehicleAdapter(this, new ArrayList<>(filteredVehicleList), position -> {
            Vehicle clickedVehicle = filteredVehicleList.get(position);
            Intent intent = new Intent(getContext(), VehicleDetailActivity.class);
            intent.putExtra("vehicleId", clickedVehicle.getVehicleId());
            startActivity(intent);
        });
        recyclerViewVehicles.setAdapter(vehicleAdapter);
        vehicleAdapter.notifyDataSetChanged();
        Log.d(TAG, "Cập nhật RecyclerView với " + filteredVehicleList.size() + " xe");
    }

    private long parsePrice(String priceString) {
        if (priceString == null || priceString.isEmpty()) {
            return 0;
        }
        try {
            String cleanPrice = priceString.replaceAll("[^0-9]", "");
            return Long.parseLong(cleanPrice);
        } catch (NumberFormatException e) {
            Log.e(TAG, "Lỗi phân tích giá: " + e.getMessage());
            return 0;
        }
    }

    private void openChatFragment() {
        FragmentTransaction transaction = getParentFragmentManager().beginTransaction();
        ChatFragment chatFragment = new ChatFragment();
        transaction.replace(R.id.frame_layout_customer, chatFragment, "CHAT_FRAGMENT");
        transaction.addToBackStack("CHAT_FRAGMENT");
        transaction.commit();
    }
}
```

### FragmentPages\Customer\CustomerNotificationFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.NotificationAdapter;
import com.uit.carrental.Model.Notification;
import com.uit.carrental.R;
import java.util.ArrayList;
import java.util.List;

public class CustomerNotificationFragment extends Fragment {

    private static final String TAG = "CustomerNotification";
    private RecyclerView recyclerView;
    private NotificationAdapter notificationAdapter;
    private List<Notification> notificationList;
    private FirebaseFirestore db;
    private TextView tvEmpty;

    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_notification, container, false);


        db = FirebaseFirestore.getInstance();
        notificationList = new ArrayList<>();
        recyclerView = view.findViewById(R.id.rv_notifications);
        tvEmpty = view.findViewById(R.id.tv_empty);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));
        recyclerView.setHasFixedSize(false);
        notificationAdapter = new NotificationAdapter(notificationList, notification -> {
            Log.d(TAG, "Thông báo được nhấn: " + notification.getNotificationId());
        });
        recyclerView.setAdapter(notificationAdapter);

        loadNotifications();
        recyclerView.post(() -> Log.d(TAG, "RecyclerView hiển thị: " + recyclerView.isShown()));
        return view;
    }

    private void loadNotifications() {
        String userId = FirebaseAuth.getInstance().getCurrentUser() != null ?
                FirebaseAuth.getInstance().getCurrentUser().getUid() : null;
        Log.d(TAG, "Current userId: " + userId);

        if (userId == null) {
            Toast.makeText(getContext(), "Người dùng chưa đăng nhập", Toast.LENGTH_SHORT).show();
            recyclerView.setVisibility(View.GONE);
            tvEmpty.setVisibility(View.VISIBLE);
            return;
        }

        try {
            db.collection("Notifications")
                    .get()
                    .addOnSuccessListener(querySnapshot -> {
                        Log.d(TAG, "Số tài liệu nhận được: " + querySnapshot.size());
                        notificationList.clear();
                        for (QueryDocumentSnapshot doc : querySnapshot) {
                            try {
                                Notification notification = doc.toObject(Notification.class);
                                notification.setNotificationId(doc.getId());
                                // Lọc thông báo cho customer
                                if (notification.getUserId() != null && notification.getUserId().equals(userId) &&
                                        "customer".equals(notification.getRole()) &&
                                        (notification.getType().equals("user_verification") ||
                                                notification.getType().equals("new_booking") ||
                                                notification.getType().equals("status_update") ||
                                                notification.getType().equals("supplement_request_user"))) {
                                    notificationList.add(notification);
                                    Log.d(TAG, "Thêm notification: " + notification.getNotificationId());
                                }
                            } catch (Exception e) {
                                Log.e(TAG, "Lỗi ánh xạ tài liệu: " + doc.getId(), e);
                            }
                        }
                        Log.d(TAG, "Số thông báo sau lọc: " + notificationList.size());
                        if (!notificationList.isEmpty()) {
                            recyclerView.setVisibility(View.VISIBLE);
                            tvEmpty.setVisibility(View.GONE);
                        } else {
                            recyclerView.setVisibility(View.GONE);
                            tvEmpty.setVisibility(View.VISIBLE);
                        }
                        notificationAdapter.updateData(notificationList);
                        recyclerView.invalidate();
                        Log.d(TAG, "Cập nhật giao diện, RecyclerView visibility: " + recyclerView.getVisibility());
                    })
                    .addOnFailureListener(e -> {
                        Log.e(TAG, "Lỗi tải thông báo: ", e);
                        if (getContext() != null) {
                            Toast.makeText(getContext(), "Lỗi tải thông báo: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    });
        } catch (Exception e) {
            Log.e(TAG, "Lỗi runtime: ", e);
            if (getContext() != null) {
                Toast.makeText(getContext(), "Lỗi runtime: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }
    }
}
```

### FragmentPages\Customer\CustomerSettingFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import androidx.lifecycle.ViewModelProvider;

import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;
import com.uit.carrental.Service.UserAuthentication.UpdatePassword;
import com.uit.carrental.Service.UserAuthentication.UserProfile;

import de.hdodenhof.circleimageview.CircleImageView;

public class CustomerSettingFragment extends Fragment {

    private TextView tvName;
    private CircleImageView imgAvatar;
    private TextView tvEdit;
    private ImageView editIcon;
    private SettingViewModel viewModel;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_setting, container, false);

        initViews(view);
        initViewModel();
        observeLiveData();

        setupClickListeners(view);
        return view;
    }

    private void initViews(View view) {
        imgAvatar = view.findViewById(R.id.img_avatar);
        tvName = view.findViewById(R.id.tv_name);
        tvEdit = view.findViewById(R.id.tv_edit);
        editIcon = view.findViewById(R.id.edit_icon);
    }

    private void initViewModel() {
        viewModel = new ViewModelProvider(this).get(SettingViewModel.class);
        viewModel.loadUserData();
    }

    private void observeLiveData() {
        viewModel.getUserLiveData().observe(getViewLifecycleOwner(), user -> {
            if (user != null) {
                tvName.setText(user.getUsername());
                if (user.getAvatarUrl() != null && !user.getAvatarUrl().isEmpty()) {
                    Picasso.get().load(user.getAvatarUrl()).into(imgAvatar);
                }
            }
        });

        viewModel.getErrorLiveData().observe(getViewLifecycleOwner(), error -> {
            if (error != null) {
                Toast.makeText(getContext(), error, Toast.LENGTH_LONG).show();
            }
        });
    }

    private void setupClickListeners(View view) {
        View layoutInformation = view.findViewById(R.id.layout_information);
        View layoutConnect = view.findViewById(R.id.layout_connect);
        View layoutChangePassword = view.findViewById(R.id.layout_change_password);
        View layoutDeleteAccount = view.findViewById(R.id.layout_delete_account);
        View layoutSettings = view.findViewById(R.id.layout_settings);
        View layoutSignOut = view.findViewById(R.id.layout_sign_out);

        setupSettingItem(layoutInformation, R.drawable.vector20_settings, "Thông tin tài khoản");
        setupSettingItem(layoutConnect, R.drawable.vector17_settings, "Giao diện nhà cung cấp");
        setupSettingItem(layoutChangePassword, R.drawable.vector8_settings, "Thay đổi mật khẩu");
        setupSettingItemWithOverlay(layoutDeleteAccount, R.drawable.vector11_settings, R.drawable.vector10_settings, "Yêu cầu xóa tài khoản");
        setupSettingItem(layoutSettings, R.drawable.vector13_settings, "Cài đặt");

        tvEdit.setOnClickListener(v -> navigateToUserProfile());
        editIcon.setOnClickListener(v -> navigateToUserProfile());

        layoutInformation.setOnClickListener(v -> navigateToUserProfile());

        layoutConnect.setOnClickListener(v -> {
            FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            if (firebaseUser == null) return;

            User user = viewModel.getUserLiveData().getValue();
            if (user != null && user.hasRole("owner")) {
                FirebaseFirestore db = FirebaseFirestore.getInstance();
                db.collection("Users").document(firebaseUser.getUid())
                        .update("currentRole", "owner")
                        .addOnSuccessListener(aVoid -> {
                            Toast.makeText(getContext(), "Đã chuyển sang giao diện chủ xe!", Toast.LENGTH_SHORT).show();
                            Intent intent = new Intent(getActivity(), OwnerMainActivity.class);
                            startActivity(intent);
                            requireActivity().finish();
                        })
                        .addOnFailureListener(e -> {
                            Toast.makeText(getContext(), "Chuyển vai trò thất bại.", Toast.LENGTH_SHORT).show();
                        });
            } else {
                Toast.makeText(getContext(), "Bạn không có quyền truy cập giao diện chủ xe.", Toast.LENGTH_SHORT).show();
            }
        });

        layoutChangePassword.setOnClickListener(v -> {
            Intent i = new Intent(getActivity(), UpdatePassword.class);
            startActivity(i);
            requireActivity().overridePendingTransition(0, 0);
        });

        layoutDeleteAccount.setOnClickListener(v -> {
            FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            if (firebaseUser != null) {
                firebaseUser.delete()
                        .addOnCompleteListener(task -> {
                            if (task.isSuccessful()) {
                                Toast.makeText(getContext(), "Tài khoản đã được xóa.", Toast.LENGTH_LONG).show();
                                Intent intent = new Intent(getActivity(), LoginActivity.class);
                                startActivity(intent);
                                requireActivity().overridePendingTransition(0, 0);
                            } else {
                                Toast.makeText(getContext(), "Xóa tài khoản thất bại.", Toast.LENGTH_LONG).show();
                            }
                        });
            }
        });

        layoutSettings.setOnClickListener(v -> {
            Toast.makeText(getContext(), "Chức năng Cài đặt chưa được triển khai", Toast.LENGTH_SHORT).show();
        });

        layoutSignOut.setOnClickListener(v -> {
            FirebaseAuth.getInstance().signOut();
            Intent intent = new Intent(getActivity(), LoginActivity.class);
            startActivity(intent);
            requireActivity().overridePendingTransition(0, 0);
        });
    }

    private void navigateToUserProfile() {
        Intent i = new Intent(getActivity(), UserProfile.class);
        startActivity(i);
        requireActivity().overridePendingTransition(0, 0);
    }

    private void setupSettingItem(View view, int iconResId, String text) {
        ImageView icon = view.findViewById(R.id.setting_icon);
        TextView textView = view.findViewById(R.id.setting_text);
        icon.setImageResource(iconResId);
        textView.setText(text);
    }

    private void setupSettingItemWithOverlay(View view, int primaryIconResId, int overlayIconResId, String text) {
        ImageView icon = view.findViewById(R.id.setting_icon);
        TextView textView = view.findViewById(R.id.setting_text);
        icon.setImageResource(primaryIconResId);
        textView.setText(text);
    }

    public static class SettingViewModel extends ViewModel {
        private final FirebaseFirestore db;
        private final FirebaseUser firebaseUser;
        private final MutableLiveData<User> userLiveData;
        private final MutableLiveData<String> errorLiveData;

        public SettingViewModel() {
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            userLiveData = new MutableLiveData<>();
            errorLiveData = new MutableLiveData<>();
        }

        public LiveData<User> getUserLiveData() {
            return userLiveData;
        }

        public LiveData<String> getErrorLiveData() {
            return errorLiveData;
        }

        public void loadUserData() {
            if (firebaseUser == null) {
                errorLiveData.setValue("Người dùng chưa đăng nhập");
                return;
            }

            DocumentReference userRef = db.collection("Users").document(firebaseUser.getUid());
            userRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi tải thông tin: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    User user = document.toObject(User.class);
                    userLiveData.setValue(user);
                } else {
                    errorLiveData.setValue("Không tìm thấy thông tin người dùng");
                }
            });
        }
    }
}

```

### FragmentPages\Customer\CustomerVehicleFilterFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import com.uit.carrental.R;
import java.util.HashMap;
import java.util.Map;

public class CustomerVehicleFilterFragment extends Fragment {

    private static final String ARG_BRAND = "brand";
    private static final String ARG_STATUS = "status";
    private static final String ARG_MIN_RATING = "minRating";
    private static final String ARG_MAX_RATING = "maxRating";

    private FilterCallback callback;
    private String selectedBrand;
    private String selectedStatus;
    private Float minRating, maxRating;
    private Map<String, View> brandViews = new HashMap<>();
    private Map<String, View> statusViews = new HashMap<>();
    private Map<String, View> ratingViews = new HashMap<>();

    public interface FilterCallback {
        void onFilterApplied(String brand, String status, Float minRating, Float maxRating);
    }

    public static CustomerVehicleFilterFragment newInstance(FilterCallback callback) {
        CustomerVehicleFilterFragment fragment = new CustomerVehicleFilterFragment();
        fragment.callback = callback;
        return fragment;
    }

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_vehicle_filter, container, false);

        // Initialize views
        initializeBrandViews(view);
        initializeStatusViews(view);
        initializeRatingViews(view);

        // Nút đóng
        view.findViewById(R.id.rz3n8dabzscm).setOnClickListener(v -> getParentFragmentManager().popBackStack());

        // Nút thiết lập lại
        view.findViewById(R.id.rvai73xq5syc).setOnClickListener(v -> resetFilters());

        // Nút xác nhận
        view.findViewById(R.id.rt94tooyri0r).setOnClickListener(v -> applyFilters());

        return view;
    }

    private void initializeBrandViews(View view) {
        String[] brands = {"Vinfast", "Honda", "Mercedes", "BMW", "Ford", "Toyota"};
        int[] brandIds = {
                R.id.re5bkjyzw71a, R.id.r29lmqq8qqka, R.id.r5wpc3jutt9d,
                R.id.r047t6es9ecg6, R.id.rwviyruuyw0d, R.id.r2lvmia82fj5
        };
        for (int i = 0; i < brands.length; i++) {
            View brandView = view.findViewById(brandIds[i]);
            String brand = brands[i];
            brandViews.put(brand, brandView);
            brandView.setOnClickListener(v -> selectBrand(brand));
        }
    }

    private void initializeStatusViews(View view) {
        statusViews.put("available", view.findViewById(R.id.rzvu0zdr3b79));
        statusViews.get("available").setOnClickListener(v -> selectStatus("available"));
    }

    private void initializeRatingViews(View view) {
        ratingViews.put("5", view.findViewById(R.id.rozw79prjrbs));
        ratingViews.put("4-5", view.findViewById(R.id.rx3ytiykf6v));
        ratingViews.put("4", view.findViewById(R.id.rsooed0x193));
        ratingViews.put("3", view.findViewById(R.id.rusqd789cwjj));
        ratingViews.put("1-2", view.findViewById(R.id.ru6lopcq6jh));

        ratingViews.get("5").setOnClickListener(v -> selectRating(5f, 5f));
        ratingViews.get("4-5").setOnClickListener(v -> selectRating(4f, 5f));
        ratingViews.get("4").setOnClickListener(v -> selectRating(4f, 4f));
        ratingViews.get("3").setOnClickListener(v -> selectRating(3f, 3f));
        ratingViews.get("1-2").setOnClickListener(v -> selectRating(1f, 2f));
    }

    private void selectBrand(String brand) {
        for (Map.Entry<String, View> entry : brandViews.entrySet()) {
            entry.getValue().setBackgroundResource(entry.getKey().equals(brand) ?
                    R.drawable.s003087sw1cr100b0030871f : R.drawable.s4d3a4dsw1cr100);
        }
        selectedBrand = brand.equals(selectedBrand) ? null : brand;
    }

    private void selectStatus(String status) {
        for (Map.Entry<String, View> entry : statusViews.entrySet()) {
            entry.getValue().setBackgroundResource(entry.getKey().equals(status) ?
                    R.drawable.s003087sw1cr100b0030871f : R.drawable.s4d3a4dsw1cr100);
        }
        selectedStatus = status.equals(selectedStatus) ? null : status;
    }

    private void selectRating(Float min, Float max) {
        for (Map.Entry<String, View> entry : ratingViews.entrySet()) {
            entry.getValue().setBackgroundResource((min.equals(minRating) && max.equals(maxRating)) ?
                    R.drawable.s4d3a4dsw1cr100 : R.drawable.s4d3a4dsw1cr100);
        }
        if (min.equals(minRating) && max.equals(maxRating)) {
            minRating = null;
            maxRating = null;
        } else {
            minRating = min;
            maxRating = max;
        }
    }

    private void resetFilters() {
        selectedBrand = null;
        selectedStatus = null;
        minRating = null;
        maxRating = null;
        for (View view : brandViews.values()) {
            view.setBackgroundResource(R.drawable.s4d3a4dsw1cr100);
        }
        for (View view : statusViews.values()) {
            view.setBackgroundResource(R.drawable.s4d3a4dsw1cr100);
        }
        for (View view : ratingViews.values()) {
            view.setBackgroundResource(R.drawable.s4d3a4dsw1cr100);
        }
    }

    private void applyFilters() {
        if (callback != null) {
            callback.onFilterApplied(selectedBrand, selectedStatus, minRating, maxRating);
        }
        getParentFragmentManager().popBackStack();
    }
}

```

### FragmentPages\Owner\OwnerActivityFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.ListenerRegistration;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.BookingAdapter;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.R;
import com.uit.carrental.Service.Booking.OwnerBookingDetailActivity;
import java.util.ArrayList;
import java.util.List;

public class OwnerActivityFragment extends Fragment {

    private static final String TAG = "OwnerActivityFragment";
    private RecyclerView recyclerView;
    private TextView tvEmpty;
    private BookingAdapter bookingAdapter;
    private List<Booking> bookingList;
    private FirebaseFirestore db;
    private FirebaseAuth auth;
    private ProgressDialog progressDialog;
    private ListenerRegistration bookingListener;

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.owner_fragment_activity, container, false);

        db = FirebaseFirestore.getInstance();
        auth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();

        recyclerView = view.findViewById(R.id.activity_list);
        tvEmpty = view.findViewById(R.id.tv_empty);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        bookingList = new ArrayList<>();
        bookingAdapter = new BookingAdapter(bookingList, booking -> {
            Intent intent = new Intent(getContext(), OwnerBookingDetailActivity.class);
            intent.putExtra("bookingId", booking.getBookingId());
            startActivity(intent);
        });
        recyclerView.setAdapter(bookingAdapter);

        loadBookings();

        return view;
    }

    private void loadBookings() {
        String userId = auth.getCurrentUser().getUid();
        bookingListener = db.collection("Bookings")
                .whereEqualTo("ownerId", userId)
                .addSnapshotListener((querySnapshot, error) -> {
                    if (error != null) {
                        Toast.makeText(getContext(), "Lỗi tải đơn hàng: " + error.getMessage(), Toast.LENGTH_SHORT).show();
                        progressDialog.dismiss();
                        return;
                    }
                    bookingList.clear();
                    if (querySnapshot != null) {
                        for (QueryDocumentSnapshot document : querySnapshot) {
                            Booking booking = document.toObject(Booking.class);
                            booking.setBookingId(document.getId());
                            bookingList.add(booking);
                        }
                    }
                    bookingAdapter.notifyDataSetChanged();
                    tvEmpty.setVisibility(bookingList.isEmpty() ? View.VISIBLE : View.GONE);
                    recyclerView.setVisibility(bookingList.isEmpty() ? View.GONE : View.VISIBLE);
                    progressDialog.dismiss();
                });
    }

    @Override
    public void onDestroyView() {
        super.onDestroyView();
        if (bookingListener != null) {
            bookingListener.remove();
        }
        if (progressDialog.isShowing()) {
            progressDialog.dismiss();
        }
    }
}

```

### FragmentPages\Owner\OwnerNotificationsFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.OwnerNotificationAdapter;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.OwnerActivityDetail;
import java.util.ArrayList;
import java.util.List;

public class OwnerNotificationsFragment extends Fragment {

    private static final String TAG = "OwnerNotifications";
    private RecyclerView recyclerView;
    private OwnerNotificationAdapter notificationAdapter;
    private List<Booking> bookingList;
    private FirebaseFirestore db;
    private TextView tvEmpty;

    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.owner_fragment_notification, container, false);


        db = FirebaseFirestore.getInstance();
        bookingList = new ArrayList<>();
        recyclerView = view.findViewById(R.id.notification_list);
        tvEmpty = view.findViewById(R.id.tv_empty);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));
        recyclerView.setHasFixedSize(false);
        notificationAdapter = new OwnerNotificationAdapter(this, bookingList);
        recyclerView.setAdapter(notificationAdapter);

        loadBookings();
        recyclerView.post(() -> Log.d(TAG, "RecyclerView hiển thị: " + recyclerView.isShown()));
        return view;
    }

    private void loadBookings() {
        String ownerId = FirebaseAuth.getInstance().getCurrentUser() != null ?
                FirebaseAuth.getInstance().getCurrentUser().getUid() : null;
        Log.d(TAG, "Current ownerId: " + ownerId);

        if (ownerId == null) {
            Toast.makeText(getContext(), "Người dùng chưa đăng nhập", Toast.LENGTH_SHORT).show();
            recyclerView.setVisibility(View.GONE);
            tvEmpty.setVisibility(View.VISIBLE);
            return;
        }

        try {
            db.collection("Bookings")
                    .get()
                    .addOnSuccessListener(querySnapshot -> {
                        Log.d(TAG, "Số tài liệu nhận được: " + querySnapshot.size());
                        bookingList.clear();
                        for (QueryDocumentSnapshot doc : querySnapshot) {
                            try {
                                Booking booking = doc.toObject(Booking.class);
                                booking.setBookingId(doc.getId());
                                if (booking.getOwnerId() != null && booking.getOwnerId().equals(ownerId)) {
                                    bookingList.add(booking);
                                    Log.d(TAG, "Thêm booking: " + booking.getBookingId());
                                }
                            } catch (Exception e) {
                                Log.e(TAG, "Lỗi ánh xạ tài liệu: " + doc.getId(), e);
                            }
                        }
                        Log.d(TAG, "Số booking sau lọc: " + bookingList.size());
                        if (!bookingList.isEmpty()) {
                            recyclerView.setVisibility(View.VISIBLE);
                            tvEmpty.setVisibility(View.GONE);
                        } else {
                            recyclerView.setVisibility(View.GONE);
                            tvEmpty.setVisibility(View.VISIBLE);
                        }
                        notificationAdapter.updateData(bookingList);
                        recyclerView.invalidate();
                        Log.d(TAG, "Cập nhật giao diện, RecyclerView visibility: " + recyclerView.getVisibility());
                    })
                    .addOnFailureListener(e -> {
                        Log.e(TAG, "Lỗi tải booking: ", e);
                        if (getContext() != null) {
                            Toast.makeText(getContext(), "Lỗi tải booking: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    });
        } catch (Exception e) {
            Log.e(TAG, "Lỗi runtime: ", e);
            if (getContext() != null) {
                Toast.makeText(getContext(), "Lỗi runtime: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }
    }
}
```

### FragmentPages\Owner\OwnerSettingFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;

import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.ForgotPasswordActivity;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;
import com.uit.carrental.Service.UserAuthentication.ProfileManagement;

import de.hdodenhof.circleimageview.CircleImageView;

public class OwnerSettingFragment extends Fragment {

    private TextView tvName;
    private CircleImageView imgAvatar;
    private TextView tvEdit;
    private ImageView editIcon;

    private FirebaseFirestore dtb_user;
    private FirebaseUser firebaseUser;
    private FirebaseAuth mAuth;
    private User user = new User();

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.owner_fragment_setting, container, false);

        // Initialize views
        imgAvatar = view.findViewById(R.id.img_avatar);
        tvName = view.findViewById(R.id.tv_name);
        tvEdit = view.findViewById(R.id.tv_edit);
        editIcon = view.findViewById(R.id.edit_icon);

        // Initialize setting items
        View layoutInformation = view.findViewById(R.id.layout_information);
        View layoutSwitchToCustomer = view.findViewById(R.id.layout_switch_to_customer);
        View layoutChangePassword = view.findViewById(R.id.layout_change_password);
        View layoutDeleteAccount = view.findViewById(R.id.layout_delete_account);
        View layoutSettings = view.findViewById(R.id.layout_settings);
        View layoutSignOut = view.findViewById(R.id.layout_sign_out);

        // Set icons and texts for setting items
        setupSettingItem(layoutInformation, R.drawable.vector20_settings, "Thông tin tài khoản");
        setupSettingItem(layoutSwitchToCustomer, R.drawable.vector17_settings, "Giao diện khách hàng");
        setupSettingItem(layoutChangePassword, R.drawable.vector8_settings, "Thay đổi mật khẩu");
        setupSettingItemWithOverlay(layoutDeleteAccount, R.drawable.vector11_settings, R.drawable.vector10_settings, "Yêu cầu xóa tài khoản");
        setupSettingItem(layoutSettings, R.drawable.vector13_settings, "Cài đặt");

        dtb_user = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        mAuth = FirebaseAuth.getInstance();
        user.setUserId(firebaseUser != null ? firebaseUser.getUid() : "");

        if (firebaseUser != null) {
            dtb_user.collection("Users")
                    .document(firebaseUser.getUid())
                    .get()
                    .addOnSuccessListener(documentSnapshot -> {
                        if (documentSnapshot.exists()) {
                            String username = documentSnapshot.getString("username");
                            String avatarURL = documentSnapshot.getString("avatarURL");

                            if (username != null) {
                                tvName.setText(username);
                            }
                            if (avatarURL != null && !avatarURL.isEmpty()) {
                                Picasso.get().load(avatarURL).into(imgAvatar);
                            }
                        }
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(view.getContext(), "Không thể lấy thông tin.", Toast.LENGTH_SHORT).show();
                    });
        }

        // Click listeners
        tvEdit.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ProfileManagement.class));
            requireActivity().overridePendingTransition(0, 0);
        });

        editIcon.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ProfileManagement.class));
            requireActivity().overridePendingTransition(0, 0);
        });

        layoutInformation.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ProfileManagement.class));
            requireActivity().overridePendingTransition(0, 0);
        });

        layoutSwitchToCustomer.setOnClickListener(v -> {
            if (firebaseUser == null) return;

            dtb_user.collection("Users")
                    .document(firebaseUser.getUid())
                    .update("currentRole", "customer")
                    .addOnSuccessListener(aVoid -> {
                        Toast.makeText(getContext(), "Đã chuyển sang giao diện khách hàng!", Toast.LENGTH_SHORT).show();
                        startActivity(new Intent(getActivity(), CustomerMainActivity.class));
                        requireActivity().finish();
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(getContext(), "Chuyển vai trò thất bại.", Toast.LENGTH_SHORT).show();
                    });
        });

        layoutChangePassword.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ForgotPasswordActivity.class));
            requireActivity().overridePendingTransition(0, 0);
        });

        layoutDeleteAccount.setOnClickListener(v -> {
            if (firebaseUser == null) return;

            dtb_user.collection("Users").document(firebaseUser.getUid())
                    .delete()
                    .addOnSuccessListener(aVoid -> {
                        firebaseUser.delete().addOnCompleteListener(task -> {
                            Toast.makeText(getContext(), "Đã xóa tài khoản!", Toast.LENGTH_SHORT).show();
                            startActivity(new Intent(getActivity(), LoginActivity.class));
                            requireActivity().finish();
                        });
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(getContext(), "Xóa tài khoản thất bại.", Toast.LENGTH_SHORT).show();
                    });
        });

        layoutSettings.setOnClickListener(v -> {
            // TODO: Thêm hành động cho mục "Cài đặt" (ví dụ: mở SettingsActivity)
            Toast.makeText(getContext(), "Chức năng Cài đặt chưa được triển khai", Toast.LENGTH_SHORT).show();
        });

        layoutSignOut.setOnClickListener(v -> {
            mAuth.signOut();
            startActivity(new Intent(getActivity(), LoginActivity.class));
            requireActivity().finish();
        });

        return view;
    }

    private void setupSettingItem(View view, int iconResId, String text) {
        ImageView icon = view.findViewById(R.id.setting_icon);
        TextView textView = view.findViewById(R.id.setting_text);
        icon.setImageResource(iconResId);
        textView.setText(text);
    }

    private void setupSettingItemWithOverlay(View view, int primaryIconResId, int overlayIconResId, String text) {
        // Chỉ dùng primaryIconResId vì item_setting_row.xml không hỗ trợ overlay
        ImageView icon = view.findViewById(R.id.setting_icon);
        TextView textView = view.findViewById(R.id.setting_text);
        icon.setImageResource(primaryIconResId);
        textView.setText(text);
    }
}
```

### FragmentPages\Owner\OwnerVehicleFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.uit.carrental.Adapter.OwnerVehicleAdapter;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.AddVehicleActivity;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;

public class OwnerVehicleFragment extends Fragment {

    private static final String TAG = "OwnerVehicleFragment";
    private RecyclerView recyclerView;
    private OwnerVehicleAdapter adapter;
    private ArrayList<Vehicle> vehicleList;
    private FirebaseFirestore firestore;
    private FirebaseAuth firebaseAuth;
    private ProgressDialog progressDialog;
    private Button buttonAddVehicle;
    private TextView textViewEmpty;
    private View rootView;

    private static final int REQUEST_ADD_VEHICLE = 100;

    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        rootView = inflater.inflate(R.layout.owner_fragment_vehicle, container, false);

        // Initialize views
        buttonAddVehicle = rootView.findViewById(R.id.btn_add);
        textViewEmpty = rootView.findViewById(R.id.text_empty);
        recyclerView = rootView.findViewById(R.id.vehicle_list);
        recyclerView.setHasFixedSize(false); // Tắt fixed size để hỗ trợ thay đổi số item
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        // Initialize Firebase and ProgressDialog
        firebaseAuth = FirebaseAuth.getInstance();
        firestore = FirebaseFirestore.getInstance();
        progressDialog = new ProgressDialog(requireContext());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");

        // Initialize adapter
        vehicleList = new ArrayList<>();
        adapter = new OwnerVehicleAdapter(requireContext(), vehicleList);
        recyclerView.setAdapter(adapter);
        Log.d(TAG, "Khởi tạo RecyclerView và adapter");

        // Set button listener
        buttonAddVehicle.setOnClickListener(v -> {
            Intent intent = new Intent(requireContext(), AddVehicleActivity.class);
            startActivityForResult(intent, REQUEST_ADD_VEHICLE);
        });

        // Load data
        loadVehicles();

        return rootView;
    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == REQUEST_ADD_VEHICLE && resultCode == Activity.RESULT_OK) {
            loadVehicles();
            Log.d(TAG, "Nhận kết quả từ AddVehicleActivity, làm mới dữ liệu");
        }
    }

    private void loadVehicles() {
        FirebaseUser firebaseUser = firebaseAuth.getCurrentUser();
        if (firebaseUser == null) {
            Toast.makeText(getContext(), "Người dùng chưa đăng nhập", Toast.LENGTH_SHORT).show();
            updateEmptyState();
            return;
        }

        String ownerId = firebaseUser.getUid();
        Log.d(TAG, "UID người dùng: " + ownerId);

        progressDialog.show();
        firestore.collection("Vehicles")
                .addSnapshotListener((snapshots, e) -> {
                    progressDialog.dismiss();
                    if (e != null) {
                        Log.e(TAG, "Lỗi tải xe: " + e.getMessage());
                        Toast.makeText(getContext(), "Không thể lấy danh sách xe: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        updateEmptyState();
                        return;
                    }

                    vehicleList.clear();
                    if (snapshots != null && !snapshots.isEmpty()) {
                        for (QueryDocumentSnapshot document : snapshots) {
                            Vehicle vehicle = document.toObject(Vehicle.class);
                            if (vehicle.getVehicleId() == null) {
                                vehicle.setVehicleId(document.getId());
                            }
                            if (ownerId.equals(vehicle.getOwnerId())) {
                                vehicleList.add(vehicle);
                                Log.d(TAG, "Tải xe: " + vehicle.toString());
                            }
                        }
                        Collections.sort(vehicleList, new Comparator<Vehicle>() {
                            @Override
                            public int compare(Vehicle v1, Vehicle v2) {
                                if (v1.getCreatedAt() == null || v2.getCreatedAt() == null) {
                                    return 0;
                                }
                                return v2.getCreatedAt().compareTo(v1.getCreatedAt());
                            }
                        });
                        Log.d(TAG, "Số xe tải được: " + vehicleList.size());
                    } else {
                        Log.d(TAG, "Không có xe nào trong Vehicles.");
                    }
                    adapter.updateData(new ArrayList<>(vehicleList)); // Tạo bản sao để tránh tham chiếu
                    recyclerView.invalidate(); // Buộc vẽ lại RecyclerView
                    updateEmptyState();
                    Log.d(TAG, "Cập nhật giao diện, RecyclerView visibility: " + recyclerView.getVisibility());
                });
    }

    private void updateEmptyState() {
        Log.d(TAG, "Cập nhật trạng thái rỗng, số xe: " + vehicleList.size());
        if (vehicleList.isEmpty()) {
            recyclerView.setVisibility(View.GONE);
            textViewEmpty.setVisibility(View.VISIBLE);
            textViewEmpty.setText(R.string.no_vehicles);
        } else {
            recyclerView.setVisibility(View.VISIBLE);
            textViewEmpty.setVisibility(View.GONE);
        }
    }
}
```

### Model\Booking.java
```java
package com.uit.carrental.Model;

import com.google.firebase.Timestamp;

public class Booking {
    private String bookingId;
    private String vehicleId;
    private String customerId;
    private String ownerId;
    private Timestamp startTime;
    private Timestamp endTime;
    private Timestamp maintenanceEndTime;
    private long totalAmount;
    private String status; // pending, confirmed, rejected, paid, completed, cancelled
    private Timestamp createdAt;
    private Timestamp updatedAt;
    private String paymentStatus; // unpaid, paid, failed
    private String paymentMethod; // ZaloPay, Other
    private String paymentId; // ID giao dịch từ ZaloPay
    private String note;
    private String pickupLocation;
    private String dropoffLocation;
    private String orderId; // ID đơn hàng từ ZaloPay

    public Booking() {
        this.bookingId = "";
        this.vehicleId = "";
        this.customerId = "";
        this.ownerId = "";
        this.startTime = null;
        this.endTime = null;
        this.maintenanceEndTime = null;
        this.totalAmount = 0;
        this.status = "pending";
        this.createdAt = Timestamp.now();
        this.updatedAt = Timestamp.now();
        this.paymentStatus = "unpaid";
        this.paymentMethod = "";
        this.paymentId = "";
        this.note = "";
        this.pickupLocation = "";
        this.dropoffLocation = "";
        this.orderId = "";
    }

    // Getters và Setters
    public String getBookingId() { return bookingId; }
    public void setBookingId(String bookingId) { this.bookingId = bookingId; }

    public String getVehicleId() { return vehicleId; }
    public void setVehicleId(String vehicleId) { this.vehicleId = vehicleId; }

    public String getCustomerId() { return customerId; }
    public void setCustomerId(String customerId) { this.customerId = customerId; }

    public String getOwnerId() { return ownerId; }
    public void setOwnerId(String ownerId) { this.ownerId = ownerId; }

    public Timestamp getStartTime() { return startTime; }
    public void setStartTime(Timestamp startTime) { this.startTime = startTime; }

    public Timestamp getEndTime() { return endTime; }
    public void setEndTime(Timestamp endTime) { this.endTime = endTime; }

    public Timestamp getMaintenanceEndTime() { return maintenanceEndTime; }
    public void setMaintenanceEndTime(Timestamp maintenanceEndTime) { this.maintenanceEndTime = maintenanceEndTime; }

    public long getTotalAmount() { return totalAmount; }
    public void setTotalAmount(long totalAmount) { this.totalAmount = totalAmount; }

    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }

    public Timestamp getCreatedAt() { return createdAt; }
    public void setCreatedAt(Timestamp createdAt) { this.createdAt = createdAt; }

    public Timestamp getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(Timestamp updatedAt) { this.updatedAt = updatedAt; }

    public String getPaymentStatus() { return paymentStatus; }
    public void setPaymentStatus(String paymentStatus) { this.paymentStatus = paymentStatus; }

    public String getPaymentMethod() { return paymentMethod; }
    public void setPaymentMethod(String paymentMethod) { this.paymentMethod = paymentMethod; }

    public String getPaymentId() { return paymentId; }
    public void setPaymentId(String paymentId) { this.paymentId = paymentId; }

    public String getNote() { return note; }
    public void setNote(String note) { this.note = note; }

    public String getPickupLocation() { return pickupLocation; }
    public void setPickupLocation(String pickupLocation) { this.pickupLocation = pickupLocation; }

    public String getDropoffLocation() { return dropoffLocation; }
    public void setDropoffLocation(String dropoffLocation) { this.dropoffLocation = dropoffLocation; }

    public String getOrderId() { return orderId; }
    public void setOrderId(String orderId) { this.orderId = orderId; }
}

```

### Model\CreateOrder.java
```java
//// File: CreateOrder.java
//package com.uit.carrental.Model;
//
//import android.os.Build;
//import androidx.annotation.RequiresApi;
//
//import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
//import com.uit.carrental.Service.ZaloPay.Helper.HMac.HMacUtil;
//
//import org.json.JSONObject;
//
//import java.io.OutputStream;
//import java.net.HttpURLConnection;
//import java.net.URL;
//import java.nio.charset.StandardCharsets;
//import java.text.SimpleDateFormat;
//import java.util.Date;
//import java.util.TimeZone;
//
//public class CreateOrder {
//
//    @RequiresApi(api = Build.VERSION_CODES.O)
//    public JSONObject createOrder(String appTransId) {
//        try {
//            long amount = 1000; // có thể lấy từ amount ngoài truyền vào
//
//            // Lấy thời gian theo chuẩn GMT+7
//            SimpleDateFormat sdf = new SimpleDateFormat("yyMMdd");
//            sdf.setTimeZone(TimeZone.getTimeZone("GMT+7"));
//            String appTime = sdf.format(new Date());
//
//            JSONObject order = new JSONObject();
//            order.put("app_id", AppInfo.APP_ID);
//            order.put("app_user", "user123"); // user định danh (tuỳ chỉnh)
//            order.put("app_time", System.currentTimeMillis()); // thời gian tạo đơn
//            order.put("amount", amount);
//            order.put("app_trans_id", appTime + "_" + appTransId); // định dạng yêu cầu
//            order.put("embed_data", "{}");
//            order.put("item", "[]");
//            order.put("description", "Thanh toán đơn thuê xe CarRental: " + appTransId);
//            order.put("bank_code", "zalopayapp"); // App mobile payment
//
//            // Build data to hash
//            String data = AppInfo.APP_ID + "|" + appTime + "_" + appTransId + "|" + AppInfo.APP_USER + "|" + amount + "|" + AppInfo.APP_NAME + "|{}|[]";
//            String mac = HMacUtil.HMacHexStringEncode("HmacSHA256", AppInfo.MAC_KEY, data);
//            order.put("mac", mac);
//
//            // Gửi HTTP request
//            URL url = new URL(AppInfo.URL_CREATE_ORDER);
//            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
//            connection.setRequestMethod("POST");
//            connection.setRequestProperty("Content-Type", "application/json");
//            connection.setDoOutput(true);
//
//            OutputStream os = connection.getOutputStream();
//            os.write(order.toString().getBytes(StandardCharsets.UTF_8));
//            os.close();
//
//            int responseCode = connection.getResponseCode();
//            if (responseCode == HttpURLConnection.HTTP_OK) {
//                java.util.Scanner s = new java.util.Scanner(connection.getInputStream()).useDelimiter("\\A");
//                String response = s.hasNext() ? s.next() : "";
//                s.close();
//                return new JSONObject(response);
//            } else {
//                throw new RuntimeException("Failed : HTTP error code : " + responseCode);
//            }
//        } catch (Exception e) {
//            e.printStackTrace();
//            return null;
//        }
//    }
//}

```

### Model\Message.java
```java
package com.uit.carrental.Model;

public class Message {
    private String content;
    private boolean isUser;

    public Message(String content, boolean isUser) {
        this.content = content;
        this.isUser = isUser;
    }

    public String getContent() {
        return content;
    }

    public boolean isUser() {
        return isUser;
    }
}
```

### Model\Notification.java
```java
package com.uit.carrental.Model;

import com.google.firebase.Timestamp;

public class Notification {
    private String notificationId;
    private String userId;
    private String title;
    private String message;
    private String type;
    private String vehicleId;
    private String bookingId;
    private Timestamp createdAt;
    private boolean isRead;
    private boolean read;
    private String role; // Thêm trường role

    public Notification() {}

    public String getNotificationId() { return notificationId; }
    public void setNotificationId(String notificationId) { this.notificationId = notificationId; }

    public String getUserId() { return userId; }
    public void setUserId(String userId) { this.userId = userId; }

    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }

    public String getMessage() { return message; }
    public void setMessage(String message) { this.message = message; }

    public String getType() { return type; }
    public void setType(String type) { this.type = type; }

    public String getVehicleId() { return vehicleId; }
    public void setVehicleId(String vehicleId) { this.vehicleId = vehicleId; }

    public String getBookingId() { return bookingId; }
    public void setBookingId(String bookingId) { this.bookingId = bookingId; }

    public Timestamp getCreatedAt() { return createdAt; }
    public void setCreatedAt(Timestamp createdAt) { this.createdAt = createdAt; }

    public boolean isRead() { return isRead || read; }
    public void setRead(boolean read) {
        this.isRead = read;
        this.read = read;
    }

    public void setIsRead(boolean isRead) {
        this.isRead = isRead;
        this.read = isRead;
    }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
}
```

### Model\onClickInterface.java
```java
package com.uit.carrental.Model;
public interface onClickInterface {
    void setClick(int position);
}

```

### Model\Order.java
```java
package com.uit.carrental.Model;

public class Order {
    private String CustomerID;
    private String OrderID;
    private String ProvideID;
    private String vehicle_id;

    public Order() {

    }

    public Order(String customerID, String orderID, String provideID, String vehicl_id) {
        CustomerID = customerID;
        OrderID = orderID;
        ProvideID = provideID;
        vehicle_id = vehicl_id;

    }

    public String getCustomerID() {
        return CustomerID;
    }

    public void setCustomerID(String customerID) {
        CustomerID = customerID;
    }

    public String getOrderID() {
        return OrderID;
    }

    public void setOrderID(String orderID) {
        OrderID = orderID;
    }

    public String getProvideID() {
        return ProvideID;
    }

    public void setProvideID(String provideID) {
        ProvideID = provideID;
    }

    public String getVehicle_id() {
        return vehicle_id;
    }

    public void setVehicle_id(String vehicle_id) {
        this.vehicle_id = vehicle_id;
    }
}


```

### Model\RentalHistory.java
```java
package com.uit.carrental.Model;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import com.google.firebase.Timestamp;

public class RentalHistory {

    private String rentalId; // ID của lần thuê
    private String vehicleId; // ID xe
    private String customerId; // ID khách hàng
    private Timestamp startDate; // Ngày bắt đầu thuê
    private Timestamp endDate; // Ngày kết thúc thuê
    private double totalCost; // Tổng chi phí
    private String status; // Trạng thái (completed, ongoing, cancelled)
    private String orderId; // Tham chiếu đến Orders (nếu có)

    public RentalHistory() {
        this.rentalId = "";
        this.vehicleId = "";
        this.customerId = "";
        this.startDate = Timestamp.now();
        this.endDate = Timestamp.now();
        this.totalCost = 0.0;
        this.status = "ongoing";
        this.orderId = "";
    }

    // Getters and Setters
    @NonNull
    public String getRentalId() { return rentalId != null ? rentalId : ""; }
    public void setRentalId(@Nullable String rentalId) { this.rentalId = rentalId != null ? rentalId : ""; }

    @NonNull
    public String getVehicleId() { return vehicleId != null ? vehicleId : ""; }
    public void setVehicleId(@Nullable String vehicleId) { this.vehicleId = vehicleId != null ? vehicleId : ""; }

    @NonNull
    public String getCustomerId() { return customerId != null ? customerId : ""; }
    public void setCustomerId(@Nullable String customerId) { this.customerId = customerId != null ? customerId : ""; }

    @Nullable
    public Timestamp getStartDate() { return startDate; }
    public void setStartDate(@Nullable Timestamp startDate) { this.startDate = startDate != null ? startDate : Timestamp.now(); }

    @Nullable
    public Timestamp getEndDate() { return endDate; }
    public void setEndDate(@Nullable Timestamp endDate) { this.endDate = endDate != null ? endDate : Timestamp.now(); }

    public double getTotalCost() { return totalCost; }
    public void setTotalCost(double totalCost) { this.totalCost = totalCost >= 0 ? totalCost : 0.0; }

    @NonNull
    public String getStatus() { return status != null ? status : "ongoing"; }
    public void setStatus(@Nullable String status) { this.status = status != null ? status : "ongoing"; }

    @NonNull
    public String getOrderId() { return orderId != null ? orderId : ""; }
    public void setOrderId(@Nullable String orderId) { this.orderId = orderId != null ? orderId : ""; }

    @NonNull
    @Override
    public String toString() {
        return "RentalHistory{rentalId='" + rentalId + "', vehicleId='" + vehicleId + "', customerId='" + customerId +
                "', totalCost=" + totalCost + ", status='" + status + "'}";
    }
}

```

### Model\User.java
```java
package com.uit.carrental.Model;

import android.os.Parcel;
import android.os.Parcelable;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import java.util.HashMap;
import java.util.Map;

public class User implements Parcelable {

    private String userId;
    private String username;
    private String email;
    private String phoneNumber;
    private String avatarUrl;
    private String birthday;
    private String address;
    private String city;
    private String ciCardFront;
    private String ciCardBehind;
    private String description;
    private String verificationStatus;
    private String status;
    private Map<String, Boolean> roles;
    private String currentRole;
    private String licenseUrl; // Trường mới cho ảnh bằng lái xe

    public User() {
        this.userId = "";
        this.username = "";
        this.email = "";
        this.phoneNumber = "";
        this.avatarUrl = "";
        this.birthday = "";
        this.address = "";
        this.city = "";
        this.ciCardFront = "";
        this.ciCardBehind = "";
        this.description = "";
        this.verificationStatus = null;
        this.status = "active";
        this.roles = new HashMap<>();
        this.currentRole = "customer";
        this.licenseUrl = "";
    }

    protected User(Parcel in) {
        userId = in.readString();
        username = in.readString();
        email = in.readString();
        phoneNumber = in.readString();
        avatarUrl = in.readString();
        birthday = in.readString();
        address = in.readString();
        city = in.readString();
        ciCardFront = in.readString();
        ciCardBehind = in.readString();
        description = in.readString();
        verificationStatus = in.readString();
        status = in.readString();
        roles = in.readHashMap(Boolean.class.getClassLoader());
        currentRole = in.readString();
        licenseUrl = in.readString();
    }

    public static final Creator<User> CREATOR = new Creator<User>() {
        @Override
        public User createFromParcel(Parcel in) {
            return new User(in);
        }

        @Override
        public User[] newArray(int size) {
            return new User[size];
        }
    };

    // Getters and Setters
    @NonNull
    public String getUserId() { return userId != null ? userId : ""; }
    public void setUserId(@Nullable String userId) { this.userId = userId != null ? userId : ""; }

    @NonNull
    public String getUsername() { return username != null ? username : ""; }
    public void setUsername(@Nullable String username) { this.username = username != null ? username : ""; }

    @NonNull
    public String getEmail() { return email != null ? email : ""; }
    public void setEmail(@Nullable String email) { this.email = email != null ? email : ""; }

    @NonNull
    public String getPhoneNumber() { return phoneNumber != null ? phoneNumber : ""; }
    public void setPhoneNumber(@Nullable String phoneNumber) { this.phoneNumber = phoneNumber != null ? phoneNumber : ""; }

    @NonNull
    public String getAvatarUrl() { return avatarUrl != null ? avatarUrl : ""; }
    public void setAvatarUrl(@Nullable String avatarUrl) { this.avatarUrl = avatarUrl != null ? avatarUrl : ""; }

    @NonNull
    public String getBirthday() { return birthday != null ? birthday : ""; }
    public void setBirthday(@Nullable String birthday) { this.birthday = birthday != null ? birthday : ""; }

    @NonNull
    public String getAddress() { return address != null ? address : ""; }
    public void setAddress(@Nullable String address) { this.address = address != null ? address : ""; }

    @NonNull
    public String getCity() { return city != null ? city : ""; }
    public void setCity(@Nullable String city) { this.city = city != null ? city : ""; }

    @NonNull
    public String getCiCardFront() { return ciCardFront != null ? ciCardFront : ""; }
    public void setCiCardFront(@Nullable String ciCardFront) { this.ciCardFront = ciCardFront != null ? ciCardFront : ""; }

    @NonNull
    public String getCiCardBehind() { return ciCardBehind != null ? ciCardBehind : ""; }
    public void setCiCardBehind(@Nullable String ciCardBehind) { this.ciCardBehind = ciCardBehind != null ? ciCardBehind : ""; }

    @NonNull
    public String getDescription() { return description != null ? description : ""; }
    public void setDescription(@Nullable String description) { this.description = description != null ? description : ""; }

    @Nullable
    public String getVerificationStatus() { return verificationStatus; }
    public void setVerificationStatus(@Nullable String verificationStatus) { this.verificationStatus = verificationStatus; }

    @NonNull
    public String getStatus() { return status != null ? status : "active"; }
    public void setStatus(@Nullable String status) { this.status = status != null ? status : "active"; }

    @NonNull
    public Map<String, Boolean> getRoles() { return roles != null ? roles : new HashMap<>(); }
    public void setRoles(@Nullable Map<String, Boolean> roles) { this.roles = roles != null ? roles : new HashMap<>(); }

    @NonNull
    public String getCurrentRole() { return currentRole != null ? currentRole : "customer"; }
    public void setCurrentRole(@Nullable String currentRole) { this.currentRole = currentRole != null ? currentRole : "customer"; }

    @NonNull
    public String getLicenseUrl() { return licenseUrl != null ? licenseUrl : ""; }
    public void setLicenseUrl(@Nullable String licenseUrl) { this.licenseUrl = licenseUrl != null ? licenseUrl : ""; }

    // Utility Methods
    public boolean hasRole(@Nullable String role) {
        return role != null && roles != null && roles.getOrDefault(role, false);
    }

    // Parcelable
    @Override
    public int describeContents() { return 0; }

    @Override
    public void writeToParcel(@NonNull Parcel dest, int flags) {
        dest.writeString(userId);
        dest.writeString(username);
        dest.writeString(email);
        dest.writeString(phoneNumber);
        dest.writeString(avatarUrl);
        dest.writeString(birthday);
        dest.writeString(address);
        dest.writeString(city);
        dest.writeString(ciCardFront);
        dest.writeString(ciCardBehind);
        dest.writeString(description);
        dest.writeString(verificationStatus);
        dest.writeString(status);
        dest.writeMap(roles);
        dest.writeString(currentRole);
        dest.writeString(licenseUrl);
    }

    @NonNull
    @Override
    public String toString() {
        return "User{userId='" + userId + "', username='" + username + "', verificationStatus='" + verificationStatus + "', currentRole='" + currentRole + "'}";
    }
}
```

### Model\UserClient.java
```java
package com.uit.carrental.Model;


import android.app.Application;

import com.uit.carrental.Model.User;


public class UserClient extends Application {
    private User user = null;

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }
}

```

### Model\Vehicle.java
```java
package com.uit.carrental.Model;

import android.os.Parcel;
import android.os.Parcelable;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import com.google.firebase.Timestamp;
import com.google.firebase.firestore.PropertyName;

public class Vehicle implements Parcelable {

    private String vehicleId;
    private String ownerId;
    private String vehicleName;
    private String vehiclePrice;
    private String vehicleSeats;
    private String vehicleNumber;
    private String vehicleAvailability;
    private String vehicleImageUrl;
    private String fuelType;
    private String maxSpeed;
    private String transmission;
    private String doorsAndSeats;
    private String vehicleBrand;
    private Float vehicleRating;
    private String verificationStatus;
    private Timestamp createdAt;
    private String documentImageUrl;

    public Vehicle() {
        this.vehicleId = "";
        this.ownerId = "";
        this.vehicleName = "";
        this.vehiclePrice = "";
        this.vehicleSeats = "";
        this.vehicleNumber = "";
        this.vehicleAvailability = "available";
        this.vehicleImageUrl = "";
        this.fuelType = "";
        this.maxSpeed = "";
        this.transmission = "";
        this.doorsAndSeats = "";
        this.vehicleBrand = "";
        this.vehicleRating = 4.0f;
        this.verificationStatus = "pending";
        this.createdAt = Timestamp.now();
        this.documentImageUrl = "";
    }

    protected Vehicle(Parcel in) {
        vehicleId = in.readString();
        ownerId = in.readString();
        vehicleName = in.readString();
        vehiclePrice = in.readString();
        vehicleSeats = in.readString();
        vehicleNumber = in.readString();
        vehicleAvailability = in.readString();
        vehicleImageUrl = in.readString();
        fuelType = in.readString();
        maxSpeed = in.readString();
        transmission = in.readString();
        doorsAndSeats = in.readString();
        vehicleBrand = in.readString();
        vehicleRating = in.readFloat();
        verificationStatus = in.readString();
        createdAt = in.readParcelable(Timestamp.class.getClassLoader());
        documentImageUrl = in.readString();
    }

    public static final Creator<Vehicle> CREATOR = new Creator<Vehicle>() {
        @Override
        public Vehicle createFromParcel(Parcel in) {
            return new Vehicle(in);
        }

        @Override
        public Vehicle[] newArray(int size) {
            return new Vehicle[size];
        }
    };

    // Getters and Setters
    @NonNull
    @PropertyName("vehicleId")
    public String getVehicleId() { return vehicleId != null ? vehicleId : ""; }
    public void setVehicleId(@Nullable String vehicleId) { this.vehicleId = vehicleId != null ? vehicleId : ""; }

    @NonNull
    @PropertyName("ownerId")
    public String getOwnerId() { return ownerId != null ? ownerId : ""; }
    public void setOwnerId(@Nullable String ownerId) { this.ownerId = ownerId != null ? ownerId : ""; }

    @NonNull
    @PropertyName("vehicleName")
    public String getVehicleName() { return vehicleName != null ? vehicleName : ""; }
    public void setVehicleName(@Nullable String vehicleName) { this.vehicleName = vehicleName != null ? vehicleName : ""; }

    @NonNull
    @PropertyName("vehiclePrice")
    public String getVehiclePrice() { return vehiclePrice != null ? vehiclePrice : ""; }
    public void setVehiclePrice(@Nullable String vehiclePrice) { this.vehiclePrice = vehiclePrice != null ? vehiclePrice : ""; }

    @NonNull
    @PropertyName("vehicleSeats")
    public String getVehicleSeats() { return vehicleSeats != null ? vehicleSeats : ""; }
    public void setVehicleSeats(@Nullable String vehicleSeats) { this.vehicleSeats = vehicleSeats != null ? vehicleSeats : ""; }

    @NonNull
    @PropertyName("vehicleNumber")
    public String getVehicleNumber() { return vehicleNumber != null ? vehicleNumber : ""; }
    public void setVehicleNumber(@Nullable String vehicleNumber) { this.vehicleNumber = vehicleNumber != null ? vehicleNumber : ""; }

    @NonNull
    @PropertyName("vehicleAvailability")
    public String getVehicleAvailability() { return vehicleAvailability != null ? vehicleAvailability : "available"; }
    public void setVehicleAvailability(@Nullable String vehicleAvailability) {
        this.vehicleAvailability = vehicleAvailability != null ? vehicleAvailability : "available";
    }

    @NonNull
    @PropertyName("vehicleImageUrl")
    public String getVehicleImageUrl() { return vehicleImageUrl != null ? vehicleImageUrl : ""; }
    public void setVehicleImageUrl(@Nullable String vehicleImageUrl) {
        this.vehicleImageUrl = vehicleImageUrl != null ? vehicleImageUrl : "";
    }

    @NonNull
    @PropertyName("fuelType")
    public String getFuelType() { return fuelType != null ? fuelType : ""; }
    public void setFuelType(@Nullable String fuelType) { this.fuelType = fuelType != null ? fuelType : ""; }

    @NonNull
    @PropertyName("maxSpeed")
    public String getMaxSpeed() { return maxSpeed != null ? maxSpeed : ""; }
    public void setMaxSpeed(@Nullable String maxSpeed) { this.maxSpeed = maxSpeed != null ? maxSpeed : ""; }

    @NonNull
    @PropertyName("transmission")
    public String getTransmission() { return transmission != null ? transmission : ""; }
    public void setTransmission(@Nullable String transmission) { this.transmission = transmission != null ? transmission : ""; }

    @NonNull
    @PropertyName("doorsAndSeats")
    public String getDoorsAndSeats() { return doorsAndSeats != null ? doorsAndSeats : ""; }
    public void setDoorsAndSeats(@Nullable String doorsAndSeats) { this.doorsAndSeats = doorsAndSeats != null ? doorsAndSeats : ""; }

    @NonNull
    @PropertyName("vehicleBrand")
    public String getVehicleBrand() { return vehicleBrand != null ? vehicleBrand : ""; }
    public void setVehicleBrand(@Nullable String vehicleBrand) { this.vehicleBrand = vehicleBrand != null ? vehicleBrand : ""; }

    @Nullable
    @PropertyName("vehicleRating")
    public Float getVehicleRating() { return vehicleRating; }
    public void setVehicleRating(@Nullable Float vehicleRating) {
        this.vehicleRating = vehicleRating != null && vehicleRating >= 0 ? vehicleRating : 4.0f;
    }

    @NonNull
    @PropertyName("verificationStatus")
    public String getVerificationStatus() { return verificationStatus != null ? verificationStatus : "pending"; }
    public void setVerificationStatus(@Nullable String verificationStatus) {
        this.verificationStatus = verificationStatus != null ? verificationStatus : "pending";
    }

    @Nullable
    @PropertyName("createdAt")
    public Timestamp getCreatedAt() { return createdAt; }
    public void setCreatedAt(@Nullable Timestamp createdAt) {
        this.createdAt = createdAt != null ? createdAt : Timestamp.now();
    }

    @NonNull
    @PropertyName("documentImageUrl")
    public String getDocumentImageUrl() { return documentImageUrl != null ? documentImageUrl : ""; }
    public void setDocumentImageUrl(@Nullable String documentImageUrl) {
        this.documentImageUrl = documentImageUrl != null ? documentImageUrl : "";
    }

    // Parcelable
    @Override
    public int describeContents() { return 0; }

    @Override
    public void writeToParcel(@NonNull Parcel dest, int flags) {
        dest.writeString(vehicleId);
        dest.writeString(ownerId);
        dest.writeString(vehicleName);
        dest.writeString(vehiclePrice);
        dest.writeString(vehicleSeats);
        dest.writeString(vehicleNumber);
        dest.writeString(vehicleAvailability);
        dest.writeString(vehicleImageUrl);
        dest.writeString(fuelType);
        dest.writeString(maxSpeed);
        dest.writeString(transmission);
        dest.writeString(doorsAndSeats);
        dest.writeString(vehicleBrand);
        dest.writeFloat(vehicleRating != null ? vehicleRating : 4.0f);
        dest.writeString(verificationStatus);
        dest.writeParcelable(createdAt, flags);
        dest.writeString(documentImageUrl);
    }

    @NonNull
    @Override
    public String toString() {
        return "Vehicle{vehicleId='" + vehicleId + "', vehicleName='" + vehicleName + "', brand='" + vehicleBrand +
                "', rating=" + vehicleRating + ", verificationStatus='" + verificationStatus + "'}";
    }
}
```

### Repository\VehicleRepository.java
```java
package com.uit.carrental.Repository;

import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.CollectionReference;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.Query;
import com.uit.carrental.Model.Vehicle;

import java.util.HashMap;
import java.util.Map;

public class VehicleRepository {
    private final CollectionReference vehiclesRef;
    private final CollectionReference notificationsRef;

    public VehicleRepository() {
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        vehiclesRef = db.collection("Vehicles");
        notificationsRef = db.collection("Notifications");
    }

    public Task<DocumentReference> addVehicle(Vehicle vehicle) {
        return vehiclesRef.add(vehicle);
    }

    public Task<Void> updateVehicleId(String vehicleId, String documentId) {
        Map<String, Object> data = new HashMap<>();
        data.put("vehicleId", vehicleId);
        return vehiclesRef.document(documentId).update(data);
    }

    public Task<DocumentReference> createAdminNotification(String title, String content, String vehicleId) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("title", title);
        notification.put("content", content);
        notification.put("timestamp", com.google.firebase.Timestamp.now());
        notification.put("status", "unread");
        notification.put("type", "vehicle_verification");
        notification.put("vehicleId", vehicleId);
        notification.put("recipient", "admin");
        return notificationsRef.add(notification);
    }

    public Query getVehiclesForOwner(String ownerId) {
        return vehiclesRef.whereEqualTo("ownerId", ownerId);
    }

    public Query getVerifiedVehicles() {
        return vehiclesRef.whereEqualTo("verificationStatus", "verified")
                .whereEqualTo("vehicleAvailability", "available");
    }
}
```

### Service\Activity\CustomerActivityDetail.java
```java
//package com.uit.carrental.Service.Activity;
//
//import android.content.Intent;
//import android.os.Build;
//import android.os.Bundle;
//import android.os.StrictMode;
//import android.util.Log;
//import android.view.View;
//import android.widget.Button;
//import android.widget.ImageView;
//import android.widget.TextView;
//import android.widget.Toast;
//
//import androidx.annotation.RequiresApi;
//import androidx.appcompat.app.AppCompatActivity;
//
//import com.google.firebase.Timestamp;
//import com.google.firebase.firestore.FirebaseFirestore;
//import com.google.firebase.firestore.QueryDocumentSnapshot;
//import com.squareup.picasso.Picasso;
//import com.uit.carrental.ActivityPages.CustomerMainActivity;
//import com.uit.carrental.Model.User;
//import com.uit.carrental.Model.Vehicle;
//import com.uit.carrental.R;
//import com.uit.carrental.Service.ZaloPay.Api.CreateOrder;
//import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
//
//import org.json.JSONObject;
//
//import java.text.ParseException;
//import java.text.SimpleDateFormat;
//import java.util.Date;
//import java.util.HashMap;
//import java.util.Map;
//
//import vn.zalopay.sdk.Environment;
//import vn.zalopay.sdk.ZaloPayError;
//import vn.zalopay.sdk.ZaloPaySDK;
//import vn.zalopay.sdk.listeners.PayOrderListener;
//
//public class CustomerActivityDetail extends AppCompatActivity {
//
//    private FirebaseFirestore db;
//    private CreateOrder orderApi;
//    private Intent intent;
//    private String ownerId, vehicleId, ownerName, ownerEmail, ownerPhone, ownerAddress, vehicleName, vehiclePrice, vehiclePickup, vehicleDrop, totalCost; // Thay provideId bằng ownerId
//    private String notiId, notiStatus, orderId;
//    private String amount = "1000";
//    private ImageView vehicleImage;
//    private TextView tvId, tvStatus, name, email, phoneNumber, tvBrandCar, tvGia, tvDiaDiem, pickup, dropoff, tvTotalCost;
//    private Button btnPayment, btnCancel, btnBack;
//
//    @Override
//    protected void onCreate(Bundle savedInstanceState) {
//        super.onCreate(savedInstanceState);
//        setContentView(R.layout.customer_booking_detail);
//        intent = getIntent();
//        notiId = intent.getStringExtra("NotiID");
//
//        init();
//
//        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();
//        StrictMode.setThreadPolicy(policy);
//
//        ZaloPaySDK.init(AppInfo.APP_ID, Environment.SANDBOX);
//
//        db = FirebaseFirestore.getInstance();
//        db.collection("Notification")
//                .whereEqualTo("noti_id", notiId)
//                .get()
//                .addOnSuccessListener(querySnapshot -> {
//                    for (QueryDocumentSnapshot document : querySnapshot) {
//                        Activity temp = new Activity();
//                        temp.setNoti_id(document.getId());
//                        temp.setOwnerId(document.getString("ownerId")); // Thay provider_id bằng ownerId
//                        temp.setVehicle_id(document.getString("vehicle_id"));
//                        temp.setStatus(document.getString("status"));
//                        temp.setPickup(document.getString("pickup"));
//                        temp.setDropoff(document.getString("dropoff"));
//
//                        vehiclePickup = temp.getPickup();
//                        vehicleDrop = temp.getDropoff();
//                        ownerId = temp.getOwnerId(); // Thay provideId bằng ownerId
//                        vehicleId = temp.getVehicle_id();
//                        notiStatus = temp.getStatus();
//
//                        if (document.contains("order_id")) {
//                            orderId = document.getString("order_id");
//                            Log.e("OrderID", "order_id: " + orderId);
//                        }
//
//                        tvId.setText(notiId);
//                        updateStatusAndButton(notiStatus);
//
//                        getUser(ownerId); // Thay provideId bằng ownerId
//                        getVehicle(vehicleId);
//                    }
//                })
//                .addOnFailureListener(e -> Toast.makeText(this, "Không thể lấy thông báo: " + e.getMessage(), Toast.LENGTH_SHORT).show());
//
//        btnPayment.setOnClickListener(v -> {
//            if (orderId != null) {
//                createOrderAndPay();
//            } else {
//                Toast.makeText(this, "Không tìm thấy order_id!", Toast.LENGTH_SHORT).show();
//            }
//        });
//
//        btnBack.setOnClickListener(v -> finish());
//
//        btnCancel.setOnClickListener(v -> handleCancel());
//    }
//
//    private void init() {
//        tvId = findViewById(R.id.txtview_noti_id);
//        tvStatus = findViewById(R.id.txtview_noti_status);
//        email = findViewById(R.id.txtview_noti_email);
//        name = findViewById(R.id.txtview_noti_name);
//        phoneNumber = findViewById(R.id.txtview_noti_phoneNumber);
//        tvBrandCar = findViewById(R.id.txtview_noti_BrandCar);
//        tvDiaDiem = findViewById(R.id.txt_checkout_address);
//        btnPayment = findViewById(R.id.btn_customer_pay);
//        btnCancel = findViewById(R.id.customer_details_btn);
//        btnBack = findViewById(R.id.btn_noti_back);
//        tvGia = findViewById(R.id.txtview_noti_price);
//        pickup = findViewById(R.id.tv_noti_pickup);
//        dropoff = findViewById(R.id.tv_noti_dropoff);
//        tvTotalCost = findViewById(R.id.txtview_noti_totalCost);
//        vehicleImage = findViewById(R.id.img_noti_car);
//    }
//
//    private void updateStatusAndButton(String status) {
//        switch (status) {
//            case "Dang cho":
//                tvStatus.setText("Chưa được xác nhận");
//                btnPayment.setVisibility(View.GONE);
//                break;
//            case "Xac nhan":
//                tvStatus.setText("Đã xác nhận");
//                btnPayment.setVisibility(View.VISIBLE);
//                break;
//            case "Thanh toan":
//                tvStatus.setText("Đang chờ thanh toán");
//                btnPayment.setVisibility(View.VISIBLE);
//                break;
//            case "Khong xac nhan":
//                tvStatus.setText("Không được xác nhận");
//                btnPayment.setVisibility(View.GONE);
//                break;
//            default:
//                tvStatus.setText("Đã thanh toán");
//                btnPayment.setVisibility(View.GONE);
//                break;
//        }
//    }
//
//    @RequiresApi(api = Build.VERSION_CODES.O)
//    private void createOrderAndPay() {
//        try {
//            CreateOrder createOrder = new CreateOrder();
//            JSONObject data = createOrder.createOrder(amount);
//
//            if (data == null) {
//                Toast.makeText(this, "Không thể tạo đơn hàng!", Toast.LENGTH_SHORT).show();
//                return;
//            }
//
//            String code = data.getString("returncode");
//            if ("1".equals(code)) {
//                String token = data.getString("zptranstoken");
//                checkout(token);
//            } else {
//                Toast.makeText(this, "Lỗi tạo đơn hàng!", Toast.LENGTH_SHORT).show();
//            }
//        } catch (Exception e) {
//            Log.e("ZaloPay", "Exception: " + e.getMessage());
//            Toast.makeText(this, "Exception: " + e.getMessage(), Toast.LENGTH_SHORT).show();
//        }
//    }
//
//    private void checkout(String token) {
//        ZaloPaySDK.getInstance().payOrder(this, token, "demozpdk://app", new PayOrderListener() {
//            @Override
//            public void onPaymentSucceeded(String transId, String zpTransToken, String appTransId) {
//                runOnUiThread(() -> {
//                    postPayment();
//                    updateOrderAfterPayment(orderId, ownerId); // Thay provideId bằng ownerId
//                });
//            }
//
//            @Override
//            public void onPaymentCanceled(String zpTransToken, String appTransId) {
//                runOnUiThread(() -> Toast.makeText(CustomerActivityDetail.this, "Bạn đã hủy thanh toán.", Toast.LENGTH_SHORT).show());
//            }
//
//            @Override
//            public void onPaymentError(ZaloPayError zaloPayError, String zpTransToken, String appTransId) {
//                runOnUiThread(() -> Toast.makeText(CustomerActivityDetail.this, "Thanh toán thất bại!", Toast.LENGTH_SHORT).show());
//            }
//        });
//    }
//
//    private void postPayment() {
//        Map<String, Object> updateData = new HashMap<>();
//        updateData.put("payment_status", "paid");
//        updateData.put("status", "processing");
//
//        db.collection("Orders")
//                .document(orderId)
//                .update(updateData)
//                .addOnSuccessListener(unused -> Log.e("Payment Update", "Cập nhật trạng thái thành công!"))
//                .addOnFailureListener(e -> Log.e("Payment Update", "Cập nhật thất bại: " + e.getMessage()));
//    }
//
//    private void updateOrderAfterPayment(String orderId, String ownerId) { // Thay providerId bằng ownerId
//        Map<String, Object> updates = new HashMap<>();
//        updates.put("status", "Đã thanh toán");
//        updates.put("payment_method", "zalo_pay");
//
//        db.collection("Orders").document(orderId)
//                .update(updates)
//                .addOnSuccessListener(aVoid -> {
//                    Toast.makeText(this, "Thanh toán thành công!", Toast.LENGTH_SHORT).show();
//                    createPaymentSuccessNotification(ownerId); // Thay providerId bằng ownerId
//                    Intent intent = new Intent(this, CustomerMainActivity.class);
//                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);
//                    startActivity(intent);
//                    finish();
//                })
//                .addOnFailureListener(e -> Toast.makeText(this, "Có lỗi khi cập nhật đơn hàng: " + e.getMessage(), Toast.LENGTH_SHORT).show());
//    }
//
//    private void createPaymentSuccessNotification(String ownerId) { // Thay providerId bằng ownerId
//        Map<String, Object> notification = new HashMap<>();
//        notification.put("user_id", ownerId);
//        notification.put("title", "Thanh toán thành công");
//        notification.put("content", "Khách hàng đã thanh toán đơn thuê xe của bạn.");
//        notification.put("timestamp", new Timestamp(new Date()));
//        notification.put("status", "unread");
//
//        db.collection("Notifications")
//                .add(notification)
//                .addOnFailureListener(e -> Log.e("Notification", "Lỗi tạo thông báo: " + e.getMessage()));
//    }
//
//    private void getUser(String ownerId) { // Thay provideId bằng ownerId
//        db.collection("Users")
//                .whereEqualTo("user_id", ownerId)
//                .get()
//                .addOnSuccessListener(querySnapshot -> {
//                    for (QueryDocumentSnapshot document : querySnapshot) {
//                        User user = document.toObject(User.class);
//                        ownerName = user.getUsername();
//                        ownerEmail = user.getEmail();
//                        ownerPhone = user.getPhoneNumber();
//                        ownerAddress = user.getAddress();
//                        name.setText(ownerName);
//                        email.setText(ownerEmail);
//                        phoneNumber.setText(ownerPhone);
//                        tvDiaDiem.setText(ownerAddress != null ? ownerAddress : "Chưa xác định");
//                    }
//                })
//                .addOnFailureListener(e -> Toast.makeText(this, "Không thể lấy thông tin nhà cung cấp: " + e.getMessage(), Toast.LENGTH_SHORT).show());
//    }
//
//    private void getVehicle(String vehicleId) {
//        db.collection("Vehicles")
//                .whereEqualTo("vehicleId", vehicleId)
//                .get()
//                .addOnSuccessListener(querySnapshot -> {
//                    for (QueryDocumentSnapshot document : querySnapshot) {
//                        Vehicle vehicle = document.toObject(Vehicle.class);
//                        vehicle.setVehicleId(document.getId());
//                        vehicleName = vehicle.getVehicleName();
//                        vehiclePrice = vehicle.getVehiclePrice();
//                        tvBrandCar.setText(vehicleName);
//                        tvGia.setText(vehiclePrice + "/ngày");
//                        pickup.setText(vehiclePickup);
//                        dropoff.setText(vehicleDrop);
//                        totalCost = calculate(vehiclePickup, vehicleDrop);
//                        tvTotalCost.setText(totalCost);
//                        amount = totalCost;
//
//                        if (!vehicle.getVehicleImageUrl().isEmpty()) {
//                            Picasso.get().load(vehicle.getVehicleImageUrl()).into(vehicleImage);
//                        }
//
//                        ownerId = vehicle.getOwnerId(); // Đã đúng với model Vehicle
//                        getUser(ownerId); // Thay provideId bằng ownerId
//                    }
//                })
//                .addOnFailureListener(e -> Toast.makeText(this, "Không thể lấy thông tin xe: " + e.getMessage(), Toast.LENGTH_SHORT).show());
//    }
//
//    private String calculate(String startDate, String endDate) {
//        try {
//            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
//            Date start = sdf.parse(startDate);
//            Date end = sdf.parse(endDate);
//
//            long diffInMillies = end.getTime() - start.getTime();
//            long daysBetween = diffInMillies / (1000 * 60 * 60 * 24);
//
//            if (daysBetween <= 0) {
//                Toast.makeText(this, "Ngày trả phải sau ngày nhận!", Toast.LENGTH_SHORT).show();
//                return "0";
//            }
//
//            String priceText = tvGia.getText().toString().replace("/ngày", "");
//            int pricePerDay = Integer.parseInt(priceText.replaceAll("[^0-9]", ""));
//            long totalPrice = pricePerDay * daysBetween;
//
//            Log.e("Total Days", String.valueOf(daysBetween));
//            Log.e("Total Price", String.valueOf(totalPrice));
//
//            return String.valueOf(totalPrice);
//        } catch (ParseException e) {
//            e.printStackTrace();
//            Toast.makeText(this, "Định dạng ngày không hợp lệ!", Toast.LENGTH_SHORT).show();
//            return "0";
//        }
//    }
//
//    private void handleCancel() {
//        Map<String, Object> updates = new HashMap<>();
//        updates.put("status", "cancelled");
//
//        db.collection("Notification").document(notiId)
//                .update(updates)
//                .addOnSuccessListener(aVoid -> {
//                    Toast.makeText(this, "Đã hủy đơn đặt xe", Toast.LENGTH_SHORT).show();
//                    finish();
//                })
//                .addOnFailureListener(e -> Toast.makeText(this, "Lỗi hủy đơn: " + e.getMessage(), Toast.LENGTH_SHORT).show());
//    }
//
//    @Override
//    protected void onNewIntent(Intent intent) {
//        super.onNewIntent(intent);
//        ZaloPaySDK.getInstance().onResult(intent);
//    }
//}
```

### Service\Activity\OwnerActivityDetail.java
```java
package com.uit.carrental.Service.Activity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;

import com.google.firebase.Timestamp;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

public class OwnerActivityDetail extends AppCompatActivity {

    private static final String TAG = "OwnerActivityDetail";

    private FirebaseFirestore db;
    private String bookingId, vehicleId;
    private Booking booking;
    private Vehicle vehicle;
    private User customer;
    private ImageView vehicleImage, btnBack;
    private TextView tvId, tvName, tvEmail, tvPhoneNumber, tvStatus, tvBrandCar, tvPrice, tvAddress, tvPickup, tvDropoff, tvTotalCost;
    private Button btnConfirm, btnReject;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.owner_booking_detail);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }

        bookingId = getIntent().getStringExtra("NotiID");
        if (bookingId == null) {
            Toast.makeText(this, "Không tìm thấy yêu cầu", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        initViews();
        initFirebase();
        loadBookingData();

        btnBack.setOnClickListener(v -> {
            startActivity(new Intent(this, OwnerMainActivity.class));
            finish();
        });

        btnConfirm.setOnClickListener(v -> confirmBooking());
        btnReject.setOnClickListener(v -> rejectBooking());
    }

    private void initViews() {
        tvId = findViewById(R.id.txtview_noti_id);
        tvName = findViewById(R.id.txtview_noti_name);
        tvEmail = findViewById(R.id.txtview_noti_email);
        tvPhoneNumber = findViewById(R.id.txtview_noti_phoneNumber);
        tvStatus = findViewById(R.id.txtview_noti_status);
        tvBrandCar = findViewById(R.id.txtview_noti_BrandCar);
        tvPrice = findViewById(R.id.txtview_noti_price);
        tvAddress = findViewById(R.id.txt_checkout_address);
        tvPickup = findViewById(R.id.tv_noti_pickup);
        tvDropoff = findViewById(R.id.tv_noti_dropoff);
        tvTotalCost = findViewById(R.id.txtview_noti_totalCost);
        btnConfirm = findViewById(R.id.btn_noti_XacNhan);
        btnReject = findViewById(R.id.btn_noti_huy);
        btnBack = findViewById(R.id.btn_noti_back);
        vehicleImage = findViewById(R.id.img_noti_car);
    }

    private void initFirebase() {
        db = FirebaseFirestore.getInstance();
    }

    private void loadBookingData() {
        db.collection("Bookings").document(bookingId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        booking = document.toObject(Booking.class);
                        if (booking != null) {
                            vehicleId = booking.getVehicleId();
                            tvId.setText(bookingId);
                            updateStatusView();
                            loadVehicleData();
                            loadCustomerData();
                            updateTimeAndPrice();
                        } else {
                            Toast.makeText(this, "Không thể đọc dữ liệu yêu cầu", Toast.LENGTH_SHORT).show();
                            finish();
                        }
                    } else {
                        Toast.makeText(this, "Yêu cầu không tồn tại", Toast.LENGTH_SHORT).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    finish();
                });
    }

    private void updateStatusView() {
        String status = booking.getStatus();
        switch (status) {
            case "pending":
                tvStatus.setText("Chưa được xác nhận");
                break;
            case "confirmed":
                tvStatus.setText("Đã xác nhận");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "rejected":
                tvStatus.setText("Không được xác nhận");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "paid":
                tvStatus.setText("Đã thanh toán");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "completed":
                tvStatus.setText("Đã hoàn thành");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            default:
                tvStatus.setText(status);
        }
    }

    private void loadVehicleData() {
        db.collection("Vehicles").document(vehicleId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        vehicle = document.toObject(Vehicle.class);
                        if (vehicle != null) {
                            tvBrandCar.setText(vehicle.getVehicleName());
                            tvPrice.setText(vehicle.getVehiclePrice());
                            if (!vehicle.getVehicleImageUrl().isEmpty()) {
                                Picasso.get().load(vehicle.getVehicleImageUrl()).into(vehicleImage);
                            }
                        }
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu xe: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải xe: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void loadCustomerData() {
        db.collection("Users").document(booking.getCustomerId())
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        customer = document.toObject(User.class);
                        if (customer != null) {
                            tvName.setText(customer.getUsername());
                            tvEmail.setText(customer.getEmail());
                            tvPhoneNumber.setText(customer.getPhoneNumber());
                            tvAddress.setText(customer.getAddress() != null ? customer.getAddress() : "Không có địa chỉ");
                        }
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu khách hàng: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải khách hàng: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void updateTimeAndPrice() {
        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());
        tvPickup.setText(sdf.format(booking.getStartTime().toDate()));
        tvDropoff.setText(sdf.format(booking.getEndTime().toDate()));
        tvTotalCost.setText(String.format(Locale.getDefault(), "%,d VNĐ", booking.getTotalAmount()));
    }

    private void confirmBooking() {
        // Tính thời gian bảo trì (1 ngày sau endTime)
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(booking.getEndTime().toDate());
        calendar.add(Calendar.DAY_OF_MONTH, 1);
        Timestamp maintenanceEndTime = new Timestamp(calendar.getTime());

        Map<String, Object> updates = new HashMap<>();
        updates.put("status", "confirmed");
        updates.put("updatedAt", Timestamp.now());
        updates.put("maintenanceEndTime", maintenanceEndTime);

        db.collection("Bookings").document(bookingId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    sendCustomerNotification("Yêu cầu được xác nhận", "Yêu cầu đặt xe của bạn đã được xác nhận.");
                    Toast.makeText(this, "Đã xác nhận yêu cầu", Toast.LENGTH_SHORT).show();
                    createOrder();
                    finish();
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi xác nhận yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi xác nhận: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void rejectBooking() {
        Map<String, Object> updates = new HashMap<>();
        updates.put("status", "rejected");
        updates.put("updatedAt", Timestamp.now());

        db.collection("Bookings").document(bookingId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    sendCustomerNotification("Yêu cầu bị từ chối", "Yêu cầu đặt xe của bạn đã bị từ chối.");
                    Toast.makeText(this, "Đã từ chối yêu cầu", Toast.LENGTH_SHORT).show();
                    finish();
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi từ chối yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi từ chối: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void createOrder() {
        Map<String, Object> orderData = new HashMap<>();
        orderData.put("customer_id", booking.getCustomerId());
        orderData.put("provider_id", vehicle.getOwnerId());
        orderData.put("vehicle_id", vehicleId);
        orderData.put("pickup_time", booking.getStartTime());
        orderData.put("dropoff_time", booking.getEndTime());
        orderData.put("total_amount", booking.getTotalAmount());
        orderData.put("status", "pending");
        orderData.put("payment_status", "pending");
        orderData.put("created_at", Timestamp.now());

        db.collection("Orders").add(orderData)
                .addOnSuccessListener(orderRef -> {
                    Log.d(TAG, "Order created: " + orderRef.getId());
                    Map<String, Object> updateData = new HashMap<>();
                    updateData.put("order_id", orderRef.getId());
                    db.collection("Bookings").document(bookingId)
                            .update(updateData)
                            .addOnSuccessListener(aVoid -> Log.d(TAG, "order_id updated in booking"))
                            .addOnFailureListener(e -> Log.e(TAG, "Failed to update booking", e));
                })
                .addOnFailureListener(e -> Log.e(TAG, "Failed to create order", e));
    }

    private void sendCustomerNotification(String title, String content) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("recipient", booking.getCustomerId());
        notification.put("title", title);
        notification.put("content", content);
        notification.put("timestamp", Timestamp.now());
        notification.put("status", "unread");
        notification.put("type", "booking_status");
        notification.put("bookingId", bookingId);
        notification.put("vehicleId", vehicleId);

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> Log.d(TAG, "Gửi thông báo thành công"))
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi gửi thông báo: " + e.getMessage()));
    }
}

```

### Service\Api\CloudinaryApi.java
```java
package com.uit.carrental.Service.Api;

import android.content.Context;
import android.net.Uri;
import android.util.Log;

import com.cloudinary.android.MediaManager;
import com.cloudinary.android.callback.ErrorInfo;
import com.cloudinary.android.callback.UploadCallback;

import java.util.HashMap;
import java.util.Map;

public class CloudinaryApi {

    private static final String CLOUD_NAME = "drc8ylzsd";
    private static final String API_KEY = "186315811678634";
    private static final String UPLOAD_PRESET = "car_rent_unsigned";

    private static boolean initialized = false;

    public static void init(Context context) {
        if (initialized) return;

        Map<String, Object> config = new HashMap<>();
        config.put("cloud_name", CLOUD_NAME);
        config.put("api_key", API_KEY);
        config.put("unsigned", true);
        MediaManager.init(context, config);
        initialized = true;
    }

    public static void uploadImage(Context context, Uri imageUri, UploadCallbackCustom callback) {
        init(context);

        MediaManager.get().upload(imageUri)
                .option("upload_preset", UPLOAD_PRESET)
                .option("unsigned", true) // THÊM DÒNG NÀY !!!
                .callback(new UploadCallback() {
                    @Override
                    public void onStart(String requestId) {
                        Log.d("Cloudinary", "Upload Started: " + requestId);
                    }

                    @Override
                    public void onProgress(String requestId, long bytes, long totalBytes) {
                        Log.d("Cloudinary", "Progress: " + bytes + "/" + totalBytes);
                    }

                    @Override
                    public void onSuccess(String requestId, Map resultData) {
                        String url = (String) resultData.get("secure_url");
                        if (callback != null) callback.onSuccess(url);
                    }

                    @Override
                    public void onError(String requestId, ErrorInfo error) {
                        if (callback != null) callback.onFailure(new Exception(error.getDescription()));
                    }

                    @Override
                    public void onReschedule(String requestId, ErrorInfo error) {
                        if (callback != null) callback.onFailure(new Exception(error.getDescription()));
                    }
                })
                .dispatch();
    }


    public interface UploadCallbackCustom {
        void onSuccess(String url);
        void onFailure(Exception e);
    }
}

```

### Service\Booking\CarDetailActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.R;


public class CarDetailActivity extends AppCompatActivity {
    Button btnBook;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.activity_detail_car);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        overridePendingTransition(R.anim.anim_in_right,R.anim.anim_out_left);

        btnBook =findViewById(R.id.btn_book);
        btnBook.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent it1=new Intent(CarDetailActivity.this, ScheduleSelect.class);
            }
        });
    }

}

```

### Service\Booking\CustomerBookingDetailActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import com.google.firebase.Timestamp;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.ZaloPay.Api.CreateOrder;
import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
import org.json.JSONObject;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import vn.zalopay.sdk.Environment;
import vn.zalopay.sdk.ZaloPayError;
import vn.zalopay.sdk.ZaloPaySDK;
import vn.zalopay.sdk.listeners.PayOrderListener;

public class CustomerBookingDetailActivity extends AppCompatActivity {

    private static final String TAG = "CustomerBookingDetailActivity";
    private ImageView imgBack, imgCar;
    private TextView tvBookingId, tvVehicleName, tvOwnerName, tvOwnerEmail, tvOwnerPhone, tvPickupLocation, tvPickupTime, tvDropoffTime, tvPrice, tvTotalCost, tvStatus;
    private Button btnPay, btnCancel;
    private FirebaseFirestore db;
    private String bookingId;
    private Booking booking;
    private String orderId;
    private final ExecutorService executorService = Executors.newSingleThreadExecutor();
    private final Handler mainHandler = new Handler(Looper.getMainLooper());

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.customer_booking_detail);

        db = FirebaseFirestore.getInstance();
        bookingId = getIntent().getStringExtra("bookingId");
        if (bookingId == null || bookingId.isEmpty()) {
            Toast.makeText(this, "Không tìm thấy bookingId", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        // Khởi tạo ZaloPay SDK
        ZaloPaySDK.init(AppInfo.APP_ID, Environment.SANDBOX);

        initViews();
        loadBookingDetails();
        setupButtons();
    }

    private void initViews() {
        imgBack = findViewById(R.id.btn_noti_back);
        imgCar = findViewById(R.id.img_noti_car);
        tvBookingId = findViewById(R.id.txtview_noti_id);
        tvVehicleName = findViewById(R.id.txtview_noti_BrandCar);
        tvOwnerName = findViewById(R.id.txtview_noti_name);
        tvOwnerEmail = findViewById(R.id.txtview_noti_email);
        tvOwnerPhone = findViewById(R.id.txtview_noti_phoneNumber);
        tvPickupLocation = findViewById(R.id.txt_checkout_address);
        tvPickupTime = findViewById(R.id.tv_noti_pickup);
        tvDropoffTime = findViewById(R.id.tv_noti_dropoff);
        tvPrice = findViewById(R.id.txtview_noti_price);
        tvTotalCost = findViewById(R.id.txtview_noti_totalCost);
        tvStatus = findViewById(R.id.txtview_noti_status);
        btnPay = findViewById(R.id.btn_customer_pay);
        btnCancel = findViewById(R.id.customer_details_btn);
    }

    private void loadBookingDetails() {
        db.collection("Bookings").document(bookingId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        booking = document.toObject(Booking.class);
                        if (booking != null) {
                            tvBookingId.setText(booking.getBookingId());
                            if (document.contains("orderId")) {
                                orderId = document.getString("orderId");
                                Log.d(TAG, "orderId: " + orderId);
                            } else {
                                Toast.makeText(this, "Không tìm thấy orderId trong booking", Toast.LENGTH_SHORT).show();
                                finish();
                                return;
                            }

                            // Lấy thông tin xe
                            db.collection("Vehicles").document(booking.getVehicleId())
                                    .get()
                                    .addOnSuccessListener(vehicleDoc -> {
                                        if (vehicleDoc.exists()) {
                                            Vehicle vehicle = vehicleDoc.toObject(Vehicle.class);
                                            if (vehicle != null) {
                                                tvVehicleName.setText(vehicle.getVehicleName());
                                                tvPrice.setText(vehicle.getVehiclePrice());
                                                if (!vehicle.getVehicleImageUrl().isEmpty()) {
                                                    Picasso.get().load(vehicle.getVehicleImageUrl()).into(imgCar);
                                                }
                                            }
                                        }
                                    })
                                    .addOnFailureListener(e -> Log.e(TAG, "Lỗi lấy vehicle: " + e.getMessage()));

                            // Lấy thông tin owner
                            db.collection("Users").document(booking.getOwnerId())
                                    .get()
                                    .addOnSuccessListener(userDoc -> {
                                        if (userDoc.exists()) {
                                            User owner = userDoc.toObject(User.class);
                                            if (owner != null) {
                                                tvOwnerName.setText(owner.getUsername());
                                                tvOwnerEmail.setText(owner.getEmail());
                                                tvOwnerPhone.setText(owner.getPhoneNumber());
                                            }
                                        }
                                    })
                                    .addOnFailureListener(e -> Log.e(TAG, "Lỗi lấy owner: " + e.getMessage()));

                            tvPickupLocation.setText(booking.getPickupLocation());
                            SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());
                            tvPickupTime.setText(booking.getStartTime() != null ? sdf.format(booking.getStartTime().toDate()) : "");
                            tvDropoffTime.setText(booking.getEndTime() != null ? sdf.format(booking.getEndTime().toDate()) : "");
                            DecimalFormat formatter = new DecimalFormat("#,### VNĐ");
                            tvTotalCost.setText(formatter.format(booking.getTotalAmount()));
                            tvStatus.setText(getStatusText(booking.getStatus()));

                            // Hiển thị nút thanh toán
                            btnPay.setVisibility(booking.getStatus().equals("confirmed") && booking.getPaymentStatus().equals("unpaid") ? View.VISIBLE : View.GONE);
                        } else {
                            Toast.makeText(this, "Không thể ánh xạ dữ liệu booking", Toast.LENGTH_SHORT).show();
                            finish();
                        }
                    } else {
                        Toast.makeText(this, "Không tìm thấy booking", Toast.LENGTH_SHORT).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(this, "Lỗi tải chi tiết: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    finish();
                });
    }

    private String getStatusText(String status) {
        switch (status) {
            case "pending": return "Chưa xác nhận";
            case "confirmed": return "Đã xác nhận";
            case "rejected": return "Bị từ chối";
            case "paid": return "Đã thanh toán";
            case "completed": return "Đã hoàn thành";
            case "cancelled": return "Đã hủy";
            default: return status;
        }
    }

    private void setupButtons() {
        imgBack.setOnClickListener(v -> finish());

        btnPay.setOnClickListener(v -> {
            if (orderId != null && !orderId.isEmpty()) {
                createOrderAndPay();
            } else {
                Toast.makeText(this, "Không tìm thấy orderId!", Toast.LENGTH_SHORT).show();
            }
        });

        btnCancel.setOnClickListener(v -> {
            Map<String, Object> updates = new HashMap<>();
            updates.put("status", "cancelled");
            updates.put("updatedAt", Timestamp.now());

            db.collection("Bookings").document(bookingId)
                    .update(updates)
                    .addOnSuccessListener(aVoid -> {
                        createNotification(booking.getOwnerId(), "Booking #" + bookingId + " đã bị hủy", "status_update");
                        Toast.makeText(this, "Hủy đơn hàng thành công", Toast.LENGTH_SHORT).show();
                        finish();
                    })
                    .addOnFailureListener(e -> Toast.makeText(this, "Lỗi hủy đơn hàng: " + e.getMessage(), Toast.LENGTH_SHORT).show());
        });
    }

    private void createOrderAndPay() {
        long amount = (long) booking.getTotalAmount();
        if (amount <= 0) {
            Toast.makeText(this, "Số tiền không hợp lệ!", Toast.LENGTH_SHORT).show();
            return;
        }

        executorService.execute(() -> {
            try {
                CreateOrder createOrder = new CreateOrder();
                JSONObject data = createOrder.createOrder(String.valueOf(amount));
                mainHandler.post(() -> {
                    if (data == null) {
                        Toast.makeText(this, "Không thể tạo đơn hàng!", Toast.LENGTH_SHORT).show();
                        Log.e(TAG, "ZaloPay response: null");
                        return;
                    }
                    try {
                        Log.d(TAG, "ZaloPay response: " + data.toString());
                        String code = data.getString("returncode");
                        if ("1".equals(code)) {
                            String token = data.getString("zptranstoken");
                            checkout(token);
                        } else {
                            Toast.makeText(this, "Lỗi tạo đơn hàng: returncode " + code, Toast.LENGTH_SHORT).show();
                            Log.e(TAG, "ZaloPay returncode: " + code);
                        }
                    } catch (Exception e) {
                        Toast.makeText(this, "Lỗi xử lý response: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                        Log.e(TAG, "ZaloPay Exception: " + e.getMessage());
                    }
                });
            } catch (Exception e) {
                mainHandler.post(() -> {
                    Toast.makeText(this, "Lỗi tạo đơn hàng: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    Log.e(TAG, "ZaloPay Exception: " + e.getMessage());
                });
            }
        });
    }

    private void checkout(String token) {
        ZaloPaySDK.getInstance().payOrder(this, token, "demozpdk://app", new PayOrderListener() {
            @Override
            public void onPaymentSucceeded(String transId, String zpTransToken, String appTransId) {
                runOnUiThread(() -> {
                    postPayment(transId, appTransId);
                });
            }

            @Override
            public void onPaymentCanceled(String zpTransToken, String appTransId) {
                runOnUiThread(() -> Toast.makeText(CustomerBookingDetailActivity.this, "Bạn đã hủy thanh toán.", Toast.LENGTH_SHORT).show());
            }

            @Override
            public void onPaymentError(ZaloPayError zaloPayError, String zpTransToken, String appTransId) {
                runOnUiThread(() -> Toast.makeText(CustomerBookingDetailActivity.this, "Thanh toán thất bại: " + zaloPayError, Toast.LENGTH_SHORT).show());
            }
        });
    }

    private void postPayment(String transId, String appTransId) {
        Map<String, Object> updates = new HashMap<>();
        updates.put("paymentStatus", "paid");
        updates.put("paymentMethod", "ZaloPay");
        updates.put("paymentId", transId);
        updates.put("status", "paid");
        updates.put("updatedAt", Timestamp.now());
        updates.put("orderId", orderId);

        db.collection("Bookings").document(bookingId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    createPaymentSuccessNotification(booking.getOwnerId());
                    Toast.makeText(this, "Thanh toán thành công!", Toast.LENGTH_SHORT).show();
                    Intent intent = new Intent(CustomerBookingDetailActivity.this, CustomerMainActivity.class);
                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);
                    startActivity(intent);
                    finish();
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi cập nhật booking: " + e.getMessage());
                    Toast.makeText(this, "Lỗi cập nhật booking: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void createPaymentSuccessNotification(String ownerId) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("userId", ownerId);
        notification.put("title", "Thanh toán thành công");
        notification.put("message", "Khách hàng đã thanh toán đơn thuê xe #" + bookingId);
        notification.put("type", "payment_success");
        notification.put("bookingId", bookingId);
        notification.put("createdAt", Timestamp.now());
        notification.put("isRead", false);
        notification.put("notificationId", "");

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    String notificationId = documentReference.getId();
                    db.collection("Notifications").document(notificationId)
                            .update("notificationId", notificationId);
                    Log.d(TAG, "Tạo thông báo thanh toán thành công: " + notificationId);
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi tạo thông báo: " + e.getMessage()));
    }

    private void createNotification(String userId, String message, String type) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("userId", userId);
        notification.put("title", type.equals("payment_success") ? "Thanh toán thành công" : "Cập nhật trạng thái");
        notification.put("message", message);
        notification.put("type", type);
        notification.put("bookingId", bookingId);
        notification.put("createdAt", Timestamp.now());
        notification.put("isRead", false);
        notification.put("notificationId", "");

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    String notificationId = documentReference.getId();
                    db.collection("Notifications").document(notificationId)
                            .update("notificationId", notificationId);
                    Log.d(TAG, "Tạo thông báo: " + notificationId);
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi tạo thông báo: " + e.getMessage()));
    }

    @Override
    protected void onNewIntent(Intent intent) {
        super.onNewIntent(intent);
        ZaloPaySDK.getInstance().onResult(intent);
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        executorService.shutdown();
    }
}

```

### Service\Booking\OwnerBookingDetailActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import com.google.firebase.Timestamp;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.Notification;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

public class OwnerBookingDetailActivity extends AppCompatActivity {

    private static final String TAG = "OwnerBookingDetailActivity";
    private FirebaseFirestore db;
    private String bookingId, vehicleId;
    private Booking booking;
    private Vehicle vehicle;
    private User customer;
    private ImageView vehicleImage, btnBack;
    private TextView tvId, tvName, tvEmail, tvPhoneNumber, tvStatus, tvBrandCar, tvPrice, tvAddress, tvPickup, tvDropoff, tvTotalCost;
    private Button btnConfirm, btnReject;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.owner_booking_detail);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }

        bookingId = getIntent().getStringExtra("bookingId");
        if (bookingId == null) {
            Toast.makeText(this, "Không tìm thấy yêu cầu", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        initViews();
        initFirebase();
        loadBookingData();

        btnBack.setOnClickListener(v -> finish());
        btnConfirm.setOnClickListener(v -> confirmBooking());
        btnReject.setOnClickListener(v -> rejectBooking());
    }

    private void initViews() {
        tvId = findViewById(R.id.txtview_noti_id);
        tvName = findViewById(R.id.txtview_noti_name);
        tvEmail = findViewById(R.id.txtview_noti_email);
        tvPhoneNumber = findViewById(R.id.txtview_noti_phoneNumber);
        tvStatus = findViewById(R.id.txtview_noti_status);
        tvBrandCar = findViewById(R.id.txtview_noti_BrandCar);
        tvPrice = findViewById(R.id.txtview_noti_price);
        tvAddress = findViewById(R.id.txt_checkout_address);
        tvPickup = findViewById(R.id.tv_noti_pickup);
        tvDropoff = findViewById(R.id.tv_noti_dropoff);
        tvTotalCost = findViewById(R.id.txtview_noti_totalCost);
        btnConfirm = findViewById(R.id.btn_noti_XacNhan);
        btnReject = findViewById(R.id.btn_noti_huy);
        btnBack = findViewById(R.id.btn_noti_back);
        vehicleImage = findViewById(R.id.img_noti_car);
    }

    private void initFirebase() {
        db = FirebaseFirestore.getInstance();
    }

    private void loadBookingData() {
        db.collection("Bookings").document(bookingId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        booking = document.toObject(Booking.class);
                        if (booking != null) {
                            vehicleId = booking.getVehicleId();
                            tvId.setText(bookingId);
                            updateStatusView();
                            loadVehicleData();
                            loadCustomerData();
                            updateTimeAndPrice();
                        } else {
                            Toast.makeText(this, "Không thể đọc dữ liệu yêu cầu", Toast.LENGTH_SHORT).show();
                            finish();
                        }
                    } else {
                        Toast.makeText(this, "Yêu cầu không tồn tại", Toast.LENGTH_SHORT).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    finish();
                });
    }

    private void updateStatusView() {
        String status = booking.getStatus();
        switch (status) {
            case "pending":
                tvStatus.setText("Chưa được xác nhận");
                break;
            case "confirmed":
                tvStatus.setText("Đã xác nhận");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "rejected":
                tvStatus.setText("Không được xác nhận");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "paid":
                tvStatus.setText("Đã thanh toán");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            case "completed":
                tvStatus.setText("Đã hoàn thành");
                btnConfirm.setEnabled(false);
                btnReject.setEnabled(false);
                break;
            default:
                tvStatus.setText(status);
        }
    }

    private void loadVehicleData() {
        db.collection("Vehicles").document(vehicleId)
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        vehicle = document.toObject(Vehicle.class);
                        if (vehicle != null) {
                            tvBrandCar.setText(vehicle.getVehicleName());
                            tvPrice.setText(vehicle.getVehiclePrice());
                            if (!vehicle.getVehicleImageUrl().isEmpty()) {
                                Picasso.get().load(vehicle.getVehicleImageUrl()).into(vehicleImage);
                            }
                        }
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu xe: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải xe: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void loadCustomerData() {
        db.collection("Users").document(booking.getCustomerId())
                .get()
                .addOnSuccessListener(document -> {
                    if (document.exists()) {
                        customer = document.toObject(User.class);
                        if (customer != null) {
                            tvName.setText(customer.getUsername());
                            tvEmail.setText(customer.getEmail());
                            tvPhoneNumber.setText(customer.getPhoneNumber());
                            tvAddress.setText(booking.getPickupLocation());
                        }
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu khách hàng: " + e.getMessage());
                    Toast.makeText(this, "Lỗi tải khách hàng: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void updateTimeAndPrice() {
        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault());
        tvPickup.setText(sdf.format(booking.getStartTime().toDate()));
        tvDropoff.setText(sdf.format(booking.getEndTime().toDate()));
        tvTotalCost.setText(String.format(Locale.getDefault(), "%,d VNĐ", booking.getTotalAmount()));
    }

    private void confirmBooking() {
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(booking.getEndTime().toDate());
        calendar.add(Calendar.DAY_OF_MONTH, 1);
        Timestamp maintenanceEndTime = new Timestamp(calendar.getTime());

        Map<String, Object> updates = new HashMap<>();
        updates.put("status", "confirmed");
        updates.put("updatedAt", Timestamp.now());
        updates.put("maintenanceEndTime", maintenanceEndTime);

        db.collection("Bookings").document(bookingId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    createNotification(booking.getCustomerId(), "Yêu cầu đặt xe #" + bookingId + " đã được xác nhận", "status_update");
                    Toast.makeText(this, "Đã xác nhận yêu cầu", Toast.LENGTH_SHORT).show();
                    createOrder();
                    finish();
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi xác nhận yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi xác nhận: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void rejectBooking() {
        Map<String, Object> updates = new HashMap<>();
        updates.put("status", "rejected");
        updates.put("updatedAt", Timestamp.now());

        db.collection("Bookings").document(bookingId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    createNotification(booking.getCustomerId(), "Yêu cầu đặt xe #" + bookingId + " đã bị từ chối", "status_update");
                    Toast.makeText(this, "Đã từ chối yêu cầu", Toast.LENGTH_SHORT).show();
                    finish();
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi từ chối yêu cầu: " + e.getMessage());
                    Toast.makeText(this, "Lỗi từ chối: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void createOrder() {
        Map<String, Object> orderData = new HashMap<>();
        orderData.put("customer_id", booking.getCustomerId());
        orderData.put("provider_id", vehicle.getOwnerId());
        orderData.put("vehicle_id", vehicleId);
        orderData.put("pickup_time", booking.getStartTime());
        orderData.put("dropoff_time", booking.getEndTime());
        orderData.put("total_amount", booking.getTotalAmount());
        orderData.put("status", "pending");
        orderData.put("payment_status", "pending");
        orderData.put("created_at", Timestamp.now());

        db.collection("Orders").add(orderData)
                .addOnSuccessListener(orderRef -> {
                    Map<String, Object> updateData = new HashMap<>();
                    updateData.put("orderId", orderRef.getId());
                    db.collection("Bookings").document(bookingId)
                            .update(updateData);
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi tạo order: " + e.getMessage()));
    }

    private void createNotification(String userId, String message, String type) {
        Notification notification = new Notification();
        notification.setUserId(userId);
        notification.setBookingId(bookingId);
        notification.setMessage(message);
        notification.setType(type);
        db.collection("Notifications").add(notification);
    }
}

```

### Service\Booking\RequestSuccessActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.R;

public class RequestSuccessActivity extends AppCompatActivity {
    private Button btn_home;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        setContentView(R.layout.activity_finished);

        init();
        btn_home.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(RequestSuccessActivity.this, CustomerMainActivity.class);
                startActivity(intent);
            }
        });


    }
    private void init()
    {
        btn_home = findViewById(R.id.btn_noti_Home);
    }
}

```

### Service\Booking\ScheduleSelect.java
```java
package com.uit.carrental.Service.Booking;

import android.app.TimePickerDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;
import com.google.android.material.datepicker.CalendarConstraints;
import com.google.android.material.datepicker.DateValidatorPointForward;
import com.google.android.material.datepicker.MaterialDatePicker;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.Booking;
import com.uit.carrental.Model.Notification;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.google.firebase.Timestamp;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;
import java.util.Locale;

public class ScheduleSelect extends AppCompatActivity {

    private static final String TAG = "ScheduleSelect";
    private TextView tvSelectStartDate, tvSelectEndDate, tvSelectStartTime, tvSelectEndTime, tvTotalDays, tvTotalPrice;
    private Button btnConfirm;
    private ImageView backButton;
    private ScheduleSelectViewModel viewModel;
    private String vehicleId;
    private Calendar startDateTime, endDateTime;
    private List<Long> bookedDates; // Danh sách epoch millis của các ngày đã đặt
    private FirebaseFirestore db;
    private Vehicle vehicle; // Đối tượng xe để lấy giá
    private long totalDays;
    private long totalAmount;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_schedule_select);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }

        vehicleId = getIntent().getStringExtra("vehicleId");
        if (vehicleId == null) {
            Toast.makeText(this, R.string.no_vehicle_id, Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        initViews();
        initViewModel();
        loadVehicleData();
        setupListeners();
    }

    private void initViews() {
        tvSelectStartDate = findViewById(R.id.tv_select_start_date);
        tvSelectEndDate = findViewById(R.id.tv_select_end_date);
        tvSelectStartTime = findViewById(R.id.tv_select_start_time);
        tvSelectEndTime = findViewById(R.id.tv_select_end_time);
        tvTotalDays = findViewById(R.id.tv_total_days);
        tvTotalPrice = findViewById(R.id.tv_total_price);
        btnConfirm = findViewById(R.id.btn_confirm);
        backButton = findViewById(R.id.back_button);
        db = FirebaseFirestore.getInstance();
        bookedDates = new ArrayList<>();
        startDateTime = null;
        endDateTime = null;
        totalDays = 0;
        totalAmount = 0;
    }

    private void initViewModel() {
        viewModel = new ViewModelProvider(this).get(ScheduleSelectViewModel.class);
    }

    private void loadVehicleData() {
        db.collection("Vehicles").document(vehicleId)
                .get()
                .addOnSuccessListener(documentSnapshot -> {
                    if (documentSnapshot.exists()) {
                        vehicle = documentSnapshot.toObject(Vehicle.class);
                        if (vehicle == null) {
                            Toast.makeText(this, R.string.vehicle_not_found, Toast.LENGTH_SHORT).show();
                            finish();
                        } else {
                            loadBookedDates();
                        }
                    } else {
                        Toast.makeText(this, R.string.vehicle_not_found, Toast.LENGTH_SHORT).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải dữ liệu xe: " + e.getMessage());
                    Toast.makeText(this, R.string.load_vehicle_error, Toast.LENGTH_SHORT).show();
                    finish();
                });
    }

    private void loadBookedDates() {
        db.collection("Bookings")
                .whereEqualTo("vehicleId", vehicleId)
                .whereIn("status", List.of("pending", "confirmed", "paid"))
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    bookedDates.clear();
                    for (DocumentSnapshot doc : querySnapshot.getDocuments()) {
                        Booking booking = doc.toObject(Booking.class);
                        if (booking != null && booking.getStartTime() != null && booking.getEndTime() != null) {
                            addBookedDates(booking.getStartTime(), booking.getEndTime());
                        }
                    }
                    Log.d(TAG, "Loaded " + bookedDates.size() + " booked dates");
                })
                .addOnFailureListener(e -> {
                    Log.e(TAG, "Lỗi tải lịch đặt xe: " + e.getMessage());
                    Toast.makeText(this, R.string.load_schedule_error, Toast.LENGTH_SHORT).show();
                });
    }

    private void addBookedDates(Timestamp startTime, Timestamp endTime) {
        Calendar startCal = Calendar.getInstance();
        startCal.setTime(startTime.toDate());
        startCal.set(Calendar.HOUR_OF_DAY, 0);
        startCal.set(Calendar.MINUTE, 0);
        startCal.set(Calendar.SECOND, 0);
        startCal.set(Calendar.MILLISECOND, 0);

        Calendar endCal = Calendar.getInstance();
        endCal.setTime(endTime.toDate());
        endCal.set(Calendar.HOUR_OF_DAY, 0);
        endCal.set(Calendar.MINUTE, 0);
        endCal.set(Calendar.SECOND, 0);
        endCal.set(Calendar.MILLISECOND, 0);

        while (!startCal.after(endCal)) {
            bookedDates.add(startCal.getTimeInMillis());
            startCal.add(Calendar.DAY_OF_MONTH, 1);
        }
    }

    private void setupListeners() {
        backButton.setOnClickListener(v -> finish());

        tvSelectStartDate.setOnClickListener(v -> showDatePicker(true));
        tvSelectEndDate.setOnClickListener(v -> showDatePicker(false));
        tvSelectStartTime.setOnClickListener(v -> showTimePicker(true));
        tvSelectEndTime.setOnClickListener(v -> showTimePicker(false));

        btnConfirm.setOnClickListener(v -> confirmBooking());
    }

    private void showDatePicker(boolean isStartDate) {
        CalendarConstraints.Builder constraintsBuilder = new CalendarConstraints.Builder()
                .setValidator(new CalendarConstraints.DateValidator() {
                    @Override
                    public boolean isValid(long date) {
                        Calendar today = Calendar.getInstance();
                        today.set(Calendar.HOUR_OF_DAY, 0);
                        today.set(Calendar.MINUTE, 0);
                        today.set(Calendar.SECOND, 0);
                        today.set(Calendar.MILLISECOND, 0);
                        return date >= today.getTimeInMillis() && !bookedDates.contains(date);
                    }

                    @Override
                    public int describeContents() { return 0; }

                    @Override
                    public void writeToParcel(android.os.Parcel dest, int flags) {}
                });

        MaterialDatePicker<Long> datePicker = MaterialDatePicker.Builder.datePicker()
                .setTitleText(isStartDate ? R.string.select_start_date : R.string.select_end_date)
                .setCalendarConstraints(constraintsBuilder.build())
                .build();

        datePicker.addOnPositiveButtonClickListener(selection -> {
            Calendar selectedCal = Calendar.getInstance();
            selectedCal.setTimeInMillis(selection);
            selectedCal.set(Calendar.HOUR_OF_DAY, 0);
            selectedCal.set(Calendar.MINUTE, 0);
            selectedCal.set(Calendar.SECOND, 0);
            selectedCal.set(Calendar.MILLISECOND, 0);

            SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy", Locale.getDefault());
            if (isStartDate) {
                startDateTime = startDateTime != null ? startDateTime : Calendar.getInstance();
                startDateTime.setTimeInMillis(selection);
                tvSelectStartDate.setText(sdf.format(new Date(selection)));
            } else {
                endDateTime = endDateTime != null ? endDateTime : Calendar.getInstance();
                endDateTime.setTimeInMillis(selection);
                tvSelectEndDate.setText(sdf.format(new Date(selection)));
            }
            updateTotalDaysAndPrice();
        });

        datePicker.show(getSupportFragmentManager(), isStartDate ? "START_DATE_PICKER" : "END_DATE_PICKER");
    }

    private void showTimePicker(boolean isStartTime) {
        Calendar calendar = Calendar.getInstance();
        TimePickerDialog timePicker = new TimePickerDialog(
                this,
                (view, hourOfDay, minute) -> {
                    if (isStartTime) {
                        startDateTime = startDateTime != null ? startDateTime : Calendar.getInstance();
                        startDateTime.set(Calendar.HOUR_OF_DAY, hourOfDay);
                        startDateTime.set(Calendar.MINUTE, minute);
                        tvSelectStartTime.setText(String.format(Locale.getDefault(), "%02d:%02d", hourOfDay, minute));
                    } else {
                        endDateTime = endDateTime != null ? endDateTime : Calendar.getInstance();
                        endDateTime.set(Calendar.HOUR_OF_DAY, hourOfDay);
                        endDateTime.set(Calendar.MINUTE, minute);
                        tvSelectEndTime.setText(String.format(Locale.getDefault(), "%02d:%02d", hourOfDay, minute));
                    }
                    updateTotalDaysAndPrice();
                },
                calendar.get(Calendar.HOUR_OF_DAY),
                calendar.get(Calendar.MINUTE),
                true
        );
        timePicker.show();
    }

    private void updateTotalDaysAndPrice() {
        if (startDateTime == null || endDateTime == null || vehicle == null) {
            tvTotalDays.setText(R.string.total_days);
            tvTotalPrice.setText(R.string.total_price);
            totalDays = 0;
            totalAmount = 0;
            return;
        }

        // Tính số giờ thuê
        long diffInMillis = endDateTime.getTimeInMillis() - startDateTime.getTimeInMillis();
        if (diffInMillis <= 0) {
            tvTotalDays.setText(R.string.total_days);
            tvTotalPrice.setText(R.string.total_price);
            totalDays = 0;
            totalAmount = 0;
            return;
        }

        // Làm tròn số ngày (1 ngày = 24 giờ)
        totalDays = (long) Math.ceil((double) diffInMillis / (1000 * 60 * 60 * 24));

        // Lấy giá xe từ vehiclePrice (giả định dạng "500.000 VNĐ/Ngày")
        long pricePerDay = parsePricePerDay(vehicle.getVehiclePrice());
        totalAmount = totalDays * pricePerDay;

        // Định dạng giá
        DecimalFormat formatter = new DecimalFormat("#,### VNĐ");
        tvTotalDays.setText(getString(R.string.total_days, totalDays));
        tvTotalPrice.setText(getString(R.string.total_price, formatter.format(totalAmount)));
    }

    private long parsePricePerDay(String priceString) {
        if (priceString == null || priceString.isEmpty()) {
            return 0;
        }
        try {
            // Loại bỏ " VNĐ/Ngày" và các dấu chấm
            String cleanPrice = priceString.replaceAll("[^0-9]", "");
            return Long.parseLong(cleanPrice);
        } catch (NumberFormatException e) {
            Log.e(TAG, "Lỗi phân tích giá: " + e.getMessage());
            return 0;
        }
    }

    private void confirmBooking() {
        if (startDateTime == null || endDateTime == null) {
            Toast.makeText(this, R.string.no_date_selected, Toast.LENGTH_SHORT).show();
            return;
        }
        if (endDateTime.before(startDateTime)) {
            Toast.makeText(this, R.string.invalid_date_range, Toast.LENGTH_SHORT).show();
            return;
        }
        if (tvSelectStartTime.getText().toString().equals(getString(R.string.select_start_time)) ||
                tvSelectEndTime.getText().toString().equals(getString(R.string.select_end_time))) {
            Toast.makeText(this, R.string.no_time_selected, Toast.LENGTH_SHORT).show();
            return;
        }
        if (totalDays <= 0 || totalAmount <= 0) {
            Toast.makeText(this, R.string.invalid_booking, Toast.LENGTH_SHORT).show();
            return;
        }

        viewModel.checkScheduleConflict(vehicleId, new Timestamp(startDateTime.getTime()), new Timestamp(endDateTime.getTime()))
                .observe(this, isAvailable -> {
                    if (isAvailable == null) {
                        Toast.makeText(this, R.string.booking_failed, Toast.LENGTH_SHORT).show();
                        return;
                    }
                    if (!isAvailable) {
                        Toast.makeText(this, R.string.time_overlap_error, Toast.LENGTH_SHORT).show();
                        return;
                    }

                    Booking booking = new Booking();
                    booking.setVehicleId(vehicleId);
                    booking.setCustomerId(FirebaseAuth.getInstance().getCurrentUser().getUid());
                    booking.setOwnerId(vehicle.getOwnerId());
                    booking.setStartTime(new Timestamp(startDateTime.getTime()));
                    booking.setEndTime(new Timestamp(endDateTime.getTime()));
                    booking.setStatus("pending");
                    booking.setCreatedAt(Timestamp.now());
                    booking.setUpdatedAt(Timestamp.now());
                    booking.setTotalAmount(totalAmount);
                    booking.setPickupLocation("Địa chỉ nhận xe"); // TODO: Lấy từ input
                    booking.setDropoffLocation("Địa chỉ trả xe"); // TODO: Lấy từ input

                    viewModel.createBooking(booking).observe(this, bookingId -> {
                        if (bookingId != null) {
                            Notification notification = new Notification();
                            notification.setUserId(vehicle.getOwnerId());
                            notification.setBookingId(bookingId);
                            notification.setMessage("Có booking mới: #" + bookingId);
                            notification.setType("new_booking");
                            db.collection("Notifications").add(notification);

                            Intent intent = new Intent(ScheduleSelect.this, RequestSuccessActivity.class);
                            intent.putExtra("bookingId", bookingId);
                            startActivity(intent);
                            Toast.makeText(this, R.string.booking_success, Toast.LENGTH_SHORT).show();
                            finish();
                        } else {
                            Toast.makeText(this, R.string.booking_failed, Toast.LENGTH_SHORT).show();
                        }
                    });
                });
    }
}

```

### Service\Booking\ScheduleSelectViewModel.java
```java
package com.uit.carrental.Service.Booking;

import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.Timestamp;
import com.uit.carrental.Model.Booking;

import java.util.Date;
import java.util.List;

public class ScheduleSelectViewModel extends ViewModel {

    private final FirebaseFirestore db;
    private final MutableLiveData<Boolean> scheduleAvailability;
    private final MutableLiveData<String> bookingResult;

    public ScheduleSelectViewModel() {
        db = FirebaseFirestore.getInstance();
        scheduleAvailability = new MutableLiveData<>();
        bookingResult = new MutableLiveData<>();
    }

    public LiveData<Boolean> checkScheduleConflict(String vehicleId, Timestamp startTime, Timestamp endTime) {
        db.collection("Bookings")
                .whereEqualTo("vehicleId", vehicleId)
                .whereIn("status", List.of("pending", "confirmed", "paid"))
                .get()
                .addOnSuccessListener(querySnapshot -> {
                    boolean isAvailable = true;
                    for (var doc : querySnapshot.getDocuments()) {
                        Booking existingBooking = doc.toObject(Booking.class);
                        if (existingBooking != null &&
                                existingBooking.getStartTime() != null &&
                                existingBooking.getEndTime() != null) {
                            Date existingStart = existingBooking.getStartTime().toDate();
                            Date existingEnd = existingBooking.getEndTime().toDate();
                            Date newStart = startTime.toDate();
                            Date newEnd = endTime.toDate();
                            if (!(newEnd.before(existingStart) || newStart.after(existingEnd))) {
                                isAvailable = false;
                                break;
                            }
                        }
                    }
                    scheduleAvailability.setValue(isAvailable);
                })
                .addOnFailureListener(e -> scheduleAvailability.setValue(null));
        return scheduleAvailability;
    }

    public LiveData<String> createBooking(Booking booking) {
        db.collection("Bookings")
                .add(booking)
                .addOnSuccessListener(documentReference -> {
                    String bookingId = documentReference.getId();
                    booking.setBookingId(bookingId);
                    documentReference.set(booking)
                            .addOnSuccessListener(aVoid -> bookingResult.setValue(bookingId))
                            .addOnFailureListener(e -> bookingResult.setValue(null));
                })
                .addOnFailureListener(e -> bookingResult.setValue(null));
        return bookingResult;
    }
}

```

### Service\UserAuthentication\CCCDActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.ProgressDialog;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.FrameLayout;
import android.widget.ImageView;
import android.widget.Toast;

import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import androidx.lifecycle.ViewModelProvider;

import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.Api.CloudinaryApi;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;

public class CCCDActivity extends AppCompatActivity {

    private static final String TAG = "CCCDActivity";
    private ImageView backButton, front, behind, license;
    private FrameLayout frontContainer, behindContainer, licenseContainer;
    private Button btnUpdate;
    private String uploadType;
    private Uri frontUri, behindUri, licenseUri;
    private CccdViewModel viewModel;
    private ProgressDialog progressDialog;

    ActivityResultLauncher<String> pickImagesFromGallery = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        switch (uploadType) {
                            case "IDCards/Front/":
                                frontUri = result;
                                front.setImageURI(result);
                                break;
                            case "IDCards/Behind/":
                                behindUri = result;
                                behind.setImageURI(result);
                                break;
                            case "Licenses/":
                                licenseUri = result;
                                license.setImageURI(result);
                                break;
                        }
                    }
                }
            });

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_cccd);

        initViews();
        initViewModel();
        observeLiveData();
        viewModel.loadUserData();
    }

    private void initViews() {
        backButton = findViewById(R.id.back_button);
        front = findViewById(R.id.img_front_CCCD);
        behind = findViewById(R.id.img_behind_CCCD);
        license = findViewById(R.id.img_license);
        frontContainer = findViewById(R.id.front_cccd_container);
        behindContainer = findViewById(R.id.behind_cccd_container);
        licenseContainer = findViewById(R.id.license_container);
        btnUpdate = findViewById(R.id.update_img);

        CloudinaryApi.init(this);

        backButton.setOnClickListener(v -> {
            Log.d(TAG, "Nút Back được nhấn");
            navigateBack();
        });

        frontContainer.setOnClickListener(v -> {
            uploadType = "IDCards/Front/";
            pickImagesFromGallery.launch("image/*");
        });

        behindContainer.setOnClickListener(v -> {
            uploadType = "IDCards/Behind/";
            pickImagesFromGallery.launch("image/*");
        });

        licenseContainer.setOnClickListener(v -> {
            uploadType = "Licenses/";
            pickImagesFromGallery.launch("image/*");
        });

        btnUpdate.setOnClickListener(v -> saveImages());
    }

    private void initViewModel() {
        ViewModelProvider.Factory factory = new ViewModelProvider.Factory() {
            @Override
            public <T extends ViewModel> T create(Class<T> modelClass) {
                if (modelClass.isAssignableFrom(CccdViewModel.class)) {
                    return (T) new CccdViewModel(CCCDActivity.this);
                }
                throw new IllegalArgumentException("Unknown ViewModel class");
            }
        };
        viewModel = new ViewModelProvider(this, factory).get(CccdViewModel.class);
    }

    private void observeLiveData() {
        viewModel.getUserLiveData().observe(this, user -> {
            if (user != null) {
                if (user.getCiCardFront() != null && !user.getCiCardFront().isEmpty()) {
                    Picasso.get().load(user.getCiCardFront()).into(front);
                }
                if (user.getCiCardBehind() != null && !user.getCiCardBehind().isEmpty()) {
                    Picasso.get().load(user.getCiCardBehind()).into(behind);
                }
                if (user.getLicenseUrl() != null && !user.getLicenseUrl().isEmpty()) {
                    Picasso.get().load(user.getLicenseUrl()).into(license);
                }
            }
        });

        viewModel.getErrorLiveData().observe(this, error -> {
            if (progressDialog != null && progressDialog.isShowing()) {
                progressDialog.dismiss();
            }
            if (error != null) {
                Toast.makeText(CCCDActivity.this, error, Toast.LENGTH_LONG).show();
            }
        });

        viewModel.getUpdateSuccessLiveData().observe(this, success -> {
            if (progressDialog != null && progressDialog.isShowing()) {
                progressDialog.dismiss();
            }
            if (success != null && success) {
                Toast.makeText(CCCDActivity.this, "Thông tin của bạn sẽ được duyệt trong vòng 30 phút.", Toast.LENGTH_LONG).show();
                navigateBack();
            }
        });
    }

    private void saveImages() {
        if (frontUri == null && behindUri == null && licenseUri == null) {
            Toast.makeText(this, "Vui lòng chọn ít nhất một ảnh", Toast.LENGTH_SHORT).show();
            return;
        }

        progressDialog = ProgressDialog.show(this, "Uploading Images", "Please wait...", true);
        viewModel.uploadImages(frontUri, behindUri, licenseUri);
    }

    private void navigateBack() {
        if (getIntent().getBooleanExtra("fromVehicleDetail", false)) {
            Intent intent = new Intent(this, CustomerMainActivity.class);
            intent.putExtra("fragment", "home");
            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
            startActivity(intent);
        } else {
            Intent intent = new Intent(this, ProfileManagement.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
            startActivity(intent);
        }
        finish();
        overridePendingTransition(0, 0);
    }

    @Override
    public void onBackPressed() {
        Log.d(TAG, "Nút Back vật lý được nhấn");
        navigateBack();
    }

    public static class CccdViewModel extends ViewModel {
        private final Context context;
        private final FirebaseFirestore db;
        private final FirebaseUser firebaseUser;
        private final MutableLiveData<User> userLiveData;
        private final MutableLiveData<String> errorLiveData;
        private final MutableLiveData<Boolean> updateSuccessLiveData;

        public CccdViewModel(Context context) {
            this.context = context;
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            userLiveData = new MutableLiveData<>();
            errorLiveData = new MutableLiveData<>();
            updateSuccessLiveData = new MutableLiveData<>();
        }

        public LiveData<User> getUserLiveData() {
            return userLiveData;
        }

        public LiveData<String> getErrorLiveData() {
            return errorLiveData;
        }

        public LiveData<Boolean> getUpdateSuccessLiveData() {
            return updateSuccessLiveData;
        }

        public void loadUserData() {
            if (firebaseUser == null) {
                errorLiveData.setValue("Người dùng chưa đăng nhập");
                return;
            }

            DocumentReference userRef = db.collection("Users").document(firebaseUser.getUid());
            userRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi tải thông tin: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    User user = document.toObject(User.class);
                    userLiveData.setValue(user);
                }
            });
        }

        public void uploadImages(Uri frontUri, Uri behindUri, Uri licenseUri) {
            int uploadCount = (frontUri != null ? 1 : 0) + (behindUri != null ? 1 : 0) + (licenseUri != null ? 1 : 0);
            if (uploadCount == 0) {
                errorLiveData.setValue("Không có ảnh nào được chọn");
                return;
            }

            AtomicInteger pendingUploads = new AtomicInteger(uploadCount);
            Map<String, Object> data = new HashMap<>();
            User user = userLiveData.getValue() != null ? userLiveData.getValue() : new User();
            user.setUserId(firebaseUser.getUid());

            if (frontUri != null) {
                CloudinaryApi.uploadImage(context, frontUri, new CloudinaryApi.UploadCallbackCustom() {
                    @Override
                    public void onSuccess(String url) {
                        user.setCiCardFront(url);
                        data.put("ciCardFront", url);
                        checkUploadComplete(pendingUploads, data, user);
                    }

                    @Override
                    public void onFailure(Exception e) {
                        errorLiveData.setValue("Lỗi tải CCCD mặt trước: " + e.getMessage());
                        checkUploadComplete(pendingUploads, data, user);
                    }
                });
            }

            if (behindUri != null) {
                CloudinaryApi.uploadImage(context, behindUri, new CloudinaryApi.UploadCallbackCustom() {
                    @Override
                    public void onSuccess(String url) {
                        user.setCiCardBehind(url);
                        data.put("ciCardBehind", url);
                        checkUploadComplete(pendingUploads, data, user);
                    }

                    @Override
                    public void onFailure(Exception e) {
                        errorLiveData.setValue("Lỗi tải CCCD mặt sau: " + e.getMessage());
                        checkUploadComplete(pendingUploads, data, user);
                    }
                });
            }

            if (licenseUri != null) {
                CloudinaryApi.uploadImage(context, licenseUri, new CloudinaryApi.UploadCallbackCustom() {
                    @Override
                    public void onSuccess(String url) {
                        user.setLicenseUrl(url);
                        data.put("licenseUrl", url);
                        checkUploadComplete(pendingUploads, data, user);
                    }

                    @Override
                    public void onFailure(Exception e) {
                        errorLiveData.setValue("Lỗi tải bằng lái xe: " + e.getMessage());
                        checkUploadComplete(pendingUploads, data, user);
                    }
                });
            }
        }

        private void checkUploadComplete(AtomicInteger pendingUploads, Map<String, Object> data, User user) {
            if (pendingUploads.decrementAndGet() == 0) {
                if (data.isEmpty()) {
                    errorLiveData.setValue("Không có ảnh nào được upload thành công");
                    return;
                }
                data.put("verificationStatus", "pending");
                db.collection("Users").document(user.getUserId())
                        .update(data)
                        .addOnSuccessListener(aVoid -> {
                            userLiveData.setValue(user);
                            updateSuccessLiveData.setValue(true);
                        })
                        .addOnFailureListener(e -> errorLiveData.setValue("Lỗi cập nhật thông tin: " + e.getMessage()));
            }
        }
    }
}
```

### Service\UserAuthentication\ForgotPasswordActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;

public class ForgotPasswordActivity extends AppCompatActivity {

    private EditText inputEmail;
    private Button btnContinue;
    private FirebaseAuth mAuth;
    private ProgressDialog progressDialog;
    private static final String TAG = "ForgotPasswordActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_forgot_password);

        initViews();

        Intent intent = getIntent();
        String emailFromIntent = intent.getStringExtra("email");
        if (emailFromIntent != null) {
            inputEmail.setText(emailFromIntent);
        }

        btnContinue.setOnClickListener(view -> sendResetPasswordEmail());
    }

    private void initViews() {
        inputEmail = findViewById(R.id.input_email);
        btnContinue = findViewById(R.id.btn_continue);
        mAuth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(this);
    }

    private void sendResetPasswordEmail() {
        String email = inputEmail.getText().toString().trim();

        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Vui lòng nhập email.");
            return;
        }

        progressDialog.setMessage("Đang gửi email khôi phục...");
        progressDialog.show();

        mAuth.sendPasswordResetEmail(email)
                .addOnCompleteListener(task -> {
                    progressDialog.dismiss();
                    if (task.isSuccessful()) {
                        Toast.makeText(this, "Đã gửi email xác nhận tới " + email, Toast.LENGTH_LONG).show();
                        finish();
                    } else {
                        Log.e(TAG, "sendPasswordResetEmail thất bại: " + task.getException());
                        Toast.makeText(this, "Không thể gửi email xác nhận.", Toast.LENGTH_SHORT).show();
                    }
                });
    }
}

```

### Service\UserAuthentication\GGVerrifyPhone.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;

import com.uit.carrental.R;

public class GGVerrifyPhone extends AppCompatActivity {

    private Button btnContinue;
    private EditText inputPhone;

    private void init()
    {
        btnContinue = findViewById(R.id.btn_continue);
        inputPhone = findViewById(R.id.input_phone_number);
    }
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_ggverrify_phone);

        init();

        btnContinue.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(GGVerrifyPhone.this, ValidatePhoneActivity.class);
                intent.putExtra("phone", inputPhone.getText().toString());
                startActivity(intent);
            }
        });
    }
}
```

### Service\UserAuthentication\LoginActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.LinearLayout;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.google.android.gms.auth.api.signin.GoogleSignIn;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInClient;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;
import com.google.android.gms.common.api.ApiException;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.AuthCredential;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.auth.GoogleAuthProvider;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.ActivityPages.AdminMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.UserClient;
import com.uit.carrental.R;

import java.util.HashMap;
import java.util.Map;

public class LoginActivity extends AppCompatActivity {

    private static final String TAG = "LoginActivity";
    private EditText inputEmail, inputPassword;
    private Button btnSignIn, btnSignUp;
    private TextView btnForgot;
    private LinearLayout btnGG, btnFacebook;
    private ProgressDialog progressDialog;
    private FirebaseAuth mAuth;
    private GoogleSignInClient mGoogleSignInClient;
    private static final int RC_SIGN_IN = 406;
    private static final String ADMIN_USERNAME = "quangdeptrai";
    private static final String ADMIN_PASSWORD = "21522516";

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_sign_in);

        initViews();
        configureGoogleSignIn();

        btnSignIn.setOnClickListener(view -> loginWithEmail());
        btnGG.setOnClickListener(view -> loginWithGoogle());
        btnSignUp.setOnClickListener(view -> {
            Intent intent = new Intent(LoginActivity.this, RegisterActivity.class);
            startActivity(intent);
        });
        btnForgot.setOnClickListener(view -> {
            Intent intent = new Intent(LoginActivity.this, ForgotPasswordActivity.class);
            startActivity(intent);
        });
        btnFacebook.setOnClickListener(view -> {
            Toast.makeText(this, "Đăng nhập với Facebook chưa được triển khai.", Toast.LENGTH_SHORT).show();
        });
    }

    private void initViews() {
        mAuth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(this);

        inputEmail = findViewById(R.id.email);
        inputPassword = findViewById(R.id.password);
        btnSignIn = findViewById(R.id.btnSignIn);
        btnSignUp = findViewById(R.id.btnSignUp);
        btnForgot = findViewById(R.id.btnForgot);
        btnGG = findViewById(R.id.btn_GGsignIn);
        btnFacebook = findViewById(R.id.btn_facebook_signIn);
    }

    private void configureGoogleSignIn() {
        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestIdToken(getString(R.string.default_web_client_id))
                .requestEmail()
                .build();
        mGoogleSignInClient = GoogleSignIn.getClient(this, gso);
    }

    private void loginWithEmail() {
        String email = inputEmail.getText().toString().trim().toLowerCase();
        String password = inputPassword.getText().toString().trim();

        if (!validateForm(email, password)) return;

        // Kiểm tra admin credentials
        if (email.equals(ADMIN_USERNAME) && password.equals(ADMIN_PASSWORD)) {
            Log.d(TAG, "Đăng nhập admin cứng: " + email);
            User adminUser = new User();
            adminUser.setUserId("admin_quangdeptrai");
            adminUser.setUsername(ADMIN_USERNAME);
            adminUser.setEmail("");
            adminUser.setCurrentRole("admin");
            Map<String, Boolean> roles = new HashMap<>();
            roles.put("admin", true);
            roles.put("customer", false);
            roles.put("owner", false);
            adminUser.setRoles(roles);

            ((UserClient) getApplicationContext()).setUser(adminUser);
            startActivity(new Intent(this, AdminMainActivity.class));
            finish();
            return;
        }

        // Đăng nhập Firebase thông thường
        progressDialog.setMessage("Đang đăng nhập...");
        progressDialog.show();

        mAuth.signInWithEmailAndPassword(email, password)
                .addOnCompleteListener(task -> {
                    progressDialog.dismiss();
                    if (task.isSuccessful()) {
                        Log.d(TAG, "Đăng nhập Firebase thành công: " + email);
                        fetchUserData();
                    } else {
                        Log.e(TAG, "Đăng nhập Firebase thất bại: " + task.getException().getMessage());
                        Toast.makeText(this, "Đăng nhập thất bại: " + task.getException().getMessage(), Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void loginWithGoogle() {
        Intent signInIntent = mGoogleSignInClient.getSignInIntent();
        startActivityForResult(signInIntent, RC_SIGN_IN);
    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == RC_SIGN_IN) {
            Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);
            try {
                GoogleSignInAccount account = task.getResult(ApiException.class);
                firebaseAuthWithGoogle(account);
            } catch (ApiException e) {
                Log.e(TAG, "Đăng nhập Google thất bại: " + e.getMessage());
                Toast.makeText(this, "Đăng nhập Google thất bại: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }
    }

    private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {
        AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);
        mAuth.signInWithCredential(credential)
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        Log.d(TAG, "Đăng nhập Google thành công: " + acct.getEmail());
                        fetchUserData();
                    } else {
                        Log.e(TAG, "Đăng nhập Google thất bại: " + task.getException().getMessage());
                        Toast.makeText(this, "Đăng nhập Google thất bại: " + task.getException().getMessage(), Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void fetchUserData() {
        FirebaseUser firebaseUser = mAuth.getCurrentUser();
        if (firebaseUser == null) {
            Log.e(TAG, "Không tìm thấy FirebaseUser");
            Toast.makeText(this, "Không tìm thấy người dùng", Toast.LENGTH_SHORT).show();
            return;
        }

        if (!firebaseUser.isEmailVerified() && !firebaseUser.getEmail().equals(ADMIN_USERNAME)) {
            Log.w(TAG, "Email chưa được xác thực: " + firebaseUser.getEmail());
            Toast.makeText(this, "Vui lòng xác nhận email trước khi đăng nhập.", Toast.LENGTH_LONG).show();
            mAuth.signOut();
            return;
        }

        String uid = firebaseUser.getUid();
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        DocumentReference userRef = db.collection("Users").document(uid);

        userRef.get().addOnCompleteListener(task -> {
            if (task.isSuccessful()) {
                DocumentSnapshot document = task.getResult();
                if (document.exists()) {
                    User user = document.toObject(User.class);
                    if (user != null) {
                        Log.d(TAG, "Tìm thấy tài liệu người dùng: " + user.getEmail() + ", vai trò: " + user.getCurrentRole());
                        ((UserClient) getApplicationContext()).setUser(user);
                        checkUserInfo(user);
                    } else {
                        Log.e(TAG, "Không thể ánh xạ tài liệu người dùng");
                        Toast.makeText(this, "Lỗi ánh xạ dữ liệu người dùng.", Toast.LENGTH_SHORT).show();
                        navigateToProfileManagement(true);
                    }
                } else {
                    Log.w(TAG, "Tài liệu người dùng không tồn tại: " + uid);
                    navigateToProfileManagement(true);
                }
            } else {
                Log.e(TAG, "Lấy tài liệu người dùng thất bại: " + task.getException().getMessage());
                Toast.makeText(this, "Không thể lấy thông tin người dùng: " + task.getException().getMessage(), Toast.LENGTH_SHORT).show();
                navigateToProfileManagement(true);
            }
        });
    }

    private void checkUserInfo(User user) {
        // Kiểm tra các trường bắt buộc
        if (user.getUsername() == null || user.getUsername().isEmpty() ||
                user.getPhoneNumber() == null || user.getPhoneNumber().isEmpty() ||
                user.getEmail() == null || user.getEmail().isEmpty() ||
                user.getAddress() == null || user.getAddress().isEmpty() ||
                user.getCity() == null || user.getCity().isEmpty() ||
                user.getDescription() == null || user.getDescription().isEmpty() ||
                user.getBirthday() == null || user.getBirthday().isEmpty()) {
            Log.d(TAG, "Thông tin người dùng chưa đầy đủ");
            navigateToProfileManagement(true);
        } else {
            Log.d(TAG, "Thông tin người dùng đầy đủ, chuyển đến giao diện chính");
            navigateToMain(user);
        }
    }

    private void navigateToMain(User user) {
        if (user.getCurrentRole() != null) {
            Log.d(TAG, "Chuyển hướng với vai trò: " + user.getCurrentRole());
            Intent intent;
            switch (user.getCurrentRole().toLowerCase()) {
                case "customer":
                    intent = new Intent(this, CustomerMainActivity.class);
                    break;
                case "owner":
                    intent = new Intent(this, OwnerMainActivity.class);
                    break;
                case "admin":
                    intent = new Intent(this, AdminMainActivity.class);
                    break;
                default:
                    Log.w(TAG, "Vai trò không xác định: " + user.getCurrentRole());
                    Toast.makeText(this, "Vai trò không xác định.", Toast.LENGTH_SHORT).show();
                    return;
            }
            startActivity(intent);
            finish();
        } else {
            Log.w(TAG, "Không tìm thấy vai trò hiện tại");
            Toast.makeText(this, "Không tìm thấy vai trò hiện tại.", Toast.LENGTH_SHORT).show();
            navigateToProfileManagement(true);
        }
    }

    private void navigateToProfileManagement(boolean isFirstLogin) {
        Intent intent = new Intent(this, ProfileManagement.class);
        intent.putExtra("is_first_login", isFirstLogin);
        startActivity(intent);
    }

    private boolean validateForm(String email, String password) {
        boolean valid = true;
        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Email bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(password)) {
            inputPassword.setError("Mật khẩu bắt buộc.");
            valid = false;
        }
        return valid;
    }
}

```

### Service\UserAuthentication\ProfileManagement.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.AlertDialog;
import android.app.DatePickerDialog;
import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.DatePicker;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import androidx.lifecycle.ViewModelProvider;

import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.SetOptions;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.AdminMainActivity;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.Api.CloudinaryApi;

import java.util.Calendar;
import java.util.HashMap;
import java.util.Map;

import de.hdodenhof.circleimageview.CircleImageView;

public class ProfileManagement extends AppCompatActivity {

    private CircleImageView imgAvatar;
    private ImageView backButton, editAvatar;
    private EditText etFullname, etEmail, etPhone, etAddress, etCity, etDescription;
    private Button btnUpdate, btnDateOfBirth;
    private TextView tvUpdateCccd, tvCurrentRole, tvVerificationStatus, tvStatus;
    private DatePickerDialog datePickerDialog;
    private ProfileViewModel viewModel;
    private Uri avatarUri;
    private ProgressDialog progressDialog;
    private boolean isFirstLogin;

    ActivityResultLauncher<String> pickImagesFromGallery = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        avatarUri = result;
                        imgAvatar.setImageURI(result);
                        uploadAvatar();
                    }
                }
            });

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_profile);

        isFirstLogin = getIntent().getBooleanExtra("is_first_login", false);

        initViews();
        initViewModel();
        observeLiveData();
        viewModel.loadUserData();

        backButton.setOnClickListener(v -> navigateBackBasedOnRole());

        btnUpdate.setOnClickListener(v -> updateInfo());

        imgAvatar.setOnClickListener(v -> pickImagesFromGallery.launch("image/*"));

        editAvatar.setOnClickListener(v -> pickImagesFromGallery.launch("image/*"));

        btnDateOfBirth.setOnClickListener(this::openDatePicker);

        tvUpdateCccd.setOnClickListener(v -> {
            Intent intent = new Intent(ProfileManagement.this, CCCDActivity.class);
            startActivity(intent);
            overridePendingTransition(0, 0);
        });

        CloudinaryApi.init(this);
    }

    private void initViews() {
        imgAvatar = findViewById(R.id.img_avatar_profile_input_fragment);
        backButton = findViewById(R.id.back_button);
        editAvatar = findViewById(R.id.edit_avatar);
        etFullname = findViewById(R.id.profile_input_fullname);
        etEmail = findViewById(R.id.profile_input_email);
        etPhone = findViewById(R.id.profile_input_phone);
        etAddress = findViewById(R.id.profile_input_address);
        etCity = findViewById(R.id.profile_input_city);
        etDescription = findViewById(R.id.profile_input_description);
        btnUpdate = findViewById(R.id.btn_update);
        btnDateOfBirth = findViewById(R.id.profile_input_dateofbirth);
        tvUpdateCccd = findViewById(R.id.update_cccd);
        tvCurrentRole = findViewById(R.id.tv_current_role);
        tvVerificationStatus = findViewById(R.id.tv_verification_status);
        tvStatus = findViewById(R.id.tv_status);

        etEmail.setEnabled(false);
        etPhone.setEnabled(false);

        initDatePicker();
        btnDateOfBirth.setText(getTodaysDate());
    }

    private void initViewModel() {
        viewModel = new ViewModelProvider(this).get(ProfileViewModel.class);
    }

    private void observeLiveData() {
        viewModel.getUserLiveData().observe(this, user -> {
            if (user != null) {
                etFullname.setText(user.getUsername());
                etEmail.setText(user.getEmail());
                etPhone.setText(user.getPhoneNumber());
                etAddress.setText(user.getAddress());
                etCity.setText(user.getCity());
                etDescription.setText(user.getDescription());
                btnDateOfBirth.setText(user.getBirthday() != null && !user.getBirthday().isEmpty() ? user.getBirthday() : getTodaysDate());
                tvCurrentRole.setText(getRoleDisplayText(user.getCurrentRole()));
                tvVerificationStatus.setText(getVerificationDisplayText(user.getVerificationStatus()));
                tvStatus.setText(getStatusDisplayText(user.getStatus()));

                if (user.getAvatarUrl() != null && !user.getAvatarUrl().isEmpty()) {
                    Picasso.get().load(user.getAvatarUrl()).placeholder(R.drawable.ic_person).into(imgAvatar);
                } else {
                    imgAvatar.setImageResource(R.drawable.ic_person);
                }
            }
        });

        viewModel.getErrorLiveData().observe(this, error -> {
            if (error != null) {
                if (progressDialog != null && progressDialog.isShowing()) {
                    progressDialog.dismiss();
                }
                Toast.makeText(this, error, Toast.LENGTH_LONG).show();
            }
        });

        viewModel.getUpdateSuccessLiveData().observe(this, success -> {
            if (progressDialog != null && progressDialog.isShowing()) {
                progressDialog.dismiss();
            }
            if (success != null && success) {
                navigateAfterUpdate();
            }
        });
    }

    private void navigateAfterUpdate() {
        User user = viewModel.getUserLiveData().getValue();
        Intent intent;
        if (user == null || user.getCurrentRole() == null) {
            // Nếu user hoặc currentRole null, lấy từ Firestore lần nữa
            FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            if (firebaseUser != null) {
                FirebaseFirestore.getInstance().collection("Users").document(firebaseUser.getUid())
                        .get()
                        .addOnSuccessListener(documentSnapshot -> {
                            if (documentSnapshot.exists()) {
                                User fetchedUser = documentSnapshot.toObject(User.class);
                                if (fetchedUser != null && fetchedUser.getCurrentRole() != null) {
                                    navigateToMain(fetchedUser);
                                } else {
                                    navigateToDefault();
                                }
                            } else {
                                navigateToDefault();
                            }
                        })
                        .addOnFailureListener(e -> {
                            Toast.makeText(this, "Lỗi lấy thông tin người dùng: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                            navigateToDefault();
                        });
            } else {
                navigateToDefault();
            }
            return;
        }

        navigateToMain(user);
    }

    private void navigateToMain(User user) {
        Intent intent;
        switch (user.getCurrentRole().toLowerCase()) {
            case "customer":
                intent = new Intent(this, CustomerMainActivity.class);
                if (!isFirstLogin) {
                    intent.putExtra("navigate_to_fragment", "CustomerSettingFragment");
                }
                break;
            case "owner":
                intent = new Intent(this, OwnerMainActivity.class);
                if (!isFirstLogin) {
                    intent.putExtra("navigate_to_fragment", "OwnerSettingFragment");
                }
                break;
            case "admin":
                intent = new Intent(this, AdminMainActivity.class);
                if (!isFirstLogin) {
                    intent.putExtra("navigate_to_fragment", "AdminSettingFragment");
                }
                break;
            default:
                Toast.makeText(this, "Vai trò không xác định", Toast.LENGTH_SHORT).show();
                intent = new Intent(this, LoginActivity.class); // Fallback
                break;
        }
        startActivity(intent);
        overridePendingTransition(0, 0);
        finish();
    }

    private void navigateToDefault() {
        // Fallback điều hướng khi không lấy được thông tin người dùng
        Intent intent = new Intent(this, LoginActivity.class);
        startActivity(intent);
        overridePendingTransition(0, 0);
        finish();
    }

    private void navigateBackBasedOnRole() {
        if (isFirstLogin) {
            Toast.makeText(this, "Vui lòng cập nhật thông tin trước khi tiếp tục.", Toast.LENGTH_SHORT).show();
            return;
        }
        navigateAfterUpdate();
    }

    private String getTodaysDate() {
        Calendar cal = Calendar.getInstance();
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH) + 1;
        int day = cal.get(Calendar.DAY_OF_MONTH);
        return makeDateString(day, month, year);
    }

    private String makeDateString(int day, int month, int year) {
        return String.format("%02d/%02d/%d", day, month, year);
    }

    private void openDatePicker(View view) {
        datePickerDialog.show();
    }

    private void initDatePicker() {
        DatePickerDialog.OnDateSetListener dateSetListener = (datePicker, year, month, day) -> {
            month = month + 1;
            String date = makeDateString(day, month, year);
            btnDateOfBirth.setText(date);
        };

        Calendar cal = Calendar.getInstance();
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH);
        int day = cal.get(Calendar.DAY_OF_MONTH);

        int style = AlertDialog.THEME_HOLO_LIGHT;
        datePickerDialog = new DatePickerDialog(this, style, dateSetListener, year, month, day);
    }

    private void uploadAvatar() {
        if (avatarUri != null) {
            progressDialog = new ProgressDialog(this);
            progressDialog.setTitle("Đang tải ảnh...");
            progressDialog.setCancelable(false);
            progressDialog.show();

            CloudinaryApi.uploadImage(this, avatarUri, new CloudinaryApi.UploadCallbackCustom() {
                @Override
                public void onSuccess(String url) {
                    viewModel.setAvatarUrl(url);
                    progressDialog.dismiss();
                    Toast.makeText(ProfileManagement.this, "Tải ảnh đại diện thành công", Toast.LENGTH_SHORT).show();
                }

                @Override
                public void onFailure(Exception e) {
                    progressDialog.dismiss();
                    Toast.makeText(ProfileManagement.this, "Tải ảnh thất bại: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                }
            });
        }
    }

    private void updateInfo() {
        String username = etFullname.getText().toString().trim();
        String address = etAddress.getText().toString().trim();
        String city = etCity.getText().toString().trim();
        String description = etDescription.getText().toString().trim();
        String birthday = btnDateOfBirth.getText().toString().trim();

        if (username.isEmpty()) {
            etFullname.setError("Vui lòng nhập họ và tên");
            etFullname.requestFocus();
            return;
        }
        if (address.isEmpty()) {
            etAddress.setError("Vui lòng nhập địa chỉ");
            etAddress.requestFocus();
            return;
        }
        if (city.isEmpty()) {
            etCity.setError("Vui lòng nhập thành phố");
            etCity.requestFocus();
            return;
        }
        if (description.isEmpty()) {
            etDescription.setError("Vui lòng nhập mô tả");
            etDescription.requestFocus();
            return;
        }
        if (birthday.isEmpty()) {
            btnDateOfBirth.setError("Vui lòng chọn ngày sinh");
            return;
        }

        progressDialog = new ProgressDialog(this);
        progressDialog.setTitle("Đang cập nhật thông tin...");
        progressDialog.setCancelable(false);
        progressDialog.show();

        User user = new User();
        user.setUserId(FirebaseAuth.getInstance().getCurrentUser().getUid());
        user.setUsername(username);
        user.setAddress(address);
        user.setCity(city);
        user.setDescription(description);
        user.setBirthday(birthday);
        user.setEmail(etEmail.getText().toString());
        user.setPhoneNumber(etPhone.getText().toString());
        // Lấy currentRole và roles từ user hiện tại
        User currentUser = viewModel.getUserLiveData().getValue();
        if (currentUser != null) {
            user.setCurrentRole(currentUser.getCurrentRole());
            user.setRoles(currentUser.getRoles());
        }

        viewModel.updateUser(user);
    }

    private String getRoleDisplayText(String role) {
        switch (role) {
            case "customer":
                return "Khách hàng";
            case "owner":
                return "Chủ xe";
            case "admin":
                return "Quản trị viên";
            default:
                return role;
        }
    }

    private String getVerificationDisplayText(String verificationStatus) {
        if (verificationStatus == null) return "Chưa xác minh";
        switch (verificationStatus) {
            case "verified":
                return "Đã xác minh";
            case "pending":
                return "Đang chờ xác minh";
            default:
                return "Chưa xác minh";
        }
    }

    private String getStatusDisplayText(String status) {
        if (status == null) return "Hoạt động";
        switch (status) {
            case "active":
                return "Hoạt động";
            case "inactive":
                return "Không hoạt động";
            default:
                return status;
        }
    }

    public static class ProfileViewModel extends ViewModel {
        private final FirebaseFirestore db;
        private final FirebaseUser firebaseUser;
        private final MutableLiveData<User> userLiveData;
        private final MutableLiveData<String> errorLiveData;
        private final MutableLiveData<Boolean> updateSuccessLiveData;
        private String avatarUrl;

        public ProfileViewModel() {
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            userLiveData = new MutableLiveData<>();
            errorLiveData = new MutableLiveData<>();
            updateSuccessLiveData = new MutableLiveData<>();
        }

        public LiveData<User> getUserLiveData() {
            return userLiveData;
        }

        public LiveData<String> getErrorLiveData() {
            return errorLiveData;
        }

        public LiveData<Boolean> getUpdateSuccessLiveData() {
            return updateSuccessLiveData;
        }

        public void setAvatarUrl(String url) {
            this.avatarUrl = url;
        }

        public void loadUserData() {
            if (firebaseUser == null) {
                errorLiveData.setValue("Người dùng chưa đăng nhập");
                return;
            }

            DocumentReference userRef = db.collection("Users").document(firebaseUser.getUid());
            userRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi tải thông tin: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    User user = document.toObject(User.class);
                    if (avatarUrl != null) {
                        user.setAvatarUrl(avatarUrl);
                    }
                    userLiveData.setValue(user);
                } else {
                    User newUser = new User();
                    newUser.setUserId(firebaseUser.getUid());
                    newUser.setEmail(firebaseUser.getEmail() != null ? firebaseUser.getEmail() : "");
                    newUser.setCurrentRole("customer"); // Mặc định vai trò customer
                    Map<String, Boolean> roles = new HashMap<>();
                    roles.put("customer", true);
                    roles.put("owner", true);
                    roles.put("admin", false);
                    newUser.setRoles(roles);
                    userRef.set(newUser)
                            .addOnSuccessListener(aVoid -> userLiveData.setValue(newUser))
                            .addOnFailureListener(e -> errorLiveData.setValue("Lỗi tạo người dùng mới: " + e.getMessage()));
                }
            });
        }

        public void updateUser(User user) {
            if (avatarUrl != null) {
                user.setAvatarUrl(avatarUrl);
            }

            Map<String, Object> data = new HashMap<>();
            data.put("username", user.getUsername());
            data.put("email", user.getEmail());
            data.put("phoneNumber", user.getPhoneNumber());
            data.put("address", user.getAddress());
            data.put("city", user.getCity());
            data.put("description", user.getDescription());
            data.put("birthday", user.getBirthday());
            if (user.getAvatarUrl() != null && !user.getAvatarUrl().isEmpty()) {
                data.put("avatarUrl", user.getAvatarUrl());
            }
            if (user.getCurrentRole() != null) {
                data.put("currentRole", user.getCurrentRole());
            }
            if (user.getRoles() != null) {
                data.put("roles", user.getRoles());
            }

            db.collection("Users").document(user.getUserId())
                    .set(data, SetOptions.merge())
                    .addOnSuccessListener(aVoid -> {
                        userLiveData.setValue(user); // Cập nhật LiveData để phản ánh thay đổi
                        updateSuccessLiveData.setValue(true);
                    })
                    .addOnFailureListener(e -> errorLiveData.setValue("Lỗi cập nhật thông tin: " + e.getMessage()));
        }
    }
}

```

### Service\UserAuthentication\RegisterActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.LinearLayout;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.google.android.gms.auth.api.signin.GoogleSignIn;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInClient;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;
import com.google.android.gms.common.api.ApiException;
import com.google.android.gms.tasks.Task;
import com.google.android.material.snackbar.Snackbar;
import com.google.firebase.FirebaseApp;
import com.google.firebase.auth.AuthCredential;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseAuthException;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.auth.GoogleAuthProvider;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;

import java.util.HashMap;
import java.util.Map;

public class RegisterActivity extends AppCompatActivity {

    private static final String TAG = "RegisterActivity";
    private static final int RC_SIGN_IN = 406;
    private static final String ADMIN_EMAIL = "21522516@gm.uit.edu.vn";

    private EditText inputUsername, inputPhone, inputEmail, inputPass, inputConfirmPass;
    private Button btnSignUp;
    private ImageButton btnBack; // Thêm biến cho nút Back
    private LinearLayout btnFacebook, btnGoogle;
    private FirebaseAuth mAuth;
    private FirebaseFirestore dbUser;
    private GoogleSignInClient mGoogleSignInClient;
    private ProgressDialog progressDialog;
    private String username, phone, email, password, confirmPassword;
    private boolean isValid = true;
    private User user;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_register);

        FirebaseApp.initializeApp(this);
        initViews();

        mAuth = FirebaseAuth.getInstance();
        dbUser = FirebaseFirestore.getInstance();
        progressDialog = new ProgressDialog(this);
        configureGoogleSignIn();

        btnBack.setOnClickListener(v -> finish()); // Xử lý sự kiện nhấn nút Back
        btnSignUp.setOnClickListener(view -> {
            checkPassword();
            if (isValid) {
                createAccount();
            }
        });

        btnFacebook.setOnClickListener(view -> {
            Toast.makeText(this, "Đăng nhập với Facebook chưa được triển khai.", Toast.LENGTH_SHORT).show();
        });

        btnGoogle.setOnClickListener(view -> loginWithGoogle());
    }

    private void initViews() {
        inputUsername = findViewById(R.id.username_input);
        inputPhone = findViewById(R.id.phone_input);
        inputEmail = findViewById(R.id.email_input);
        inputPass = findViewById(R.id.password_input);
        inputConfirmPass = findViewById(R.id.confirm_password_input);
        btnSignUp = findViewById(R.id.btn_signUp2);
        btnBack = findViewById(R.id.btn_back); // Ánh xạ nút Back
        btnFacebook = findViewById(R.id.facebook_button);
        btnGoogle = findViewById(R.id.google_button);
    }

    private void configureGoogleSignIn() {
        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestIdToken(getString(R.string.default_web_client_id))
                .requestEmail()
                .build();
        mGoogleSignInClient = GoogleSignIn.getClient(this, gso);
    }

    private void checkPassword() {
        password = inputPass.getText().toString().trim();
        confirmPassword = inputConfirmPass.getText().toString().trim();
        if (TextUtils.isEmpty(password)) {
            inputPass.setError("Vui lòng nhập mật khẩu");
            inputPass.requestFocus();
            isValid = false;
        } else if (!password.equals(confirmPassword)) {
            inputConfirmPass.setError("Mật khẩu không khớp");
            inputConfirmPass.requestFocus();
            isValid = false;
        } else if (password.length() < 6) {
            inputPass.setError("Mật khẩu phải có ít nhất 6 ký tự");
            inputPass.requestFocus();
            isValid = false;
        } else {
            isValid = true;
        }
    }

    private void createAccount() {
        username = inputUsername.getText().toString().trim();
        phone = inputPhone.getText().toString().trim();
        email = inputEmail.getText().toString().trim().toLowerCase();
        password = inputPass.getText().toString().trim();

        if (!validateForm()) return;

        progressDialog.setMessage("Đang tạo tài khoản...");
        progressDialog.show();

        mAuth.createUserWithEmailAndPassword(email, password)
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        sendVerificationEmail();
                    } else {
                        progressDialog.dismiss();
                        String errorMessage = "Không thể tạo tài khoản.";
                        if (task.getException() instanceof FirebaseAuthException) {
                            FirebaseAuthException e = (FirebaseAuthException) task.getException();
                            switch (e.getErrorCode()) {
                                case "ERROR_EMAIL_ALREADY_IN_USE":
                                    errorMessage = "Email đã được sử dụng.";
                                    inputEmail.setError(errorMessage);
                                    inputEmail.requestFocus();
                                    break;
                                case "ERROR_INVALID_EMAIL":
                                    errorMessage = "Email không hợp lệ.";
                                    inputEmail.setError(errorMessage);
                                    inputEmail.requestFocus();
                                    break;
                                case "ERROR_WEAK_PASSWORD":
                                    errorMessage = "Mật khẩu quá yếu.";
                                    break;
                                default:
                                    errorMessage = e.getMessage();
                            }
                        }
                        Toast.makeText(RegisterActivity.this, errorMessage, Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void sendVerificationEmail() {
        FirebaseUser firebaseUser = mAuth.getCurrentUser();
        if (firebaseUser != null) {
            firebaseUser.sendEmailVerification()
                    .addOnCompleteListener(task -> {
                        if (task.isSuccessful()) {
                            Toast.makeText(this, "Đã gửi email xác nhận đến " + email, Toast.LENGTH_LONG).show();
                            createUserDocument();
                        } else {
                            progressDialog.dismiss();
                            Toast.makeText(this, "Gửi email xác nhận thất bại: " + task.getException().getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    });
        }
    }

    private void createUserDocument() {
        user = new User();
        user.setUserId(mAuth.getCurrentUser().getUid());
        user.setUsername(username);
        user.setEmail(email);
        user.setPhoneNumber(phone);

        Map<String, Boolean> roleMap = new HashMap<>();
        roleMap.put("customer", true);
        roleMap.put("owner", true);
        roleMap.put("admin", email.equalsIgnoreCase(ADMIN_EMAIL));
        user.setRoles(roleMap);
        user.setCurrentRole(email.equalsIgnoreCase(ADMIN_EMAIL) ? "admin" : "customer");

        DocumentReference newUserRef = dbUser.collection("Users").document(user.getUserId());

        newUserRef.set(user).addOnCompleteListener(task -> {
            progressDialog.dismiss();
            if (task.isSuccessful()) {
                Toast.makeText(this, "Đăng ký thành công. Vui lòng đăng nhập.", Toast.LENGTH_LONG).show();
                Intent intent = new Intent(RegisterActivity.this, LoginActivity.class);
                startActivity(intent);
                finish();
            } else {
                View parentLayout = findViewById(android.R.id.content);
                Snackbar.make(parentLayout, "Tạo tài liệu người dùng thất bại: " + task.getException().getMessage(), Snackbar.LENGTH_LONG).show();
            }
        });
    }

    private boolean validateForm() {
        boolean valid = true;
        if (TextUtils.isEmpty(username)) {
            inputUsername.setError("Tên đăng nhập bắt buộc.");
            inputUsername.requestFocus();
            valid = false;
        }
        if (TextUtils.isEmpty(phone)) {
            inputPhone.setError("Số điện thoại bắt buộc.");
            inputPhone.requestFocus();
            valid = false;
        } else if (!phone.matches("^(0|\\+84)(\\s|\\.)?((3[2-9])|(5[689])|(7[06-9])|(8[1-689])|(9[0-46-9]))(\\d)(\\s|\\.)?(\\d{3})(\\s|\\.)?(\\d{3})$")) {
            inputPhone.setError("Số điện thoại không hợp lệ.");
            inputPhone.requestFocus();
            valid = false;
        }
        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Email bắt buộc.");
            inputEmail.requestFocus();
            valid = false;
        } else if (!email.matches("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")) {
            inputEmail.setError("Email không hợp lệ.");
            inputEmail.requestFocus();
            valid = false;
        }
        if (TextUtils.isEmpty(password)) {
            inputPass.setError("Mật khẩu bắt buộc.");
            inputPass.requestFocus();
            valid = false;
        }
        return valid;
    }

    private void loginWithGoogle() {
        Intent signInIntent = mGoogleSignInClient.getSignInIntent();
        startActivityForResult(signInIntent, RC_SIGN_IN);
    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == RC_SIGN_IN) {
            Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);
            try {
                GoogleSignInAccount account = task.getResult(ApiException.class);
                firebaseAuthWithGoogle(account);
            } catch (ApiException e) {
                Toast.makeText(this, "Đăng nhập Google thất bại: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }
    }

    private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {
        AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);
        mAuth.signInWithCredential(credential)
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        username = acct.getDisplayName() != null ? acct.getDisplayName() : "";
                        email = acct.getEmail();
                        phone = "";
                        createUserDocument();
                    } else {
                        Toast.makeText(this, "Đăng nhập Google thất bại: " + task.getException().getMessage(), Toast.LENGTH_SHORT).show();
                    }
                });
    }
}

```

### Service\UserAuthentication\UpdatePassword.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.AuthCredential;
import com.google.firebase.auth.EmailAuthProvider;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;

public class UpdatePassword extends AppCompatActivity {

    private FirebaseUser user;
    private EditText currentPass, newPass, confirmPass;
    private String current, newPassword, confirmNew;
    private Button btnContinue;
    private Boolean isValid = true;

    private void init()
    {
        currentPass = findViewById(R.id.input_password);
        newPass = findViewById(R.id.input_new_password);
        confirmPass = findViewById(R.id.reinput_new_password);
        btnContinue = findViewById(R.id.btn_continue);

        user = FirebaseAuth.getInstance().getCurrentUser();
    }

    private void getPass()
    {
        current = currentPass.getText().toString();
        newPassword = newPass.getText().toString();
        confirmNew = confirmPass.getText().toString();
        checkPassword();
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_update_password);

        init();

        btnContinue.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                getPass();

                AuthCredential credential = EmailAuthProvider.getCredential(user.getEmail(), current);

                if(isValid)
                {
                    user.reauthenticate(credential)
                        .addOnCompleteListener(new OnCompleteListener<Void>() {
                            @Override
                            public void onComplete(@NonNull Task<Void> task) {
                                if (task.isSuccessful()) {
                                    // Mật khẩu hiện tại đã được xác thực thành công
                                    user.updatePassword(newPassword)
                                            .addOnCompleteListener(new OnCompleteListener<Void>() {
                                                @Override
                                                public void onComplete(@NonNull Task<Void> task) {
                                                    if (task.isSuccessful()) {
                                                        Toast.makeText(UpdatePassword.this, "Thay đổi mật khẩu thành công",Toast.LENGTH_LONG).show();
                                                        finish();
                                                    } else {
                                                        Toast.makeText(UpdatePassword.this, "Đã xảy ra lỗi trong quá trình thay đổi mật khẩu",Toast.LENGTH_LONG).show();
                                                    }
                                                }
                                            });
                                } else {
                                    Toast.makeText(UpdatePassword.this, "Mật khẩu hiện tại không chính xác",Toast.LENGTH_LONG).show();
                                }
                            }
                        });
                }
            }
        });
    }

    private void checkPassword() {

        if (!newPassword.equals(confirmNew))
        {
            Toast.makeText(this,"Mật khẩu không khớp, mời nhập lại",Toast.LENGTH_LONG).show();
            newPass.setText("");
            confirmPass.setText("");
            isValid = false;
        }
        else if(newPassword.isEmpty())
        {
            Toast.makeText(this,"Vui lòng nhập mật khẩu",Toast.LENGTH_LONG).show();
            newPass.setText("");
            confirmPass.setText("");
            isValid = false;
        }
    }
}
```

### Service\UserAuthentication\UserProfile.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import androidx.lifecycle.ViewModelProvider;

import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;

import de.hdodenhof.circleimageview.CircleImageView;

public class UserProfile extends AppCompatActivity {

    private static final String MOCK_AVATAR = "https://media4.giphy.com/media/v1.Y2lkPTZjMDliOTUyd2owNnAxcXR5YmJhMmh3ZDlvY3hoOXFhaWN2aXY3cm1tMXkwMnBlNyZlcD12MV9naWZzX3NlYXJjaCZjdD1n/FY8c5SKwiNf1EtZKGs/giphy_s.gif";

    private Button btnUpdate;
    private ImageView backButton, imgFrontCCCD, imgBehindCCCD, imgLicense;
    private CircleImageView imgAvatar;
    private TextView tvName, tvEmail, tvPhone, tvAddress, tvCity, tvBirthday;
    private ProfileViewModel viewModel;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_profile_management);

        initViews();
        initViewModel();
        observeLiveData();

        backButton.setOnClickListener(v -> {
            finish();
            overridePendingTransition(0, 0);
        });

        btnUpdate.setOnClickListener(v -> {
            Intent intent = new Intent(UserProfile.this, ProfileManagement.class);
            startActivity(intent);
            overridePendingTransition(0, 0);
        });
    }

    private void initViews() {
        btnUpdate = findViewById(R.id.btn_update);
        backButton = findViewById(R.id.back_button);
        imgAvatar = findViewById(R.id.img_avatar);
        imgFrontCCCD = findViewById(R.id.img_front_CCCD);
        imgBehindCCCD = findViewById(R.id.img_behind_CCCD);
        imgLicense = findViewById(R.id.img_license);
        tvName = findViewById(R.id.fullname);
        tvEmail = findViewById(R.id.email);
        tvPhone = findViewById(R.id.phone);
        tvAddress = findViewById(R.id.address);
        tvCity = findViewById(R.id.city);
        tvBirthday = findViewById(R.id.birthday);
    }

    private void initViewModel() {
        viewModel = new ViewModelProvider(this).get(ProfileViewModel.class);
        viewModel.loadUserData();
    }

    private void observeLiveData() {
        viewModel.getUserLiveData().observe(this, user -> {
            if (user != null) {
                tvName.setText(user.getUsername());
                tvEmail.setText(user.getEmail());
                tvPhone.setText(user.getPhoneNumber());
                tvAddress.setText(user.getAddress());
                tvCity.setText(user.getCity());
                tvBirthday.setText(user.getBirthday());

                if (user.getAvatarUrl() != null && !user.getAvatarUrl().isEmpty()) {
                    Picasso.get().load(user.getAvatarUrl()).into(imgAvatar);
                } else {
                    Picasso.get().load(MOCK_AVATAR).into(imgAvatar);
                }

                if (user.getCiCardFront() != null && !user.getCiCardFront().isEmpty()) {
                    Picasso.get().load(user.getCiCardFront()).into(imgFrontCCCD);
                } else {
                    imgFrontCCCD.setImageDrawable(null); // Không hiển thị ảnh nếu không có dữ liệu
                }

                if (user.getCiCardBehind() != null && !user.getCiCardBehind().isEmpty()) {
                    Picasso.get().load(user.getCiCardBehind()).into(imgBehindCCCD);
                } else {
                    imgBehindCCCD.setImageDrawable(null); // Không hiển thị ảnh nếu không có dữ liệu
                }

                if (user.getLicenseUrl() != null && !user.getLicenseUrl().isEmpty()) {
                    Picasso.get().load(user.getLicenseUrl()).into(imgLicense);
                } else {
                    imgLicense.setImageDrawable(null); // Không hiển thị ảnh nếu không có dữ liệu
                }
            }
        });

        viewModel.getErrorLiveData().observe(this, error -> {
            if (error != null) {
                Toast.makeText(UserProfile.this, error, Toast.LENGTH_LONG).show();
                Picasso.get().load(MOCK_AVATAR).into(imgAvatar);
                imgFrontCCCD.setImageDrawable(null);
                imgBehindCCCD.setImageDrawable(null);
                imgLicense.setImageDrawable(null);
            }
        });
    }

    public static class ProfileViewModel extends ViewModel {
        private final FirebaseFirestore db;
        private final FirebaseUser firebaseUser;
        private final MutableLiveData<User> userLiveData;
        private final MutableLiveData<String> errorLiveData;

        public ProfileViewModel() {
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            userLiveData = new MutableLiveData<>();
            errorLiveData = new MutableLiveData<>();
        }

        public LiveData<User> getUserLiveData() {
            return userLiveData;
        }

        public LiveData<String> getErrorLiveData() {
            return errorLiveData;
        }

        public void loadUserData() {
            if (firebaseUser == null) {
                errorLiveData.setValue("Người dùng chưa đăng nhập");
                return;
            }

            DocumentReference userRef = db.collection("Users").document(firebaseUser.getUid());
            userRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi tải thông tin: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    User user = document.toObject(User.class);
                    userLiveData.setValue(user);
                } else {
                    errorLiveData.setValue("Không tìm thấy thông tin người dùng");
                }
            });
        }
    }
}

```

### Service\UserAuthentication\ValidatePhoneActivity.java
```java
/**package com.example.carrenting.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.example.carrenting.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.FirebaseException;
import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthOptions;
import com.google.firebase.auth.PhoneAuthProvider;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.FirebaseFirestoreSettings;

import java.util.concurrent.TimeUnit;

public class ValidatePhoneActivity extends AppCompatActivity {

    private EditText otpNumberOne, getOtpNumberTwo, getOtpNumberThree, getOtpNumberFour, getOtpNumberFive, otpNumberSix;
    private Button btnSendCode;
    private TextView tvResend;
    private String mVerificationId;
    PhoneAuthProvider.ForceResendingToken mResendToken;
    String phoneNumber;
    Boolean otpValid = true;
    private FirebaseAuth mAuth;
    FirebaseAuth firebaseAuth;
    private FirebaseFirestore mDb;
    PhoneAuthCredential phoneAuthCredential;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_validate_phone);

        initUI();
        Intent data = getIntent();
        phoneNumber = data.getStringExtra("phone");

        firebaseAuth = FirebaseAuth.getInstance();
        mAuth = FirebaseAuth.getInstance();
        mDb = FirebaseFirestore.getInstance();

        if (phoneNumber.startsWith("0")) {
            phoneNumber = "+84" + phoneNumber.substring(1, phoneNumber.length());
        }
        Log.wtf("Phone Number", "Phone number is : " + phoneNumber);
        btnSendCode.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                validateField(otpNumberOne);
                validateField(getOtpNumberTwo);
                validateField(getOtpNumberThree);
                validateField(getOtpNumberFour);
                validateField(getOtpNumberFive);
                validateField(otpNumberSix);

                if(otpValid) {
                    // send otp to the user
                    String otp = otpNumberOne.getText().toString() + getOtpNumberTwo.getText().toString() + getOtpNumberThree.getText().toString() + getOtpNumberFour.getText().toString() + getOtpNumberFive.getText().toString() + otpNumberSix.getText().toString();

                    PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, otp);

                    verifyAuthentication(credential);

                    FirebaseFirestoreSettings settings = new FirebaseFirestoreSettings.Builder()
                            .build();
                    mDb.setFirestoreSettings(settings);
                    DocumentReference newUserRef = mDb
                            .collection(getString(R.string.collection_users))
                            .document(FirebaseAuth.getInstance().getUid());

                    newUserRef.update("phoneNumber", phoneNumber).addOnCompleteListener(new OnCompleteListener<Void>() {
                        @Override
                        public void onComplete(@NonNull Task<Void> task) {
                            if(task.isSuccessful()){


                                //Toast.makeText(ValidatePhoneActivity.this, "Update phone number successful", Toast.LENGTH_LONG).show();

                                Intent intent = new Intent(ValidatePhoneActivity.this, CCCDActivity.class);
                                startActivity(intent);
                            }
                        }
                    });
                }
            }
        });


        SendOtpCode(phoneNumber);

        tvResend.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                ReSendOtpCode(phoneNumber);
          }

        });

    }

    private void VerifyPhoneNumber(String phoneNumber){
        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)
                .setPhoneNumber(phoneNumber)
                .setTimeout(15L, TimeUnit.SECONDS)
                .setActivity(this)
                .setCallbacks(new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                    @Override
                    public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
                        verifyAuthentication(phoneAuthCredential);
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onVerificationFailed(@NonNull FirebaseException e) {
                        Toast.makeText(ValidatePhoneActivity.this, "OTP Verification Failed.", Toast.LENGTH_SHORT).show();
                    }
                    @Override
                    public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
                        super.onCodeSent(verificationId, forceResendingToken);
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                        mVerificationId = verificationId;
                        mResendToken = forceResendingToken;
                        tvResend.setVisibility(View.GONE);

                    }
                    @Override
                    public void onCodeAutoRetrievalTimeOut(@NonNull String s) {
                        super.onCodeAutoRetrievalTimeOut(s);
                        tvResend.setVisibility(View.VISIBLE);
                    }
                })
                .build();
        PhoneAuthProvider.verifyPhoneNumber(options);
    }
    private void ReSendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    private void SendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }
    public void verifyAuthentication(PhoneAuthCredential credential){
        firebaseAuth.getCurrentUser()
                .linkWithCredential(credential)
                .addOnSuccessListener(new OnSuccessListener<AuthResult>() {
            @Override
            public void onSuccess(AuthResult authResult) {
                // send to dashboard.
                Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
            }
        });
    }

    public void validateField(EditText field){
        if(field.getText().toString().isEmpty()){
            field.setError("Cần nhập OTP");
            otpValid = false;
        }else {
            otpValid = true;
        }
    }
    private void initUI() {
        otpNumberOne = findViewById(R.id.otpNumberOne);
        getOtpNumberTwo = findViewById(R.id.otpNumberTwo);
        getOtpNumberThree = findViewById(R.id.otpNumberThree);
        getOtpNumberFour = findViewById(R.id.otpNumberFour);
        getOtpNumberFive = findViewById(R.id.otpNumberFive);
        otpNumberSix = findViewById(R.id.optNumberSix);
        btnSendCode = findViewById(R.id.btn_signup);
        tvResend = findViewById(R.id.tvResend);
    }
}
**/

package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.FirebaseException;
import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthOptions;
import com.google.firebase.auth.PhoneAuthProvider;
import com.google.firebase.firestore.FirebaseFirestore;

import java.util.concurrent.TimeUnit;

public class ValidatePhoneActivity extends AppCompatActivity {

    private EditText otpNumberOne, getOtpNumberTwo, getOtpNumberThree, getOtpNumberFour, getOtpNumberFive, otpNumberSix;
    private Button btnSendCode;
    private TextView tvResend;
    private String mVerificationId;
    PhoneAuthProvider.ForceResendingToken mResendToken;
    String phoneNumber;
    Boolean otpValid = true;
    private FirebaseAuth mAuth;
    FirebaseAuth firebaseAuth;
    private FirebaseFirestore mDb;
    PhoneAuthCredential phoneAuthCredential;

    boolean bypassTestMode = false; // Dùng để bỏ qua xác thực OTP khi cần test

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_validate_phone);

        initUI();
        Intent data = getIntent();
        phoneNumber = data.getStringExtra("phone");

        firebaseAuth = FirebaseAuth.getInstance();
        mAuth = FirebaseAuth.getInstance();
        mDb = FirebaseFirestore.getInstance();

        if (phoneNumber.startsWith("0")) {
            phoneNumber = "+84" + phoneNumber.substring(1);
        }

        if (phoneNumber.equals("+84965853014")) {
            bypassTestMode = true;
            Toast.makeText(this, "Test mode enabled, skipping OTP", Toast.LENGTH_SHORT).show();

            mDb.collection(getString(R.string.collection_users))
                    .document(FirebaseAuth.getInstance().getUid())
                    .update("phoneNumber", phoneNumber)
                    .addOnCompleteListener(task -> {
                        if (task.isSuccessful()) {
                            startActivity(new Intent(this, CCCDActivity.class));
                            finish();
                        }
                    });
            return;
        }

        SendOtpCode(phoneNumber);

        btnSendCode.setOnClickListener(view -> {
            if (bypassTestMode) return;

            validateField(otpNumberOne);
            validateField(getOtpNumberTwo);
            validateField(getOtpNumberThree);
            validateField(getOtpNumberFour);
            validateField(getOtpNumberFive);
            validateField(otpNumberSix);

            if (otpValid) {
                String otp = otpNumberOne.getText().toString()
                        + getOtpNumberTwo.getText().toString()
                        + getOtpNumberThree.getText().toString()
                        + getOtpNumberFour.getText().toString()
                        + getOtpNumberFive.getText().toString()
                        + otpNumberSix.getText().toString();

                if (mVerificationId == null || otp.isEmpty()) {
                    Toast.makeText(this, "Không thể tạo PhoneAuthCredential: thiếu mã OTP.", Toast.LENGTH_SHORT).show();
                    return;
                }

                PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, otp);
                verifyAuthentication(credential);

                mDb.collection(getString(R.string.collection_users))
                        .document(FirebaseAuth.getInstance().getUid())
                        .update("phoneNumber", phoneNumber)
                        .addOnCompleteListener(task -> {
                            if (task.isSuccessful()) {
                                startActivity(new Intent(this, CCCDActivity.class));
                            }
                        });
            }
        });

        tvResend.setOnClickListener(view -> ReSendOtpCode(phoneNumber));
    }

    private void VerifyPhoneNumber(String phoneNumber){
        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)
                .setPhoneNumber(phoneNumber)
                .setTimeout(15L, TimeUnit.SECONDS)
                .setActivity(this)
                .setCallbacks(new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                    @Override
                    public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
                        verifyAuthentication(phoneAuthCredential);
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onVerificationFailed(@NonNull FirebaseException e) {
                        Toast.makeText(ValidatePhoneActivity.this, "OTP Verification Failed.", Toast.LENGTH_SHORT).show();
                    }
                    @Override
                    public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
                        super.onCodeSent(verificationId, forceResendingToken);
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                        mVerificationId = verificationId;
                        mResendToken = forceResendingToken;
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onCodeAutoRetrievalTimeOut(@NonNull String s) {
                        super.onCodeAutoRetrievalTimeOut(s);
                        tvResend.setVisibility(View.VISIBLE);
                    }
                })
                .build();
        PhoneAuthProvider.verifyPhoneNumber(options);
    }

    private void ReSendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    private void SendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    public void verifyAuthentication(PhoneAuthCredential credential){
        firebaseAuth.getCurrentUser()
                .linkWithCredential(credential)
                .addOnSuccessListener(new OnSuccessListener<AuthResult>() {
                    @Override
                    public void onSuccess(AuthResult authResult) {
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                    }
                });
    }

    public void validateField(EditText field){
        if(field.getText().toString().isEmpty()){
            field.setError("Cần nhập OTP");
            otpValid = false;
        }else {
            otpValid = true;
        }
    }

    private void initUI() {
        otpNumberOne = findViewById(R.id.otpNumberOne);
        getOtpNumberTwo = findViewById(R.id.otpNumberTwo);
        getOtpNumberThree = findViewById(R.id.otpNumberThree);
        getOtpNumberFour = findViewById(R.id.otpNumberFour);
        getOtpNumberFive = findViewById(R.id.otpNumberFive);
        otpNumberSix = findViewById(R.id.optNumberSix);
        btnSendCode = findViewById(R.id.btn_signup);
        tvResend = findViewById(R.id.tvResend);
    }
}
```

### Service\Vehicle\AddVehicleActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.Toast;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.appcompat.app.AppCompatActivity;
import com.google.firebase.Timestamp;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Api.CloudinaryApi;
import java.util.HashMap;
import java.util.Map;

public class AddVehicleActivity extends AppCompatActivity {

    private static final String TAG = "AddVehicleActivity";
    private FirebaseUser firebaseUser;
    private String vehicleImageUrl, documentImageUrl;
    private Uri vehicleImageUri, documentImageUri;
    private EditText vehicleName, vehicleSeats, vehiclePrice, vehicleNumber, vehicleBrand, fuelType, maxSpeed, transmission, doorsAndSeats;
    private Button btnAdd;
    private ImageButton btnBack;
    private ImageView vehicleImgView, documentImgView;
    private FirebaseFirestore db;
    private Vehicle vehicle;
    private ProgressDialog progressDialog;

    ActivityResultLauncher<String> pickVehicleImage = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        vehicleImageUri = result;
                        vehicleImgView.setImageURI(result);
                    }
                }
            });

    ActivityResultLauncher<String> pickDocumentImage = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        documentImageUri = result;
                        documentImgView.setImageURI(result);
                    }
                }
            });

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_add_vehicle);
        if (getSupportActionBar() != null) getSupportActionBar().hide();

        init();

        btnBack.setOnClickListener(v -> finish());
        btnAdd.setOnClickListener(view -> {
            if (fullFill()) {
                if (vehicleImageUri != null && documentImageUri != null) {
                    uploadImagesAndAddVehicle();
                } else {
                    toast("Vui lòng chọn cả ảnh xe và giấy tờ xe.");
                }
            } else {
                toast("Vui lòng nhập đầy đủ thông tin.");
            }
        });

        vehicleImgView.setOnClickListener(v -> pickVehicleImage.launch("image/*"));
        documentImgView.setOnClickListener(v -> pickDocumentImage.launch("image/*"));
    }

    private void init() {
        vehicleName = findViewById(R.id.et_name);
        vehicleSeats = findViewById(R.id.et_seats);
        vehiclePrice = findViewById(R.id.et_price);
        vehicleNumber = findViewById(R.id.et_number);
        vehicleBrand = findViewById(R.id.et_brand);
        fuelType = findViewById(R.id.et_fuel_type);
        maxSpeed = findViewById(R.id.et_max_speed);
        transmission = findViewById(R.id.et_transmission);
        doorsAndSeats = findViewById(R.id.et_doors_and_seats);
        vehicleImgView = findViewById(R.id.vehicle_img_view);
        documentImgView = findViewById(R.id.document_img_view);
        btnAdd = findViewById(R.id.btn_add);
        btnBack = findViewById(R.id.btn_back);

        try {
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            if (firebaseUser == null) {
                toast("Người dùng chưa đăng nhập");
                finish();
            }
            vehicle = new Vehicle();
        } catch (Exception e) {
            Log.e(TAG, "Lỗi khởi tạo Firebase: " + e.getMessage());
            toast("Lỗi khởi tạo Firebase: " + e.getMessage());
            finish();
        }

        CloudinaryApi.init(this);
    }

    private void uploadImagesAndAddVehicle() {
        if (vehicleImageUri == null || documentImageUri == null) {
            toast("Vui lòng chọn cả ảnh xe và giấy tờ xe.");
            return;
        }

        progressDialog = ProgressDialog.show(this, "Đang tải ảnh", "Vui lòng chờ...", true);

        // Tải ảnh xe
        CloudinaryApi.uploadImage(this, vehicleImageUri, new CloudinaryApi.UploadCallbackCustom() {
            @Override
            public void onSuccess(String url) {
                vehicleImageUrl = url;
                uploadDocumentImage();
            }

            @Override
            public void onFailure(Exception e) {
                if (progressDialog != null) progressDialog.dismiss();
                Log.e(TAG, "Lỗi tải ảnh xe: " + e.getMessage());
                toast("Lỗi tải ảnh xe: " + e.getMessage());
            }
        });
    }

    private void uploadDocumentImage() {
        CloudinaryApi.uploadImage(this, documentImageUri, new CloudinaryApi.UploadCallbackCustom() {
            @Override
            public void onSuccess(String url) {
                documentImageUrl = url;
                if (progressDialog != null) progressDialog.dismiss();
                if (vehicleImageUrl != null && documentImageUrl != null) {
                    addVehicle();
                } else {
                    toast("Lỗi: Không nhận được URL ảnh.");
                }
            }

            @Override
            public void onFailure(Exception e) {
                if (progressDialog != null) progressDialog.dismiss();
                Log.e(TAG, "Lỗi tải ảnh giấy tờ: " + e.getMessage());
                toast("Lỗi tải ảnh giấy tờ: " + e.getMessage());
            }
        });
    }

    private void addVehicle() {
        if (db == null) {
            toast("Lỗi Firebase Firestore, không thể thêm xe.");
            return;
        }

        vehicle.setVehicleName(vehicleName.getText().toString().trim());
        vehicle.setVehicleSeats(vehicleSeats.getText().toString().trim());
        vehicle.setVehiclePrice(vehiclePrice.getText().toString().trim() + " VND");
        vehicle.setVehicleNumber(vehicleNumber.getText().toString().trim());
        vehicle.setVehicleBrand(vehicleBrand.getText().toString().trim());
        vehicle.setFuelType(fuelType.getText().toString().trim());
        vehicle.setMaxSpeed(maxSpeed.getText().toString().trim());
        vehicle.setTransmission(transmission.getText().toString().trim());
        vehicle.setDoorsAndSeats(doorsAndSeats.getText().toString().trim());
        vehicle.setVehicleAvailability("pending");
        vehicle.setVehicleImageUrl(vehicleImageUrl);
        vehicle.setDocumentImageUrl(documentImageUrl);
        vehicle.setVerificationStatus("pending");
        vehicle.setCreatedAt(Timestamp.now());
        if (firebaseUser != null) {
            vehicle.setOwnerId(firebaseUser.getUid());
        } else {
            toast("Không thể thêm xe: Người dùng chưa đăng nhập.");
            return;
        }

        progressDialog = ProgressDialog.show(this, "Đang thêm xe", "Vui lòng chờ...", true);

        db.collection("Vehicles")
                .add(vehicle)
                .addOnSuccessListener(documentReference -> {
                    String vehicleId = documentReference.getId();
                    vehicle.setVehicleId(vehicleId);
                    updateVehicleId(vehicleId);
                    createAdminNotification(vehicleId);
                    if (progressDialog != null) progressDialog.dismiss();
                    toast("Xe đã được thêm thành công, đang chờ duyệt.");
                    setResult(RESULT_OK); // Gửi tín hiệu thành công
                    finish(); // Kết thúc activity
                })
                .addOnFailureListener(e -> {
                    if (progressDialog != null) progressDialog.dismiss();
                    Log.e(TAG, "Thêm xe thất bại: " + e.getMessage());
                    toast("Thêm xe thất bại: " + e.getMessage());
                });
    }

    private void updateVehicleId(String vehicleId) {
        Map<String, Object> data = new HashMap<>();
        data.put("vehicleId", vehicleId);

        db.collection("Vehicles").document(vehicleId)
                .update(data)
                .addOnSuccessListener(aVoid -> Log.d(TAG, "Cập nhật ID xe thành công"))
                .addOnFailureListener(e -> Log.e(TAG, "Cập nhật ID xe thất bại: " + e.getMessage()));
    }

    private void createAdminNotification(String vehicleId) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("title", "Xe mới chờ duyệt");
        notification.put("content", "Một xe mới (" + vehicle.getVehicleName() + ") đã được thêm, đang chờ duyệt.");
        notification.put("timestamp", Timestamp.now());
        notification.put("status", "unread");
        notification.put("type", "vehicle_verification");
        notification.put("vehicleId", vehicleId);
        notification.put("recipient", "admin");

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> Log.d(TAG, "Tạo thông báo cho admin thành công"))
                .addOnFailureListener(e -> Log.e(TAG, "Tạo thông báo cho admin thất bại: " + e.getMessage()));
    }

    private boolean fullFill() {
        boolean valid = true;
        if (TextUtils.isEmpty(vehicleName.getText().toString().trim())) {
            vehicleName.setError("Tên xe bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(vehicleSeats.getText().toString().trim())) {
            vehicleSeats.setError("Số chỗ bắt buộc.");
            valid = false;
        } else {
            try {
                int seats = Integer.parseInt(vehicleSeats.getText().toString().trim());
                if (seats <= 0) {
                    vehicleSeats.setError("Số chỗ phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                vehicleSeats.setError("Số chỗ phải là số.");
                valid = false;
            }
        }
        if (TextUtils.isEmpty(vehiclePrice.getText().toString().trim())) {
            vehiclePrice.setError("Giá bắt buộc.");
            valid = false;
        } else {
            try {
                float price = Float.parseFloat(vehiclePrice.getText().toString().trim());
                if (price <= 0) {
                    vehiclePrice.setError("Giá phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                vehiclePrice.setError("Giá phải là số.");
                valid = false;
            }
        }
        if (TextUtils.isEmpty(vehicleNumber.getText().toString().trim())) {
            vehicleNumber.setError("Biển số xe bắt buộc.");
            valid = false;
        } else if (!vehicleNumber.getText().toString().trim().matches("^[0-9A-Z]{7,9}$")) {
            vehicleNumber.setError("Biển số xe không hợp lệ (7-9 ký tự số hoặc chữ).");
            valid = false;
        }
        if (TextUtils.isEmpty(vehicleBrand.getText().toString().trim())) {
            vehicleBrand.setError("Thương hiệu bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(fuelType.getText().toString().trim())) {
            fuelType.setError("Loại nhiên liệu bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(maxSpeed.getText().toString().trim())) {
            maxSpeed.setError("Tốc độ tối đa bắt buộc.");
            valid = false;
        } else {
            try {
                int speed = Integer.parseInt(maxSpeed.getText().toString().trim());
                if (speed <= 0) {
                    maxSpeed.setError("Tốc độ phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                maxSpeed.setError("Tốc độ phải là số.");
                valid = false;
            }
        }
        if (TextUtils.isEmpty(transmission.getText().toString().trim())) {
            transmission.setError("Hộp số bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(doorsAndSeats.getText().toString().trim())) {
            doorsAndSeats.setError("Số cửa và ghế bắt buộc.");
            valid = false;
        }
        return valid;
    }

    private void toast(String txt) {
        Toast.makeText(getApplicationContext(), txt, Toast.LENGTH_LONG).show();
    }
}
```

### Service\Vehicle\AdminVehicleDetailActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import com.bumptech.glide.Glide;
import com.google.firebase.Timestamp;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.FragmentPages.Admin.RequestSupplementDialogFragment;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import java.text.SimpleDateFormat;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

public class AdminVehicleDetailActivity extends AppCompatActivity {

    private static final String TAG = "AdminVehicleDetail";
    private FirebaseFirestore db;
    private ProgressDialog progressDialog;
    private String vehicleId;
    private Vehicle vehicle;
    private TextView vehicleName, vehicleNumber, registrationDate, ownerName, verificationStatus;
    private TextView approveButtonText, rejectButtonText;
    private ImageView vehicleImage, documentImage, backButton; // Thêm backButton
    private LinearLayout approveButton, rejectButton;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_admin_vehicle_detail);

        initViews();
        db = FirebaseFirestore.getInstance();

        Intent intent = getIntent();
        vehicleId = intent.getStringExtra("vehicleId");
        if (vehicleId == null) {
            Toast.makeText(this, R.string.vehicle_not_found, Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        loadVehicleData();
    }

    private void initViews() {
        vehicleName = findViewById(R.id.ry1qg0h2dho);
        vehicleNumber = findViewById(R.id.ru72c47csbt);
        registrationDate = findViewById(R.id.r898i1ih4yvt);
        ownerName = findViewById(R.id.rucikt3pzv6);
        verificationStatus = findViewById(R.id.rac1kcrnb8f);
        vehicleImage = findViewById(R.id.rag6uycqqw4a);
        documentImage = findViewById(R.id.r9mpttg5k7eo);
        backButton = findViewById(R.id.rx7d0apsish); // Khởi tạo ImageView back
        approveButton = findViewById(R.id.r55jpwn8v3im);
        rejectButton = findViewById(R.id.rqczrg8gtglj);
        approveButtonText = findViewById(R.id.rnm7adnyh58b);
        rejectButtonText = findViewById(R.id.ruxnan76tqd);

        // Thêm sự kiện nhấn cho nút back
        backButton.setOnClickListener(v -> {
            Log.d(TAG, "Nút back được nhấn");
            finish(); // Quay lại giao diện trước
        });
    }

    private void loadVehicleData() {
        progressDialog = ProgressDialog.show(this, "Đang tải dữ liệu", "Vui lòng chờ...", true);

        DocumentReference vehicleRef = db.collection("Vehicles").document(vehicleId);
        vehicleRef.get().addOnSuccessListener(documentSnapshot -> {
            if (documentSnapshot.exists()) {
                vehicle = documentSnapshot.toObject(Vehicle.class);
                if (vehicle != null) {
                    displayVehicleData();
                    setupButtons();
                    loadOwnerData();
                } else {
                    Toast.makeText(this, "Không thể ánh xạ dữ liệu xe", Toast.LENGTH_SHORT).show();
                    finish();
                }
            } else {
                Toast.makeText(this, R.string.vehicle_not_found, Toast.LENGTH_SHORT).show();
                finish();
            }
            if (progressDialog != null) progressDialog.dismiss();
        }).addOnFailureListener(e -> {
            Log.e(TAG, "Lỗi tải dữ liệu xe: " + e.getMessage());
            Toast.makeText(this, R.string.load_vehicle_error, Toast.LENGTH_SHORT).show();
            if (progressDialog != null) progressDialog.dismiss();
            finish();
        });
    }

    private void displayVehicleData() {
        vehicleName.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : "Xe không tên");
        vehicleNumber.setText(vehicle.getVehicleNumber() != null ? vehicle.getVehicleNumber() : "Không có biển số");
        verificationStatus.setText(getVerificationStatusText(vehicle.getVerificationStatus()));
        if (vehicle.getCreatedAt() != null) {
            SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy", Locale.getDefault());
            registrationDate.setText(sdf.format(vehicle.getCreatedAt().toDate()));
        } else {
            registrationDate.setText("Không có ngày đăng");
        }

        if (vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty()) {
            Glide.with(this)
                    .load(vehicle.getVehicleImageUrl())
                    .placeholder(R.drawable.ic_car)
                    .into(vehicleImage);
        } else {
            vehicleImage.setImageResource(R.drawable.ic_car);
        }

        if (vehicle.getDocumentImageUrl() != null && !vehicle.getDocumentImageUrl().isEmpty()) {
            Glide.with(this)
                    .load(vehicle.getDocumentImageUrl())
                    .placeholder(R.drawable.ic_car).into(documentImage);
        } else {
            documentImage.setImageResource(R.drawable.ic_car);
        }
    }

    private void setupButtons() {
        if (vehicle.getVerificationStatus() != null && vehicle.getVerificationStatus().equals("verified")) {
            approveButtonText.setText("Ẩn xe");
            rejectButtonText.setText("Cảnh báo vi phạm");
            approveButton.setOnClickListener(v -> hideVehicle());
            rejectButton.setOnClickListener(v -> showViolationDialog());
        } else {
            approveButtonText.setText(R.string.confirm);
            rejectButtonText.setText(R.string.reject);
            approveButton.setOnClickListener(v -> approveVehicle());
            rejectButton.setOnClickListener(v -> showSupplementDialog());
        }
    }

    private void loadOwnerData() {
        if (vehicle.getOwnerId() == null) {
            ownerName.setText("Không có chủ xe");
            return;
        }

        DocumentReference ownerRef = db.collection("Users").document(vehicle.getOwnerId());
        ownerRef.get().addOnSuccessListener(documentSnapshot -> {
            if (documentSnapshot.exists()) {
                User owner = documentSnapshot.toObject(User.class);
                ownerName.setText(owner != null && owner.getUsername() != null ? owner.getUsername() : "Không có tên");
            } else {
                ownerName.setText("Không tìm thấy chủ xe");
            }
        }).addOnFailureListener(e -> {
            Log.e(TAG, "Lỗi tải dữ liệu chủ xe: " + e.getMessage());
            ownerName.setText("Lỗi tải chủ xe");
        });
    }

    private void approveVehicle() {
        progressDialog = ProgressDialog.show(this, "Đang duyệt xe", "Vui lòng chờ...", true);

        Map<String, Object> updates = new HashMap<>();
        updates.put("verificationStatus", "verified");
        updates.put("vehicleAvailability", "available");

        DocumentReference vehicleRef = db.collection("Vehicles").document(vehicleId);
        vehicleRef.update(updates).addOnSuccessListener(aVoid -> {
            sendNotification(vehicle.getOwnerId(), "Xe đã được duyệt",
                    "Xe " + vehicle.getVehicleName() + " của bạn đã được duyệt và sẵn sàng cho thuê.",
                    "vehicle_verification", vehicleId);
            Toast.makeText(this, "Xe đã được duyệt", Toast.LENGTH_SHORT).show();
            if (progressDialog != null) progressDialog.dismiss();
            finish();
        }).addOnFailureListener(e -> {
            Log.e(TAG, "Lỗi duyệt xe: " + e.getMessage());
            Toast.makeText(this, "Lỗi duyệt xe: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            if (progressDialog != null) progressDialog.dismiss();
        });
    }

    private void hideVehicle() {
        progressDialog = ProgressDialog.show(this, "Đang ẩn xe", "Vui lòng chờ...", true);

        Map<String, Object> updates = new HashMap<>();
        updates.put("vehicleAvailability", "hidden");

        DocumentReference vehicleRef = db.collection("Vehicles").document(vehicleId);
        vehicleRef.update(updates).addOnSuccessListener(aVoid -> {
            sendNotification(vehicle.getOwnerId(), "Xe đã bị ẩn",
                    "Xe " + vehicle.getVehicleName() + " của bạn đã bị ẩn khỏi nền tảng.",
                    "vehicle_verification", vehicleId);
            Toast.makeText(this, "Xe đã bị ẩn", Toast.LENGTH_SHORT).show();
            if (progressDialog != null) progressDialog.dismiss();
            finish();
        }).addOnFailureListener(e -> {
            Log.e(TAG, "Lỗi ẩn xe: " + e.getMessage());
            Toast.makeText(this, "Lỗi ẩn xe: " + e.getMessage(), Toast.LENGTH_SHORT).show();
            if (progressDialog != null) progressDialog.dismiss();
        });
    }

    private void showSupplementDialog() {
        RequestSupplementDialogFragment dialog = RequestSupplementDialogFragment.newInstance(vehicle.getOwnerId(), vehicleId, "supplement_request_vehicle");
        dialog.setOnSubmitListener(message -> {
            Map<String, Object> updates = new HashMap<>();
            updates.put("verificationStatus", "rejected");
            db.collection("Vehicles").document(vehicleId)
                    .update(updates)
                    .addOnSuccessListener(aVoid -> {
                        Map<String, Object> notification = new HashMap<>();
                        notification.put("userId", vehicle.getOwnerId());
                        notification.put("title", "Yêu cầu bổ sung thông tin xe");
                        notification.put("message", "Xe " + vehicle.getVehicleName() + " cần bổ sung: " + message);
                        notification.put("type", "supplement_request_vehicle");
                        notification.put("vehicleId", vehicleId);
                        notification.put("createdAt", Timestamp.now());
                        notification.put("isRead", false);
                        notification.put("role", "owner");

                        db.collection("Notifications")
                                .add(notification)
                                .addOnSuccessListener(doc -> db.collection("Notifications").document(doc.getId()).update("notificationId", doc.getId()));
                        Toast.makeText(this, "Đã gửi yêu cầu bổ sung", Toast.LENGTH_SHORT).show();
                        finish();
                    })
                    .addOnFailureListener(e -> {
                        Log.e(TAG, "Lỗi cập nhật trạng thái xe: ", e);
                        Toast.makeText(this, "Lỗi gửi yêu cầu: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                    });
        });
        dialog.show(getSupportFragmentManager(), "RequestSupplementDialog");
    }

    private void showViolationDialog() {
        RequestSupplementDialogFragment dialog = RequestSupplementDialogFragment.newInstance(vehicle.getOwnerId(), vehicleId, "violation_warning");
        dialog.setOnSubmitListener(message -> {
            sendNotification(vehicle.getOwnerId(), "Cảnh báo vi phạm",
                    "Xe " + vehicle.getVehicleName() + " vi phạm: " + message,
                    "vehicle_verification", vehicleId);
            Toast.makeText(this, "Đã gửi cảnh báo vi phạm", Toast.LENGTH_SHORT).show();
            finish();
        });
        dialog.show(getSupportFragmentManager(), "RequestSupplementDialog");
    }

    private void sendNotification(String userId, String title, String message, String type, String vehicleId) {
        Map<String, Object> notification = new HashMap<>();
        notification.put("userId", userId);
        notification.put("title", title);
        notification.put("message", message);
        notification.put("type", type);
        notification.put("vehicleId", vehicleId != null ? vehicleId : "");
        notification.put("createdAt", Timestamp.now());
        notification.put("isRead", false);

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    String notificationId = documentReference.getId();
                    db.collection("Notifications").document(notificationId)
                            .update("notificationId", notificationId);
                    Log.d(TAG, "Gửi thông báo thành công");
                })
                .addOnFailureListener(e -> Log.e(TAG, "Lỗi gửi thông báo: " + e.getMessage()));
    }

    private String getVerificationStatusText(String verificationStatus) {
        if (verificationStatus == null) return "Không xác định";
        switch (verificationStatus) {
            case "verified": return getString(R.string.confirm);
            case "pending": return "Chưa duyệt";
            case "rejected": return getString(R.string.reject);
            default: return "Không xác định";
        }
    }
}
```

### Service\Vehicle\UpdateVehicleActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.Toast;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.appcompat.app.AppCompatActivity;
import com.bumptech.glide.Glide;
import com.google.firebase.Timestamp;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.SetOptions;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Api.CloudinaryApi;
import java.util.HashMap;
import java.util.Map;

public class UpdateVehicleActivity extends AppCompatActivity {

    private static final String TAG = "UpdateVehicleActivity";
    private ImageView vehicleImage, documentImage;
    private ImageButton btnBack;
    private EditText editTextVehicleName, editTextVehiclePrice, editTextVehicleNumber, editTextVehicleSeats;
    private EditText editTextVehicleBrand, editTextFuelType, editTextMaxSpeed, editTextTransmission, editTextDoorsAndSeats;
    private Button btnUpdate;
    private String vehicleId;
    private FirebaseFirestore dbVehicle;
    private Vehicle vehicle = new Vehicle();
    private Uri vehicleImageUri, documentImageUri;
    private String vehicleImageUrl, documentImageUrl;
    private ProgressDialog progressDialog;

    ActivityResultLauncher<String> pickVehicleImage = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        vehicleImageUri = result;
                        vehicleImage.setImageURI(result);
                    }
                }
            });

    ActivityResultLauncher<String> pickDocumentImage = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null) {
                        documentImageUri = result;
                        documentImage.setImageURI(result);
                    }
                }
            });

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_update_vehicle);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }

        Intent intent = getIntent();
        vehicleId = intent.getStringExtra("vehicleId");
        if (vehicleId == null || vehicleId.isEmpty()) {
            Toast.makeText(this, "Không tìm thấy ID xe", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }
        vehicle.setVehicleId(vehicleId);

        init();
        getDetail();

        btnBack.setOnClickListener(v -> finish());
        btnUpdate.setOnClickListener(view -> update());
        vehicleImage.setOnClickListener(v -> pickVehicleImage.launch("image/*"));
        documentImage.setOnClickListener(v -> pickDocumentImage.launch("image/*"));
    }

    private void init() {
        btnBack = findViewById(R.id.btn_back);
        btnUpdate = findViewById(R.id.btn_updatevehicle);
        editTextVehicleName = findViewById(R.id.et_vehiclename);
        editTextVehicleNumber = findViewById(R.id.et_platenumber);
        editTextVehicleSeats = findViewById(R.id.et_vehicleseats);
        editTextVehiclePrice = findViewById(R.id.et_vehicleprice);
        editTextVehicleBrand = findViewById(R.id.et_brand);
        editTextFuelType = findViewById(R.id.et_fuel_type);
        editTextMaxSpeed = findViewById(R.id.et_max_speed);
        editTextTransmission = findViewById(R.id.et_transmission);
        editTextDoorsAndSeats = findViewById(R.id.et_doors_and_seats);
        vehicleImage = findViewById(R.id.vehicle_img_view);
        documentImage = findViewById(R.id.document_img_view);
        dbVehicle = FirebaseFirestore.getInstance();
        editTextVehicleName.setEnabled(false); // Tên xe không chỉnh sửa
        CloudinaryApi.init(this);
    }

    private void getDetail() {
        progressDialog = ProgressDialog.show(this, "Đang tải dữ liệu", "Vui lòng chờ...", true);

        dbVehicle.collection("Vehicles").document(vehicleId)
                .get()
                .addOnSuccessListener(documentSnapshot -> {
                    progressDialog.dismiss();
                    if (documentSnapshot.exists()) {
                        vehicle = documentSnapshot.toObject(Vehicle.class);
                        if (vehicle != null) {
                            vehicle.setVehicleId(vehicleId); // Đảm bảo vehicleId được set
                            // Set UI
                            editTextVehicleName.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : "");
                            editTextVehiclePrice.setText(vehicle.getVehiclePrice() != null ? vehicle.getVehiclePrice().replace(" VND", "") : "");
                            editTextVehicleSeats.setText(vehicle.getVehicleSeats() != null ? vehicle.getVehicleSeats() : "");
                            editTextVehicleNumber.setText(vehicle.getVehicleNumber() != null ? vehicle.getVehicleNumber() : "");
                            editTextVehicleBrand.setText(vehicle.getVehicleBrand() != null ? vehicle.getVehicleBrand() : "");
                            editTextFuelType.setText(vehicle.getFuelType() != null ? vehicle.getFuelType() : "");
                            editTextMaxSpeed.setText(vehicle.getMaxSpeed() != null ? vehicle.getMaxSpeed() : "");
                            editTextTransmission.setText(vehicle.getTransmission() != null ? vehicle.getTransmission() : "");
                            editTextDoorsAndSeats.setText(vehicle.getDoorsAndSeats() != null ? vehicle.getDoorsAndSeats() : "");
                            if (vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty()) {
                                Glide.with(this)
                                        .load(vehicle.getVehicleImageUrl())
                                        .placeholder(R.drawable.ic_car)
                                        .into(vehicleImage);
                            } else {
                                vehicleImage.setImageResource(R.drawable.ic_car);
                            }
                            if (vehicle.getDocumentImageUrl() != null && !vehicle.getDocumentImageUrl().isEmpty()) {
                                Glide.with(this)
                                        .load(vehicle.getDocumentImageUrl())
                                        .placeholder(R.drawable.ic_car)
                                        .into(documentImage);
                            } else {
                                documentImage.setImageResource(R.drawable.ic_car);
                            }
                            Log.d(TAG, "Tải chi tiết xe thành công: " + vehicle.toString());
                        } else {
                            Toast.makeText(this, "Không thể ánh xạ dữ liệu xe", Toast.LENGTH_SHORT).show();
                            finish();
                        }
                    } else {
                        Toast.makeText(this, "Không tìm thấy xe", Toast.LENGTH_SHORT).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    progressDialog.dismiss();
                    Log.e(TAG, "Lỗi lấy chi tiết xe: " + e.getMessage());
                    Toast.makeText(this, "Lỗi lấy chi tiết xe: " + e.getMessage(), Toast.LENGTH_LONG).show();
                    finish();
                });
    }

    private void update() {
        if (!validateInputs()) {
            return;
        }

        Map<String, Object> data = new HashMap<>();
        boolean flag = false;
        String plateNumber = editTextVehicleNumber.getText().toString().trim();
        String seats = editTextVehicleSeats.getText().toString().trim();
        String price = editTextVehiclePrice.getText().toString().trim();
        String brand = editTextVehicleBrand.getText().toString().trim();
        String fuelType = editTextFuelType.getText().toString().trim();
        String maxSpeed = editTextMaxSpeed.getText().toString().trim();
        String transmission = editTextTransmission.getText().toString().trim();
        String doorsAndSeats = editTextDoorsAndSeats.getText().toString().trim();

        // Check for changes
        if (!plateNumber.equals(vehicle.getVehicleNumber())) {
            data.put("vehicleNumber", plateNumber);
            flag = true;
        }
        if (!seats.equals(vehicle.getVehicleSeats())) {
            data.put("vehicleSeats", seats);
            flag = true;
        }
        if (!price.equals(vehicle.getVehiclePrice() != null ? vehicle.getVehiclePrice().replace(" VND", "") : "")) {
            data.put("vehiclePrice", price + " VND");
            flag = true;
        }
        if (!brand.equals(vehicle.getVehicleBrand())) {
            data.put("vehicleBrand", brand);
            flag = true;
        }
        if (!fuelType.equals(vehicle.getFuelType())) {
            data.put("fuelType", fuelType);
            flag = true;
        }
        if (!maxSpeed.equals(vehicle.getMaxSpeed())) {
            data.put("maxSpeed", maxSpeed);
            flag = true;
        }
        if (!transmission.equals(vehicle.getTransmission())) {
            data.put("transmission", transmission);
            flag = true;
        }
        if (!doorsAndSeats.equals(vehicle.getDoorsAndSeats())) {
            data.put("doorsAndSeats", doorsAndSeats);
            flag = true;
        }

        if (vehicleImageUri != null || documentImageUri != null) {
            uploadImagesAndUpdate(data, flag);
        } else if (flag) {
            updateFirestore(data);
        } else {
            Toast.makeText(this, "Không có thay đổi để cập nhật", Toast.LENGTH_SHORT).show();
        }
    }

    private void uploadImagesAndUpdate(Map<String, Object> data, boolean flag) {
        progressDialog = ProgressDialog.show(this, "Đang tải ảnh", "Vui lòng chờ...", true);

        if (vehicleImageUri != null) {
            CloudinaryApi.uploadImage(this, vehicleImageUri, new CloudinaryApi.UploadCallbackCustom() {
                @Override
                public void onSuccess(String url) {
                    vehicleImageUrl = url;
                    data.put("vehicleImageUrl", vehicleImageUrl);
                    if (documentImageUri != null) {
                        uploadDocumentImage(data, flag);
                    } else {
                        updateFirestore(data);
                    }
                }

                @Override
                public void onFailure(Exception e) {
                    if (progressDialog != null) progressDialog.dismiss();
                    Log.e(TAG, "Lỗi tải ảnh xe: " + e.getMessage());
                    toast("Lỗi tải ảnh xe: " + e.getMessage());
                }
            });
        } else if (documentImageUri != null) {
            uploadDocumentImage(data, flag);
        }
    }

    private void uploadDocumentImage(Map<String, Object> data, boolean flag) {
        CloudinaryApi.uploadImage(this, documentImageUri, new CloudinaryApi.UploadCallbackCustom() {
            @Override
            public void onSuccess(String url) {
                documentImageUrl = url;
                data.put("documentImageUrl", documentImageUrl);
                updateFirestore(data);
            }

            @Override
            public void onFailure(Exception e) {
                if (progressDialog != null) progressDialog.dismiss();
                Log.e(TAG, "Lỗi tải ảnh giấy tờ: " + e.getMessage());
                toast("Lỗi tải ảnh giấy tờ: " + e.getMessage());
            }
        });
    }

    private void updateFirestore(Map<String, Object> data) {
        data.put("verificationStatus", "pending");
        data.put("vehicleAvailability", "pending");

        dbVehicle.collection("Vehicles")
                .document(vehicleId)
                .set(data, SetOptions.merge())
                .addOnSuccessListener(aVoid -> {
                    createAdminNotification();
                    if (progressDialog != null) progressDialog.dismiss();
                    Toast.makeText(this, "Cập nhật thông tin thành công, đang chờ admin duyệt.", Toast.LENGTH_LONG).show();
                    finish();
                })
                .addOnFailureListener(e -> {
                    if (progressDialog != null) progressDialog.dismiss();
                    Log.e(TAG, "Không thể cập nhật thông tin: " + e.getMessage());
                    Toast.makeText(this, "Không thể cập nhật thông tin: " + e.getMessage(), Toast.LENGTH_LONG).show();
                });
    }

    private boolean validateInputs() {
        boolean valid = true;
        String plateNumber = editTextVehicleNumber.getText().toString().trim();
        String seats = editTextVehicleSeats.getText().toString().trim();
        String price = editTextVehiclePrice.getText().toString().trim();
        String brand = editTextVehicleBrand.getText().toString().trim();
        String fuelType = editTextFuelType.getText().toString().trim();
        String maxSpeed = editTextMaxSpeed.getText().toString().trim();
        String transmission = editTextTransmission.getText().toString().trim();
        String doorsAndSeats = editTextDoorsAndSeats.getText().toString().trim();

        if (TextUtils.isEmpty(plateNumber)) {
            editTextVehicleNumber.setError("Biển số xe bắt buộc.");
            valid = false;
        } else if (!plateNumber.matches("^[0-9A-Z]{7,9}$")) {
            editTextVehicleNumber.setError("Biển số xe không hợp lệ (7-9 ký tự số hoặc chữ).");
            valid = false;
        }

        if (TextUtils.isEmpty(seats)) {
            editTextVehicleSeats.setError("Số chỗ bắt buộc.");
            valid = false;
        } else {
            try {
                int seatCount = Integer.parseInt(seats);
                if (seatCount <= 0) {
                    editTextVehicleSeats.setError("Số chỗ phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                editTextVehicleSeats.setError("Số chỗ phải là số.");
                valid = false;
            }
        }

        if (TextUtils.isEmpty(price)) {
            editTextVehiclePrice.setError("Giá bắt buộc.");
            valid = false;
        } else {
            try {
                float priceValue = Float.parseFloat(price);
                if (priceValue <= 0) {
                    editTextVehiclePrice.setError("Giá phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                editTextVehiclePrice.setError("Giá phải là số.");
                valid = false;
            }
        }

        if (TextUtils.isEmpty(brand)) {
            editTextVehicleBrand.setError("Thương hiệu bắt buộc.");
            valid = false;
        }

        if (TextUtils.isEmpty(fuelType)) {
            editTextFuelType.setError("Loại nhiên liệu bắt buộc.");
            valid = false;
        }

        if (TextUtils.isEmpty(maxSpeed)) {
            editTextMaxSpeed.setError("Tốc độ tối đa bắt buộc.");
            valid = false;
        } else {
            try {
                int speed = Integer.parseInt(maxSpeed);
                if (speed <= 0) {
                    editTextMaxSpeed.setError("Tốc độ phải lớn hơn 0.");
                    valid = false;
                }
            } catch (NumberFormatException e) {
                editTextMaxSpeed.setError("Tốc độ phải là số.");
                valid = false;
            }
        }

        if (TextUtils.isEmpty(transmission)) {
            editTextTransmission.setError("Hộp số bắt buộc.");
            valid = false;
        }

        if (TextUtils.isEmpty(doorsAndSeats)) {
            editTextDoorsAndSeats.setError("Số cửa và ghế bắt buộc.");
            valid = false;
        }

        return valid;
    }

    private void createAdminNotification() {
        Map<String, Object> notification = new HashMap<>();
        notification.put("title", "Xe cập nhật chờ duyệt");
        notification.put("content", "Xe " + vehicle.getVehicleName() + " đã được cập nhật, đang chờ duyệt.");
        notification.put("timestamp", Timestamp.now());
        notification.put("status", "unread");
        notification.put("type", "vehicle_verification");
        notification.put("vehicleId", vehicleId);
        notification.put("recipient", "admin");

        dbVehicle.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    // Silent success
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(this, "Lỗi gửi thông báo cho admin: " + e.getMessage(), Toast.LENGTH_SHORT).show();
                });
    }

    private void toast(String txt) {
        Toast.makeText(getApplicationContext(), txt, Toast.LENGTH_LONG).show();
    }
}

```

### Service\Vehicle\VehicleCardActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import com.bumptech.glide.Glide;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;

public class VehicleCardActivity extends AppCompatActivity {

    private FirebaseFirestore dbVehicle;
    private String vehicleId;
    private TextView textViewVehicleName, textViewVehiclePrice;
    private ImageView imageViewVehicle;
    private Vehicle vehicle = new Vehicle();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.vehicle_card);

        vehicleId = getIntent().getStringExtra("vehicleId");
        if (vehicleId == null) {
            Toast.makeText(this, "Không tìm thấy ID xe", Toast.LENGTH_LONG).show();
            finish();
            return;
        }

        init();
        getDetail();
    }

    private void init() {
        dbVehicle = FirebaseFirestore.getInstance();
        textViewVehicleName = findViewById(R.id.vehicle_name);
        textViewVehiclePrice = findViewById(R.id.tv_vehicle_price);
        imageViewVehicle = findViewById(R.id.img_vehicle);
    }

    private void getDetail() {
        dbVehicle.collection("Vehicles")
                .document(vehicleId)
                .get()
                .addOnSuccessListener(documentSnapshot -> {
                    if (documentSnapshot.exists()) {
                        vehicle = documentSnapshot.toObject(Vehicle.class);
                        if (vehicle != null) {
                            textViewVehicleName.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : "Xe không tên");
                            textViewVehiclePrice.setText(vehicle.getVehiclePrice() != null ? vehicle.getVehiclePrice() : "0 VNĐ");
                            if (vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty()) {
                                Glide.with(this)
                                        .load(vehicle.getVehicleImageUrl())
                                        .placeholder(R.drawable.ic_car)
                                        .into(imageViewVehicle);
                            } else {
                                imageViewVehicle.setImageResource(R.drawable.ic_car);
                            }
                        }
                    } else {
                        Toast.makeText(this, "Không tìm thấy xe", Toast.LENGTH_LONG).show();
                        finish();
                    }
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(this, "Lỗi lấy chi tiết xe: " + e.getMessage(), Toast.LENGTH_LONG).show();
                    finish();
                });
    }
}
```

### Service\Vehicle\VehicleDetailActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import android.app.AlertDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import androidx.lifecycle.ViewModelProvider;

import com.bumptech.glide.Glide;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Booking.ScheduleSelect;
import com.uit.carrental.Service.UserAuthentication.CCCDActivity;

public class VehicleDetailActivity extends AppCompatActivity {

    private static final String TAG = "VehicleDetailActivity";
    private ImageView imageViewVehicle, backButton;
    private TextView textViewName, textViewPrice, textViewFuel, textViewSpeed, textViewTransmission, textViewSeats, textViewNumber;
    private TextView textViewProviderName, textViewProviderPhone, textViewProviderEmail, textViewProviderAddress, textViewOwner;
    private Button btnBook;
    private String vehicleId;
    private VehicleDetailViewModel viewModel;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_detail_car);

        vehicleId = getIntent().getStringExtra("vehicleId");
        if (vehicleId == null) {
            Toast.makeText(this, "Không tìm thấy xe", Toast.LENGTH_SHORT).show();
            finish();
            return;
        }

        initViews();
        initViewModel();
        observeLiveData();

        btnBook.setOnClickListener(v -> checkCccdAndBook());
    }

    private void initViews() {
        btnBook = findViewById(R.id.btn_book);
        imageViewVehicle = findViewById(R.id.vehicle_img);
        backButton = findViewById(R.id.back_button);
        textViewName = findViewById(R.id.vehicle_name);
        textViewPrice = findViewById(R.id.tv_vehicle_price);
        textViewFuel = findViewById(R.id.fuel_value);
        textViewSpeed = findViewById(R.id.speed_value);
        textViewTransmission = findViewById(R.id.transmission_value);
        textViewSeats = findViewById(R.id.seats_value);
        textViewNumber = findViewById(R.id.tv_vehicle_number);
        textViewProviderName = findViewById(R.id.tv_provider_name);
        textViewProviderPhone = findViewById(R.id.tv_provider_phone);
        textViewProviderEmail = findViewById(R.id.tv_provider_gmail);
        textViewProviderAddress = findViewById(R.id.tv_provider_address);
        textViewOwner = findViewById(R.id.tv_vehicle_owner);

        backButton.setOnClickListener(v -> {
            Log.d(TAG, "Nút Back giao diện được nhấn");
            navigateBackToHome();
        });
    }

    private void initViewModel() {
        viewModel = new ViewModelProvider(this).get(VehicleDetailViewModel.class);
        viewModel.loadVehicleData(vehicleId);
    }

    private void observeLiveData() {
        viewModel.getVehicleLiveData().observe(this, vehicle -> {
            if (vehicle != null) {
                textViewName.setText(vehicle.getVehicleName() != null ? vehicle.getVehicleName() : "Mercedes C300 AMG");
                textViewPrice.setText(vehicle.getVehiclePrice() != null ? vehicle.getVehiclePrice() : "999.000VNĐ/Ngày");
                textViewFuel.setText(vehicle.getFuelType() != null ? vehicle.getFuelType() : "Xăng không chì 95+");
                textViewSpeed.setText(vehicle.getMaxSpeed() != null ? vehicle.getMaxSpeed() : "250 km/h");
                textViewTransmission.setText(vehicle.getTransmission() != null ? vehicle.getTransmission() : "Tự động 9 cấp");
                textViewSeats.setText(vehicle.getDoorsAndSeats() != null ? vehicle.getDoorsAndSeats() : "2 Cửa và 4 Ghế");
                textViewNumber.setText(vehicle.getVehicleNumber() != null ? vehicle.getVehicleNumber() : "60C2-88888");

                if (vehicle.getVehicleImageUrl() != null && !vehicle.getVehicleImageUrl().isEmpty()) {
                    Glide.with(this)
                            .load(vehicle.getVehicleImageUrl())
                            .placeholder(R.drawable.ic_car)
                            .into(imageViewVehicle);
                }

                if (vehicle.getOwnerId() != null) {
                    viewModel.loadOwnerData(vehicle.getOwnerId());
                }
            }
        });

        viewModel.getOwnerLiveData().observe(this, owner -> {
            if (owner != null) {
                textViewProviderName.setText(owner.getUsername() != null ? owner.getUsername() : "Công ty ABC");
                textViewProviderPhone.setText(owner.getPhoneNumber() != null ? owner.getPhoneNumber() : "0123456789");
                textViewProviderEmail.setText(owner.getEmail() != null ? owner.getEmail() : "abc@example.com");
                textViewProviderAddress.setText(owner.getAddress() != null ? owner.getAddress() : "123 Đường ABC, Đồng Nai");
                textViewOwner.setText(owner.getUsername() != null ? owner.getUsername() : "Nguyễn Văn A");
            }
        });

        viewModel.getErrorLiveData().observe(this, error -> {
            if (error != null) {
                Toast.makeText(this, error, Toast.LENGTH_LONG).show();
                finish();
            }
        });

        viewModel.getUserLiveData().observe(this, user -> {
            // Dữ liệu người dùng đã tải, sẵn sàng để kiểm tra CCCD
        });
    }

    private void checkCccdAndBook() {
        FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        if (firebaseUser == null) {
            Toast.makeText(this, "Vui lòng đăng nhập để đặt xe", Toast.LENGTH_SHORT).show();
            return;
        }

        User user = viewModel.getUserLiveData().getValue();
        if (user == null ||
                user.getCiCardFront() == null || user.getCiCardFront().isEmpty() ||
                user.getCiCardBehind() == null || user.getCiCardBehind().isEmpty() ||
                user.getLicenseUrl() == null || user.getLicenseUrl().isEmpty() ||
                !"verified".equals(user.getVerificationStatus())) {
            showVerificationRequiredDialog();
        } else {
            Intent intent = new Intent(VehicleDetailActivity.this, ScheduleSelect.class);
            intent.putExtra("vehicleId", vehicleId);
            startActivity(intent);
        }
    }

    private void showVerificationRequiredDialog() {
        new AlertDialog.Builder(this)
                .setTitle("Yêu cầu xác minh")
                .setMessage("Bạn cần cập nhật căn cước công dân và bằng lái xe, đồng thời được admin duyệt để thuê xe. Bạn có muốn cập nhật ngay không?")
                .setPositiveButton("Cập nhật", (dialog, which) -> {
                    Intent intent = new Intent(VehicleDetailActivity.this, CCCDActivity.class);
                    intent.putExtra("fromVehicleDetail", true); // Thêm extra để theo dõi
                    startActivity(intent);
                })
                .setNegativeButton("Hủy", (dialog, which) -> dialog.dismiss())
                .create()
                .show();
    }

    private void navigateBackToHome() {
        Intent intent = new Intent(this, CustomerMainActivity.class);
        intent.putExtra("fragment", "home");
        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
        startActivity(intent);
        finish();
    }

    @Override
    public void onBackPressed() {
        Log.d(TAG, "Nút Back vật lý được nhấn");
        navigateBackToHome();
    }

    public static class VehicleDetailViewModel extends ViewModel {
        private final FirebaseFirestore db;
        private final FirebaseUser firebaseUser;
        private final MutableLiveData<Vehicle> vehicleLiveData;
        private final MutableLiveData<User> userLiveData;
        private final MutableLiveData<User> ownerLiveData;
        private final MutableLiveData<String> errorLiveData;

        public VehicleDetailViewModel() {
            db = FirebaseFirestore.getInstance();
            firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            vehicleLiveData = new MutableLiveData<>();
            userLiveData = new MutableLiveData<>();
            ownerLiveData = new MutableLiveData<>();
            errorLiveData = new MutableLiveData<>();
        }

        public LiveData<Vehicle> getVehicleLiveData() {
            return vehicleLiveData;
        }

        public LiveData<User> getUserLiveData() {
            return userLiveData;
        }

        public LiveData<User> getOwnerLiveData() {
            return ownerLiveData;
        }

        public LiveData<String> getErrorLiveData() {
            return errorLiveData;
        }

        public void loadVehicleData(String vehicleId) {
            DocumentReference vehicleRef = db.collection("Vehicles").document(vehicleId);
            vehicleRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi lấy chi tiết xe: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    Vehicle vehicle = document.toObject(Vehicle.class);
                    vehicleLiveData.setValue(vehicle);
                } else {
                    errorLiveData.setValue("Không tìm thấy xe");
                }
            });

            if (firebaseUser != null) {
                DocumentReference userRef = db.collection("Users").document(firebaseUser.getUid());
                userRef.addSnapshotListener((document, error) -> {
                    if (error != null) {
                        errorLiveData.setValue("Lỗi tải thông tin người dùng: " + error.getMessage());
                        return;
                    }
                    if (document != null && document.exists()) {
                        User user = document.toObject(User.class);
                        userLiveData.setValue(user);
                    }
                });
            }
        }

        public void loadOwnerData(String ownerId) {
            DocumentReference ownerRef = db.collection("Users").document(ownerId);
            ownerRef.addSnapshotListener((document, error) -> {
                if (error != null) {
                    errorLiveData.setValue("Lỗi tải thông tin chủ xe: " + error.getMessage());
                    return;
                }
                if (document != null && document.exists()) {
                    User owner = document.toObject(User.class);
                    ownerLiveData.setValue(owner);
                }
            });
        }
    }
}
```

### Service\ZaloPay\Api\CreateOrder.java
```java
package com.uit.carrental.Service.ZaloPay.Api;

import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
import com.uit.carrental.Service.ZaloPay.Helper.Helpers;

import org.json.JSONObject;

import java.util.Date;

import okhttp3.FormBody;
import okhttp3.RequestBody;

public class CreateOrder {
    private class CreateOrderData {
        String AppId;
        String AppUser;
        String AppTime;
        String Amount;
        String AppTransId;
        String EmbedData;
        String Items;
        String BankCode;
        String Description;
        String Mac;

        private CreateOrderData(String amount) throws Exception {
            long appTime = new Date().getTime();
            AppId = String.valueOf(AppInfo.APP_ID);
            AppUser = "Android_Demo";
            AppTime = String.valueOf(appTime);
            Amount = amount;
            AppTransId = Helpers.getAppTransId();
            EmbedData = "{}";
            Items = "[]";
            BankCode = "zalopayapp";
            Description = "Merchant pay for order #" + Helpers.getAppTransId();
            String inputHMac = String.format("%s|%s|%s|%s|%s|%s|%s",
                    this.AppId,
                    this.AppTransId,
                    this.AppUser,
                    this.Amount,
                    this.AppTime,
                    this.EmbedData,
                    this.Items);

            Mac = Helpers.getMac(AppInfo.MAC_KEY, inputHMac);
        }
    }

     public JSONObject createOrder(String amount) throws Exception {
        CreateOrderData input = new CreateOrderData(amount);

        RequestBody formBody = new FormBody.Builder()
                .add("appid", input.AppId)
                .add("appuser", input.AppUser)
                .add("apptime", input.AppTime)
                .add("amount", input.Amount)
                .add("apptransid", input.AppTransId)
                .add("embeddata", input.EmbedData)
                .add("item", input.Items)
                .add("bankcode", input.BankCode)
                .add("description", input.Description)
                .add("mac", input.Mac)
                .build();

        JSONObject data = HttpProvider.sendPost(AppInfo.URL_CREATE_ORDER, formBody);
        return data;
    }
}


```

### Service\ZaloPay\Api\HttpProvider.java
```java
package com.uit.carrental.Service.ZaloPay.Api;

import android.util.Log;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.Collections;
import java.util.concurrent.TimeUnit;

import okhttp3.CipherSuite;
import okhttp3.ConnectionSpec;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;
import okhttp3.TlsVersion;

public class HttpProvider {
     public static JSONObject sendPost(String URL, RequestBody formBody) {
        JSONObject data = new JSONObject();
        try {
            ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
                    .tlsVersions(TlsVersion.TLS_1_2)
                    .cipherSuites(
                            CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
                            CipherSuite.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
                            CipherSuite.TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)
                    .build();

            OkHttpClient client = new OkHttpClient.Builder()
                    .connectionSpecs(Collections.singletonList(spec))
                    .callTimeout(5000, TimeUnit.MILLISECONDS)
                    .build();

            Request request = new Request.Builder()
                    .url(URL)
                    .addHeader("Content-Type", "application/x-www-form-urlencoded")
                    .post(formBody)
                    .build();

            Response response = client.newCall(request).execute();

            if (!response.isSuccessful()) {
                Log.println(Log.ERROR, "BAD_REQUEST", response.body().string());
                data = null;
            } else {
                data = new JSONObject(response.body().string());
            }

        }  catch (IOException | JSONException e) {
            e.printStackTrace();
        }

        return data;
    }
}

```

### Service\ZaloPay\Constant\AppInfo.java
```java
package com.uit.carrental.Service.ZaloPay.Constant;

public class AppInfo {
    public static final int APP_ID = 553;
    public static final String MAC_KEY = "9phuAOYhan4urywHTh0ndEXiV3pKHr5Q";
    public static final String URL_CREATE_ORDER = "https://sandbox.zalopay.com.vn/v001/tpe/createorder";
}

```

### Service\ZaloPay\Helper\Helpers.java
```java
package com.uit.carrental.Service.ZaloPay.Helper;

import android.annotation.SuppressLint;

import com.uit.carrental.Service.ZaloPay.Helper.HMac.HMacUtil;

import org.jetbrains.annotations.NotNull;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Objects;

public class Helpers {
    private static int transIdDefault = 1;

    @NotNull
    @SuppressLint("DefaultLocale")
     public static String getAppTransId() {
        if (transIdDefault >= 100000) {
            transIdDefault = 1;
        }

        transIdDefault += 1;
        @SuppressLint("SimpleDateFormat") SimpleDateFormat formatDateTime = new SimpleDateFormat("yyMMdd_hhmmss");
        String timeString = formatDateTime.format(new Date());
        return String.format("%s%06d", timeString, transIdDefault);
    }

    @NotNull
    public static String getMac(@NotNull String key, @NotNull String data) throws NoSuchAlgorithmException, InvalidKeyException {
        return Objects.requireNonNull(HMacUtil.HMacHexStringEncode(HMacUtil.HMACSHA256, key, data));
     }
}

```

### Service\ZaloPay\Helper\HMac\HexStringUtil.java
```java
package com.uit.carrental.Service.ZaloPay.Helper.HMac;

import java.util.Locale;

public class HexStringUtil {
    private static final byte[] HEX_CHAR_TABLE = {
            (byte) '0', (byte) '1', (byte) '2', (byte) '3',
            (byte) '4', (byte) '5', (byte) '6', (byte) '7',
            (byte) '8', (byte) '9', (byte) 'a', (byte) 'b',
            (byte) 'c', (byte) 'd', (byte) 'e', (byte) 'f'
    };
    // @formatter:on

    /**
     * Convert a byte array to a hexadecimal string
     *
     * @param raw
     *            A raw byte array
     *
     * @return Hexadecimal string
     */
    public static String byteArrayToHexString(byte[] raw) {
        byte[] hex = new byte[2 * raw.length];
        int index = 0;

        for (byte b : raw) {
            int v = b & 0xFF;
            hex[index++] = HEX_CHAR_TABLE[v >>> 4];
            hex[index++] = HEX_CHAR_TABLE[v & 0xF];
        }
        return new String(hex);
    }

    /**
     * Convert a hexadecimal string to a byte array
     *
     * @param hex
     *            A hexadecimal string
     *
     * @return The byte array
     */
    public static byte[] hexStringToByteArray(String hex) {
        String hexstandard = hex.toLowerCase(Locale.ENGLISH);
        int sz = hexstandard.length() / 2;
        byte[] bytesResult = new byte[sz];

        int idx = 0;
        for (int i = 0; i < sz; i++) {
            bytesResult[i] = (byte) (hexstandard.charAt(idx));
            ++idx;
            byte tmp = (byte) (hexstandard.charAt(idx));
            ++idx;

            if (bytesResult[i] > HEX_CHAR_TABLE[9]) {
                bytesResult[i] -= ((byte) ('a') - 10);
            } else {
                bytesResult[i] -= (byte) ('0');
            }
            if (tmp > HEX_CHAR_TABLE[9]) {
                tmp -= ((byte) ('a') - 10);
            } else {
                tmp -= (byte) ('0');
            }

            bytesResult[i] = (byte) (bytesResult[i] * 16 + tmp);
        }
        return bytesResult;
    }
}

```

### Service\ZaloPay\Helper\HMac\HMacUtil.java
```java
package com.uit.carrental.Service.ZaloPay.Helper.HMac;

import android.os.Build;

import androidx.annotation.RequiresApi;

import java.io.UnsupportedEncodingException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.Base64;
import java.util.LinkedList;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class HMacUtil {
    public final static String HMACMD5 = "HmacMD5";
    public final static String HMACSHA1 = "HmacSHA1";
    public final static String HMACSHA256 = "HmacSHA256";
    public final static String HMACSHA512 = "HmacSHA512";
    public final static Charset UTF8CHARSET = StandardCharsets.UTF_8;

    public final static LinkedList<String> HMACS = new LinkedList<String>(Arrays.asList("UnSupport", "HmacSHA256", "HmacMD5", "HmacSHA384", "HMacSHA1", "HmacSHA512"));
    // @formatter:on

    private static byte[] HMacEncode(final String algorithm, final String key, final String data) {
        Mac macGenerator = null;
        try {
            macGenerator = Mac.getInstance(algorithm);
            SecretKeySpec signingKey = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), algorithm);
            macGenerator.init(signingKey);
        } catch (Exception ex) {
        }

        if (macGenerator == null) {
            return null;
        }

        byte[] dataByte = null;
        try {
            dataByte = data.getBytes("UTF-8");
        } catch (UnsupportedEncodingException e) {
        }

        return macGenerator.doFinal(dataByte);
    }

    /**
     * Calculating a message authentication code (MAC) involving a cryptographic
     * hash function in combination with a secret cryptographic key.
     *
     * The result will be represented base64-encoded string.
     *
     * @param algorithm A cryptographic hash function (such as MD5 or SHA-1)
     *
     * @param key A secret cryptographic key
     *
     * @param data The message to be authenticated
     *
     * @return Base64-encoded HMAC String
     */
    @RequiresApi(api = Build.VERSION_CODES.O)
    public static String HMacBase64Encode(final String algorithm, final String key, final String data) {
        byte[] hmacEncodeBytes = HMacEncode(algorithm, key, data);
        if (hmacEncodeBytes == null) {
            return null;
        }
        return Base64.getEncoder().encodeToString(hmacEncodeBytes);
    }

    /**
     * Calculating a message authentication code (MAC) involving a cryptographic
     * hash function in combination with a secret cryptographic key.
     *
     * The result will be represented hex string.
     *
     * @param algorithm A cryptographic hash function (such as MD5 or SHA-1)
     *
     * @param key A secret cryptographic key
     *
     * @param data The message to be authenticated
     *
     * @return Hex HMAC String
     */
    public static String HMacHexStringEncode(final String algorithm, final String key, final String data) {
        byte[] hmacEncodeBytes = HMacEncode(algorithm, key, data);
        if (hmacEncodeBytes == null) {
            return null;
        }
        return HexStringUtil.byteArrayToHexString(hmacEncodeBytes);
    }
}

```
