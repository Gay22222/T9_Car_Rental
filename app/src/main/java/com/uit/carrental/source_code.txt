# ==================================================
# Path: E:\UIT\HK8\NT118\Project\T9_Car_Rental\app\src\main\java\com\uit\carrental
# Detected tech: java
# ==================================================

## DIRECTORY STRUCTURE
```
carrental/
├── ActivityPages/
│   ├── CustomerMainActivity.java
│   ├── OwnerMainActivity.java
│   └── StartAppActivity.java
├── Adapter/
│   ├── ActivityAdapter.java
│   ├── NotificationAdapter.java
│   ├── OwnerActivityAdapter.java
│   ├── OwnerNotificationAdapter.java
│   ├── OwnerVehicleAdapter.java
│   ├── SplashPagerAdapter.java
│   └── VehicleAdapter.java
├── FragmentPages/
│   ├── Customer/
│   │   ├── CustomerActivityFragment.java
│   │   ├── CustomerHomeFragment.java
│   │   ├── CustomerNotificationFragment.java
│   │   └── CustomerSettingFragment.java
│   ├── Owner/
│   │   ├── OwnerActivityFragment.java
│   │   ├── OwnerNotificationsFragment.java
│   │   ├── OwnerSettingFragment.java
│   │   └── OwnerVehicleFragment.java
│   └── SplashFragment.java
├── Model/
│   ├── Activity.java
│   ├── CreateOrder.java
│   ├── Order.java
│   ├── User.java
│   ├── UserClient.java
│   ├── Vehicle.java
│   └── onClickInterface.java
└── Service/
    ├── Activity/
    │   ├── CustomerActivityDetail.java
    │   └── OwnerActivityDetail.java
    ├── Api/
    │   └── CloudinaryApi.java
    ├── Booking/
    │   ├── CarDetailActivity.java
    │   ├── RequestSuccessActivity.java
    │   └── ScheduleSelect.java
    ├── UserAuthentication/
    │   ├── CCCDActivity.java
    │   ├── ForgotPasswordActivity.java
    │   ├── GGVerrifyPhone.java
    │   ├── LoginActivity.java
    │   ├── ProfileManagement.java
    │   ├── RegisterActivity.java
    │   ├── UpdatePassword.java
    │   ├── UserProfile.java
    │   └── ValidatePhoneActivity.java
    ├── Vehicle/
    │   ├── AddVehicleActivity.java
    │   ├── UpdateVehicle.java
    │   ├── VehicleCardActivity.java
    │   └── VehicleDetailActivity.java
    └── ZaloPay/
        ├── Api/
        │   ├── CreateOrder.java
        │   └── HttpProvider.java
        ├── Constant/
        │   └── AppInfo.java
        ├── Helper/
        │   ├── HMac/
        │   │   ├── HMacUtil.java
        │   │   └── HexStringUtil.java
        │   └── Helpers.java
        └── ZPDK/
            └── zpdk-release-v3.1.aar
```

## FILE CONTENTS

### ActivityPages\CustomerMainActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.annotation.SuppressLint;
import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;

import com.uit.carrental.FragmentPages.Customer.CustomerActivityFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerHomeFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerNotificationFragment;
import com.uit.carrental.FragmentPages.Customer.CustomerSettingFragment;
import com.uit.carrental.R;
import com.uit.carrental.databinding.CustomerActivityMainBinding;

public class CustomerMainActivity extends AppCompatActivity{

    CustomerActivityMainBinding binding;
    @SuppressLint("NonConstantResourceId")
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        binding = CustomerActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());

        replaceFragment(new CustomerHomeFragment());
        binding.bottomNavigationView.setBackground(null);

        binding.bottomNavigationView.setOnItemSelectedListener(item -> {
            int itemId = item.getItemId();

            if (itemId == R.id.home) {
                replaceFragment(new CustomerHomeFragment());
            } else if (itemId == R.id.activity) {
                replaceFragment(new CustomerActivityFragment());
            } else if (itemId == R.id.notifications) {
                replaceFragment(new CustomerNotificationFragment());
            } else if (itemId == R.id.setting) {
                replaceFragment(new CustomerSettingFragment());
            }

            return true;
        });

    }

    private void replaceFragment(Fragment fragment)
    {
        FragmentManager fragmentManager = getSupportFragmentManager();
        FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
        fragmentTransaction.replace(R.id.frame_layout_customer, fragment);
        fragmentTransaction.commit();
    }

}
```

### ActivityPages\OwnerMainActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentManager;
import androidx.fragment.app.FragmentTransaction;

import com.uit.carrental.FragmentPages.Owner.OwnerActivityFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerNotificationsFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerSettingFragment;
import com.uit.carrental.FragmentPages.Owner.OwnerVehicleFragment;
import com.uit.carrental.R;
import com.uit.carrental.databinding.OwnerActivityMainBinding;

public class OwnerMainActivity extends AppCompatActivity {

    OwnerActivityMainBinding binding;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = OwnerActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        replaceFragment(new OwnerVehicleFragment());
        binding.bottomNavigationView.setBackground(null);

        binding.bottomNavigationView.setOnItemSelectedListener(item -> {
            int itemId = item.getItemId();

            if (itemId == R.id.vehicle) {
                replaceFragment(new OwnerVehicleFragment());
            } else if (itemId == R.id.activity) {
                replaceFragment(new OwnerActivityFragment());
            } else if (itemId == R.id.notifications) {
                replaceFragment(new OwnerNotificationsFragment());
            } else if (itemId == R.id.setting) {
                replaceFragment(new OwnerSettingFragment());
            }

            return true;
        });

    }

    private void replaceFragment(Fragment fragment)
    {
        FragmentManager fragmentManager = getSupportFragmentManager();
        FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
        fragmentTransaction.replace(R.id.frame_layout_owner, fragment);
        fragmentTransaction.commit();
    }
}
```

### ActivityPages\StartAppActivity.java
```java
package com.uit.carrental.ActivityPages;

import android.content.Intent;
import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.viewpager2.widget.ViewPager2;

import com.uit.carrental.Adapter.SplashPagerAdapter;
import com.uit.carrental.FragmentPages.SplashFragment;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;

public class StartAppActivity extends AppCompatActivity implements SplashFragment.OnNextButtonClickListener {

    private ViewPager2 viewPager;
    private static final int TOTAL_SPLASHES = 4;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_splash);

        viewPager = findViewById(R.id.splash_viewpager);
        SplashPagerAdapter adapter = new SplashPagerAdapter(this);
        viewPager.setAdapter(adapter);

        viewPager.setPageTransformer((page, position) -> {
            page.setAlpha(1 - Math.abs(position));
            page.setTranslationX(-position * page.getWidth());
        });
    }

    @Override
    public void onNextButtonClicked(int position) {
        if (position < TOTAL_SPLASHES - 1) {
            viewPager.setCurrentItem(position + 1, true);
        } else {
            startActivity(new Intent(this, LoginActivity.class));
            overridePendingTransition(R.anim.anim_in_right, R.anim.anim_out_left);
            finish();
        }
    }
}
```

### Adapter\ActivityAdapter.java
```java
package com.uit.carrental.Adapter;


import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.FragmentPages.Customer.CustomerActivityFragment;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.CustomerActivityDetail;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;

import java.util.ArrayList;

public class ActivityAdapter extends RecyclerView.Adapter<ActivityAdapter.MyViewHolder>{

    CustomerActivityFragment customerActivityFragment;
    Activity noti;
    ArrayList<Activity> mNoti;
    FirebaseFirestore dtb;
    String Name, ProvideID;
    public ActivityAdapter(CustomerActivityFragment mContext, ArrayList<Activity>mNoti){
        this.customerActivityFragment=mContext;
        this.mNoti=mNoti;
    }
    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(customerActivityFragment.getActivity()).inflate(R.layout.item_activity, parent, false);
        return new MyViewHolder(v);
    }
    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {
        noti = mNoti.get(position);
        dtb = FirebaseFirestore.getInstance();
        ProvideID=noti.getProvider_id();
        getuser(ProvideID);
        holder.name.setText(Name);
        holder.id.setText(noti.getNoti_id());
        if(noti.getStatus().equals( "Dang cho"))
        {
            holder.status.setText("Nhà cung cấp chưa xác nhận");
        }
        else
        {
            if(noti.getStatus().equals( "Thanh toan"))
            {
                holder.status.setText("Đang chờ thanh toán");
            }
            else
            if (noti.getStatus().equals("Khong xac nhan"))
            {
                holder.status.setText("Nhà cung cấp không xác nhận");
            }
            else
            if (noti.getStatus().equals("Da thanh toan"))
            {
                holder.status.setText("Đã thanh toán");
            }
            else {
                holder.status.setText("Đã xác nhận");
            }

        }
        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(customerActivityFragment.getActivity(), CustomerActivityDetail.class);
                intent.putExtra("NotiID", noti.getNoti_id());
                customerActivityFragment.startActivity(intent);
            }
        });
    }

    @Override
    public int getItemCount() {
        return mNoti.size();
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {

        TextView name, status,id;

        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            name = itemView.findViewById(R.id.tv_noti_name);
            status=itemView.findViewById(R.id.tv_Status);
            id=itemView.findViewById(R.id.tv_noti_ID);
        }
    }

    private void getuser(String ProvideID){
        dtb.collection("Users")
                .whereEqualTo("user_id", ProvideID)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                User user = new User();
                                user.setUser_id(document.get("user_id").toString());
                                user.setUsername(document.get("username").toString());
                                user.setEmail(document.get("email").toString());
                                user.setPhoneNumber(document.get("phoneNumber").toString());
                                Name=user.getUsername();
                            }
                        } else {

                        }
                    }
                });
    }




}

```

### Adapter\NotificationAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Context;
import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.FragmentPages.Customer.CustomerNotificationFragment;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.CustomerActivityDetail;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.firestore.FirebaseFirestore;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class NotificationAdapter extends RecyclerView.Adapter<NotificationAdapter.NotificationViewHolder> {
    private CustomerNotificationFragment customerNotificationFragment;
    //    private ArrayList<String> title, content;
    Activity noti;
    ArrayList<Activity> mNoti;
    FirebaseFirestore dtb;

    //    public NotificationAdapter(ArrayList<String> a, ArrayList<String> b) {
//        this.title = a;
//        this.content = b;
//    }
    public NotificationAdapter(CustomerNotificationFragment mContext, ArrayList<Activity> mNoti){
        this.customerNotificationFragment = mContext;
        this.mNoti=mNoti;
    }

    @NonNull
    @Override
    public NotificationViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(customerNotificationFragment.getActivity()).inflate(R.layout.item_notification, parent, false);
        return new NotificationViewHolder(v);
    }

    @Override
    public void onBindViewHolder(@NonNull NotificationViewHolder holder, int position) {
        noti = mNoti.get(position);

        if(noti.getStatus().equals( "Xac nhan"))
        {
            holder.status.setText("Nhà cung cấp đã xác nhận");
        }
        else
        {
//            if(noti.getStatus().equals( "Khong xac nhan"))
//            {
            holder.status.setText("Nhà cung cấp không xác nhận");
//            }

        }



    }

    @Override
    public int getItemCount() {
        return mNoti.size();
    }
    public  class  NotificationViewHolder extends RecyclerView.ViewHolder{
        TextView status;

        public NotificationViewHolder(@NonNull View itemView) {
            super(itemView);
            status=itemView.findViewById(R.id.tv_noti_text);

        }
    }


}

```

### Adapter\OwnerActivityAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.FragmentPages.Owner.OwnerActivityFragment;
import com.uit.carrental.Model.Activity;

import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.OwnerActivityDetail;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;

import java.util.ArrayList;

public class OwnerActivityAdapter extends RecyclerView.Adapter<OwnerActivityAdapter.MyViewHolder>{
    OwnerActivityFragment ownerActivityFragment;
    Activity noti;
    ArrayList<Activity> mNoti;

    String CustomerID, Name;
    FirebaseFirestore dtb;

    public OwnerActivityAdapter(OwnerActivityFragment mContext, ArrayList<Activity>mNoti){
        this.ownerActivityFragment=mContext;
        this.mNoti=mNoti;

    }

    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(ownerActivityFragment.getActivity()).inflate(R.layout.item_activity, parent, false);
        return new MyViewHolder(v);
    }


    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {

        noti = mNoti.get(position);
        dtb = FirebaseFirestore.getInstance();
        CustomerID=noti.getCustomer_id();
        getuser(CustomerID);
        holder.name.setText(Name);

        holder.id.setText(noti.getNoti_id());

        if(noti.getStatus().equals( "Dang cho"))
        {
            holder.status.setText("Nhà cung cấp chưa xác nhận");
        }
        else
        {
            if(noti.getStatus().equals( "Thanh toan"))
            {
                holder.status.setText("Đang chờ thanh toán");
            }
            else
            if (noti.getStatus().equals("Khong xac nhan"))
            {
                holder.status.setText("Nhà cung cấp không xác nhận");
            }
            else
            if (noti.getStatus().equals("Da thanh toan"))
            {
                holder.status.setText("Đã thanh toán");
            }
            else {
                holder.status.setText("Đã xác nhận");
            }

        }

        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(ownerActivityFragment.getActivity(), OwnerActivityDetail.class);
                intent.putExtra("NotiID", noti.getNoti_id());
                ownerActivityFragment.startActivity(intent);
            }
        });
    }

    @Override
    public int getItemCount() {
        return mNoti.size();
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {

        TextView name, status,id;

        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            name = itemView.findViewById(R.id.tv_noti_name);
            status=itemView.findViewById(R.id.tv_Status);
            id=itemView.findViewById(R.id.tv_noti_ID);


        }
    }
    private void getuser(String Customerid){
        dtb.collection("Users")
                .whereEqualTo("user_id",Customerid)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                User user = new User();
                                user.setUser_id(document.get("user_id").toString());
                                user.setUsername(document.get("username").toString());

                                Name=user.getUsername();
                            }
                        } else {

                        }
                    }
                });
    }




}

```

### Adapter\OwnerNotificationAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.FragmentPages.Owner.OwnerNotificationsFragment;
import com.uit.carrental.Model.Activity;

import com.uit.carrental.R;
import com.uit.carrental.Service.Activity.OwnerActivityDetail;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.firestore.FirebaseFirestore;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class OwnerNotificationAdapter extends RecyclerView.Adapter<OwnerNotificationAdapter.MyViewHolder>{
    //    OwnerActivityFragment ownerActivityFragment;
    OwnerNotificationsFragment ownerNotificationsFragment;
    Activity noti;
    ArrayList<Activity> mNoti;

    String CustomerID, Name;
    FirebaseFirestore dtb;



    public OwnerNotificationAdapter(OwnerNotificationsFragment mContext, ArrayList<Activity>mNoti){
        this.ownerNotificationsFragment=mContext;
        this.mNoti=mNoti;

    }

    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(ownerNotificationsFragment.getActivity()).inflate(R.layout.item_notification, parent, false);
        return new MyViewHolder(v);
    }

    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, int position) {

        noti = mNoti.get(position);


        holder.status.setText("Bạn vừa nhận 1 yêu cầu");

    }

    @Override
    public int getItemCount() {
        return mNoti.size();
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {

        TextView  status;


        public MyViewHolder(@NonNull View itemView) {
            super(itemView);

            status=itemView.findViewById(R.id.tv_noti_text);




        }
    }





}

```

### Adapter\OwnerVehicleAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.uit.carrental.FragmentPages.Owner.OwnerVehicleFragment;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.Model.onClickInterface;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.UpdateVehicle;

import java.util.ArrayList;

public class OwnerVehicleAdapter extends RecyclerView.Adapter<OwnerVehicleAdapter.MyViewHolder>{
    OwnerVehicleFragment ownerVehicleFragment;
    Vehicle vehicle;
    ArrayList<Vehicle> vehicles;
    onClickInterface onClickInterface;
    public OwnerVehicleAdapter(OwnerVehicleFragment context, ArrayList<Vehicle> vehicles, onClickInterface onClickInterface) {
        this.ownerVehicleFragment = context;
        this.vehicles = vehicles;
        this.onClickInterface = onClickInterface;
    }

    @NonNull
    @Override
    public OwnerVehicleAdapter.MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(ownerVehicleFragment.getActivity()).inflate(R.layout.vehicle_card, parent, false);
        return new MyViewHolder(v);
    }

    @Override
    public void onBindViewHolder(@NonNull OwnerVehicleAdapter.MyViewHolder holder, int position) {
        final int pos = position;
        vehicle = vehicles.get(position);
        holder.name.setText(vehicle.getVehicle_name());
        holder.price.setText(vehicle.getVehicle_price());
        holder.provider.setText(vehicle.getProvider_name());
        Glide.with(ownerVehicleFragment.getActivity()).load(vehicle.getVehicle_imageURL()).into(holder.vehicleImage);

        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                onClickInterface.setClick(pos);
                vehicle = vehicles.get(pos);
                Intent intent = new Intent(ownerVehicleFragment.getActivity(), UpdateVehicle.class);
                intent.putExtra("vehicle_id", vehicle.getVehicle_id());
                ownerVehicleFragment.startActivity(intent);
            }
        });
    }

    @Override
    public int getItemCount() {
        return vehicles.size();
    }

    public static class MyViewHolder extends RecyclerView.ViewHolder {

        TextView name, price, provider;
        ImageView vehicleImage;
        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            name = itemView.findViewById(R.id.vehicle_name);
            price = itemView.findViewById(R.id.tv_vehicle_price);
            provider = itemView.findViewById(R.id.provider_name);
            vehicleImage = itemView.findViewById(R.id.img_vehicle);
        }
    }
}

```

### Adapter\SplashPagerAdapter.java
```java
package com.uit.carrental.Adapter;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.fragment.app.FragmentActivity;
import androidx.viewpager2.adapter.FragmentStateAdapter;

import com.uit.carrental.FragmentPages.SplashFragment;
import com.uit.carrental.R;

public class SplashPagerAdapter extends FragmentStateAdapter {

    private final int[] splashLayouts = {
            R.layout.sflash_1,
            R.layout.sflash_2,
            R.layout.sflash_3,
            R.layout.sflash_4
    };

    public SplashPagerAdapter(@NonNull FragmentActivity fragmentActivity) {
        super(fragmentActivity);
    }

    @NonNull
    @Override
    public Fragment createFragment(int position) {
        return SplashFragment.newInstance(splashLayouts[position], position);
    }

    @Override
    public int getItemCount() {
        return splashLayouts.length;
    }
}
```

### Adapter\VehicleAdapter.java
```java
package com.uit.carrental.Adapter;

import android.content.Intent;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.uit.carrental.FragmentPages.Customer.CustomerHomeFragment;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.Model.onClickInterface;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.VehicleDetailActivity;

import java.util.ArrayList;

public class VehicleAdapter extends RecyclerView.Adapter<VehicleAdapter.MyViewHolder>{
    CustomerHomeFragment customerHomeFragment;
    Vehicle vehicle;
    ArrayList<Vehicle> vehicles;
    onClickInterface onClickInterface;
    public VehicleAdapter(CustomerHomeFragment context, ArrayList<Vehicle> vehicles, onClickInterface onClickInterface) {
        this.customerHomeFragment = context;
        this.vehicles = vehicles;
        this.onClickInterface = onClickInterface;
    }
    @NonNull
    @Override
    public MyViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        View v = LayoutInflater.from(customerHomeFragment.getActivity()).inflate(R.layout.vehicle_card, parent, false);
        return new MyViewHolder(v);
    }
    @Override
    public void onBindViewHolder(@NonNull MyViewHolder holder, final int position) {
        final int pos = position;
        vehicle = vehicles.get(position);
        holder.name.setText(vehicle.getVehicle_name());
        holder.price.setText(vehicle.getVehicle_price());
        holder.provider.setText(vehicle.getProvider_name());
        Glide.with(customerHomeFragment.getActivity()).load(vehicle.getVehicle_imageURL()).into(holder.vehicleImage);
        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                onClickInterface.setClick(pos);
                vehicle = vehicles.get(pos);
                Intent intent = new Intent(customerHomeFragment.getActivity(), VehicleDetailActivity.class);
                intent.putExtra("vehicle_id", vehicle.getVehicle_id());
                customerHomeFragment.startActivity(intent);
            }
        });
    }

    @Override
    public int getItemCount() {
        return vehicles.size();
    }
    public static class MyViewHolder extends RecyclerView.ViewHolder {
        TextView name, price, provider;
        ImageView vehicleImage;
        public MyViewHolder(@NonNull View itemView) {
            super(itemView);
            name = itemView.findViewById(R.id.vehicle_name);
            price = itemView.findViewById(R.id.tv_vehicle_price);
            provider = itemView.findViewById(R.id.provider_name);
            vehicleImage = itemView.findViewById(R.id.img_vehicle);
        }

    }
}
```

### FragmentPages\SplashFragment.java
```java
package com.uit.carrental.FragmentPages;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;

import com.uit.carrental.R;

public class SplashFragment extends Fragment {

    private static final String ARG_LAYOUT = "layout";
    private static final String ARG_POSITION = "position";
    private OnNextButtonClickListener listener;

    public interface OnNextButtonClickListener {
        void onNextButtonClicked(int position);
    }

    public static SplashFragment newInstance(int layoutResId, int position) {
        SplashFragment fragment = new SplashFragment();
        Bundle args = new Bundle();
        args.putInt(ARG_LAYOUT, layoutResId);
        args.putInt(ARG_POSITION, position);
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getActivity() instanceof OnNextButtonClickListener) {
            listener = (OnNextButtonClickListener) getActivity();
        }
    }

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        int layoutResId = getArguments() != null ? getArguments().getInt(ARG_LAYOUT) : R.layout.sflash_1;
        View view = inflater.inflate(layoutResId, container, false);

        Button nextButton = view.findViewById(R.id.next_button);
        int position = getArguments() != null ? getArguments().getInt(ARG_POSITION) : 0;
        nextButton.setOnClickListener(v -> {
            if (listener != null) {
                listener.onNextButtonClicked(position);
            }
        });

        return view;
    }
}
```

### FragmentPages\Customer\CustomerActivityFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.ProgressDialog;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.Adapter.ActivityAdapter;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;

import java.util.ArrayList;


public class CustomerActivityFragment extends Fragment {

    RecyclerView recyclerView;
    ActivityAdapter notificationAdapter;
    ArrayList<Activity> activities;
    FirebaseFirestore dtb_noti;
    ProgressDialog progressDialog;
    String current_user_id;
    StorageReference storageReference;
    FirebaseAuth firebaseAuth;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.customer_fragment_activity, container, false);
        recyclerView = view.findViewById(R.id.activity_list);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();

        storageReference = FirebaseStorage.getInstance().getReference();
        dtb_noti = FirebaseFirestore.getInstance();
        firebaseAuth = FirebaseAuth.getInstance();
        current_user_id = firebaseAuth.getCurrentUser().getUid();

        activities = new ArrayList<Activity>();
        notificationAdapter = new ActivityAdapter(CustomerActivityFragment.this, activities);
        recyclerView.setAdapter(notificationAdapter);

        EventChangeListener();
        progressDialog.cancel();
        return view;
    }
    private void EventChangeListener()
    {
        dtb_noti.collection("Notification")
                .whereEqualTo("customer_id", current_user_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Activity temp = new Activity();
                                temp.setNoti_id(document.get("noti_id").toString());
                                temp.setProvider_id(document.get("provider_id").toString());
                                temp.setCustomer_id(document.get("customer_id").toString());
                                temp.setStatus(document.get("status").toString());
                                temp.setVehicle_id(document.get("vehicle_id").toString());
                                activities.add(temp);
                                notificationAdapter.notifyDataSetChanged();
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin đơn hàng ", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
}
```

### FragmentPages\Customer\CustomerHomeFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.uit.carrental.Adapter.VehicleAdapter;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.Model.onClickInterface;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.VehicleDetailActivity;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.Query;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;

import java.util.ArrayList;


public class CustomerHomeFragment extends Fragment {

    ImageView imageView;
    DocumentReference imageRef;
    RecyclerView recyclerView;
    ArrayList<Vehicle> vehicles;
    VehicleAdapter adapter;
    FirebaseFirestore dtb_vehicle;
    ProgressDialog progressDialog;
    private onClickInterface onclickInterface;
    private View mView;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        mView = inflater.inflate(R.layout.customer_fragment_home, container, false);
        onclickInterface = new onClickInterface() {
            @Override
            public void setClick(int position) {
                Vehicle clickedVehicle = vehicles.get(position);
                Intent intent = new Intent(getContext(), VehicleDetailActivity.class);
                intent.putExtra("vehicle_id", clickedVehicle.getVehicle_id());
                startActivity(intent);
            }
        };


       /* progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();*/

        recyclerView = mView.findViewById(R.id.vehicle_list);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));


        dtb_vehicle = FirebaseFirestore.getInstance();
        vehicles = new ArrayList<Vehicle>();
        adapter = new VehicleAdapter(CustomerHomeFragment.this, vehicles, onclickInterface);
        recyclerView.setAdapter(adapter);

        try {
            EventChangeListener();
            //Toast.makeText(getContext(),"Catching...", Toast.LENGTH_LONG).show();
        } catch (Exception exception){
            Toast.makeText(getContext(), "Exception", Toast.LENGTH_LONG).show();
        }


        return  mView;
    }
    private void initUI() {
        /*btnMap =  mView.findViewById(R.id.locate_card);*/
    }
    private void LoadImage(String docId) {
        if (docId == null) {
            Log.e("LoadImage", "docId is null, returning");
            return;
        }
        // Reference to the image document in Firestore
        imageRef = FirebaseFirestore.getInstance().collection("Image").document(docId);

        // Get the image document
        imageRef.get().addOnSuccessListener(new OnSuccessListener<DocumentSnapshot>() {
            @Override
            public void onSuccess(DocumentSnapshot documentSnapshot) {
                if (documentSnapshot != null && documentSnapshot.exists()) {
                    // Get the image URL from the document
                    String imageUrl = documentSnapshot.getString("Image");

                    // Load the image into the ImageView
                    Glide.with(getView()).load(imageUrl).into(imageView);
                }else{
                    Log.e("LoadImage", "documentSnapshot is null or does not exists");
                }
            }
        }).addOnFailureListener(new OnFailureListener() {
            @Override
            public void onFailure(@NonNull Exception e) {
                Log.e("LoadImage", "Error: " + e.getMessage());
            }
        });
    }

    private void EventChangeListener()
    {
        dtb_vehicle.collection("Vehicles")
                .orderBy("vehicle_name", Query.Direction.ASCENDING)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Vehicle temp = new Vehicle();
                                temp.setVehicle_id(document.getId());
                                temp.setVehicle_name(document.get("vehicle_name").toString());
                                temp.setVehicle_price(document.get("vehicle_price").toString());
                                temp.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                temp.setProvider_name(document.get("provider_name").toString());
                                vehicles.add(temp);
                                adapter.notifyDataSetChanged();/*
                                progressDialog.cancel();*/
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin xe", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
}

```

### FragmentPages\Customer\CustomerNotificationFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.ProgressDialog;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;


import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.uit.carrental.Adapter.NotificationAdapter;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;
import com.mobsandgeeks.saripaar.adapter.TextViewStringAdapter;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import kotlin.collections.ArrayDeque;


public class CustomerNotificationFragment extends Fragment {
    RecyclerView recyclerView;
    NotificationAdapter notificationAdapter;
    ArrayList<Activity> notifications;
    FirebaseFirestore dtb_noti;
    ProgressDialog progressDialog;
    String current_user_id;
    StorageReference storageReference;
    FirebaseAuth firebaseAuth;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_notification, container, false);
        recyclerView = view.findViewById(R.id.frame_layout_noti);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        storageReference = FirebaseStorage.getInstance().getReference();
        dtb_noti = FirebaseFirestore.getInstance();
        firebaseAuth = FirebaseAuth.getInstance();
        current_user_id = firebaseAuth.getCurrentUser().getUid();

        notifications = new ArrayList<Activity>();
        notificationAdapter = new NotificationAdapter(CustomerNotificationFragment.this,notifications);
        recyclerView.setAdapter(notificationAdapter);

        EventChangeListener();
        return view;
    }

    private void EventChangeListener()
    {

        dtb_noti.collection("Notification")
                .whereEqualTo("customer_id", current_user_id)
//                .whereNotEqualTo("status","Dang cho")
//                .whereEqualTo("status","Xac nhan")
//                .whereEqualTo("status","Khong xac nhan")
                .whereIn("status", Arrays.asList("Xac nhan","Khong xac nhan"))
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Activity temp = new Activity();
                                temp.setNoti_id(document.get("noti_id").toString());
                                temp.setProvider_id(document.get("provider_id").toString());
                                temp.setCustomer_id(document.get("customer_id").toString());
                                temp.setStatus(document.get("status").toString());
                                temp.setVehicle_id(document.get("vehicle_id").toString());
                                notifications.add(temp);
                                notificationAdapter.notifyDataSetChanged();
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin đơn hàng ", Toast.LENGTH_SHORT).show();
                        }
                    }
                });

    }

}
```

### FragmentPages\Customer\CustomerSettingFragment.java
```java
package com.uit.carrental.FragmentPages.Customer;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;

import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;
import com.uit.carrental.Service.UserAuthentication.UpdatePassword;
import com.uit.carrental.Service.UserAuthentication.UserProfile;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.squareup.picasso.Picasso;

import de.hdodenhof.circleimageview.CircleImageView;

public class CustomerSettingFragment extends Fragment {

    private TextView tvName;
    private CircleImageView imgAvatar;

    private FirebaseFirestore dtb_user;
    private FirebaseUser firebaseUser;
    private User user = new User();

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.customer_fragment_setting,
                container, false);

        imgAvatar = view.findViewById(R.id.img_avatar);
        tvName = view.findViewById(R.id.tv_name);

        dtb_user = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        user.setUser_id(firebaseUser.getUid());

        dtb_user.collection("Users")
                .whereEqualTo("user_id", user.getUser_id())
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()){
                            for (QueryDocumentSnapshot document : task.getResult()){
                                tvName.setText(document.get("username").toString());
                                user.setAvatarURL(document.get("avatarURL").toString());
                                if (!document.get("avatarURL").toString().isEmpty()) {
                                    Picasso.get().load(user.getAvatarURL()).into(imgAvatar);
                                }
                                else {
                                    user.setAvatarURL("");
                                }
                            }
                        }
                        else {
                            //
                            Toast.makeText(view.getContext(), "Không thể lấy thông tin", Toast.LENGTH_LONG).show();
                        }
                    }
                });


        LinearLayout connect = view.findViewById(R.id.layout_connect);
        connect.setOnClickListener(v -> {
            FirebaseUser firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
            if (firebaseUser == null) return;

            FirebaseFirestore db = FirebaseFirestore.getInstance();
            db.collection("Users").document(firebaseUser.getUid())
                    .update("currentRole", "owner")
                    .addOnSuccessListener(aVoid -> {
                        Toast.makeText(getContext(), "Đã chuyển sang giao diện chủ xe!", Toast.LENGTH_SHORT).show();
                        Intent intent = new Intent(getActivity(), OwnerMainActivity.class);
                        startActivity(intent);
                        requireActivity().finish();
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(getContext(), "Chuyển vai trò thất bại.", Toast.LENGTH_SHORT).show();
                    });
        });


        LinearLayout changePass = (LinearLayout) view.findViewById(R.id.layout_change_password);
        changePass.setOnClickListener(new View.OnClickListener()
        {
            @Override
            public void onClick(View v)
            {
                Intent i = new Intent(getActivity(), UpdatePassword.class);
                startActivity(i);
                ((Activity) getActivity()).overridePendingTransition(0, 0);
            }
        });



        LinearLayout profile = (LinearLayout) view.findViewById(R.id.layout_information);
        profile.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent i = new Intent(getActivity(), UserProfile.class);
                startActivity(i);
                ((Activity) getActivity()).overridePendingTransition(0, 0);
            }
        });

        LinearLayout delete = (LinearLayout) view.findViewById(R.id.layout_delete_account);
        delete.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                FirebaseUser user = FirebaseAuth.getInstance().getCurrentUser();

                if (user != null) {
                    user.delete()
                            .addOnCompleteListener(new OnCompleteListener<Void>() {
                                @Override
                                public void onComplete(@NonNull Task<Void> task) {
                                    if (task.isSuccessful()) {
                                        Toast.makeText(view.getContext(), "User account deleted.", Toast.LENGTH_LONG).show();
                                        Intent intent = new Intent(getActivity(), LoginActivity.class);
                                        startActivity(intent);
                                        ((Activity) getActivity()).overridePendingTransition(0, 0);
                                    } else {
                                        Toast.makeText(view.getContext(), "Failed to delete user account.", Toast.LENGTH_LONG).show();
                                    }
                                }
                            });
                }
            }
        });

        LinearLayout signOut = (LinearLayout) view.findViewById(R.id.layout_sign_out);
        signOut.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                FirebaseAuth.getInstance().signOut();

                Intent intent = new Intent(getActivity(), LoginActivity.class);
                startActivity(intent);
                ((Activity) getActivity()).overridePendingTransition(0, 0);
            }
        });
        return view;
        /*        return inflater.inflate(R.layout.customer_fragment_user, container, false);*/
    }

}
```

### FragmentPages\Owner\OwnerActivityFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.ProgressDialog;
import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Toast;

import com.uit.carrental.Adapter.OwnerActivityAdapter;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;

import java.util.ArrayList;

public class OwnerActivityFragment extends Fragment {

    RecyclerView recyclerView;
    OwnerActivityAdapter ownerActivityAdapter;
    ArrayList<Activity> activities;
    FirebaseFirestore dtb_noti;
    ProgressDialog progressDialog;
    String current_user_id;
    StorageReference storageReference;
    FirebaseAuth firebaseAuth;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.customer_fragment_activity, container, false);
        recyclerView = view.findViewById(R.id.activity_list);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();

        storageReference = FirebaseStorage.getInstance().getReference();
        dtb_noti = FirebaseFirestore.getInstance();
        firebaseAuth = FirebaseAuth.getInstance();
        current_user_id = firebaseAuth.getCurrentUser().getUid();

        activities = new ArrayList<Activity>();
        ownerActivityAdapter = new OwnerActivityAdapter(OwnerActivityFragment.this, activities);
        recyclerView.setAdapter(ownerActivityAdapter);

        EventChangeListener();

        progressDialog.dismiss();
        return view;
    }
    private void EventChangeListener()
    {

        dtb_noti.collection("Notification")
                .whereEqualTo("provider_id", current_user_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Activity temp = new Activity();
                                temp.setNoti_id(document.get("noti_id").toString());
                                temp.setProvider_id(document.get("provider_id").toString());
                                temp.setCustomer_id(document.get("customer_id").toString());
                                temp.setStatus(document.get("status").toString());
                                temp.setVehicle_id(document.get("vehicle_id").toString());
                                activities.add(temp);
                                ownerActivityAdapter.notifyDataSetChanged();
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin đơn hàng ", Toast.LENGTH_SHORT).show();
                        }
                    }
                });

    }
}
```

### FragmentPages\Owner\OwnerNotificationsFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.ProgressDialog;
import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Toast;

import com.uit.carrental.Adapter.NotificationAdapter;
import com.uit.carrental.Adapter.OwnerNotificationAdapter;
import com.uit.carrental.FragmentPages.Customer.CustomerNotificationFragment;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;

import java.util.ArrayList;
import java.util.Arrays;

public class OwnerNotificationsFragment extends Fragment {
    RecyclerView recyclerView;
    //    NotificationAdapter notificationAdapter;
    OwnerNotificationAdapter ownerNotificationAdapter;
    ArrayList<Activity> notifications;
    FirebaseFirestore dtb_noti;
    ProgressDialog progressDialog;
    String current_user_id;
    StorageReference storageReference;
    FirebaseAuth firebaseAuth;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.customer_fragment_notification, container, false);
        recyclerView = view.findViewById(R.id.frame_layout_noti);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));

        storageReference = FirebaseStorage.getInstance().getReference();
        dtb_noti = FirebaseFirestore.getInstance();
        firebaseAuth = FirebaseAuth.getInstance();
        current_user_id = firebaseAuth.getCurrentUser().getUid();

        notifications = new ArrayList<Activity>();
        ownerNotificationAdapter = new OwnerNotificationAdapter(OwnerNotificationsFragment.this,notifications);
        recyclerView.setAdapter(ownerNotificationAdapter);

        EventChangeListener();
        return view;
    }
    private void EventChangeListener()
    {

        dtb_noti.collection("Notification")
                .whereEqualTo("provider_id", current_user_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Activity temp = new Activity();
                                temp.setNoti_id(document.get("noti_id").toString());
                                temp.setProvider_id(document.get("provider_id").toString());
                                temp.setCustomer_id(document.get("customer_id").toString());
                                temp.setStatus(document.get("status").toString());
                                temp.setVehicle_id(document.get("vehicle_id").toString());

                                notifications.add(temp);
                                ownerNotificationAdapter.notifyDataSetChanged();
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin đơn hàng ", Toast.LENGTH_SHORT).show();
                        }
                    }
                });

    }
}
```

### FragmentPages\Owner\OwnerSettingFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.squareup.picasso.Picasso;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Service.UserAuthentication.ProfileManagement;
import com.uit.carrental.R;
import com.uit.carrental.Service.UserAuthentication.ForgotPasswordActivity;
import com.uit.carrental.Service.UserAuthentication.LoginActivity;

import de.hdodenhof.circleimageview.CircleImageView;


public class OwnerSettingFragment extends Fragment {

    private TextView tvName;
    private CircleImageView imgAvatar;
    private FirebaseFirestore dtb_user;
    private FirebaseUser firebaseUser;
    private FirebaseAuth mAuth;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.owner_fragment_setting, container, false);

        imgAvatar = view.findViewById(R.id.img_avatar);
        tvName = view.findViewById(R.id.tv_name);

        dtb_user = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        mAuth = FirebaseAuth.getInstance();

        if (firebaseUser != null) {
            dtb_user.collection("Users")
                    .document(firebaseUser.getUid())
                    .get()
                    .addOnSuccessListener(documentSnapshot -> {
                        if (documentSnapshot.exists()) {
                            String username = documentSnapshot.getString("username");
                            String avatarURL = documentSnapshot.getString("avatarURL");

                            if (username != null) {
                                tvName.setText(username);
                            }
                            if (avatarURL != null && !avatarURL.isEmpty()) {
                                Picasso.get().load(avatarURL).into(imgAvatar);
                            }
                        }
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(view.getContext(), "Không thể lấy thông tin.", Toast.LENGTH_SHORT).show();
                    });
        }

        // Sự kiện các nút
        LinearLayout profile = view.findViewById(R.id.layout_information);
        LinearLayout password = view.findViewById(R.id.layout_change_password);
        LinearLayout deleteAccount = view.findViewById(R.id.layout_delete_account);
        LinearLayout logout = view.findViewById(R.id.layout_sign_out);
        LinearLayout connect = view.findViewById(R.id.layout_connect);


        profile.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ProfileManagement.class));
            ((Activity) getActivity()).overridePendingTransition(0, 0);
        });

        password.setOnClickListener(v -> {
            startActivity(new Intent(getActivity(), ForgotPasswordActivity.class));
            ((Activity) getActivity()).overridePendingTransition(0, 0);
        });

        deleteAccount.setOnClickListener(v -> {
            if (firebaseUser == null) return;

            dtb_user.collection("Users").document(firebaseUser.getUid())
                    .delete()
                    .addOnSuccessListener(aVoid -> {
                        firebaseUser.delete().addOnCompleteListener(task -> {
                            Toast.makeText(getContext(), "Đã xóa tài khoản!", Toast.LENGTH_SHORT).show();
                            startActivity(new Intent(getActivity(), LoginActivity.class));
                            requireActivity().finish();
                        });
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(getContext(), "Xóa tài khoản thất bại.", Toast.LENGTH_SHORT).show();
                    });
        });

        logout.setOnClickListener(v -> {
            mAuth.signOut();
            startActivity(new Intent(getActivity(), LoginActivity.class));
            requireActivity().finish();
        });

        connect.setOnClickListener(v -> {
            if (firebaseUser == null) return;

            dtb_user.collection("Users")
                    .document(firebaseUser.getUid())
                    .update("currentRole", "customer")
                    .addOnSuccessListener(aVoid -> {
                        Toast.makeText(getContext(), "Đã chuyển sang giao diện khách hàng!", Toast.LENGTH_SHORT).show();
                        startActivity(new Intent(getActivity(), CustomerMainActivity.class));
                        requireActivity().finish();
                    })
                    .addOnFailureListener(e -> {
                        Toast.makeText(getContext(), "Chuyển vai trò thất bại.", Toast.LENGTH_SHORT).show();
                    });
        });

        return view;
    }
}

```

### FragmentPages\Owner\OwnerVehicleFragment.java
```java
package com.uit.carrental.FragmentPages.Owner;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.fragment.app.Fragment;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.Toast;

import com.bumptech.glide.Glide;
import com.uit.carrental.Adapter.OwnerVehicleAdapter;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.Model.onClickInterface;
import com.uit.carrental.R;
import com.uit.carrental.Service.Vehicle.AddVehicleActivity;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.Query;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;

import java.util.ArrayList;

public class OwnerVehicleFragment extends Fragment {

    ImageView imageView;
    DocumentReference imageRef;
    RecyclerView recyclerView;
    ArrayList<Vehicle> vehicles;
    OwnerVehicleAdapter adapter;

    FirebaseFirestore dtb_vehicle;
    private FirebaseUser firebaseUser;
    private User user = new User();
    private onClickInterface onclickInterface;

    ProgressDialog progressDialog;
    private View view;
    private Button btnAdd;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        view = inflater.inflate(R.layout.owner_fragment_vehicle, container, false);
        btnAdd = (Button) view.findViewById(R.id.btn_add);
        onclickInterface = new onClickInterface() {
            @Override
            public void setClick(int position) {
                vehicles.indexOf(position);
                Log.d("Position: ","Position is " + position);
                adapter.notifyDataSetChanged();
            }
        };
        btnAdd.setOnClickListener(new View.OnClickListener()
        {
            @Override
            public void onClick(View v)
            {
                Intent i = new Intent(getActivity(), AddVehicleActivity.class);
                startActivity(i);
                ((Activity) getActivity()).overridePendingTransition(0, 0);
            }
        });


/*        progressDialog = new ProgressDialog(getActivity());
        progressDialog.setCancelable(false);
        progressDialog.setMessage("Đang lấy dữ liệu...");
        progressDialog.show();*/

        recyclerView = view.findViewById(R.id.vehicle_list);
        recyclerView.setHasFixedSize(true);
        recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));

        dtb_vehicle = FirebaseFirestore.getInstance();
        vehicles = new ArrayList<Vehicle>();
        adapter = new OwnerVehicleAdapter(OwnerVehicleFragment.this, vehicles, onclickInterface);
        recyclerView.setAdapter(adapter);

        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        user.setUser_id(firebaseUser.getUid());

        try {
            EventChangeListener();
            //Toast.makeText(getContext(),"Catching...", Toast.LENGTH_LONG).show();
        } catch (Exception exception){
            Toast.makeText(getContext(), "Exception", Toast.LENGTH_LONG).show();
        }

        return view;
    }

    private void LoadImage(String docId) {
        if (docId == null) {
            Log.e("LoadImage", "docId is null, returning");
            return;
        }
        // Reference to the image document in Firestore
        imageRef = FirebaseFirestore.getInstance().collection("Image").document(docId);

        // Get the image document
        imageRef.get().addOnSuccessListener(new OnSuccessListener<DocumentSnapshot>() {
            @Override
            public void onSuccess(DocumentSnapshot documentSnapshot) {
                if (documentSnapshot != null && documentSnapshot.exists()) {
                    // Get the image URL from the document
                    String imageUrl = documentSnapshot.getString("Image");

                    // Load the image into the ImageView
                    Glide.with(getView()).load(imageUrl).into(imageView);
                }else{
                    Log.e("LoadImage", "documentSnapshot is null or does not exists");
                }
            }
        }).addOnFailureListener(new OnFailureListener() {
            @Override
            public void onFailure(@NonNull Exception e) {
                Log.e("LoadImage", "Error: " + e.getMessage());
            }
        });
    }
    private void EventChangeListener()
    {
        dtb_vehicle.collection("Vehicles")
                .whereEqualTo("provider_id", user.getUser_id())
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                Vehicle temp = new Vehicle();
                                temp.setVehicle_id(document.getId());
                                temp.setVehicle_name(document.get("vehicle_name").toString());
                                temp.setVehicle_price(document.get("vehicle_price").toString());
                                temp.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                temp.setProvider_name(document.get("provider_name").toString());
                                vehicles.add(temp);
                                adapter.notifyDataSetChanged();
                                /*                                progressDialog.cancel();*/
                            }
                        } else {
                            Toast.makeText(getContext(), "Không thể lấy thông tin xe", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
}
```

### Model\Activity.java
```java
package com.uit.carrental.Model;


public class Activity {
    private String customer_id;
    private String provider_id;
    private String status;
    private String noti_id;
    private String vehicle_id;

    private String dropoff;

    private String pickup;

    public Activity()

    {

    }

    public Activity(String customer_id, String provide_id, String status, String noti_id, String vehicle_id) {
        this.customer_id = customer_id;
        this.provider_id = provide_id;
        this.status = status;
        this.noti_id = noti_id;
        this.vehicle_id = vehicle_id;
    }

    public String getCustomer_id() {
        return customer_id;
    }

    public void setCustomer_id(String customer_id) {
        this.customer_id = customer_id;
    }

    public String getProvider_id() {
        return provider_id;
    }

    public void setProvider_id(String provide_id) {
        this.provider_id = provide_id;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getNoti_id() {
        return noti_id;
    }

    public void setNoti_id(String noti_id) {
        this.noti_id = noti_id;
    }

    public String getVehicle_id() {
        return vehicle_id;
    }

    public void setVehicle_id(String vehicle_id) {
        this.vehicle_id = vehicle_id;
    }

    public void setPickup(String pickup) {
        this.pickup = pickup;

    }

    public void setDropoff(String dropoff) {
        this.dropoff = dropoff;
    }

    public String getDropoff() {
        return dropoff;
    }

    public String getPickup() {
        return pickup;
    }

}

```

### Model\CreateOrder.java
```java
//// File: CreateOrder.java
//package com.uit.carrental.Model;
//
//import android.os.Build;
//import androidx.annotation.RequiresApi;
//
//import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
//import com.uit.carrental.Service.ZaloPay.Helper.HMac.HMacUtil;
//
//import org.json.JSONObject;
//
//import java.io.OutputStream;
//import java.net.HttpURLConnection;
//import java.net.URL;
//import java.nio.charset.StandardCharsets;
//import java.text.SimpleDateFormat;
//import java.util.Date;
//import java.util.TimeZone;
//
//public class CreateOrder {
//
//    @RequiresApi(api = Build.VERSION_CODES.O)
//    public JSONObject createOrder(String appTransId) {
//        try {
//            long amount = 1000; // có thể lấy từ amount ngoài truyền vào
//
//            // Lấy thời gian theo chuẩn GMT+7
//            SimpleDateFormat sdf = new SimpleDateFormat("yyMMdd");
//            sdf.setTimeZone(TimeZone.getTimeZone("GMT+7"));
//            String appTime = sdf.format(new Date());
//
//            JSONObject order = new JSONObject();
//            order.put("app_id", AppInfo.APP_ID);
//            order.put("app_user", "user123"); // user định danh (tuỳ chỉnh)
//            order.put("app_time", System.currentTimeMillis()); // thời gian tạo đơn
//            order.put("amount", amount);
//            order.put("app_trans_id", appTime + "_" + appTransId); // định dạng yêu cầu
//            order.put("embed_data", "{}");
//            order.put("item", "[]");
//            order.put("description", "Thanh toán đơn thuê xe CarRental: " + appTransId);
//            order.put("bank_code", "zalopayapp"); // App mobile payment
//
//            // Build data to hash
//            String data = AppInfo.APP_ID + "|" + appTime + "_" + appTransId + "|" + AppInfo.APP_USER + "|" + amount + "|" + AppInfo.APP_NAME + "|{}|[]";
//            String mac = HMacUtil.HMacHexStringEncode("HmacSHA256", AppInfo.MAC_KEY, data);
//            order.put("mac", mac);
//
//            // Gửi HTTP request
//            URL url = new URL(AppInfo.URL_CREATE_ORDER);
//            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
//            connection.setRequestMethod("POST");
//            connection.setRequestProperty("Content-Type", "application/json");
//            connection.setDoOutput(true);
//
//            OutputStream os = connection.getOutputStream();
//            os.write(order.toString().getBytes(StandardCharsets.UTF_8));
//            os.close();
//
//            int responseCode = connection.getResponseCode();
//            if (responseCode == HttpURLConnection.HTTP_OK) {
//                java.util.Scanner s = new java.util.Scanner(connection.getInputStream()).useDelimiter("\\A");
//                String response = s.hasNext() ? s.next() : "";
//                s.close();
//                return new JSONObject(response);
//            } else {
//                throw new RuntimeException("Failed : HTTP error code : " + responseCode);
//            }
//        } catch (Exception e) {
//            e.printStackTrace();
//            return null;
//        }
//    }
//}

```

### Model\onClickInterface.java
```java
package com.uit.carrental.Model;
public interface onClickInterface {
    void setClick(int position);
}

```

### Model\Order.java
```java
package com.uit.carrental.Model;

public class Order {
    private String CustomerID;
    private String OrderID;
    private String ProvideID;
    private String vehicle_id;

    public Order() {

    }

    public Order(String customerID, String orderID, String provideID, String vehicl_id) {
        CustomerID = customerID;
        OrderID = orderID;
        ProvideID = provideID;
        vehicle_id = vehicl_id;

    }

    public String getCustomerID() {
        return CustomerID;
    }

    public void setCustomerID(String customerID) {
        CustomerID = customerID;
    }

    public String getOrderID() {
        return OrderID;
    }

    public void setOrderID(String orderID) {
        OrderID = orderID;
    }

    public String getProvideID() {
        return ProvideID;
    }

    public void setProvideID(String provideID) {
        ProvideID = provideID;
    }

    public String getVehicle_id() {
        return vehicle_id;
    }

    public void setVehicle_id(String vehicle_id) {
        this.vehicle_id = vehicle_id;
    }
}


```

### Model\User.java
```java
package com.uit.carrental.Model;

import android.os.Parcel;
import android.os.Parcelable;
import java.util.Map;

public class User implements Parcelable {

    private String email;
    private String user_id;
    private String username;
    private String avatarURL;
    private String birthday;
    private String phoneNumber;
    private String address;
    private String city;
    private String ciCardFront;
    private String ciCardBehind;
    private String role;
    private Map<String, Boolean> roles;
    private String currentRole;

    public User() {
        address = "";
        email = "";
        user_id = "";
        username = "";
        avatarURL = "";
        birthday = "";
        phoneNumber = "";
        city = "";
        ciCardFront = "";
        ciCardBehind = "";
    }

    protected User(Parcel in) {
        email = in.readString();
        user_id = in.readString();
        username = in.readString();
        avatarURL = in.readString();
        birthday = in.readString();
        phoneNumber = in.readString();
        address = in.readString();
        city = in.readString();
        ciCardFront = in.readString();
        ciCardBehind = in.readString();
    }

    public static final Creator<User> CREATOR = new Creator<User>() {
        @Override
        public User createFromParcel(Parcel in) {
            return new User(in);
        }

        @Override
        public User[] newArray(int size) {
            return new User[size];
        }
    };

    // --- Getter và Setter ---
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getUser_id() { return user_id; }
    public void setUser_id(String user_id) { this.user_id = user_id; }

    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }

    public String getAvatarURL() { return avatarURL; }
    public void setAvatarURL(String avatarURL) { this.avatarURL = avatarURL; }

    public String getBirthday() { return birthday; }
    public void setBirthday(String birthday) { this.birthday = birthday; }

    public String getPhoneNumber() { return phoneNumber; }
    public void setPhoneNumber(String phoneNumber) { this.phoneNumber = phoneNumber; }

    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }

    public String getCity() { return city; }
    public void setCity(String city) { this.city = city; }

    public String getCiCardFront() { return ciCardFront; }
    public void setCiCardFront(String ciCardFront) { this.ciCardFront = ciCardFront; }

    public String getCiCardBehind() { return ciCardBehind; }
    public void setCiCardBehind(String ciCardBehind) { this.ciCardBehind = ciCardBehind; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }

    public Map<String, Boolean> getRoles() { return roles; }
    public void setRoles(Map<String, Boolean> roles) { this.roles = roles; }

    public String getCurrentRole() { return currentRole; }
    public void setCurrentRole(String currentRole) { this.currentRole = currentRole; }

    // --- Parcelable ---
    @Override
    public int describeContents() { return 0; }

    @Override
    public void writeToParcel(Parcel dest, int flags) {
        dest.writeString(email);
        dest.writeString(user_id);
        dest.writeString(username);
        dest.writeString(avatarURL);
        dest.writeString(birthday);
        dest.writeString(phoneNumber);
        dest.writeString(address);
        dest.writeString(city);
        dest.writeString(ciCardFront);
        dest.writeString(ciCardBehind);
    }
}

```

### Model\UserClient.java
```java
package com.uit.carrental.Model;


import android.app.Application;

import com.uit.carrental.Model.User;


public class UserClient extends Application {

    private User user = null;

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

}

```

### Model\Vehicle.java
```java
package com.uit.carrental.Model;

public class Vehicle {
    String vehicle_id, provider_id, provider_name;
    String owner_name, provider_gmail, provider_phone, provider_address;
    String vehicle_name, vehicle_price, vehicle_seats, vehicle_number, vehicle_availability;
    String vehicle_imageURL;


    public Vehicle() {
        this.vehicle_id = "";
        this.owner_name = "";
        this.provider_id = "";
        this.provider_name = "";
        this.provider_gmail = "";
        this.provider_phone = "";
        this.provider_address = "";
        this.vehicle_name = "";
        this.vehicle_price = "";
        this.vehicle_seats = "";
        this.vehicle_number = "";
        this.vehicle_availability = "";
        this.vehicle_imageURL = "";
    }

    public Vehicle(String vehicle_id, String provider_id, String provider_name, String owner_name, String provider_gmail, String provider_phone, String provider_address, String vehicle_name, String vehicle_price, String vehicle_seats, String vehicle_number, String vehicle_availability, String vehicle_imageURL) {
        this.vehicle_id = vehicle_id;
        this.owner_name = owner_name;
        this.provider_id = provider_id;
        this.provider_name = provider_name;
        this.provider_gmail = provider_gmail;
        this.provider_phone = provider_phone;
        this.provider_address = provider_address;
        this.vehicle_name = vehicle_name;
        this.vehicle_price = vehicle_price;
        this.vehicle_seats = vehicle_seats;
        this.vehicle_number = vehicle_number;
        this.vehicle_availability = vehicle_availability;
        this.vehicle_imageURL = vehicle_imageURL;
    }

    public String getProvider_id() {
        return provider_id;
    }

    public void setProvider_id(String provider_id) {
        this.provider_id = provider_id;
    }

    public String getProvider_name() {
        return provider_name;
    }

    public void setProvider_name(String provider_name) {
        this.provider_name = provider_name;
    }

    public String getVehicle_id() {
        return vehicle_id;
    }

    public void setVehicle_id(String vehicle_id) {
        this.vehicle_id = vehicle_id;
    }

    public String getOwner_name() {
        return owner_name;
    }

    public void setOwner_name(String owner_name) {
        this.owner_name = owner_name;
    }

    public String getProvider_gmail() {
        return provider_gmail;
    }

    public void setProvider_gmail(String provider_gmail) {
        this.provider_gmail = provider_gmail;
    }

    public String getProvider_phone() {
        return provider_phone;
    }

    public void setProvider_phone(String provider_phone) {
        this.provider_phone = provider_phone;
    }

    public String getProvider_address() {
        return provider_address;
    }

    public void setProvider_address(String provider_address) {
        this.provider_address = provider_address;
    }

    public String getVehicle_name() {
        return vehicle_name;
    }

    public void setVehicle_name(String vehicle_name) {
        this.vehicle_name = vehicle_name;
    }

    public String getVehicle_price() {
        return vehicle_price;
    }

    public void setVehicle_price(String vehicle_price) {
        this.vehicle_price = vehicle_price;
    }

    public String getVehicle_seats() {
        return vehicle_seats;
    }

    public void setVehicle_seats(String vehicle_seats) {
        this.vehicle_seats = vehicle_seats;
    }

    public String getVehicle_number() {
        return vehicle_number;
    }

    public void setVehicle_number(String vehicle_number) {
        this.vehicle_number = vehicle_number;
    }

    public String getVehicle_availability() {
        return vehicle_availability;
    }

    public void setVehicle_availability(String vehicle_availability) {
        this.vehicle_availability = vehicle_availability;
    }

    public String getVehicle_imageURL() {
        return vehicle_imageURL;
    }

    public void setVehicle_imageURL(String vehicle_imageURL) {
        this.vehicle_imageURL = vehicle_imageURL;
    }

}

```

### Service\Activity\CustomerActivityDetail.java
```java
package com.uit.carrental.Service.Activity;

import android.annotation.SuppressLint;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.StrictMode;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.RequiresApi;
import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Service.ZaloPay.Api.CreateOrder;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.firestore.SetOptions;
import com.squareup.picasso.Picasso;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.OnFailureListener;

import org.json.JSONObject;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import vn.zalopay.sdk.Environment;
import vn.zalopay.sdk.ZaloPayError;
import vn.zalopay.sdk.ZaloPaySDK;
import vn.zalopay.sdk.listeners.PayOrderListener;

import com.google.firebase.Timestamp;
import java.util.Date;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class CustomerActivityDetail extends AppCompatActivity {

    FirebaseFirestore dtb;
    CreateOrder orderApi;
    Intent intent;
    String ProvideID, vehicle_id, ownername, owneremail, ownerphone, vehiclename, vehicleprice, vehicleaddress, vehiclepickup, vehicledrop, totalcost;
    String NotiID,noti_status;
    String amount = "1000";
    String token;
    String orderId ;
    int bit;
    ImageView vehicleImage;
    String vnp_url, vnp_tmnCode;
    FirebaseFirestore db = FirebaseFirestore.getInstance();
    private ArrayList<Vehicle> ls = new ArrayList<Vehicle>();
    private TextView tv_id,name,email,phoneNumber, tv_status;// Thông tin nhà cung cấp
    private TextView tv_BrandCar,tv_Gia,tv_DiaDiem,pickup,dropoff,totalCost;// Thông tin xe
    private Button btn_payment, btn_back;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.customer_booking_detail);
        intent = getIntent();

        String OrderID = intent.getStringExtra("NotiID");
        NotiID = OrderID;

        init();

        StrictMode.ThreadPolicy policy = new
                StrictMode.ThreadPolicy.Builder().permitAll().build();
        StrictMode.setThreadPolicy(policy);

        ZaloPaySDK.init(AppInfo.APP_ID, Environment.SANDBOX);

        dtb = FirebaseFirestore.getInstance();
        dtb.collection("Notification")
                .whereEqualTo("noti_id", NotiID)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                Activity temp = new Activity();
                                temp.setNoti_id(document.getId());
                                temp.setProvider_id(document.getString("provider_id"));
                                temp.setVehicle_id(document.getString("vehicle_id"));
                                temp.setStatus(document.getString("status"));
                                temp.setPickup(document.getString("pickup"));
                                temp.setDropoff(document.getString("dropoff"));

                                vehiclepickup = temp.getPickup();
                                vehicledrop = temp.getDropoff();
                                ProvideID = temp.getProvider_id();
                                vehicle_id = temp.getVehicle_id();
                                noti_status = temp.getStatus();

                                if (document.contains("order_id")) {
                                    orderId = document.getString("order_id");
                                    Log.e("OrderID", "order_id: " + orderId);
                                }

                                tv_id.setText(NotiID);
                                updateStatusAndButton(noti_status);

                                getuser(ProvideID);
                                getvehicle(vehicle_id);
                            }
                        } else {
                            Toast.makeText(CustomerActivityDetail.this, "Không thể lấy thông báo", Toast.LENGTH_SHORT).show();
                        }
                    }

                    private void updateStatusAndButton(String status) {
                        switch (status) {
                            case "Dang cho":
                                tv_status.setText("Chưa được xác nhận");
                                btn_payment.setVisibility(View.GONE);
                                break;
                            case "Xac nhan":
                                tv_status.setText("Đã xác nhận");
                                btn_payment.setVisibility(View.VISIBLE);
                                break;
                            case "Thanh toan":
                                tv_status.setText("Đang chờ thanh toán");
                                btn_payment.setVisibility(View.VISIBLE);
                                break;
                            case "Khong duoc xac nhan":
                                tv_status.setText("Không được xác nhận");
                                btn_payment.setVisibility(View.GONE);
                                break;
                            default:
                                tv_status.setText("Đã thanh toán");
                                btn_payment.setVisibility(View.GONE);
                                break;
                        }
                    }

                });


        btn_payment.setOnClickListener(v -> {
            if (orderId != null) {
                createOrderAndPay(); // --- CHỈNH SỬA ---
            } else {
                Toast.makeText(this, "Không tìm thấy order_id!", Toast.LENGTH_SHORT).show();
            }
        });
        btn_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                finish();
            }
        });

    }
    private void postpayment() {
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        String orderId = intent.getStringExtra("order_id");

        Map<String, Object> updateData = new HashMap<>();
        updateData.put("payment_status", "paid");
        updateData.put("status", "processing");

        db.collection("Orders")
                .document(orderId)
                .update(updateData)
                .addOnSuccessListener(new OnSuccessListener<Void>() {
                    @Override
                    public void onSuccess(Void unused) {
                        Log.e("Payment Update", "Cập nhật trạng thái thành công!");
                    }
                })
                .addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Log.e("Payment Update", "Cập nhật thất bại: " + e.getMessage());
                    }
                });
    }
    @RequiresApi(api = Build.VERSION_CODES.O)
    private void createOrderAndPay() { // --- CHỈNH SỬA ---
        try {
            CreateOrder createOrder = new CreateOrder();
            JSONObject data = createOrder.createOrder(amount);

            if (data == null) {
                Toast.makeText(this, "Không thể tạo đơn hàng!", Toast.LENGTH_SHORT).show();
                return;
            }

            String code = data.getString("returncode");
            if ("1".equals(code)) {
                String token = data.getString("zptranstoken");
                checkout(token);
            } else {
                Toast.makeText(this, "Lỗi tạo đơn hàng!", Toast.LENGTH_SHORT).show();
            }
        } catch (Exception e) {
            Log.e("ZaloPay", "Exception: " + e.getMessage());
            Toast.makeText(this, "Exception: " + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }


    private void updateOrderAfterPayment(String orderId, String providerId) {
        FirebaseFirestore db = FirebaseFirestore.getInstance();

        // Update Order
        Map<String, Object> updates = new HashMap<>();
        updates.put("status", "Đã thanh toán");
        updates.put("payment_method", "zalo_pay");

        db.collection("Orders").document(orderId)
                .update(updates)
                .addOnSuccessListener(aVoid -> {
                    Toast.makeText(this, "Thanh toán thành công!", Toast.LENGTH_SHORT).show();

                    // Tạo Notification cho chủ xe
                    createPaymentSuccessNotification(providerId);

                    // Chuyển màn
                    Intent intent = new Intent(this, CustomerMainActivity.class); // hoặc RequestSuccessActivity.class
                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);
                    startActivity(intent);
                    finish();
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(this, "Có lỗi khi cập nhật đơn hàng.", Toast.LENGTH_SHORT).show();
                });
    }

    private void createPaymentSuccessNotification(String providerId) {
        FirebaseFirestore db = FirebaseFirestore.getInstance();

        Map<String, Object> notification = new HashMap<>();
        notification.put("user_id", providerId);
        notification.put("title", "Thanh toán thành công");
        notification.put("content", "Khách hàng đã thanh toán đơn thuê xe của bạn.");
        notification.put("timestamp", new Timestamp(new Date()));
        notification.put("status", "unread");

        db.collection("Notifications")
                .add(notification)
                .addOnSuccessListener(documentReference -> {
                    // Notification đã được tạo cho chủ xe
                })
                .addOnFailureListener(e -> {
                    // Có lỗi xảy ra
                });
    }

    private void checkout(String token) {
        ZaloPaySDK.getInstance().payOrder(this, token, "demozpdk://app", new PayOrderListener() {
            @Override
            public void onPaymentSucceeded(String transId, String zpTransToken, String appTransId) {
                runOnUiThread(() -> {
                    postpayment();
                    updateOrderAfterPayment(orderId, ProvideID);
                });
            }

            @Override
            public void onPaymentCanceled(String zpTransToken, String appTransId) {
                runOnUiThread(() -> Toast.makeText(CustomerActivityDetail.this, "Bạn đã hủy thanh toán.", Toast.LENGTH_SHORT).show());
            }

            @Override
            public void onPaymentError(ZaloPayError zaloPayError, String zpTransToken, String appTransId) {
                runOnUiThread(() -> Toast.makeText(CustomerActivityDetail.this, "Thanh toán thất bại!", Toast.LENGTH_SHORT).show());
            }
        });
    }


    private void setstatus(){
        if(noti_status.equals( "Dang cho"))
        {
            tv_status.setText("Nhà cung cấp chưa xác nhận");
        }
        else
        {
            if(noti_status.equals("Thanh toan"))
            {
                tv_status.setText("Đang chờ thanh toán");
            }
            else
            if (noti_status.equals("Khong xac nhan")) {
                tv_status.setText("Nhà cung cấp không xác nhận");
            }
            else{
                tv_status.setText("Đã xác nhận thuê xe");
            }
        }
    }
    private void getuser(String ProvideID){
        dtb.collection("Users")
                .whereEqualTo("user_id", ProvideID)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                User user = new User();
                                ownername = document.get("username").toString();
                                owneremail = document.get("email").toString();
                                ownerphone = document.get("phoneNumber").toString();
                                user.setUser_id(document.get("user_id").toString());
                                user.setUsername(ownername);
                                user.setEmail(owneremail);
                                user.setPhoneNumber(ownerphone);
                                name.setText(user.getUsername());
                                email.setText(user.getEmail());
                                phoneNumber.setText(user.getPhoneNumber());
                            }
                        } else {
                            Toast.makeText(CustomerActivityDetail.this, "Không thể lấy thông tin nhà cung cấp", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
    private void getvehicle(String vehicle_id){
        dtb.collection("Vehicles")
                .whereEqualTo("vehicle_id", vehicle_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                Vehicle temp = new Vehicle();
                                temp.setVehicle_id(document.getId());

                                vehiclename = document.get("vehicle_name").toString();
                                vehicleprice = document.get("vehicle_price").toString();
                                vehicleaddress = document.get("provider_address").toString();

                                temp.setVehicle_name(vehiclename);
                                temp.setVehicle_availability(document.get("vehicle_availability").toString());
                                temp.setVehicle_price(vehicleprice);
                                temp.setProvider_address(vehicleaddress);

                                tv_BrandCar.setText(temp.getVehicle_name());
                                tv_Gia.setText(temp.getVehicle_price() + "/ngày");
                                tv_DiaDiem.setText(temp.getProvider_address());

                                pickup.setText(vehiclepickup);
                                dropoff.setText(vehicledrop);
                                totalcost = calculate(vehiclepickup, vehicledrop);
                                totalCost.setText(totalcost);

                                amount = totalcost;

                                temp.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                if (!document.get("vehicle_imageURL").toString().isEmpty()) {
                                    Picasso.get().load(temp.getVehicle_imageURL()).into(vehicleImage);
                                }
                                else {
                                    temp.setVehicle_imageURL("");
                                }
                            }
                        } else {
                            Toast.makeText(CustomerActivityDetail.this, "Không thể lấy thông tin xe", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
    private String calculate(String a, String b) {
        try {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");

            Date startDate = sdf.parse(a);
            Date endDate = sdf.parse(b);

            long diffInMillies = endDate.getTime() - startDate.getTime();
            long daysBetween = diffInMillies / (1000 * 60 * 60 * 24);

            if (daysBetween <= 0) {
                Toast.makeText(this, "Ngày trả phải sau ngày nhận!", Toast.LENGTH_SHORT).show();
                return "0";
            }

            int pricePerDay = Integer.parseInt(tv_Gia.getText().toString().substring(0, tv_Gia.getText().toString().indexOf(" ")));
            long totalPrice = pricePerDay * daysBetween;

            Log.e("Total Days", String.valueOf(daysBetween));
            Log.e("Total Price", String.valueOf(totalPrice));

            return String.valueOf(totalPrice);

        } catch (ParseException e) {
            e.printStackTrace();
            Toast.makeText(this, "Định dạng ngày không hợp lệ!", Toast.LENGTH_SHORT).show();
            return "0";
        }
    }
    public void init(){
        tv_id=findViewById(R.id.txtview_noti_id);
        tv_status=findViewById(R.id.txtview_noti_status);

        email=findViewById(R.id.txtview_noti_email);
        name=findViewById(R.id.txtview_noti_name);
        phoneNumber=findViewById(R.id.txtview_noti_phoneNumber);
        tv_BrandCar=findViewById(R.id.txtview_noti_BrandCar);
        tv_DiaDiem=findViewById(R.id.txt_checkout_address);

        btn_payment=findViewById(R.id.btn_customer_pay);
        btn_back=findViewById(R.id.btn_noti_back);

        tv_Gia=findViewById(R.id.txtview_noti_price);
        pickup=findViewById(R.id.tv_noti_pickup);
        dropoff=findViewById(R.id.tv_noti_dropoff);
        totalCost=findViewById(R.id.txtview_noti_totalCost);
        vehicleImage=findViewById(R.id.img_noti_car);

        //btn_payment.setVisibility(View.GONE);
        //btn_payment.setEnabled(false);
    }
    private int getday(String date){
        int day = 31;
        //
        return day;
    }
    private int getmonth(String date){
        int month = 12;
        //
        return month;
    }
    private int getyear(String date){
        int year = 2022;
        //
        return year;
    }
    @Override
    protected void onNewIntent(Intent intent) {
        super.onNewIntent(intent);
        ZaloPaySDK.getInstance().onResult(intent);
    }
}

```

### Service\Activity\OwnerActivityDetail.java
```java
package com.uit.carrental.Service.Activity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.Activity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.squareup.picasso.Picasso;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class OwnerActivityDetail extends AppCompatActivity {

    FirebaseFirestore dtb;
    Intent intent;
    String ProvideID, vehicle_id, vehiclename, vehicleprice, vehicleaddress, vehiclepickup, vehicledrop, totalcost;
    String CustomerID;
    String NotiID,noti_status;
    ImageView vehicleImage;
    private Activity temp = new Activity();


    private ArrayList<Vehicle> ls = new ArrayList<Vehicle>();
    private TextView tv_id,name,email,phoneNumber, tv_status;// Thông tin nhà cung cấp
    private TextView tv_BrandCar,tv_Gia,tv_DiaDiem,pickup,dropoff,totalCost;// Thông tin xe
    private Button btn_xacnhan,btn_huy,btn_back;

//    APIService apiService;
//
//    FirebaseUser user;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.owner_booking_detail);
        intent = getIntent();

        String OrderID = intent.getStringExtra("NotiID");
        NotiID = OrderID;

        init();

        dtb = FirebaseFirestore.getInstance();
        dtb.collection("Notification")
                .whereEqualTo("noti_id", NotiID)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

//                            Notification temp = new Notification();
                                temp.setNoti_id(document.getId());
                                temp.setCustomer_id(document.get("customer_id").toString());
                                temp.setVehicle_id(document.get("vehicle_id").toString());
                                temp.setStatus(document.get("status").toString());

                                vehiclepickup = document.get("pickup").toString();
                                vehicledrop = document.get("dropoff").toString();

                                CustomerID = temp.getCustomer_id();
                                vehicle_id = temp.getVehicle_id();
                                noti_status=temp.getStatus();

                                tv_id.setText(NotiID);

                                if(noti_status.equals( "Dang cho"))
                                {
                                    tv_status.setText("Chưa được xác nhận");
                                }
                                else
                                {
                                    if(tv_status.equals( "Thanh toan"))
                                    {
                                        tv_status.setText("Đang chờ thanh toán");
                                    }
                                    else
                                    if(noti_status.equals("Xac nhan"))
                                    {
                                        tv_status.setText("Đã xác nhận");
                                    }
                                    else
                                    if (noti_status.equals("Khong duoc xac nhan"))
                                    {
                                        tv_status.setText("Không được xác nhận");
                                    }
                                    else {
                                        tv_status.setText("Đã thanh toán");
                                    }
                                }
                                getuser(CustomerID);
                                getvehicle(vehicle_id);

                            }
                        } else {
                            Toast.makeText(OwnerActivityDetail.this, "Không thể lấy thông báo", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
        btn_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(OwnerActivityDetail.this, OwnerMainActivity.class);
                startActivity(intent);
            }
        });
        btn_huy.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                update_noti_huy();
            }
        });

        btn_xacnhan.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                update_noti_xacnhan();
                createOrderFromNotification(NotiID);

            }
        });
    }
    private String calculate(String a, String b) {
        try {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");

            Date startDate = sdf.parse(a);
            Date endDate = sdf.parse(b);

            long diffInMillies = endDate.getTime() - startDate.getTime();
            long daysBetween = diffInMillies / (1000 * 60 * 60 * 24);

            if (daysBetween <= 0) {
                Toast.makeText(this, "Ngày trả phải sau ngày nhận!", Toast.LENGTH_SHORT).show();
                return "0";
            }

            int pricePerDay = Integer.parseInt(tv_Gia.getText().toString().substring(0, tv_Gia.getText().toString().indexOf(" ")));
            long totalPrice = pricePerDay * daysBetween;

            Log.e("Total Days", String.valueOf(daysBetween));
            Log.e("Total Price", String.valueOf(totalPrice));

            return String.valueOf(totalPrice);

        } catch (ParseException e) {
            e.printStackTrace();
            Toast.makeText(this, "Định dạng ngày không hợp lệ!", Toast.LENGTH_SHORT).show();
            return "0";
        }
    }
    private void getuser(String ProvideID){
        dtb.collection("Users")
                .whereEqualTo("user_id", CustomerID)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                User user = new User();
                                user.setUser_id(document.get("user_id").toString());
                                user.setUsername(document.get("username").toString());
                                user.setEmail(document.get("email").toString());
                                user.setPhoneNumber(document.get("phoneNumber").toString());
                                name.setText(user.getUsername());
                                email.setText(user.getEmail());
                                phoneNumber.setText(user.getPhoneNumber());
                            }
                        } else {
                            Toast.makeText(OwnerActivityDetail.this, "Không thể lấy thông tin nhà cung cấp", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }
    private void getvehicle(String vehicle_id){
        dtb.collection("Vehicles")
                .whereEqualTo("vehicle_id", vehicle_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                Vehicle temp = new Vehicle();
                                temp.setVehicle_id(document.getId());

                                vehiclename = document.get("vehicle_name").toString();
                                vehicleprice = document.get("vehicle_price").toString();
                                vehicleaddress = document.get("provider_address").toString();

                                temp.setVehicle_name(document.get("vehicle_name").toString());
                                temp.setVehicle_availability(document.get("vehicle_availability").toString());
                                temp.setVehicle_price(document.get("vehicle_price").toString());


                                tv_BrandCar.setText(temp.getVehicle_name());
                                tv_Gia.setText(temp.getVehicle_price() + "/ngày");
                                tv_DiaDiem.setText(temp.getProvider_address());
                                temp.setProvider_address(document.get("provider_address").toString());

                                tv_DiaDiem.setText(vehicleaddress);
                                pickup.setText(vehiclepickup);
                                dropoff.setText(vehicledrop);
                                totalcost = calculate(vehiclepickup, vehicledrop);
                                totalCost.setText(totalcost);

                                temp.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                if (!document.get("vehicle_imageURL").toString().isEmpty()) {
                                    Picasso.get().load(temp.getVehicle_imageURL()).into(vehicleImage);
                                }
                                else {
                                    temp.setVehicle_imageURL("");
                                }
                            }
                        } else {
                            Toast.makeText(OwnerActivityDetail.this, "Không thể lấy thông tin xe", Toast.LENGTH_SHORT).show();
                        }
                    }
                });
    }

    private void update_noti_huy(){

        Map<String, Object> data = new HashMap<>();
        data.put("status", "Khong xac nhan");
        dtb.collection("Notification").document(temp.getNoti_id()).update(data)
                .addOnSuccessListener(new OnSuccessListener<Void>() {
                    @Override
                    public void onSuccess(Void aVoid) {
                        Toast.makeText(OwnerActivityDetail.this, "Đã hủy đơn hàng", Toast.LENGTH_LONG).show();
                        tv_status.setText("Không được xác nhận");
                    }
                })
                .addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Toast.makeText(OwnerActivityDetail.this, "Lỗi hủy đơn hàng", Toast.LENGTH_LONG).show();
                    }
                });

    }
    private void update_noti_xacnhan(){

        Map<String, Object> data = new HashMap<>();
        data.put("status", "Xac nhan");
        dtb.collection("Notification").document(temp.getNoti_id()).update(data)
                .addOnSuccessListener(new OnSuccessListener<Void>() {
                    @Override
                    public void onSuccess(Void aVoid) {
                        Toast.makeText(OwnerActivityDetail.this, "Đã xác nhận", Toast.LENGTH_LONG).show();
                        tv_status.setText("Đã xác nhận");
                    }
                })
                .addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Toast.makeText(OwnerActivityDetail.this, "Lỗi hủy đơn hàng", Toast.LENGTH_LONG).show();
                    }
                });

    }
    public void init(){
        tv_id=findViewById(R.id.txtview_noti_id);
        email=findViewById(R.id.txtview_noti_email);
        name=findViewById(R.id.txtview_noti_name);
        phoneNumber=findViewById(R.id.txtview_noti_phoneNumber);
        tv_BrandCar=findViewById(R.id.txtview_noti_BrandCar);
        tv_DiaDiem=findViewById(R.id.txt_checkout_address);

        tv_Gia=findViewById(R.id.txtview_noti_price);
        pickup=findViewById(R.id.tv_noti_pickup);
        dropoff=findViewById(R.id.tv_noti_dropoff);
        totalCost=findViewById(R.id.txtview_noti_totalCost);
        tv_status=findViewById(R.id.txtview_noti_status);

        btn_xacnhan=findViewById(R.id.btn_noti_XacNhan);
        btn_huy=findViewById(R.id.btn_noti_huy);
        btn_back=findViewById(R.id.btn_noti_back);
        vehicleImage=findViewById(R.id.img_noti_car);
    }

    // OwnerActivityDetail.java

    private void createOrderFromNotification(String notiId) {
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        db.collection("Notification").document(notiId).get()
                .addOnSuccessListener(documentSnapshot -> {
                    if (documentSnapshot.exists()) {
                        Map<String, Object> notiData = documentSnapshot.getData();
                        if (notiData == null) return;

                        Map<String, Object> orderData = new HashMap<>();
                        orderData.put("customer_id", notiData.get("customer_id"));
                        orderData.put("provider_id", notiData.get("provider_id"));
                        orderData.put("vehicle_id", notiData.get("vehicle_id"));
                        orderData.put("pickup_time", notiData.get("pickup"));
                        orderData.put("dropoff_time", notiData.get("dropoff"));
                        orderData.put("status", "pending");
                        orderData.put("payment_status", "pending");

                        db.collection("Orders").add(orderData)
                                .addOnSuccessListener(orderRef -> {
                                    Log.d("CreateOrder", "Order created: " + orderRef.getId());

                                    // Update notification with order_id
                                    Map<String, Object> updateData = new HashMap<>();
                                    updateData.put("order_id", orderRef.getId());
                                    db.collection("Notification").document(notiId)
                                            .update(updateData)
                                            .addOnSuccessListener(aVoid -> {
                                                Log.d("Notification Update", "order_id updated in notification!");
                                            })
                                            .addOnFailureListener(e -> {
                                                Log.e("Notification Update", "Failed to update notification", e);
                                            });
                                })
                                .addOnFailureListener(e -> {
                                    Log.e("CreateOrder", "Failed to create order", e);
                                });
                    }
                })
                .addOnFailureListener(e -> {
                    Log.e("FetchNoti", "Failed to fetch notification", e);
                });
    }





}

```

### Service\Api\CloudinaryApi.java
```java
package com.uit.carrental.Service.Api;

import android.content.Context;
import android.net.Uri;
import android.util.Log;

import com.cloudinary.android.MediaManager;
import com.cloudinary.android.callback.ErrorInfo;
import com.cloudinary.android.callback.UploadCallback;

import java.util.HashMap;
import java.util.Map;

public class CloudinaryApi {

    private static final String CLOUD_NAME = "drc8ylzsd";
    private static final String API_KEY = "186315811678634";
    private static final String UPLOAD_PRESET = "car_rent_unsigned";

    private static boolean initialized = false;

    public static void init(Context context) {
        if (initialized) return;

        Map<String, Object> config = new HashMap<>();
        config.put("cloud_name", CLOUD_NAME);
        config.put("api_key", API_KEY);
        config.put("unsigned", true);
        MediaManager.init(context, config);
        initialized = true;
    }

    public static void uploadImage(Context context, Uri imageUri, UploadCallbackCustom callback) {
        init(context);

        MediaManager.get().upload(imageUri)
                .option("upload_preset", UPLOAD_PRESET)
                .option("unsigned", true) // THÊM DÒNG NÀY !!!
                .callback(new UploadCallback() {
                    @Override
                    public void onStart(String requestId) {
                        Log.d("Cloudinary", "Upload Started: " + requestId);
                    }

                    @Override
                    public void onProgress(String requestId, long bytes, long totalBytes) {
                        Log.d("Cloudinary", "Progress: " + bytes + "/" + totalBytes);
                    }

                    @Override
                    public void onSuccess(String requestId, Map resultData) {
                        String url = (String) resultData.get("secure_url");
                        if (callback != null) callback.onSuccess(url);
                    }

                    @Override
                    public void onError(String requestId, ErrorInfo error) {
                        if (callback != null) callback.onFailure(new Exception(error.getDescription()));
                    }

                    @Override
                    public void onReschedule(String requestId, ErrorInfo error) {
                        if (callback != null) callback.onFailure(new Exception(error.getDescription()));
                    }
                })
                .dispatch();
    }


    public interface UploadCallbackCustom {
        void onSuccess(String url);
        void onFailure(Exception e);
    }
}

```

### Service\Booking\CarDetailActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.R;


public class CarDetailActivity extends AppCompatActivity {
    Button btnBook;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.activity_detail_car);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        overridePendingTransition(R.anim.anim_in_right,R.anim.anim_out_left);

        btnBook =findViewById(R.id.btn_book);
        btnBook.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent it1=new Intent(CarDetailActivity.this, ScheduleSelect.class);
            }
        });
    }

}

```

### Service\Booking\RequestSuccessActivity.java
```java
package com.uit.carrental.Service.Booking;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.R;

public class RequestSuccessActivity extends AppCompatActivity {
    private Button btn_home;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        setContentView(R.layout.activity_finished);

        init();
        btn_home.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(RequestSuccessActivity.this, CustomerMainActivity.class);
                startActivity(intent);
            }
        });


    }
    private void init()
    {
        btn_home = findViewById(R.id.btn_noti_Home);
    }
}

```

### Service\Booking\ScheduleSelect.java
```java
package com.uit.carrental.Service.Booking;

import android.app.DatePickerDialog;
import android.app.TimePickerDialog;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.DatePicker;
import android.widget.TextView;
import android.widget.TimePicker;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.Model.Activity;
import com.uit.carrental.R;

import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;

import org.checkerframework.checker.units.qual.C;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Map;


public class ScheduleSelect extends AppCompatActivity {
    Button btn_request, btn_back;
    TextView NgayNhan, NgayTra;
    TextView GioNhan, GioTra;
    private DatePickerDialog picker;
    private TimePickerDialog tpicker;
    Intent intent;
    String vehicle_id;
    FirebaseFirestore dtb_Vehicle, dtb_Noti,dtb_update;
    private Activity noti = new Activity();
    String current_user_id;
    StorageReference storageReference;
    FirebaseAuth firebaseAuth;

    //
//    APIService apiService;
//    boolean notify = false;
//    String provideID;
    //


    FirebaseUser user;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (getSupportActionBar() != null) {
            getSupportActionBar().hide();
        }
        setContentView(R.layout.activity_schedule_select);

        intent = getIntent();

        String Vehicle_ID = intent.getStringExtra("vehicle_id");
        vehicle_id = Vehicle_ID;

        storageReference = FirebaseStorage.getInstance().getReference();
        dtb_Vehicle = FirebaseFirestore.getInstance();
        firebaseAuth = FirebaseAuth.getInstance();
        current_user_id = firebaseAuth.getCurrentUser().getUid();
        dtb_Noti = FirebaseFirestore.getInstance();
        dtb_update = FirebaseFirestore.getInstance();

        //
//        user= FirebaseAuth.getInstance().getCurrentUser();
//        apiService= Client.getClient("http:/fcm.googleapis.com/").create(APIService.class);
        //

        initComponents();

        overridePendingTransition(R.anim.anim_in_left, R.anim.anim_out_right);


        btn_request.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
//                notify=true;
                setNotiFirebase();
                Intent Writeinfor=new Intent(ScheduleSelect.this, RequestSuccessActivity.class);
                startActivity(Writeinfor);
            }
        });
        btn_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                onStop();
            }
        });
    }
    private void setNotiFirebase(){
        dtb_Vehicle.collection("Vehicles")
                .whereEqualTo("vehicle_id", vehicle_id)
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                noti.setVehicle_id(document.get("vehicle_id").toString());
                                noti.setProvider_id(document.get("provider_id").toString());
                                noti.setPickup(NgayNhan.getText().toString() + " " + GioNhan.getText().toString());
                                noti.setDropoff(NgayTra.getText().toString() + " " + GioTra.getText().toString());
                                noti.setStatus("Dang cho");

                                noti.setCustomer_id(current_user_id);
//                                provideID=noti.getProvider_id();

                                dtb_Noti.collection("Notification")
                                        .add(noti)
                                        .addOnSuccessListener(new OnSuccessListener<DocumentReference>() {
                                            @Override
                                            public void onSuccess(DocumentReference documentReference) {
                                                noti.setNoti_id(documentReference.getId());
                                                Log.e("NotiID", noti.getNoti_id());
                                                updateData(noti.getNoti_id());
                                                Intent intent = new Intent(ScheduleSelect.this, RequestSuccessActivity.class);
                                                startActivity(intent);
/*
                                                toast("Thêm noti thành công");
*/
                                            }
                                        })
                                        .addOnFailureListener(new OnFailureListener() {
                                            @Override
                                            public void onFailure(@NonNull Exception e) {
                                                toast("Thêm noti thất bại");
                                            }
                                        });

                            }
                        } else {
                            Toast.makeText(ScheduleSelect.this, "Không thể lấy thông báo", Toast.LENGTH_SHORT).show();
                        }


                    }
                    private void updateData(String NotiID) {
                        Log.e("NotificationID", NotiID);
                        Map<String, Object> data = new HashMap<>();
                        data.put("noti_id", NotiID);

                        dtb_update.collection("Notification")
                                .document(NotiID)
                                .update(data)
                                .addOnSuccessListener(new OnSuccessListener<Void>() {
                                    @Override
                                    public void onSuccess(Void aVoid) {
/*
                                        Toast.makeText(ScheduleSelect.this, "DocumentSnapshot successfully updated!", Toast.LENGTH_LONG).show();
*/
                                    }
                                })
                                .addOnFailureListener(new OnFailureListener() {
                                    @Override
                                    public void onFailure(@NonNull Exception e) {
                                        Toast.makeText(ScheduleSelect.this, "Error updating document", Toast.LENGTH_LONG).show();
                                    }
                                });
                    }
                });
    }
    private void toast(String txt){
        Toast toast = Toast.makeText(getApplicationContext(),txt,Toast.LENGTH_LONG);
        toast.show();
    }
    private void setonclick(){
        NgayNhan.setFocusable(false);
        NgayNhan.setClickable(true);
        NgayTra.setFocusable(false);
        NgayTra.setClickable(true);
        GioNhan.setFocusable(false);
        GioNhan.setClickable(true);
        GioTra.setFocusable(false);
        GioTra.setClickable(true);

        final Calendar calendar = Calendar.getInstance();

        NgayNhan.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                int year = calendar.get(Calendar.YEAR);
                int month = calendar.get(Calendar.MONTH);
                int day = calendar.get(Calendar.DAY_OF_MONTH);
                picker = new DatePickerDialog(ScheduleSelect.this, new DatePickerDialog.OnDateSetListener() {
                    @Override
                    public void onDateSet(DatePicker view, int year1, int month1, int dayOfMonth) {
                        String formattedDate = String.format("%04d-%02d-%02d", year1, month1 + 1, dayOfMonth);
                        NgayNhan.setText(formattedDate);
                    }
                }, year, month, day);
                picker.show();
            }
        });

        NgayTra.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                int year = calendar.get(Calendar.YEAR);
                int month = calendar.get(Calendar.MONTH);
                int day = calendar.get(Calendar.DAY_OF_MONTH);
                picker = new DatePickerDialog(ScheduleSelect.this, new DatePickerDialog.OnDateSetListener() {
                    @Override
                    public void onDateSet(DatePicker view, int year1, int month1, int dayOfMonth) {
                        String formattedDate = String.format("%04d-%02d-%02d", year1, month1 + 1, dayOfMonth);
                        NgayTra.setText(formattedDate);
                    }
                }, year, month, day);
                picker.show();
            }
        });

        GioNhan.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                int hour = calendar.get(Calendar.HOUR_OF_DAY);
                int minute = calendar.get(Calendar.MINUTE);

                tpicker = new TimePickerDialog(ScheduleSelect.this, new TimePickerDialog.OnTimeSetListener() {
                    @Override
                    public void onTimeSet(TimePicker view, int hourOfDay, int minute) {
                        String formattedTime = String.format("%02d:%02d", hourOfDay, minute);
                        GioNhan.setText(formattedTime);
                    }
                }, hour, minute, true);
                tpicker.show();
            }
        });

        GioTra.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                int hour = calendar.get(Calendar.HOUR_OF_DAY);
                int minute = calendar.get(Calendar.MINUTE);

                tpicker = new TimePickerDialog(ScheduleSelect.this, new TimePickerDialog.OnTimeSetListener() {
                    @Override
                    public void onTimeSet(TimePicker view, int hourOfDay, int minute) {
                        String formattedTime = String.format("%02d:%02d", hourOfDay, minute);
                        GioTra.setText(formattedTime);
                    }
                }, hour, minute, true);
                tpicker.show();
            }
        });
    }

    private void initComponents(){
        btn_request = findViewById(R.id.btn_requestbooking);
        btn_back = findViewById(R.id.btn_noti_back);
        NgayNhan = findViewById(R.id.edt_NgayNhan);
        NgayTra = findViewById(R.id.edt_NgayTra);
        GioNhan= findViewById(R.id.edt_GioNhan);
        GioTra= findViewById(R.id.edt_GioTra);
        setonclick();
    }

}

```

### Service\UserAuthentication\CCCDActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.Toast;

import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.OnProgressListener;
import com.google.firebase.storage.StorageReference;
import com.google.firebase.storage.UploadTask;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

public class CCCDActivity extends AppCompatActivity {

    private ImageView front, behind;
    private String uploadtype, frontUrl, behindUrl;
    private Uri frontURI, behindURI;
    private String imageID;
    private Button btnUpdate;
    private FirebaseFirestore dtb_user;
    private FirebaseUser firebaseUser;
    private User user = new User();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_cccd);

        init();

        front.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                uploadtype = "IDCards/Front/";
                pickFrontImagesFromGallery.launch("image/*");
            }
        });

        behind.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                uploadtype = "IDCards/Behind/";
                pickBehindImagesFromGallery.launch("image/*");
            }
        });

        btnUpdate.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                SaveImageInFirestore();
            }
        });
    }

    private void init()
    {
        front = findViewById(R.id.img_front_CCCD);
        behind = findViewById(R.id.img_behind_CCCD);
        btnUpdate = findViewById(R.id.update_img);

        dtb_user = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        user.setUser_id(firebaseUser.getUid());
    }

    ActivityResultLauncher<String> pickFrontImagesFromGallery = registerForActivityResult(new ActivityResultContracts.GetContent()
            , new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null){
                        frontURI = result;
                        front.setImageURI(result);
                    }
                    uploadFront(uploadtype);
                }
            });

    ActivityResultLauncher<String> pickBehindImagesFromGallery = registerForActivityResult(new ActivityResultContracts.GetContent()
            , new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null){
                        behindURI = result;
                        behind.setImageURI(result);
                    }
                    uploadBehind(uploadtype);
                }
            });

    private void uploadFront(String type) {

        //Firebase
        FirebaseStorage storage;
        StorageReference storageReference;

        // Initialize storage reference
        storage = FirebaseStorage.getInstance();
        storageReference = storage.getReference();

        if(frontURI != null)
        {
            imageID = UUID.randomUUID().toString();
            final ProgressDialog progressDialog = new ProgressDialog(this);
            progressDialog.setTitle("Uploading...");
            progressDialog.show();

            StorageReference ref = storageReference.child(type + "/"+ imageID);

            ref.putFile(frontURI)
                    .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {
                            progressDialog.dismiss();
/*
                            Toast.makeText(CCCDActivity.this, "Uploaded", Toast.LENGTH_SHORT).show();
*/
                            ref.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {
                                @Override
                                public void onSuccess(Uri uri) {
                                    frontUrl = uri.toString();
/*
                                    Toast.makeText(getBaseContext(), "Upload success! URL - " + frontUrl, Toast.LENGTH_SHORT).show();
*/
                                }
                            });
                        }
                    })
                    .addOnFailureListener(new OnFailureListener() {
                        @Override
                        public void onFailure(@NonNull Exception e) {
                            progressDialog.dismiss();
                            Toast.makeText(CCCDActivity.this, "Failed "+e.getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    })
                    .addOnProgressListener(new OnProgressListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onProgress(UploadTask.TaskSnapshot taskSnapshot) {
                            double progress = (100.0*taskSnapshot.getBytesTransferred()/taskSnapshot
                                    .getTotalByteCount());
                            progressDialog.setMessage("Uploaded "+(int)progress+"%");
                        }
                    });
        }
    }


    private void uploadBehind(String type) {

        //Firebase
        FirebaseStorage storage;
        StorageReference storageReference;

        // Initialize storage reference
        storage = FirebaseStorage.getInstance();
        storageReference = storage.getReference();

        if(behindURI != null)
        {
            imageID = UUID.randomUUID().toString();
            final ProgressDialog progressDialog = new ProgressDialog(this);
            progressDialog.setTitle("Uploading...");
            progressDialog.show();

            StorageReference ref = storageReference.child(type + "/"+ imageID);

            ref.putFile(behindURI)
                    .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {
                            progressDialog.dismiss();
/*
                            Toast.makeText(CCCDActivity.this, "Uploaded", Toast.LENGTH_SHORT).show();
*/
                            ref.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {
                                @Override
                                public void onSuccess(Uri uri) {
                                    behindUrl = uri.toString();
/*
                                    Toast.makeText(getBaseContext(), "Upload success! URL - " + behindUrl, Toast.LENGTH_SHORT).show();
*/
                                }
                            });
                        }
                    })
                    .addOnFailureListener(new OnFailureListener() {
                        @Override
                        public void onFailure(@NonNull Exception e) {
                            progressDialog.dismiss();
                            Toast.makeText(CCCDActivity.this, "Failed "+e.getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    })
                    .addOnProgressListener(new OnProgressListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onProgress(UploadTask.TaskSnapshot taskSnapshot) {
                            double progress = (100.0*taskSnapshot.getBytesTransferred()/taskSnapshot
                                    .getTotalByteCount());
                            progressDialog.setMessage("Uploaded "+(int)progress+"%");
                        }
                    });
        }
    }

    private void SaveImageInFirestore()
    {
        user.setCiCardFront(frontUrl);
        user.setCiCardBehind(behindUrl);

        Map<String, Object> data = new HashMap<>();
        data.put("ciCardFront", user.getCiCardFront());
        data.put("ciCardBehind", user.getCiCardBehind());

        dtb_user.collection("Users").document(firebaseUser.getUid())
                .update(data)
                .addOnCompleteListener(new OnCompleteListener<Void>() {
                    @Override
                    public void onComplete(@NonNull Task<Void> task) {
/*
                        Toast.makeText(CCCDActivity.this, "DocumentSnapshot successfully updated!", Toast.LENGTH_LONG).show();
*/
                        Intent intent = new Intent(CCCDActivity.this, ProfileManagement.class);
                        startActivity(intent);
                    }
                }).addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Toast.makeText(CCCDActivity.this, "Error updating document", Toast.LENGTH_LONG).show();
                    }
                });
    }
}
```

### Service\UserAuthentication\ForgotPasswordActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;

public class ForgotPasswordActivity extends AppCompatActivity {

    private EditText inputEmail;
    private Button btnContinue;
    private FirebaseAuth mAuth;
    private ProgressDialog progressDialog;
    private static final String TAG = "ForgotPasswordActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_forgot_password);

        initViews();

        Intent intent = getIntent();
        String emailFromIntent = intent.getStringExtra("email");
        if (emailFromIntent != null) {
            inputEmail.setText(emailFromIntent);
        }

        btnContinue.setOnClickListener(view -> sendResetPasswordEmail());
    }

    private void initViews() {
        inputEmail = findViewById(R.id.input_email);
        btnContinue = findViewById(R.id.btn_continue);
        mAuth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(this);
    }

    private void sendResetPasswordEmail() {
        String email = inputEmail.getText().toString().trim();

        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Vui lòng nhập email.");
            return;
        }

        progressDialog.setMessage("Đang gửi email khôi phục...");
        progressDialog.show();

        mAuth.sendPasswordResetEmail(email)
                .addOnCompleteListener(task -> {
                    progressDialog.dismiss();
                    if (task.isSuccessful()) {
                        Toast.makeText(this, "Đã gửi email xác nhận tới " + email, Toast.LENGTH_LONG).show();
                        finish();
                    } else {
                        Log.e(TAG, "sendPasswordResetEmail thất bại: " + task.getException());
                        Toast.makeText(this, "Không thể gửi email xác nhận.", Toast.LENGTH_SHORT).show();
                    }
                });
    }
}

```

### Service\UserAuthentication\GGVerrifyPhone.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;

import com.uit.carrental.R;

public class GGVerrifyPhone extends AppCompatActivity {

    private Button btnContinue;
    private EditText inputPhone;

    private void init()
    {
        btnContinue = findViewById(R.id.btn_continue);
        inputPhone = findViewById(R.id.input_phone_number);
    }
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_ggverrify_phone);

        init();

        btnContinue.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(GGVerrifyPhone.this, ValidatePhoneActivity.class);
                intent.putExtra("phone", inputPhone.getText().toString());
                startActivity(intent);
            }
        });
    }
}
```

### Service\UserAuthentication\LoginActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.google.android.gms.auth.api.signin.GoogleSignIn;
import com.google.android.gms.auth.api.signin.GoogleSignInAccount;
import com.google.android.gms.auth.api.signin.GoogleSignInClient;
import com.google.android.gms.auth.api.signin.GoogleSignInOptions;
import com.google.android.gms.common.api.ApiException;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.AuthCredential;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.auth.GoogleAuthProvider;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.DocumentSnapshot;
import com.google.firebase.firestore.FirebaseFirestore;
import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.UserClient;
import com.uit.carrental.R;

public class LoginActivity extends AppCompatActivity {

    private EditText inputEmail, inputPassword;
    private Button btnSignIn, btnSignUp, btnGG, btnFacebook;
    private TextView btnForget;
    private ProgressDialog progressDialog;
    private FirebaseAuth mAuth;
    private GoogleSignInClient mGoogleSignInClient;
    private static final int RC_SIGN_IN = 406;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_sign_in);

        initViews();
        configureGoogleSignIn();

        btnSignIn.setOnClickListener(view -> loginWithEmail());
        btnGG.setOnClickListener(view -> loginWithGoogle());
        btnSignUp.setOnClickListener(view -> {
            Intent intent = new Intent(LoginActivity.this, RegisterActivity.class);
            startActivity(intent);
        });
        btnForget.setOnClickListener(view -> {
            Intent intent = new Intent(LoginActivity.this, ForgotPasswordActivity.class);
            startActivity(intent);
        });
        btnFacebook.setOnClickListener(view -> {
            Toast.makeText(this, "Đăng nhập với Facebook chưa được triển khai.", Toast.LENGTH_SHORT).show();
            // TODO: Implement Facebook login logic (e.g., using Facebook SDK and Firebase)
        });
    }

    private void initViews() {
        mAuth = FirebaseAuth.getInstance();
        progressDialog = new ProgressDialog(this);

        inputEmail = findViewById(R.id.email);
        inputPassword = findViewById(R.id.password);
        btnSignIn = findViewById(R.id.btn_signIn);
        btnSignUp = findViewById(R.id.btn_signUp);
        btnForget = findViewById(R.id.btn_forget);
        btnGG = findViewById(R.id.btn_GGsignIn);
        btnFacebook = findViewById(R.id.btn_facebook_signIn);
    }

    private void configureGoogleSignIn() {
        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestIdToken(getString(R.string.default_web_client_id))
                .requestEmail()
                .build();
        mGoogleSignInClient = GoogleSignIn.getClient(this, gso);
    }

    private void loginWithEmail() {
        String email = inputEmail.getText().toString().trim();
        String password = inputPassword.getText().toString().trim();

        if (!validateForm(email, password)) return;

        progressDialog.setMessage("Đang đăng nhập...");
        progressDialog.show();

        mAuth.signInWithEmailAndPassword(email, password)
                .addOnCompleteListener(task -> {
                    progressDialog.dismiss();
                    if (task.isSuccessful()) {
                        fetchUserData();
                    } else {
                        Toast.makeText(this, "Đăng nhập thất bại.", Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void loginWithGoogle() {
        Intent signInIntent = mGoogleSignInClient.getSignInIntent();
        startActivityForResult(signInIntent, RC_SIGN_IN);
    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == RC_SIGN_IN) {
            Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);
            try {
                GoogleSignInAccount account = task.getResult(ApiException.class);
                firebaseAuthWithGoogle(account);
            } catch (ApiException e) {
                Toast.makeText(this, "Đăng nhập Google thất bại.", Toast.LENGTH_SHORT).show();
            }
        }
    }

    private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {
        AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);
        mAuth.signInWithCredential(credential)
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        fetchUserData();
                    } else {
                        Toast.makeText(this, "Đăng nhập Google thất bại.", Toast.LENGTH_SHORT).show();
                    }
                });
    }

    private void fetchUserData() {
        FirebaseUser firebaseUser = mAuth.getCurrentUser();
        if (firebaseUser == null) return;

        if (!firebaseUser.isEmailVerified()) {
            Toast.makeText(this, "Vui lòng xác nhận email trước khi đăng nhập.", Toast.LENGTH_LONG).show();
            mAuth.signOut();
            return;
        }

        String uid = firebaseUser.getUid();
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        DocumentReference userRef = db.collection("Users").document(uid);

        userRef.get().addOnCompleteListener(task -> {
            if (task.isSuccessful()) {
                DocumentSnapshot document = task.getResult();
                if (document.exists()) {
                    User user = document.toObject(User.class);
                    ((UserClient) getApplicationContext()).setUser(user);
                    navigateToMain(user);
                } else {
                    createNewUser(uid);
                }
            } else {
                Toast.makeText(this, "Không thể lấy thông tin người dùng.", Toast.LENGTH_SHORT).show();
            }
        });
    }

    private void createNewUser(String uid) {
        FirebaseFirestore db = FirebaseFirestore.getInstance();
        User user = new User();
        user.setUser_id(uid);
        user.setUsername("");
        user.setEmail("");
        user.setRole("customer");

        db.collection("Users").document(uid).set(user)
                .addOnSuccessListener(aVoid -> {
                    ((UserClient) getApplicationContext()).setUser(user);
                    navigateToMain(user);
                })
                .addOnFailureListener(e -> {
                    Toast.makeText(this, "Không thể tạo tài khoản người dùng mới.", Toast.LENGTH_SHORT).show();
                });
    }

    private void navigateToMain(User user) {
        if (user.getUsername() == null || user.getUsername().isEmpty() ||
                user.getPhoneNumber() == null || user.getPhoneNumber().isEmpty()) {
            Intent intent = new Intent(this, ProfileManagement.class);
            startActivity(intent);
        } else {
            if (user.getCurrentRole() != null) {
                if (user.getCurrentRole().equalsIgnoreCase("customer")) {
                    startActivity(new Intent(this, CustomerMainActivity.class));
                } else if (user.getCurrentRole().equalsIgnoreCase("owner")) {
                    startActivity(new Intent(this, OwnerMainActivity.class));
                } else {
                    Toast.makeText(this, "Vai trò không xác định.", Toast.LENGTH_SHORT).show();
                }
            } else {
                Toast.makeText(this, "Không tìm thấy vai trò hiện tại.", Toast.LENGTH_SHORT).show();
            }
        }
        finish();
    }

    private boolean validateForm(String email, String password) {
        boolean valid = true;
        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Email bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(password)) {
            inputPassword.setError("Mật khẩu bắt buộc.");
            valid = false;
        }
        return valid;
    }
}
```

### Service\UserAuthentication\ProfileManagement.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.AlertDialog;
import android.app.DatePickerDialog;
import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.DatePicker;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.Toast;

import com.uit.carrental.ActivityPages.CustomerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.OnProgressListener;
import com.google.firebase.storage.StorageReference;
import com.google.firebase.storage.UploadTask;
import com.squareup.picasso.Picasso;

import java.util.Calendar;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

public class ProfileManagement extends AppCompatActivity {
    private DatePickerDialog datePickerDialog;
    private Button dateButton,btnUpdate;
    private Uri mImageURI;
    private ImageView  imgAvatar;
    private String imageID;
    private String documentId, downloadUrl, uploadtype;
    private FirebaseUser firebaseUser;
    private FirebaseFirestore dtb_user;
    private EditText phonenumber, email, fullname, address, city;
    private User user = new User();

    ActivityResultLauncher<String> AvatarpickImagesFromGallery = registerForActivityResult(new ActivityResultContracts.GetContent()
            , new ActivityResultCallback<Uri>() {
                @Override
                public void onActivityResult(Uri result) {
                    if (result != null){
                        mImageURI = result;
                        imgAvatar.setImageURI(result);
                    }
                    uploadImage(uploadtype);
                }
            });
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_profile);
        init();
        getinfo();

        btnUpdate.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                updateinfo();
            }
        });

        imgAvatar.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                uploadtype = "UsersAvatar/";
                AvatarpickImagesFromGallery.launch("image/*");
            }
        });
    }

    private void init(){
        phonenumber = findViewById(R.id.profile_input_phone);
        email = findViewById(R.id.profile_input_email);

        phonenumber.setEnabled(false);
        email.setEnabled(false);

        fullname = findViewById(R.id.profile_input_fullname);
        address = findViewById(R.id.profile_input_address);
        city = findViewById(R.id.profile_input_city);
        btnUpdate = findViewById(R.id.btn_update);
        imgAvatar = findViewById(R.id.img_avatar_profile_input_fragment);

        //date of birth button
        initDatePicker();
        dateButton = findViewById(R.id.profile_input_dateofbirth);
        dateButton.setText(getTodaysDate());

        dtb_user = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        user.setUser_id(firebaseUser.getUid());
    }
    private String getTodaysDate()  {
        Calendar cal = Calendar.getInstance();
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH);
        month = month + 1;
        int day = cal.get(Calendar.DAY_OF_MONTH);
        return makeDateString(day, month, year);
    }
    private String makeDateString(int day, int month, int year) {
        return getMonthFormat(month) + " " + day + " " + year;
    }
    private String getMonthFormat(int month) {
        if(month == 1)
            return "01";
        if(month == 2)
            return "02";
        if(month == 3)
            return "03";
        if(month == 4)
            return "04";
        if(month == 5)
            return "05";
        if(month == 6)
            return "06";
        if(month == 7)
            return "07";
        if(month == 8)
            return "08";
        if(month == 9)
            return "09";
        if(month == 10)
            return "10";
        if(month == 11)
            return "11";
        if(month == 12)
            return "12";

        //default should never happen
        return "01";
    }
    public void openDatePicker(View view)
    {
        datePickerDialog.show();
    }
    private void initDatePicker() {
        DatePickerDialog.OnDateSetListener dateSetListener = new DatePickerDialog.OnDateSetListener()
        {
            @Override
            public void onDateSet(DatePicker datePicker, int year, int month, int day) {
                month = month + 1;
                String date = makeDateString(day, month, year);
                dateButton.setText(date);
            }
        };

        Calendar cal = Calendar.getInstance();
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH);
        int day = cal.get(Calendar.DAY_OF_MONTH);

        int style = AlertDialog.THEME_HOLO_LIGHT;

        datePickerDialog = new DatePickerDialog(this, style, dateSetListener, year, month, day);
        //datePickerDialog.getDatePicker().setMaxDate(System.currentTimeMillis());

    }
    private void uploadImage(String type) {

        //Firebase
        FirebaseStorage storage;
        StorageReference storageReference;

        // Initialize storage reference
        storage = FirebaseStorage.getInstance();
        storageReference = storage.getReference();

        if(mImageURI != null) {
            imageID = UUID.randomUUID().toString();
            final ProgressDialog progressDialog = new ProgressDialog(this);
            progressDialog.setTitle("Uploading...");
            progressDialog.show();

            StorageReference ref = storageReference.child(type + "/"+ imageID);
            ref.putFile(mImageURI)
                    .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {
                            progressDialog.dismiss();
/*
                            Toast.makeText(ProfileManagement.this, "Uploaded", Toast.LENGTH_SHORT).show();
*/
                            ref.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {
                                @Override
                                public void onSuccess(Uri uri) {
                                    downloadUrl = uri.toString();
/*
                                    Toast.makeText(getBaseContext(), "Upload success! URL - " + downloadUrl, Toast.LENGTH_SHORT).show();
*/
                                }
                            });
                        }
                    })
                    .addOnFailureListener(new OnFailureListener() {
                        @Override
                        public void onFailure(@NonNull Exception e) {
                            progressDialog.dismiss();
                            Toast.makeText(ProfileManagement.this, "Failed "+e.getMessage(), Toast.LENGTH_SHORT).show();
                        }
                    })
                    .addOnProgressListener(new OnProgressListener<UploadTask.TaskSnapshot>() {
                        @Override
                        public void onProgress(UploadTask.TaskSnapshot taskSnapshot) {
                            double progress = (100.0*taskSnapshot.getBytesTransferred()/taskSnapshot
                                    .getTotalByteCount());
                            progressDialog.setMessage("Uploaded "+(int)progress+"%");
                        }
                    });
        }
    }
    private void updateinfo() {
        user.setUsername(fullname.getText().toString());
        user.setAddress(address.getText().toString());
        user.setCity(city.getText().toString());
        user.setBirthday(dateButton.getText().toString());
        user.setAvatarURL(downloadUrl);
        user.setEmail(email.getText().toString());

        Map<String, Object> data = new HashMap<>();
        data.put("username", user.getUsername());
        data.put("address", user.getAddress());
        data.put("city", user.getCity());
        data.put("birthday", user.getBirthday());
        data.put("email", user.getEmail());

        if (downloadUrl!=null)
        {
            data.put("avatarURL", user.getAvatarURL());
        }

        dtb_user.collection("Users").document(user.getUser_id())
                .update(data)
                .addOnSuccessListener(new OnSuccessListener<Void>() {
                    @Override
                    public void onSuccess(Void aVoid) {
/*
                        Toast.makeText(ProfileManagement.this, "DocumentSnapshot successfully updated!", Toast.LENGTH_LONG).show();
*/
                        Intent intent = new Intent(ProfileManagement.this, CustomerMainActivity.class);
                        startActivity(intent);
                    }
                })
                .addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Toast.makeText(ProfileManagement.this, "Error updating document", Toast.LENGTH_LONG).show();
                    }
                });

    }

    private void getinfo(){

        dtb_user.collection("Users")
                .whereEqualTo("user_id", user.getUser_id())
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()){
                            for (QueryDocumentSnapshot document : task.getResult()){
                                fullname.setText(document.get("username").toString());
                                email.setText(document.get("email").toString());
                                phonenumber.setText(document.get("phoneNumber").toString());
                                address.setText(document.get("address").toString());
                                city.setText(document.get("city").toString());

                                dateButton.setText(document.get("birthday").toString());

                                user.setAvatarURL(document.get("avatarURL").toString());
                                if (!document.get("avatarURL").toString().isEmpty()) {
                                    Picasso.get().load(user.getAvatarURL()).into(imgAvatar);
                                }
                                else {
                                    user.setAvatarURL("");
                                }

                            }
                        }
                        else {
                            //
                            Toast.makeText(ProfileManagement.this, "Không thể lấy thông tin", Toast.LENGTH_LONG).show();
                        }
                    }
                });
        if (email.getText().toString().isEmpty()) email.setEnabled(true);
    }

}
```

### Service\UserAuthentication\RegisterActivity.java
```java
package com.uit.carrental.Service.UserAuthentication;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.google.android.gms.tasks.Task;
import com.google.android.material.snackbar.Snackbar;
import com.google.firebase.FirebaseApp;
import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.FirebaseFirestoreSettings;

import java.util.HashMap;
import java.util.Map;

public class RegisterActivity extends AppCompatActivity {

    private static final String TAG = "RegisterActivity";

    private EditText inputPhone, inputEmail, inputPass, reinputPass;
    private Button btnSignUp;
    private FirebaseAuth mAuth;
    private FirebaseFirestore dtbUser;
    private ProgressDialog progressDialog;
    private String phone, email, password, rePassword;
    private boolean isValid = true;
    private User user;

    private void initViews() {
        inputEmail = findViewById(R.id.input_email);
        inputPhone = findViewById(R.id.input_phone);
        inputPass = findViewById(R.id.input_password);
        reinputPass = findViewById(R.id.reinput_password);
        btnSignUp = findViewById(R.id.btn_signup);
    }

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_register);

        FirebaseApp.initializeApp(this);
        initViews();

        mAuth = FirebaseAuth.getInstance();
        dtbUser = FirebaseFirestore.getInstance();
        progressDialog = new ProgressDialog(this);

        btnSignUp.setOnClickListener(view -> {
            checkPassword();
            if (isValid) {
                createAccount();
            }
        });
    }

    private void checkPassword() {
        password = inputPass.getText().toString().trim();
        rePassword = reinputPass.getText().toString().trim();
        if (!password.equals(rePassword)) {
            Toast.makeText(this, "Mật khẩu không khớp, mời nhập lại", Toast.LENGTH_LONG).show();
            inputPass.setText("");
            reinputPass.setText("");
            isValid = false;
        } else if (password.isEmpty()) {
            Toast.makeText(this, "Vui lòng nhập mật khẩu", Toast.LENGTH_LONG).show();
            inputPass.setText("");
            reinputPass.setText("");
            isValid = false;
        } else {
            isValid = true;
        }
    }

    private void createAccount() {
        phone = inputPhone.getText().toString();
        email = inputEmail.getText().toString();
        password = inputPass.getText().toString();

        if (!validateForm()) return;

        progressDialog.setMessage("Đang tạo tài khoản...");
        progressDialog.show();

        mAuth.createUserWithEmailAndPassword(email, password)
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        sendVerificationEmail();
                    } else {
                        Toast.makeText(RegisterActivity.this, "Không thể tạo User.", Toast.LENGTH_SHORT).show();
                        progressDialog.dismiss();
                    }
                });
    }

    private void sendVerificationEmail() {
        FirebaseUser firebaseUser = mAuth.getCurrentUser();
        if (firebaseUser != null) {
            firebaseUser.sendEmailVerification()
                    .addOnCompleteListener(task -> {
                        if (task.isSuccessful()) {
                            Toast.makeText(this, "Đã gửi email xác thực đến " + email, Toast.LENGTH_LONG).show();
                            createUserDocument();
                        } else {
                            Toast.makeText(this, "Gửi email xác thực thất bại.", Toast.LENGTH_SHORT).show();
                        }
                    });
        }
    }

    private void createUserDocument() {
        user = new User();
        user.setEmail(email);
        user.setPhoneNumber(phone);
        user.setUser_id(FirebaseAuth.getInstance().getUid());

        Map<String, Boolean> roleMap = new HashMap<>();
        roleMap.put("customer", true);
        roleMap.put("owner", true);

        user.setRoles(roleMap);
        user.setCurrentRole("customer"); // mặc định ban đầu là customer

        FirebaseFirestoreSettings settings = new FirebaseFirestoreSettings.Builder()
                .build();
        dtbUser.setFirestoreSettings(settings);

        DocumentReference newUserRef = dtbUser.collection("Users")
                .document(FirebaseAuth.getInstance().getUid());

        newUserRef.set(user).addOnCompleteListener(task -> {
            progressDialog.dismiss();
            if (task.isSuccessful()) {
                Toast.makeText(this, "Đăng ký thành công. Vui lòng xác thực Email trước khi đăng nhập.", Toast.LENGTH_LONG).show();
                finish();
            } else {
                View parentLayout = findViewById(android.R.id.content);
                Snackbar.make(parentLayout, "Tạo user Firestore thất bại.", Snackbar.LENGTH_SHORT).show();
            }
        });
    }

    private boolean validateForm() {
        boolean valid = true;
        if (TextUtils.isEmpty(email)) {
            inputEmail.setError("Email bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(password)) {
            inputPass.setError("Mật khẩu bắt buộc.");
            valid = false;
        }
        if (TextUtils.isEmpty(phone)) {
            inputPhone.setError("Số điện thoại bắt buộc.");
            valid = false;
        }
        return valid;
    }
}

```

### Service\UserAuthentication\UpdatePassword.java
```java
package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.AuthCredential;
import com.google.firebase.auth.EmailAuthProvider;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;

public class UpdatePassword extends AppCompatActivity {

    private FirebaseUser user;
    private EditText currentPass, newPass, confirmPass;
    private String current, newPassword, confirmNew;
    private Button btnContinue;
    private Boolean isValid = true;

    private void init()
    {
        currentPass = findViewById(R.id.input_password);
        newPass = findViewById(R.id.input_new_password);
        confirmPass = findViewById(R.id.reinput_new_password);
        btnContinue = findViewById(R.id.btn_continue);

        user = FirebaseAuth.getInstance().getCurrentUser();
    }

    private void getPass()
    {
        current = currentPass.getText().toString();
        newPassword = newPass.getText().toString();
        confirmNew = confirmPass.getText().toString();
        checkPassword();
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_update_password);

        init();

        btnContinue.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                getPass();

                AuthCredential credential = EmailAuthProvider.getCredential(user.getEmail(), current);

                if(isValid)
                {
                    user.reauthenticate(credential)
                        .addOnCompleteListener(new OnCompleteListener<Void>() {
                            @Override
                            public void onComplete(@NonNull Task<Void> task) {
                                if (task.isSuccessful()) {
                                    // Mật khẩu hiện tại đã được xác thực thành công
                                    user.updatePassword(newPassword)
                                            .addOnCompleteListener(new OnCompleteListener<Void>() {
                                                @Override
                                                public void onComplete(@NonNull Task<Void> task) {
                                                    if (task.isSuccessful()) {
                                                        Toast.makeText(UpdatePassword.this, "Thay đổi mật khẩu thành công",Toast.LENGTH_LONG).show();
                                                        finish();
                                                    } else {
                                                        Toast.makeText(UpdatePassword.this, "Đã xảy ra lỗi trong quá trình thay đổi mật khẩu",Toast.LENGTH_LONG).show();
                                                    }
                                                }
                                            });
                                } else {
                                    Toast.makeText(UpdatePassword.this, "Mật khẩu hiện tại không chính xác",Toast.LENGTH_LONG).show();
                                }
                            }
                        });
                }
            }
        });
    }

    private void checkPassword() {

        if (!newPassword.equals(confirmNew))
        {
            Toast.makeText(this,"Mật khẩu không khớp, mời nhập lại",Toast.LENGTH_LONG).show();
            newPass.setText("");
            confirmPass.setText("");
            isValid = false;
        }
        else if(newPassword.isEmpty())
        {
            Toast.makeText(this,"Vui lòng nhập mật khẩu",Toast.LENGTH_LONG).show();
            newPass.setText("");
            confirmPass.setText("");
            isValid = false;
        }
    }
}
```

### Service\UserAuthentication\UserProfile.java
```java
//package com.example.carrenting.Service.UserAuthentication;
//
//import androidx.annotation.NonNull;
//import androidx.appcompat.app.AppCompatActivity;
//
//import android.content.Intent;
//import android.os.Bundle;
//import android.view.View;
//import android.widget.Button;
//import android.widget.ImageView;
//import android.widget.TextView;
//import android.widget.Toast;
//
//import com.example.carrenting.Model.User;
//import com.example.carrenting.R;
//import com.google.android.gms.tasks.OnCompleteListener;
//import com.google.android.gms.tasks.Task;
//import com.google.firebase.auth.FirebaseAuth;
//import com.google.firebase.auth.FirebaseUser;
//import com.google.firebase.firestore.FirebaseFirestore;
//import com.google.firebase.firestore.QueryDocumentSnapshot;
//import com.google.firebase.firestore.QuerySnapshot;
//import com.squareup.picasso.Picasso;
//
//public class UserProfile extends AppCompatActivity {
//
//   private Button btnUpdate;
//   private ImageView imgAvatar, imgFrontCCCD, imgBehindCCCD;
//   private TextView tvPhone, tvEmail, tvName, tvAddress, tvCity, tvBirthday;
//   private FirebaseFirestore dtb_user;
//   private FirebaseUser firebaseUser;
//   private User user = new User();
//
//    @Override
//    protected void onCreate(Bundle savedInstanceState) {
//        super.onCreate(savedInstanceState);
//        setContentView(R.layout.activity_profile_management);
//
//        init();
//        getInfor();
//
//        btnUpdate.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                Intent i = new Intent(UserProfile.this, ProfileManagement.class);
//                startActivity(i);
//            }
//        });
//    }
//
//    private void getInfor() {
//        dtb_user.collection("Users")
//            .whereEqualTo("user_id", user.getUser_id())
//            .get()
//            .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
//                @Override
//                public void onComplete(@NonNull Task<QuerySnapshot> task) {
//                    if (task.isSuccessful()){
//                        for (QueryDocumentSnapshot document : task.getResult()){
//                            tvName.setText(document.get("username").toString());
//                            tvEmail.setText(document.get("email").toString());
//                            tvPhone.setText(document.get("phoneNumber").toString());
//                            tvAddress.setText(document.get("address").toString());
//                            tvCity.setText(document.get("city").toString());
//                            tvBirthday.setText(document.get("birthday").toString());
//                            user.setAvatarURL(document.get("avatarURL").toString());
//
//                            if (!document.get("avatarURL").toString().isEmpty()) {
//                                Picasso.get().load(user.getAvatarURL()).into(imgAvatar);
//                            }
//                            else {
//                                user.setAvatarURL("");
//                            }
//
//                            user.setCiCardFront(document.get("ciCardFront").toString());
//                            if (!document.get("ciCardFront").toString().isEmpty()) {
//                                Picasso.get().load(user.getCiCardFront()).into(imgFrontCCCD);
//                            }
//                            else {
//                                user.setCiCardFront("");
//                            }
//
//                            user.setCiCardBehind(document.get("ciCardBehind").toString());
//                            if (!document.get("ciCardBehind").toString().isEmpty()) {
//                                Picasso.get().load(user.getCiCardBehind()).into(imgBehindCCCD);
//                            }
//                            else {
//                                user.setCiCardBehind("");
//                            }
//
//                        }
//                    }
//                    else {
//                        //
//                        Toast.makeText(UserProfile.this, "Không thể lấy thông tin", Toast.LENGTH_LONG).show();
//                    }
//                }
//            });
//    }
//
//    private void init(){
//        btnUpdate = findViewById(R.id.btn_update);
//
//        imgAvatar = findViewById(R.id.img_avatar);
//        imgFrontCCCD = findViewById(R.id.img_front_CCCD);
//        imgBehindCCCD = findViewById(R.id.img_behind_CCCD);
//
//        tvName = findViewById(R.id.fullname);
//        tvEmail = findViewById(R.id.email);
//        tvPhone = findViewById(R.id.phone);
//        tvAddress = findViewById(R.id.address);
//        tvCity = findViewById(R.id.city);
//        tvBirthday = findViewById(R.id.birthday);
//
//        dtb_user = FirebaseFirestore.getInstance();
//        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
//        user.setUser_id(firebaseUser.getUid());
//    }
//}

package com.uit.carrental.Service.UserAuthentication;

import androidx.appcompat.app.AppCompatActivity;
import android.content.Intent;
import android.os.Bundle;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import com.uit.carrental.Model.User;
import com.uit.carrental.R;
import com.squareup.picasso.Picasso;

public class UserProfile extends AppCompatActivity {

    private Button btnUpdate;
    private ImageView imgAvatar, imgFrontCCCD, imgBehindCCCD;
    private TextView tvPhone, tvEmail, tvName, tvAddress, tvCity, tvBirthday;




    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_profile);

        btnUpdate = findViewById(R.id.btn_update);
        imgAvatar = findViewById(R.id.img_avatar_profile_input_fragment);
        imgFrontCCCD = findViewById(R.id.img_front_CCCD);
        imgBehindCCCD = findViewById(R.id.img_behind_CCCD);

        tvName = findViewById(R.id.profile_input_fullname);
        tvEmail = findViewById(R.id.profile_input_email);
        tvPhone = findViewById(R.id.profile_input_phone);
        tvAddress = findViewById(R.id.profile_input_address);
        tvCity = findViewById(R.id.profile_input_city);
        tvBirthday = findViewById(R.id.tvBirthDate);

        User demoUser = new User();
        demoUser.setUsername("Trương Đức Quang Khoa");
        demoUser.setEmail("khoa.quang@example.com");
        demoUser.setPhoneNumber("+84912345678");
        demoUser.setAddress("123 Đường số 1");
        demoUser.setCity("TP. Hồ Chí Minh");
        demoUser.setBirthday("15/08/2002");
        demoUser.setAvatarURL("https://techie.vn/wp-content/uploads/2023/01/Doge-meme-2-1024x614-1.webp");
        demoUser.setCiCardFront("https://demo.com/front.png");
        demoUser.setCiCardBehind("https://demo.com/back.png");

        tvName.setText(demoUser.getUsername());
        tvEmail.setText(demoUser.getEmail());
        tvPhone.setText(demoUser.getPhoneNumber());
        tvAddress.setText(demoUser.getAddress());
        tvCity.setText(demoUser.getCity());
        tvBirthday.setText(demoUser.getBirthday());

        if (imgAvatar != null) Picasso.get().load(demoUser.getAvatarURL()).into(imgAvatar);
        if (imgFrontCCCD != null) Picasso.get().load(demoUser.getCiCardFront()).into(imgFrontCCCD);
        if (imgBehindCCCD != null) Picasso.get().load(demoUser.getCiCardBehind()).into(imgBehindCCCD);

        btnUpdate.setOnClickListener(view -> {
            startActivity(new Intent(UserProfile.this, ProfileManagement.class));
        });
    }
}


```

### Service\UserAuthentication\ValidatePhoneActivity.java
```java
/**package com.example.carrenting.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.example.carrenting.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.FirebaseException;
import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthOptions;
import com.google.firebase.auth.PhoneAuthProvider;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.FirebaseFirestoreSettings;

import java.util.concurrent.TimeUnit;

public class ValidatePhoneActivity extends AppCompatActivity {

    private EditText otpNumberOne, getOtpNumberTwo, getOtpNumberThree, getOtpNumberFour, getOtpNumberFive, otpNumberSix;
    private Button btnSendCode;
    private TextView tvResend;
    private String mVerificationId;
    PhoneAuthProvider.ForceResendingToken mResendToken;
    String phoneNumber;
    Boolean otpValid = true;
    private FirebaseAuth mAuth;
    FirebaseAuth firebaseAuth;
    private FirebaseFirestore mDb;
    PhoneAuthCredential phoneAuthCredential;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_validate_phone);

        initUI();
        Intent data = getIntent();
        phoneNumber = data.getStringExtra("phone");

        firebaseAuth = FirebaseAuth.getInstance();
        mAuth = FirebaseAuth.getInstance();
        mDb = FirebaseFirestore.getInstance();

        if (phoneNumber.startsWith("0")) {
            phoneNumber = "+84" + phoneNumber.substring(1, phoneNumber.length());
        }
        Log.wtf("Phone Number", "Phone number is : " + phoneNumber);
        btnSendCode.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                validateField(otpNumberOne);
                validateField(getOtpNumberTwo);
                validateField(getOtpNumberThree);
                validateField(getOtpNumberFour);
                validateField(getOtpNumberFive);
                validateField(otpNumberSix);

                if(otpValid) {
                    // send otp to the user
                    String otp = otpNumberOne.getText().toString() + getOtpNumberTwo.getText().toString() + getOtpNumberThree.getText().toString() + getOtpNumberFour.getText().toString() + getOtpNumberFive.getText().toString() + otpNumberSix.getText().toString();

                    PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, otp);

                    verifyAuthentication(credential);

                    FirebaseFirestoreSettings settings = new FirebaseFirestoreSettings.Builder()
                            .build();
                    mDb.setFirestoreSettings(settings);
                    DocumentReference newUserRef = mDb
                            .collection(getString(R.string.collection_users))
                            .document(FirebaseAuth.getInstance().getUid());

                    newUserRef.update("phoneNumber", phoneNumber).addOnCompleteListener(new OnCompleteListener<Void>() {
                        @Override
                        public void onComplete(@NonNull Task<Void> task) {
                            if(task.isSuccessful()){


                                //Toast.makeText(ValidatePhoneActivity.this, "Update phone number successful", Toast.LENGTH_LONG).show();

                                Intent intent = new Intent(ValidatePhoneActivity.this, CCCDActivity.class);
                                startActivity(intent);
                            }
                        }
                    });
                }
            }
        });


        SendOtpCode(phoneNumber);

        tvResend.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                ReSendOtpCode(phoneNumber);
          }

        });

    }

    private void VerifyPhoneNumber(String phoneNumber){
        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)
                .setPhoneNumber(phoneNumber)
                .setTimeout(15L, TimeUnit.SECONDS)
                .setActivity(this)
                .setCallbacks(new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                    @Override
                    public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
                        verifyAuthentication(phoneAuthCredential);
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onVerificationFailed(@NonNull FirebaseException e) {
                        Toast.makeText(ValidatePhoneActivity.this, "OTP Verification Failed.", Toast.LENGTH_SHORT).show();
                    }
                    @Override
                    public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
                        super.onCodeSent(verificationId, forceResendingToken);
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                        mVerificationId = verificationId;
                        mResendToken = forceResendingToken;
                        tvResend.setVisibility(View.GONE);

                    }
                    @Override
                    public void onCodeAutoRetrievalTimeOut(@NonNull String s) {
                        super.onCodeAutoRetrievalTimeOut(s);
                        tvResend.setVisibility(View.VISIBLE);
                    }
                })
                .build();
        PhoneAuthProvider.verifyPhoneNumber(options);
    }
    private void ReSendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    private void SendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }
    public void verifyAuthentication(PhoneAuthCredential credential){
        firebaseAuth.getCurrentUser()
                .linkWithCredential(credential)
                .addOnSuccessListener(new OnSuccessListener<AuthResult>() {
            @Override
            public void onSuccess(AuthResult authResult) {
                // send to dashboard.
                Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
            }
        });
    }

    public void validateField(EditText field){
        if(field.getText().toString().isEmpty()){
            field.setError("Cần nhập OTP");
            otpValid = false;
        }else {
            otpValid = true;
        }
    }
    private void initUI() {
        otpNumberOne = findViewById(R.id.otpNumberOne);
        getOtpNumberTwo = findViewById(R.id.otpNumberTwo);
        getOtpNumberThree = findViewById(R.id.otpNumberThree);
        getOtpNumberFour = findViewById(R.id.otpNumberFour);
        getOtpNumberFive = findViewById(R.id.otpNumberFive);
        otpNumberSix = findViewById(R.id.optNumberSix);
        btnSendCode = findViewById(R.id.btn_signup);
        tvResend = findViewById(R.id.tvResend);
    }
}
**/

package com.uit.carrental.Service.UserAuthentication;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.uit.carrental.R;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.firebase.FirebaseException;
import com.google.firebase.auth.AuthResult;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.PhoneAuthCredential;
import com.google.firebase.auth.PhoneAuthOptions;
import com.google.firebase.auth.PhoneAuthProvider;
import com.google.firebase.firestore.FirebaseFirestore;

import java.util.concurrent.TimeUnit;

public class ValidatePhoneActivity extends AppCompatActivity {

    private EditText otpNumberOne, getOtpNumberTwo, getOtpNumberThree, getOtpNumberFour, getOtpNumberFive, otpNumberSix;
    private Button btnSendCode;
    private TextView tvResend;
    private String mVerificationId;
    PhoneAuthProvider.ForceResendingToken mResendToken;
    String phoneNumber;
    Boolean otpValid = true;
    private FirebaseAuth mAuth;
    FirebaseAuth firebaseAuth;
    private FirebaseFirestore mDb;
    PhoneAuthCredential phoneAuthCredential;

    boolean bypassTestMode = false; // Dùng để bỏ qua xác thực OTP khi cần test

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_validate_phone);

        initUI();
        Intent data = getIntent();
        phoneNumber = data.getStringExtra("phone");

        firebaseAuth = FirebaseAuth.getInstance();
        mAuth = FirebaseAuth.getInstance();
        mDb = FirebaseFirestore.getInstance();

        if (phoneNumber.startsWith("0")) {
            phoneNumber = "+84" + phoneNumber.substring(1);
        }

        if (phoneNumber.equals("+84965853014")) {
            bypassTestMode = true;
            Toast.makeText(this, "Test mode enabled, skipping OTP", Toast.LENGTH_SHORT).show();

            mDb.collection(getString(R.string.collection_users))
                    .document(FirebaseAuth.getInstance().getUid())
                    .update("phoneNumber", phoneNumber)
                    .addOnCompleteListener(task -> {
                        if (task.isSuccessful()) {
                            startActivity(new Intent(this, CCCDActivity.class));
                            finish();
                        }
                    });
            return;
        }

        SendOtpCode(phoneNumber);

        btnSendCode.setOnClickListener(view -> {
            if (bypassTestMode) return;

            validateField(otpNumberOne);
            validateField(getOtpNumberTwo);
            validateField(getOtpNumberThree);
            validateField(getOtpNumberFour);
            validateField(getOtpNumberFive);
            validateField(otpNumberSix);

            if (otpValid) {
                String otp = otpNumberOne.getText().toString()
                        + getOtpNumberTwo.getText().toString()
                        + getOtpNumberThree.getText().toString()
                        + getOtpNumberFour.getText().toString()
                        + getOtpNumberFive.getText().toString()
                        + otpNumberSix.getText().toString();

                if (mVerificationId == null || otp.isEmpty()) {
                    Toast.makeText(this, "Không thể tạo PhoneAuthCredential: thiếu mã OTP.", Toast.LENGTH_SHORT).show();
                    return;
                }

                PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, otp);
                verifyAuthentication(credential);

                mDb.collection(getString(R.string.collection_users))
                        .document(FirebaseAuth.getInstance().getUid())
                        .update("phoneNumber", phoneNumber)
                        .addOnCompleteListener(task -> {
                            if (task.isSuccessful()) {
                                startActivity(new Intent(this, CCCDActivity.class));
                            }
                        });
            }
        });

        tvResend.setOnClickListener(view -> ReSendOtpCode(phoneNumber));
    }

    private void VerifyPhoneNumber(String phoneNumber){
        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)
                .setPhoneNumber(phoneNumber)
                .setTimeout(15L, TimeUnit.SECONDS)
                .setActivity(this)
                .setCallbacks(new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
                    @Override
                    public void onVerificationCompleted(@NonNull PhoneAuthCredential phoneAuthCredential) {
                        verifyAuthentication(phoneAuthCredential);
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onVerificationFailed(@NonNull FirebaseException e) {
                        Toast.makeText(ValidatePhoneActivity.this, "OTP Verification Failed.", Toast.LENGTH_SHORT).show();
                    }
                    @Override
                    public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken forceResendingToken) {
                        super.onCodeSent(verificationId, forceResendingToken);
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                        mVerificationId = verificationId;
                        mResendToken = forceResendingToken;
                        tvResend.setVisibility(View.GONE);
                    }
                    @Override
                    public void onCodeAutoRetrievalTimeOut(@NonNull String s) {
                        super.onCodeAutoRetrievalTimeOut(s);
                        tvResend.setVisibility(View.VISIBLE);
                    }
                })
                .build();
        PhoneAuthProvider.verifyPhoneNumber(options);
    }

    private void ReSendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    private void SendOtpCode(String phoneNumber) {
        VerifyPhoneNumber(phoneNumber);
    }

    public void verifyAuthentication(PhoneAuthCredential credential){
        firebaseAuth.getCurrentUser()
                .linkWithCredential(credential)
                .addOnSuccessListener(new OnSuccessListener<AuthResult>() {
                    @Override
                    public void onSuccess(AuthResult authResult) {
                        Toast.makeText(ValidatePhoneActivity.this, "Đã gửi OTP xác thực", Toast.LENGTH_SHORT).show();
                    }
                });
    }

    public void validateField(EditText field){
        if(field.getText().toString().isEmpty()){
            field.setError("Cần nhập OTP");
            otpValid = false;
        }else {
            otpValid = true;
        }
    }

    private void initUI() {
        otpNumberOne = findViewById(R.id.otpNumberOne);
        getOtpNumberTwo = findViewById(R.id.otpNumberTwo);
        getOtpNumberThree = findViewById(R.id.otpNumberThree);
        getOtpNumberFour = findViewById(R.id.otpNumberFour);
        getOtpNumberFive = findViewById(R.id.otpNumberFive);
        otpNumberSix = findViewById(R.id.optNumberSix);
        btnSendCode = findViewById(R.id.btn_signup);
        tvResend = findViewById(R.id.tvResend);
    }
}
```

### Service\Vehicle\AddVehicleActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.ProgressDialog;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.Toast;

import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.firestore.DocumentReference;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.uit.carrental.ActivityPages.OwnerMainActivity;
import com.uit.carrental.Model.User;
import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Api.CloudinaryApi;

import java.util.HashMap;
import java.util.Map;

public class AddVehicleActivity extends AppCompatActivity {

    private FirebaseUser firebaseUser;
    private String documentId, downloadUrl;
    private Uri mImageURI;
    private EditText vehicle_name, vehicle_seats, vehicle_price, vehicle_owner, vehicle_number;
    private Button btnAdd;
    private ImageView vehicle_imgView;
    private FirebaseFirestore dtb_vehicle, dtb_user, dtb_update;
    private User user = new User();
    private Vehicle vehicle = new Vehicle();
    private ProgressDialog progressDialog;

    ActivityResultLauncher<String> pickImagesFromGallery = registerForActivityResult(
            new ActivityResultContracts.GetContent(),
            result -> {
                if (result != null) {
                    mImageURI = result;
                    vehicle_imgView.setImageURI(result);
                }
            });

    private void init() {
        vehicle_name = findViewById(R.id.et_name);
        vehicle_seats = findViewById(R.id.et_seats);
        vehicle_price = findViewById(R.id.et_price);
        vehicle_owner = findViewById(R.id.et_owner);
        vehicle_number = findViewById(R.id.et_number);
        vehicle_imgView = findViewById(R.id.img_view);
        btnAdd = findViewById(R.id.btn_add);

        dtb_vehicle = FirebaseFirestore.getInstance();
        dtb_user = FirebaseFirestore.getInstance();
        dtb_update = FirebaseFirestore.getInstance();
        firebaseUser = FirebaseAuth.getInstance().getCurrentUser();
        user.setUser_id(firebaseUser.getUid());
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_add_vehicle);
        if (getSupportActionBar() != null) getSupportActionBar().hide();

        init();

        btnAdd.setOnClickListener(view -> {
            if (FullFill()) {
                if (mImageURI != null) {
                    uploadImageAndAddVehicle();
                } else {
                    toast("Vui lòng chọn hình ảnh cho xe.");
                }
            } else {
                toast("Vui lòng nhập đủ thông tin.");
            }
        });

        vehicle_imgView.setOnClickListener(v -> pickImagesFromGallery.launch("image/*"));
    }

    private void uploadImageAndAddVehicle() {
        progressDialog = ProgressDialog.show(this, "Uploading Image", "Please wait...", true);

        CloudinaryApi.uploadImage(this, mImageURI, new CloudinaryApi.UploadCallbackCustom() {
            @Override
            public void onSuccess(String url) {
                downloadUrl = url;
                progressDialog.dismiss();
                addVehicle(); // Chỉ add vehicle khi upload xong
            }

            @Override
            public void onFailure(Exception e) {
                progressDialog.dismiss();
                toast("Lỗi tải ảnh: " + e.getMessage());
            }
        });
    }

    private void addVehicle() {
        dtb_user.collection("Users")
                .whereEqualTo("user_id", user.getUser_id())
                .get()
                .addOnCompleteListener(task -> {
                    if (task.isSuccessful()) {
                        for (QueryDocumentSnapshot document : task.getResult()) {
                            vehicle.setProvider_id(document.get("user_id").toString());
                            vehicle.setProvider_name(document.get("username").toString());
                            vehicle.setProvider_address(document.get("address").toString() + " " + document.get("city").toString());
                            vehicle.setProvider_gmail(document.get("email").toString());
                            vehicle.setProvider_phone(document.get("phoneNumber").toString());

                            vehicle.setVehicle_name(vehicle_name.getText().toString());
                            vehicle.setVehicle_seats(vehicle_seats.getText().toString());
                            vehicle.setVehicle_price(vehicle_price.getText().toString() + " VND");
                            vehicle.setOwner_name(vehicle_owner.getText().toString());
                            vehicle.setVehicle_number(vehicle_number.getText().toString());
                            vehicle.setVehicle_availability("available");
                            vehicle.setVehicle_imageURL(downloadUrl);

                            dtb_vehicle.collection("Vehicles")
                                    .add(vehicle)
                                    .addOnSuccessListener(documentReference -> {
                                        vehicle.setVehicle_id(documentReference.getId());
                                        updateVehicleId(vehicle.getVehicle_id());
                                        startActivity(new Intent(AddVehicleActivity.this, OwnerMainActivity.class));
                                        finish();
                                        toast("Thêm xe thành công");
                                    })
                                    .addOnFailureListener(e -> toast("Thêm xe thất bại"));
                        }
                    } else {
                        toast("Không thể lấy thông tin người dùng");
                    }
                });
    }

    private void updateVehicleId(String vehicle_id) {
        Map<String, Object> data = new HashMap<>();
        data.put("vehicle_id", vehicle_id);

        dtb_update.collection("Vehicles").document(vehicle_id)
                .update(data)
                .addOnSuccessListener(aVoid -> toast("Cập nhật thành công"))
                .addOnFailureListener(e -> toast("Cập nhật thất bại"));
    }

    private boolean FullFill() {
        return !vehicle_name.getText().toString().isEmpty()
                && !vehicle_owner.getText().toString().isEmpty()
                && !vehicle_number.getText().toString().isEmpty()
                && !vehicle_price.getText().toString().isEmpty()
                && !vehicle_seats.getText().toString().isEmpty();
    }

    private void toast(String txt) {
        Toast.makeText(getApplicationContext(), txt, Toast.LENGTH_LONG).show();
    }
}

```

### Service\Vehicle\UpdateVehicle.java
```java
package com.uit.carrental.Service.Vehicle;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.OnFailureListener;
import com.google.android.gms.tasks.OnSuccessListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.firestore.SetOptions;
import com.squareup.picasso.Picasso;

import java.util.HashMap;
import java.util.Map;

public class UpdateVehicle extends AppCompatActivity {

    private ImageView vehicleImage;
    private TextView vehicleName, vehiclePrice, vehicleNumber, vehicleSeats, vehicleOwner;
    private Button btnUpdate, btnDelete;

    private String vehicleID;

    private FirebaseFirestore dtb_vehicle;
    private Vehicle vehicle = new Vehicle();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_update_vehicle);

        Intent intent = getIntent();
        vehicleID = intent.getStringExtra("vehicle_id");
        vehicle.setVehicle_id(vehicleID);

        init();

        getDetail();

        btnUpdate.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                update();
            }
        });
        btnDelete.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                delete();
            }
        });

    }
    private void init()
    {
        btnUpdate = findViewById(R.id.btn_updatevehicle);
        btnDelete = findViewById(R.id.btn_deletevehicle);
// -------------------------------------------------
        vehicleName = findViewById(R.id.et_vehiclename);
        vehicleNumber = findViewById(R.id.et_platenumber);
        vehicleSeats = findViewById(R.id.et_vehicleseats);
        vehiclePrice = findViewById(R.id.et_vehicleprice);
        vehicleOwner = findViewById(R.id.et_vehicleowner);
//--------------------------------------------------
        vehicleImage = findViewById(R.id.img_view);
//--------------------------------------------------
        dtb_vehicle = FirebaseFirestore.getInstance();
        vehicleName.setEnabled(false);
    }
    private void getDetail() {
        dtb_vehicle.collection("Vehicles")
                .whereEqualTo("vehicle_id", vehicle.getVehicle_id())
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {

                                vehicle.setProvider_id(document.get("provider_id").toString());
                                vehicle.setVehicle_id(document.get("vehicle_id").toString());
                                vehicle.setVehicle_availability(document.get("vehicle_availability").toString());

                                vehicle.setVehicle_name(document.get("vehicle_name").toString());
                                vehicleName.setText(vehicle.getVehicle_name());

                                vehicle.setVehicle_price(document.get("vehicle_price").toString());
                                vehiclePrice.setText(vehicle.getVehicle_price());

                                vehicle.setVehicle_seats(document.get("vehicle_seats").toString());
                                vehicleSeats.setText(vehicle.getVehicle_seats());

                                vehicle.setOwner_name(document.get("owner_name").toString());
                                vehicleOwner.setText(vehicle.getOwner_name());

                                vehicle.setVehicle_number(document.get("vehicle_number").toString());
                                vehicleNumber.setText(vehicle.getVehicle_number());

                                vehicle.setVehicle_imageURL(document.get("vehicle_imageURL").toString());

                                if (!document.get("vehicle_imageURL").toString().isEmpty()) {
                                    vehicle.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                    Picasso.get().load(vehicle.getVehicle_imageURL()).into(vehicleImage);
                                }
                                else {
                                    vehicle.setVehicle_imageURL("");
                                }

                            }

                        }
                    }
                });
    }
    private void update(){
        Map<String, Object> data = new HashMap<>();
        Boolean flag = false;
        String platenumber = vehicleNumber.getText().toString();
        String seats = vehicleSeats.getText().toString();
        String price = vehiclePrice.getText().toString();
        String ownername = vehicleOwner.getText().toString();

        if (!platenumber.equals(vehicle.getVehicle_number())){
            data.put("vehicle_number",platenumber);
            flag = true;
        }
        if (!seats.equals(vehicle.getVehicle_seats())){
            data.put("vehicle_seats", seats);
            flag = true;
        }
        if (!price.equals(vehicle.getVehicle_price())){
            data.put("vehicle_price", price);
            flag = true;
        }
        if (!ownername.equals(vehicle.getOwner_name())){
            data.put("owner_name", ownername);
            flag = true;
        }
        if (flag) {
            dtb_vehicle.collection("Vehicles")
                    .document(vehicleID)
                    .set(data, SetOptions.merge())
                    .addOnFailureListener(new OnFailureListener() {
                        @Override
                        public void onFailure(@NonNull Exception e) {
                            Toast.makeText(UpdateVehicle.this, "Không thể cập nhật thông tin", Toast.LENGTH_LONG).show();
                            return;
                        }
                    })
                    .addOnSuccessListener(new OnSuccessListener<Void>() {
                        @Override
                        public void onSuccess(Void unused) {
                            Toast.makeText(UpdateVehicle.this, "Câp nhật thông tin thành công", Toast.LENGTH_LONG).show();
                            finish();
                        }
                    });
        }
    }
    private void delete(){
        dtb_vehicle.collection("Vehicles")
                .document(vehicleID)
                .delete()
                .addOnSuccessListener(new OnSuccessListener<Void>() {
                    @Override
                    public void onSuccess(Void aVoid) {
                        Log.d("Delete Vehicle", "Xóa xe thành công");
                        Toast.makeText(UpdateVehicle.this, "Xóa xe thành công", Toast.LENGTH_LONG).show();
                    }
                })
                .addOnFailureListener(new OnFailureListener() {
                    @Override
                    public void onFailure(@NonNull Exception e) {
                        Log.w("Delete Vehicle", "Không thể xóa xe", e);
                        Toast.makeText(UpdateVehicle.this, "Không thể xóa xe", Toast.LENGTH_LONG).show();
                    }
                });
    }
}
```

### Service\Vehicle\VehicleCardActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.google.firebase.storage.FirebaseStorage;
import com.google.firebase.storage.StorageReference;
import com.squareup.picasso.Picasso;

public class VehicleCardActivity extends AppCompatActivity {

    FirebaseFirestore dtb;
    String id;
    private ImageView imgCar;
    private VehicleCardActivity mMainActivity = this;
    private FirebaseStorage storage;
    TextView vehicle_name, vehicle_price;

    Vehicle temp = new Vehicle();

    @Override
    protected void onCreate(Bundle savedInstanceState) {

        super.onCreate(savedInstanceState);
        setContentView(R.layout.vehicle_card);

        StorageReference storageRef = storage.getReference();


        vehicle_name = findViewById(R.id.vehicle_name);
        vehicle_price = findViewById(R.id.tv_vehicle_price);
        imgCar = findViewById(R.id.img_vehicle);

        dtb = FirebaseFirestore.getInstance();
        dtb.collection("Vehicles")
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()) {
                            for (QueryDocumentSnapshot document : task.getResult()) {
                                temp.setVehicle_id(document.getId());
                                temp.setVehicle_name(document.get("vehicle_name").toString());
                                temp.setVehicle_price(document.get("vehicle_price").toString());
                                temp.setVehicle_imageURL(document.get("imageURL").toString());

                                Picasso.get().load(temp.getVehicle_imageURL()).into(imgCar);

                                vehicle_name.setText(temp.getVehicle_name());
                                vehicle_price.setText(temp.getVehicle_price());

                            }
                        } else {
                            Toast.makeText(VehicleCardActivity.this, "Error getting documents ", Toast.LENGTH_LONG).show();
                        }
                    }
                });

    }
}
```

### Service\Vehicle\VehicleDetailActivity.java
```java
package com.uit.carrental.Service.Vehicle;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;

import com.uit.carrental.Model.Vehicle;
import com.uit.carrental.R;
import com.uit.carrental.Service.Booking.ScheduleSelect;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;
import com.google.firebase.firestore.FirebaseFirestore;
import com.google.firebase.firestore.QueryDocumentSnapshot;
import com.google.firebase.firestore.QuerySnapshot;
import com.squareup.picasso.Picasso;

public class VehicleDetailActivity extends AppCompatActivity {

    private ImageView vehicleImage;
    private TextView providerName, providerGmail, providerPhone, providerAddress;
    private TextView vehicleName, vehiclePrice, vehicleNumber, vehicleSeats, vehicleOwner;
    private Button btnBook;
    private String vehicleID;
    private FirebaseFirestore dtb_vehicle;
    private Vehicle vehicle = new Vehicle();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_detail_car);

        Intent intent = getIntent();
        vehicleID = intent.getStringExtra("vehicle_id");
        vehicle.setVehicle_id(vehicleID);

        init();

        getDetail();

        FirebaseFirestore dtb = FirebaseFirestore.getInstance();
        btnBook.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent i = new Intent(VehicleDetailActivity.this, ScheduleSelect.class);
                i.putExtra("vehicle_id", vehicleID);
                startActivity(i);
            }
        });

    }

    private void init()
    {
        btnBook = findViewById(R.id.btn_book);

        vehicleImage = findViewById(R.id.vehicle_img);
        providerName = findViewById(R.id.tv_provider_name);
        providerGmail = findViewById(R.id.tv_provider_gmail);
        providerAddress = findViewById(R.id.tv_provider_address);
        providerPhone = findViewById(R.id.tv_provider_phone);

        vehicleName = findViewById(R.id.tv_vehicle_name);
        vehicleNumber = findViewById(R.id.tv_vehicle_number);
        vehicleSeats = findViewById(R.id.tv_vehicle_seats);
        vehiclePrice = findViewById(R.id.tv_vehicle_price);
        vehicleOwner = findViewById(R.id.tv_vehicle_owner);

        dtb_vehicle = FirebaseFirestore.getInstance();
    }

    private void getDetail() {
        dtb_vehicle.collection("Vehicles")
                .whereEqualTo("vehicle_id", vehicle.getVehicle_id())
                .get()
                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {
                    @Override
                    public void onComplete(@NonNull Task<QuerySnapshot> task) {
                        if (task.isSuccessful()){
                            for (QueryDocumentSnapshot document : task.getResult()){

                                vehicle.setProvider_id(document.get("provider_id").toString());
                                vehicle.setVehicle_id(document.get("vehicle_id").toString());
                                vehicle.setVehicle_availability(document.get("vehicle_availability").toString());

                                vehicle.setProvider_name(document.get("provider_name").toString());
                                providerName.setText(vehicle.getProvider_name());

                                vehicle.setProvider_phone(document.get("provider_phone").toString());
                                providerPhone.setText(vehicle.getProvider_phone());

                                vehicle.setProvider_address(document.get("provider_address").toString());
                                providerAddress.setText(vehicle.getProvider_address());

                                vehicle.setProvider_gmail(document.get("provider_gmail").toString());
                                providerGmail.setText(vehicle.getProvider_gmail());

                                vehicle.setVehicle_name(document.get("vehicle_name").toString());
                                vehicleName.setText(vehicle.getVehicle_name());

                                vehicle.setVehicle_price(document.get("vehicle_price").toString());
                                vehiclePrice.setText(vehicle.getVehicle_price());

                                vehicle.setVehicle_seats(document.get("vehicle_seats").toString());
                                vehicleSeats.setText(vehicle.getVehicle_seats());

                                vehicle.setOwner_name(document.get("owner_name").toString());
                                vehicleOwner.setText(vehicle.getOwner_name());

                                vehicle.setVehicle_number(document.get("vehicle_number").toString());
                                vehicleNumber.setText(vehicle.getVehicle_number());

                                if (!document.get("vehicle_imageURL").toString().isEmpty()) {
                                    vehicle.setVehicle_imageURL(document.get("vehicle_imageURL").toString());
                                    Picasso.get().load(vehicle.getVehicle_imageURL()).into(vehicleImage);
                                }
                                else {
                                    vehicle.setVehicle_imageURL("");
                                }

                            }

                        }
                    }
                });

    }
}
```

### Service\ZaloPay\Api\CreateOrder.java
```java
package com.uit.carrental.Service.ZaloPay.Api;

import com.uit.carrental.Service.ZaloPay.Constant.AppInfo;
import com.uit.carrental.Service.ZaloPay.Helper.Helpers;

import org.json.JSONObject;

import java.util.Date;

import okhttp3.FormBody;
import okhttp3.RequestBody;

public class CreateOrder {
    private class CreateOrderData {
        String AppId;
        String AppUser;
        String AppTime;
        String Amount;
        String AppTransId;
        String EmbedData;
        String Items;
        String BankCode;
        String Description;
        String Mac;

        private CreateOrderData(String amount) throws Exception {
            long appTime = new Date().getTime();
            AppId = String.valueOf(AppInfo.APP_ID);
            AppUser = "Android_Demo";
            AppTime = String.valueOf(appTime);
            Amount = amount;
            AppTransId = Helpers.getAppTransId();
            EmbedData = "{}";
            Items = "[]";
            BankCode = "zalopayapp";
            Description = "Merchant pay for order #" + Helpers.getAppTransId();
            String inputHMac = String.format("%s|%s|%s|%s|%s|%s|%s",
                    this.AppId,
                    this.AppTransId,
                    this.AppUser,
                    this.Amount,
                    this.AppTime,
                    this.EmbedData,
                    this.Items);

            Mac = Helpers.getMac(AppInfo.MAC_KEY, inputHMac);
        }
    }

     public JSONObject createOrder(String amount) throws Exception {
        CreateOrderData input = new CreateOrderData(amount);

        RequestBody formBody = new FormBody.Builder()
                .add("appid", input.AppId)
                .add("appuser", input.AppUser)
                .add("apptime", input.AppTime)
                .add("amount", input.Amount)
                .add("apptransid", input.AppTransId)
                .add("embeddata", input.EmbedData)
                .add("item", input.Items)
                .add("bankcode", input.BankCode)
                .add("description", input.Description)
                .add("mac", input.Mac)
                .build();

        JSONObject data = HttpProvider.sendPost(AppInfo.URL_CREATE_ORDER, formBody);
        return data;
    }
}


```

### Service\ZaloPay\Api\HttpProvider.java
```java
package com.uit.carrental.Service.ZaloPay.Api;

import android.util.Log;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.Collections;
import java.util.concurrent.TimeUnit;

import okhttp3.CipherSuite;
import okhttp3.ConnectionSpec;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;
import okhttp3.TlsVersion;

public class HttpProvider {
     public static JSONObject sendPost(String URL, RequestBody formBody) {
        JSONObject data = new JSONObject();
        try {
            ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
                    .tlsVersions(TlsVersion.TLS_1_2)
                    .cipherSuites(
                            CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
                            CipherSuite.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
                            CipherSuite.TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)
                    .build();

            OkHttpClient client = new OkHttpClient.Builder()
                    .connectionSpecs(Collections.singletonList(spec))
                    .callTimeout(5000, TimeUnit.MILLISECONDS)
                    .build();

            Request request = new Request.Builder()
                    .url(URL)
                    .addHeader("Content-Type", "application/x-www-form-urlencoded")
                    .post(formBody)
                    .build();

            Response response = client.newCall(request).execute();

            if (!response.isSuccessful()) {
                Log.println(Log.ERROR, "BAD_REQUEST", response.body().string());
                data = null;
            } else {
                data = new JSONObject(response.body().string());
            }

        }  catch (IOException | JSONException e) {
            e.printStackTrace();
        }

        return data;
    }
}

```

### Service\ZaloPay\Constant\AppInfo.java
```java
package com.uit.carrental.Service.ZaloPay.Constant;

public class AppInfo {
    public static final int APP_ID = 553;
    public static final String MAC_KEY = "9phuAOYhan4urywHTh0ndEXiV3pKHr5Q";
    public static final String URL_CREATE_ORDER = "https://sandbox.zalopay.com.vn/v001/tpe/createorder";
}

```

### Service\ZaloPay\Helper\Helpers.java
```java
package com.uit.carrental.Service.ZaloPay.Helper;

import android.annotation.SuppressLint;

import com.uit.carrental.Service.ZaloPay.Helper.HMac.HMacUtil;

import org.jetbrains.annotations.NotNull;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Objects;

public class Helpers {
    private static int transIdDefault = 1;

    @NotNull
    @SuppressLint("DefaultLocale")
     public static String getAppTransId() {
        if (transIdDefault >= 100000) {
            transIdDefault = 1;
        }

        transIdDefault += 1;
        @SuppressLint("SimpleDateFormat") SimpleDateFormat formatDateTime = new SimpleDateFormat("yyMMdd_hhmmss");
        String timeString = formatDateTime.format(new Date());
        return String.format("%s%06d", timeString, transIdDefault);
    }

    @NotNull
    public static String getMac(@NotNull String key, @NotNull String data) throws NoSuchAlgorithmException, InvalidKeyException {
        return Objects.requireNonNull(HMacUtil.HMacHexStringEncode(HMacUtil.HMACSHA256, key, data));
     }
}

```

### Service\ZaloPay\Helper\HMac\HexStringUtil.java
```java
package com.uit.carrental.Service.ZaloPay.Helper.HMac;

import java.util.Locale;

public class HexStringUtil {
    private static final byte[] HEX_CHAR_TABLE = {
            (byte) '0', (byte) '1', (byte) '2', (byte) '3',
            (byte) '4', (byte) '5', (byte) '6', (byte) '7',
            (byte) '8', (byte) '9', (byte) 'a', (byte) 'b',
            (byte) 'c', (byte) 'd', (byte) 'e', (byte) 'f'
    };
    // @formatter:on

    /**
     * Convert a byte array to a hexadecimal string
     *
     * @param raw
     *            A raw byte array
     *
     * @return Hexadecimal string
     */
    public static String byteArrayToHexString(byte[] raw) {
        byte[] hex = new byte[2 * raw.length];
        int index = 0;

        for (byte b : raw) {
            int v = b & 0xFF;
            hex[index++] = HEX_CHAR_TABLE[v >>> 4];
            hex[index++] = HEX_CHAR_TABLE[v & 0xF];
        }
        return new String(hex);
    }

    /**
     * Convert a hexadecimal string to a byte array
     *
     * @param hex
     *            A hexadecimal string
     *
     * @return The byte array
     */
    public static byte[] hexStringToByteArray(String hex) {
        String hexstandard = hex.toLowerCase(Locale.ENGLISH);
        int sz = hexstandard.length() / 2;
        byte[] bytesResult = new byte[sz];

        int idx = 0;
        for (int i = 0; i < sz; i++) {
            bytesResult[i] = (byte) (hexstandard.charAt(idx));
            ++idx;
            byte tmp = (byte) (hexstandard.charAt(idx));
            ++idx;

            if (bytesResult[i] > HEX_CHAR_TABLE[9]) {
                bytesResult[i] -= ((byte) ('a') - 10);
            } else {
                bytesResult[i] -= (byte) ('0');
            }
            if (tmp > HEX_CHAR_TABLE[9]) {
                tmp -= ((byte) ('a') - 10);
            } else {
                tmp -= (byte) ('0');
            }

            bytesResult[i] = (byte) (bytesResult[i] * 16 + tmp);
        }
        return bytesResult;
    }
}

```

### Service\ZaloPay\Helper\HMac\HMacUtil.java
```java
package com.uit.carrental.Service.ZaloPay.Helper.HMac;

import android.os.Build;

import androidx.annotation.RequiresApi;

import java.io.UnsupportedEncodingException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.Base64;
import java.util.LinkedList;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class HMacUtil {
    public final static String HMACMD5 = "HmacMD5";
    public final static String HMACSHA1 = "HmacSHA1";
    public final static String HMACSHA256 = "HmacSHA256";
    public final static String HMACSHA512 = "HmacSHA512";
    public final static Charset UTF8CHARSET = StandardCharsets.UTF_8;

    public final static LinkedList<String> HMACS = new LinkedList<String>(Arrays.asList("UnSupport", "HmacSHA256", "HmacMD5", "HmacSHA384", "HMacSHA1", "HmacSHA512"));
    // @formatter:on

    private static byte[] HMacEncode(final String algorithm, final String key, final String data) {
        Mac macGenerator = null;
        try {
            macGenerator = Mac.getInstance(algorithm);
            SecretKeySpec signingKey = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), algorithm);
            macGenerator.init(signingKey);
        } catch (Exception ex) {
        }

        if (macGenerator == null) {
            return null;
        }

        byte[] dataByte = null;
        try {
            dataByte = data.getBytes("UTF-8");
        } catch (UnsupportedEncodingException e) {
        }

        return macGenerator.doFinal(dataByte);
    }

    /**
     * Calculating a message authentication code (MAC) involving a cryptographic
     * hash function in combination with a secret cryptographic key.
     *
     * The result will be represented base64-encoded string.
     *
     * @param algorithm A cryptographic hash function (such as MD5 or SHA-1)
     *
     * @param key A secret cryptographic key
     *
     * @param data The message to be authenticated
     *
     * @return Base64-encoded HMAC String
     */
    @RequiresApi(api = Build.VERSION_CODES.O)
    public static String HMacBase64Encode(final String algorithm, final String key, final String data) {
        byte[] hmacEncodeBytes = HMacEncode(algorithm, key, data);
        if (hmacEncodeBytes == null) {
            return null;
        }
        return Base64.getEncoder().encodeToString(hmacEncodeBytes);
    }

    /**
     * Calculating a message authentication code (MAC) involving a cryptographic
     * hash function in combination with a secret cryptographic key.
     *
     * The result will be represented hex string.
     *
     * @param algorithm A cryptographic hash function (such as MD5 or SHA-1)
     *
     * @param key A secret cryptographic key
     *
     * @param data The message to be authenticated
     *
     * @return Hex HMAC String
     */
    public static String HMacHexStringEncode(final String algorithm, final String key, final String data) {
        byte[] hmacEncodeBytes = HMacEncode(algorithm, key, data);
        if (hmacEncodeBytes == null) {
            return null;
        }
        return HexStringUtil.byteArrayToHexString(hmacEncodeBytes);
    }
}

```
